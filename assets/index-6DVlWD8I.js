var F1=Object.defineProperty;var O1=(t,e,n)=>e in t?F1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var _c=(t,e,n)=>O1(t,typeof e!="symbol"?e+"":e,n);import{r as j,j as c,p as V1,u as xh,C as B1,O as U1,P as $1,a as H1,e as Je,b as W1,d as X1,B as G1,E as Y1,L as te,T as jt,R as z1}from"./three-fiber-gElx9mfP.js";import{c as mo}from"./store-IPzLMAa1.js";import{u as Al,a as Sm,b as bm,B as q1,R as K1,c as us,N as Qo}from"./router-DyTV7ai8.js";import{k as Q1,M as yc,w as Cm,Y as J1,V as Z1,A as ev,c as tv,e as nt,a6 as Ut,a7 as Of,Z as nv,a8 as sv,a9 as Dm,aa as iv,ab as Qt,$ as vn,K as yu,ac as rv,t as Vf,h as ov,R as av,ad as Pm,ae as oi,a1 as Sh,T as lv,a0 as cv,g as Yt,af as uv}from"./three-core-CV1u6Hpc.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const hv=()=>{};var Bf={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rm=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++s)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},dv=function(t){const e=[];let n=0,s=0;for(;n<t.length;){const i=t[n++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=t[n++];e[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=t[n++],o=t[n++],a=t[n++],u=((i&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(u>>10)),e[s++]=String.fromCharCode(56320+(u&1023))}else{const r=t[n++],o=t[n++];e[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|o&63)}}return e.join("")},Nm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<t.length;i+=3){const r=t[i],o=i+1<t.length,a=o?t[i+1]:0,u=i+2<t.length,h=u?t[i+2]:0,d=r>>2,p=(r&3)<<4|a>>4;let m=(a&15)<<2|h>>6,_=h&63;u||(_=64,o||(m=64)),s.push(n[d],n[p],n[m],n[_])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Rm(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):dv(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<t.length;){const r=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;const h=i<t.length?n[t.charAt(i)]:64;++i;const p=i<t.length?n[t.charAt(i)]:64;if(++i,r==null||a==null||h==null||p==null)throw new fv;const m=r<<2|a>>4;if(s.push(m),h!==64){const _=a<<4&240|h>>2;if(s.push(_),p!==64){const y=h<<6&192|p;s.push(y)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class fv extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const pv=function(t){const e=Rm(t);return Nm.encodeByteArray(e,!0)},Ba=function(t){return pv(t).replace(/\./g,"")},Mm=function(t){try{return Nm.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gv(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mv=()=>gv().__FIREBASE_DEFAULTS__,_v=()=>{if(typeof process>"u"||typeof Bf>"u")return;const t=Bf.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},yv=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Mm(t[1]);return e&&JSON.parse(e)},Il=()=>{try{return hv()||mv()||_v()||yv()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},jm=t=>{var e,n;return(n=(e=Il())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},vv=t=>{const e=jm(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),s]:[e.substring(0,n),s]},Lm=()=>{var t;return(t=Il())===null||t===void 0?void 0:t.config},km=t=>{var e;return(e=Il())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,s)=>{n?this.reject(n):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $i(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Fm(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tv(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},s=e||"demo-project",i=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[Ba(JSON.stringify(n)),Ba(JSON.stringify(o)),""].join(".")}const Fr={};function Ev(){const t={prod:[],emulator:[]};for(const e of Object.keys(Fr))Fr[e]?t.emulator.push(e):t.prod.push(e);return t}function Av(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Uf=!1;function Om(t,e){if(typeof window>"u"||typeof document>"u"||!$i(window.location.host)||Fr[t]===e||Fr[t]||Uf)return;Fr[t]=e;function n(m){return`__firebase__banner__${m}`}const s="__firebase__banner",r=Ev().prod.length>0;function o(){const m=document.getElementById(s);m&&m.remove()}function a(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function u(m,_){m.setAttribute("width","24"),m.setAttribute("id",_),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function h(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{Uf=!0,o()},m}function d(m,_){m.setAttribute("id",_),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function p(){const m=Av(s),_=n("text"),y=document.getElementById(_)||document.createElement("span"),v=n("learnmore"),w=document.getElementById(v)||document.createElement("a"),b=n("preprendIcon"),A=document.getElementById(b)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const R=m.element;a(R),d(w,v);const N=h();u(A,b),R.append(A,y,w,N),document.body.appendChild(R)}r?(y.innerText="Preview backend disconnected.",A.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(A.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,y.innerText="Preview backend running in this workspace."),y.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Iv(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(bt())}function xv(){var t;const e=(t=Il())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Sv(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function bv(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Cv(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Dv(){const t=bt();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Pv(){return!xv()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Rv(){try{return typeof indexedDB=="object"}catch{return!1}}function Nv(){return new Promise((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var r;e(((r=i.error)===null||r===void 0?void 0:r.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mv="FirebaseError";class ns extends Error{constructor(e,n,s){super(n),this.code=e,this.customData=s,this.name=Mv,Object.setPrototypeOf(this,ns.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_o.prototype.create)}}class _o{constructor(e,n,s){this.service=e,this.serviceName=n,this.errors=s}create(e,...n){const s=n[0]||{},i=`${this.service}/${e}`,r=this.errors[e],o=r?jv(r,s):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new ns(i,a,s)}}function jv(t,e){return t.replace(Lv,(n,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const Lv=/\{\$([^}]+)}/g;function kv(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Zs(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const i of n){if(!s.includes(i))return!1;const r=t[i],o=e[i];if($f(r)&&$f(o)){if(!Zs(r,o))return!1}else if(r!==o)return!1}for(const i of s)if(!n.includes(i))return!1;return!0}function $f(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yo(t){const e=[];for(const[n,s]of Object.entries(t))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Cr(t){const e={};return t.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[i,r]=s.split("=");e[decodeURIComponent(i)]=decodeURIComponent(r)}}),e}function Dr(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function Fv(t,e){const n=new Ov(t,e);return n.subscribe.bind(n)}class Ov{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,s){let i;if(e===void 0&&n===void 0&&s===void 0)throw new Error("Missing Observer.");Vv(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:s},i.next===void 0&&(i.next=vc),i.error===void 0&&(i.error=vc),i.complete===void 0&&(i.complete=vc);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Vv(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function vc(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ut(t){return t&&t._delegate?t._delegate:t}class ei{constructor(e,n,s){this.name=e,this.instanceFactory=n,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zs="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bv{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const s=new wv;if(this.instancesDeferred.set(n,s),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if($v(e))try{this.getOrInitializeService({instanceIdentifier:zs})}catch{}for(const[n,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(e=zs){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=zs){return this.instances.has(e)}getOptions(e=zs){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:n});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);s===a&&o.resolve(i)}return i}onInit(e,n){var s;const i=this.normalizeInstanceIdentifier(n),r=(s=this.onInitCallbacks.get(i))!==null&&s!==void 0?s:new Set;r.add(e),this.onInitCallbacks.set(i,r);const o=this.instances.get(i);return o&&e(o,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,n){const s=this.onInitCallbacks.get(n);if(s)for(const i of s)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Uv(e),options:n}),this.instances.set(e,s),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=zs){return this.component?this.component.multipleInstances?e:zs:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Uv(t){return t===zs?void 0:t}function $v(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new Bv(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ee;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Ee||(Ee={}));const Wv={debug:Ee.DEBUG,verbose:Ee.VERBOSE,info:Ee.INFO,warn:Ee.WARN,error:Ee.ERROR,silent:Ee.SILENT},Xv=Ee.INFO,Gv={[Ee.DEBUG]:"log",[Ee.VERBOSE]:"log",[Ee.INFO]:"info",[Ee.WARN]:"warn",[Ee.ERROR]:"error"},Yv=(t,e,...n)=>{if(e<t.logLevel)return;const s=new Date().toISOString(),i=Gv[e];if(i)console[i](`[${s}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class bh{constructor(e){this.name=e,this._logLevel=Xv,this._logHandler=Yv,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ee))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Wv[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ee.DEBUG,...e),this._logHandler(this,Ee.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ee.VERBOSE,...e),this._logHandler(this,Ee.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ee.INFO,...e),this._logHandler(this,Ee.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ee.WARN,...e),this._logHandler(this,Ee.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ee.ERROR,...e),this._logHandler(this,Ee.ERROR,...e)}}const zv=(t,e)=>e.some(n=>t instanceof n);let Hf,Wf;function qv(){return Hf||(Hf=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Kv(){return Wf||(Wf=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Vm=new WeakMap,vu=new WeakMap,Bm=new WeakMap,wc=new WeakMap,Ch=new WeakMap;function Qv(t){const e=new Promise((n,s)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",o)},r=()=>{n(ws(t.result)),i()},o=()=>{s(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&Vm.set(n,t)}).catch(()=>{}),Ch.set(e,t),e}function Jv(t){if(vu.has(t))return;const e=new Promise((n,s)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",o),t.removeEventListener("abort",o)},r=()=>{n(),i()},o=()=>{s(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",o),t.addEventListener("abort",o)});vu.set(t,e)}let wu={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return vu.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Bm.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ws(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Zv(t){wu=t(wu)}function e2(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const s=t.call(Tc(this),e,...n);return Bm.set(s,e.sort?e.sort():[e]),ws(s)}:Kv().includes(t)?function(...e){return t.apply(Tc(this),e),ws(Vm.get(this))}:function(...e){return ws(t.apply(Tc(this),e))}}function t2(t){return typeof t=="function"?e2(t):(t instanceof IDBTransaction&&Jv(t),zv(t,qv())?new Proxy(t,wu):t)}function ws(t){if(t instanceof IDBRequest)return Qv(t);if(wc.has(t))return wc.get(t);const e=t2(t);return e!==t&&(wc.set(t,e),Ch.set(e,t)),e}const Tc=t=>Ch.get(t);function n2(t,e,{blocked:n,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(t,e),a=ws(o);return s&&o.addEventListener("upgradeneeded",u=>{s(ws(o.result),u.oldVersion,u.newVersion,ws(o.transaction),u)}),n&&o.addEventListener("blocked",u=>n(u.oldVersion,u.newVersion,u)),a.then(u=>{r&&u.addEventListener("close",()=>r()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),a}const s2=["get","getKey","getAll","getAllKeys","count"],i2=["put","add","delete","clear"],Ec=new Map;function Xf(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Ec.get(e))return Ec.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,i=i2.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(i||s2.includes(n)))return;const r=async function(o,...a){const u=this.transaction(o,i?"readwrite":"readonly");let h=u.store;return s&&(h=h.index(a.shift())),(await Promise.all([h[n](...a),i&&u.done]))[0]};return Ec.set(e,r),r}Zv(t=>({...t,get:(e,n,s)=>Xf(e,n)||t.get(e,n,s),has:(e,n)=>!!Xf(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r2{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(o2(n)){const s=n.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(n=>n).join(" ")}}function o2(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Tu="@firebase/app",Gf="0.13.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qn=new bh("@firebase/app"),a2="@firebase/app-compat",l2="@firebase/analytics-compat",c2="@firebase/analytics",u2="@firebase/app-check-compat",h2="@firebase/app-check",d2="@firebase/auth",f2="@firebase/auth-compat",p2="@firebase/database",g2="@firebase/data-connect",m2="@firebase/database-compat",_2="@firebase/functions",y2="@firebase/functions-compat",v2="@firebase/installations",w2="@firebase/installations-compat",T2="@firebase/messaging",E2="@firebase/messaging-compat",A2="@firebase/performance",I2="@firebase/performance-compat",x2="@firebase/remote-config",S2="@firebase/remote-config-compat",b2="@firebase/storage",C2="@firebase/storage-compat",D2="@firebase/firestore",P2="@firebase/ai",R2="@firebase/firestore-compat",N2="firebase",M2="11.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eu="[DEFAULT]",j2={[Tu]:"fire-core",[a2]:"fire-core-compat",[c2]:"fire-analytics",[l2]:"fire-analytics-compat",[h2]:"fire-app-check",[u2]:"fire-app-check-compat",[d2]:"fire-auth",[f2]:"fire-auth-compat",[p2]:"fire-rtdb",[g2]:"fire-data-connect",[m2]:"fire-rtdb-compat",[_2]:"fire-fn",[y2]:"fire-fn-compat",[v2]:"fire-iid",[w2]:"fire-iid-compat",[T2]:"fire-fcm",[E2]:"fire-fcm-compat",[A2]:"fire-perf",[I2]:"fire-perf-compat",[x2]:"fire-rc",[S2]:"fire-rc-compat",[b2]:"fire-gcs",[C2]:"fire-gcs-compat",[D2]:"fire-fst",[R2]:"fire-fst-compat",[P2]:"fire-vertex","fire-js":"fire-js",[N2]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ua=new Map,L2=new Map,Au=new Map;function Yf(t,e){try{t.container.addComponent(e)}catch(n){qn.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Mi(t){const e=t.name;if(Au.has(e))return qn.debug(`There were multiple attempts to register component ${e}.`),!1;Au.set(e,t);for(const n of Ua.values())Yf(n,t);for(const n of L2.values())Yf(n,t);return!0}function Dh(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function $t(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k2={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ts=new _o("app","Firebase",k2);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F2{constructor(e,n,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new ei("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ts.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hi=M2;function Um(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const s=Object.assign({name:Eu,automaticDataCollectionEnabled:!0},e),i=s.name;if(typeof i!="string"||!i)throw Ts.create("bad-app-name",{appName:String(i)});if(n||(n=Lm()),!n)throw Ts.create("no-options");const r=Ua.get(i);if(r){if(Zs(n,r.options)&&Zs(s,r.config))return r;throw Ts.create("duplicate-app",{appName:i})}const o=new Hv(i);for(const u of Au.values())o.addComponent(u);const a=new F2(n,s,o);return Ua.set(i,a),a}function $m(t=Eu){const e=Ua.get(t);if(!e&&t===Eu&&Lm())return Um();if(!e)throw Ts.create("no-app",{appName:t});return e}function Es(t,e,n){var s;let i=(s=j2[t])!==null&&s!==void 0?s:t;n&&(i+=`-${n}`);const r=i.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const a=[`Unable to register library "${i}" with version "${e}":`];r&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),qn.warn(a.join(" "));return}Mi(new ei(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O2="firebase-heartbeat-database",V2=1,Qr="firebase-heartbeat-store";let Ac=null;function Hm(){return Ac||(Ac=n2(O2,V2,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Qr)}catch(n){console.warn(n)}}}}).catch(t=>{throw Ts.create("idb-open",{originalErrorMessage:t.message})})),Ac}async function B2(t){try{const n=(await Hm()).transaction(Qr),s=await n.objectStore(Qr).get(Wm(t));return await n.done,s}catch(e){if(e instanceof ns)qn.warn(e.message);else{const n=Ts.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});qn.warn(n.message)}}}async function zf(t,e){try{const s=(await Hm()).transaction(Qr,"readwrite");await s.objectStore(Qr).put(e,Wm(t)),await s.done}catch(n){if(n instanceof ns)qn.warn(n.message);else{const s=Ts.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});qn.warn(s.message)}}}function Wm(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U2=1024,$2=30;class H2{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new X2(n),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=qf();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:i}),this._heartbeatsCache.heartbeats.length>$2){const o=G2(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){qn.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=qf(),{heartbeatsToSend:s,unsentEntries:i}=W2(this._heartbeatsCache.heartbeats),r=Ba(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(n){return qn.warn(n),""}}}function qf(){return new Date().toISOString().substring(0,10)}function W2(t,e=U2){const n=[];let s=t.slice();for(const i of t){const r=n.find(o=>o.agent===i.agent);if(r){if(r.dates.push(i.date),Kf(n)>e){r.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Kf(n)>e){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}class X2{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Rv()?Nv().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await B2(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return zf(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return zf(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Kf(t){return Ba(JSON.stringify({version:2,heartbeats:t})).length}function G2(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let s=1;s<t.length;s++)t[s].date<n&&(n=t[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y2(t){Mi(new ei("platform-logger",e=>new r2(e),"PRIVATE")),Mi(new ei("heartbeat",e=>new H2(e),"PRIVATE")),Es(Tu,Gf,t),Es(Tu,Gf,"esm2017"),Es("fire-js","")}Y2("");function Ph(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(t);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(t,s[i])&&(n[s[i]]=t[s[i]]);return n}function Xm(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const z2=Xm,Gm=new _o("auth","Firebase",Xm());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $a=new bh("@firebase/auth");function q2(t,...e){$a.logLevel<=Ee.WARN&&$a.warn(`Auth (${Hi}): ${t}`,...e)}function ba(t,...e){$a.logLevel<=Ee.ERROR&&$a.error(`Auth (${Hi}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nn(t,...e){throw Nh(t,...e)}function un(t,...e){return Nh(t,...e)}function Rh(t,e,n){const s=Object.assign(Object.assign({},z2()),{[e]:n});return new _o("auth","Firebase",s).create(e,{appName:t.name})}function Yn(t){return Rh(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function K2(t,e,n){const s=n;if(!(e instanceof s))throw s.name!==e.constructor.name&&nn(t,"argument-error"),Rh(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Nh(t,...e){if(typeof t!="string"){const n=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=t.name),t._errorFactory.create(n,...s)}return Gm.create(t,...e)}function ie(t,e,...n){if(!t)throw Nh(e,...n)}function Xn(t){const e="INTERNAL ASSERTION FAILED: "+t;throw ba(e),new Error(e)}function Kn(t,e){t||Xn(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iu(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function Q2(){return Qf()==="http:"||Qf()==="https:"}function Qf(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J2(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Q2()||bv()||"connection"in navigator)?navigator.onLine:!0}function Z2(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo{constructor(e,n){this.shortDelay=e,this.longDelay=n,Kn(n>e,"Short delay should be less than long delay!"),this.isMobile=Iv()||Cv()}get(){return J2()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mh(t,e){Kn(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym{static initialize(e,n,s){this.fetchImpl=e,n&&(this.headersImpl=n),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Xn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Xn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Xn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ew={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tw=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],nw=new vo(3e4,6e4);function js(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function ss(t,e,n,s,i={}){return zm(t,i,async()=>{let r={},o={};s&&(e==="GET"?o=s:r={body:JSON.stringify(s)});const a=yo(Object.assign({key:t.config.apiKey},o)).slice(1),u=await t._getAdditionalHeaders();u["Content-Type"]="application/json",t.languageCode&&(u["X-Firebase-Locale"]=t.languageCode);const h=Object.assign({method:e,headers:u},r);return Sv()||(h.referrerPolicy="no-referrer"),t.emulatorConfig&&$i(t.emulatorConfig.host)&&(h.credentials="include"),Ym.fetch()(await qm(t,t.config.apiHost,n,a),h)})}async function zm(t,e,n){t._canInitEmulator=!1;const s=Object.assign(Object.assign({},ew),e);try{const i=new iw(t),r=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw Jo(t,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const a=r.ok?o.errorMessage:o.error.message,[u,h]=a.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Jo(t,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw Jo(t,"email-already-in-use",o);if(u==="USER_DISABLED")throw Jo(t,"user-disabled",o);const d=s[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Rh(t,d,h);nn(t,d)}}catch(i){if(i instanceof ns)throw i;nn(t,"network-request-failed",{message:String(i)})}}async function wo(t,e,n,s,i={}){const r=await ss(t,e,n,s,i);return"mfaPendingCredential"in r&&nn(t,"multi-factor-auth-required",{_serverResponse:r}),r}async function qm(t,e,n,s){const i=`${e}${n}?${s}`,r=t,o=r.config.emulator?Mh(t.config,i):`${t.config.apiScheme}://${i}`;return tw.includes(n)&&(await r._persistenceManagerAvailable,r._getPersistenceType()==="COOKIE")?r._getPersistence()._getFinalTarget(o).toString():o}function sw(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class iw{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,s)=>{this.timer=setTimeout(()=>s(un(this.auth,"network-request-failed")),nw.get())})}}function Jo(t,e,n){const s={appName:t.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const i=un(t,e,s);return i.customData._tokenResponse=n,i}function Jf(t){return t!==void 0&&t.enterprise!==void 0}class rw{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return sw(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function ow(t,e){return ss(t,"GET","/v2/recaptchaConfig",js(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aw(t,e){return ss(t,"POST","/v1/accounts:delete",e)}async function Ha(t,e){return ss(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Or(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function lw(t,e=!1){const n=ut(t),s=await n.getIdToken(e),i=jh(s);ie(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const r=typeof i.firebase=="object"?i.firebase:void 0,o=r==null?void 0:r.sign_in_provider;return{claims:i,token:s,authTime:Or(Ic(i.auth_time)),issuedAtTime:Or(Ic(i.iat)),expirationTime:Or(Ic(i.exp)),signInProvider:o||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function Ic(t){return Number(t)*1e3}function jh(t){const[e,n,s]=t.split(".");if(e===void 0||n===void 0||s===void 0)return ba("JWT malformed, contained fewer than 3 sections"),null;try{const i=Mm(n);return i?JSON.parse(i):(ba("Failed to decode base64 JWT payload"),null)}catch(i){return ba("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function Zf(t){const e=jh(t);return ie(e,"internal-error"),ie(typeof e.exp<"u","internal-error"),ie(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ji(t,e,n=!1){if(n)return e;try{return await e}catch(s){throw s instanceof ns&&cw(s)&&t.auth.currentUser===t&&await t.auth.signOut(),s}}function cw({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uw{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const i=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xu{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Or(this.lastLoginAt),this.creationTime=Or(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wa(t){var e;const n=t.auth,s=await t.getIdToken(),i=await ji(t,Ha(n,{idToken:s}));ie(i==null?void 0:i.users.length,n,"internal-error");const r=i.users[0];t._notifyReloadListener(r);const o=!((e=r.providerUserInfo)===null||e===void 0)&&e.length?Km(r.providerUserInfo):[],a=dw(t.providerData,o),u=t.isAnonymous,h=!(t.email&&r.passwordHash)&&!(a!=null&&a.length),d=u?h:!1,p={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new xu(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(t,p)}async function hw(t){const e=ut(t);await Wa(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function dw(t,e){return[...t.filter(s=>!e.some(i=>i.providerId===s.providerId)),...e]}function Km(t){return t.map(e=>{var{providerId:n}=e,s=Ph(e,["providerId"]);return{providerId:n,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fw(t,e){const n=await zm(t,{},async()=>{const s=yo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=t.config,o=await qm(t,i,"/v1/token",`key=${r}`),a=await t._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:a,body:s};return t.emulatorConfig&&$i(t.emulatorConfig.host)&&(u.credentials="include"),Ym.fetch()(o,u)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function pw(t,e){return ss(t,"POST","/v2/accounts:revokeToken",js(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ie(e.idToken,"internal-error"),ie(typeof e.idToken<"u","internal-error"),ie(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Zf(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){ie(e.length!==0,"internal-error");const n=Zf(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(ie(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:s,refreshToken:i,expiresIn:r}=await fw(e,n);this.updateTokensAndExpiration(s,i,Number(r))}updateTokensAndExpiration(e,n,s){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,n){const{refreshToken:s,accessToken:i,expirationTime:r}=n,o=new xi;return s&&(ie(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),i&&(ie(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),r&&(ie(typeof r=="number","internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new xi,this.toJSON())}_performRefresh(){return Xn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hs(t,e){ie(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class an{constructor(e){var{uid:n,auth:s,stsTokenManager:i}=e,r=Ph(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new uw(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=s,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new xu(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const n=await ji(this,this.stsTokenManager.getToken(this.auth,e));return ie(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return lw(this,e)}reload(){return hw(this)}_assign(e){this!==e&&(ie(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new an(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){ie(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),n&&await Wa(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if($t(this.auth.app))return Promise.reject(Yn(this.auth));const e=await this.getIdToken();return await ji(this,aw(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var s,i,r,o,a,u,h,d;const p=(s=n.displayName)!==null&&s!==void 0?s:void 0,m=(i=n.email)!==null&&i!==void 0?i:void 0,_=(r=n.phoneNumber)!==null&&r!==void 0?r:void 0,y=(o=n.photoURL)!==null&&o!==void 0?o:void 0,v=(a=n.tenantId)!==null&&a!==void 0?a:void 0,w=(u=n._redirectEventId)!==null&&u!==void 0?u:void 0,b=(h=n.createdAt)!==null&&h!==void 0?h:void 0,A=(d=n.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:R,emailVerified:N,isAnonymous:M,providerData:k,stsTokenManager:x}=n;ie(R&&x,e,"internal-error");const T=xi.fromJSON(this.name,x);ie(typeof R=="string",e,"internal-error"),hs(p,e.name),hs(m,e.name),ie(typeof N=="boolean",e,"internal-error"),ie(typeof M=="boolean",e,"internal-error"),hs(_,e.name),hs(y,e.name),hs(v,e.name),hs(w,e.name),hs(b,e.name),hs(A,e.name);const E=new an({uid:R,auth:e,email:m,emailVerified:N,displayName:p,isAnonymous:M,photoURL:y,phoneNumber:_,tenantId:v,stsTokenManager:T,createdAt:b,lastLoginAt:A});return k&&Array.isArray(k)&&(E.providerData=k.map(C=>Object.assign({},C))),w&&(E._redirectEventId=w),E}static async _fromIdTokenResponse(e,n,s=!1){const i=new xi;i.updateFromServerResponse(n);const r=new an({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:s});return await Wa(r),r}static async _fromGetAccountInfoResponse(e,n,s){const i=n.users[0];ie(i.localId!==void 0,"internal-error");const r=i.providerUserInfo!==void 0?Km(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(r!=null&&r.length),a=new xi;a.updateFromIdToken(s);const u=new an({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new xu(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(r!=null&&r.length)};return Object.assign(u,h),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ep=new Map;function Gn(t){Kn(t instanceof Function,"Expected a class definition");let e=ep.get(t);return e?(Kn(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,ep.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}Qm.type="NONE";const tp=Qm;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ca(t,e,n){return`firebase:${t}:${e}:${n}`}class Si{constructor(e,n,s){this.persistence=e,this.auth=n,this.userKey=s;const{config:i,name:r}=this.auth;this.fullUserKey=Ca(this.userKey,i.apiKey,r),this.fullPersistenceKey=Ca("persistence",i.apiKey,r),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Ha(this.auth,{idToken:e}).catch(()=>{});return n?an._fromGetAccountInfoResponse(this.auth,n,e):null}return an._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,s="authUser"){if(!n.length)return new Si(Gn(tp),e,s);const i=(await Promise.all(n.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let r=i[0]||Gn(tp);const o=Ca(s,e.config.apiKey,e.name);let a=null;for(const h of n)try{const d=await h._get(o);if(d){let p;if(typeof d=="string"){const m=await Ha(e,{idToken:d}).catch(()=>{});if(!m)break;p=await an._fromGetAccountInfoResponse(e,m,d)}else p=an._fromJSON(e,d);h!==r&&(a=p),r=h;break}}catch{}const u=i.filter(h=>h._shouldAllowMigration);return!r._shouldAllowMigration||!u.length?new Si(r,e,s):(r=u[0],a&&await r._set(o,a.toJSON()),await Promise.all(n.map(async h=>{if(h!==r)try{await h._remove(o)}catch{}})),new Si(r,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function np(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(t0(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Jm(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(s0(e))return"Blackberry";if(i0(e))return"Webos";if(Zm(e))return"Safari";if((e.includes("chrome/")||e0(e))&&!e.includes("edge/"))return"Chrome";if(n0(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=t.match(n);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function Jm(t=bt()){return/firefox\//i.test(t)}function Zm(t=bt()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function e0(t=bt()){return/crios\//i.test(t)}function t0(t=bt()){return/iemobile/i.test(t)}function n0(t=bt()){return/android/i.test(t)}function s0(t=bt()){return/blackberry/i.test(t)}function i0(t=bt()){return/webos/i.test(t)}function Lh(t=bt()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function gw(t=bt()){var e;return Lh(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function mw(){return Dv()&&document.documentMode===10}function r0(t=bt()){return Lh(t)||n0(t)||i0(t)||s0(t)||/windows phone/i.test(t)||t0(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o0(t,e=[]){let n;switch(t){case"Browser":n=np(bt());break;case"Worker":n=`${np(bt())}-${t}`;break;default:n=t}const s=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Hi}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _w{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const s=r=>new Promise((o,a)=>{try{const u=e(r);o(u)}catch(u){a(u)}});s.onAbort=n,this.queue.push(s);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const s of this.queue)await s(e),s.onAbort&&n.push(s.onAbort)}catch(s){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yw(t,e={}){return ss(t,"GET","/v2/passwordPolicy",js(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vw=6;class ww{constructor(e){var n,s,i,r;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:vw,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(r=e.forceUpgradeOnSignin)!==null&&r!==void 0?r:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,s,i,r,o,a;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(n=u.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),u.isValid&&(u.isValid=(s=u.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(r=u.containsUppercaseLetter)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(a=u.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),u}validatePasswordLengthOptions(e,n){const s=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;s&&(n.meetsMinPasswordLength=e.length>=s),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let s;for(let i=0;i<e.length;i++)s=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,n,s,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tw{constructor(e,n,s,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=s,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new sp(this),this.idTokenSubscription=new sp(this),this.beforeStateQueue=new _w(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Gm,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(r=>this._resolvePersistenceManagerAvailable=r)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Gn(n)),this._initializationPromise=this.queue(async()=>{var s,i,r;if(!this._deleted&&(this.persistenceManager=await Si.create(this,e),(s=this._resolvePersistenceManagerAvailable)===null||s===void 0||s.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Ha(this,{idToken:e}),s=await an._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(s)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if($t(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let i=s,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=i==null?void 0:i._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===a)&&(u!=null&&u.user)&&(i=u.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return ie(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Wa(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Z2()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if($t(this.app))return Promise.reject(Yn(this));const n=e?ut(e):null;return n&&ie(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&ie(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return $t(this.app)?Promise.reject(Yn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return $t(this.app)?Promise.reject(Yn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Gn(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await yw(this),n=new ww(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new _o("auth","Firebase",e())}onAuthStateChanged(e,n,s){return this.registerStateListener(this.authStateSubscription,e,n,s)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,s){return this.registerStateListener(this.idTokenSubscription,e,n,s)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(s.tenantId=this.tenantId),await pw(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const s=await this.getOrInitRedirectPersistenceManager(n);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Gn(e)||this._popupRedirectResolver;ie(n,this,"argument-error"),this.redirectPersistenceManager=await Si.create(this,[Gn(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,s;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,s,i){if(this._deleted)return()=>{};const r=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ie(a,this,"internal-error"),a.then(()=>{o||r(this.currentUser)}),typeof n=="function"){const u=e.addObserver(n,s,i);return()=>{o=!0,u()}}else{const u=e.addObserver(n);return()=>{o=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ie(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=o0(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(n["X-Firebase-Client"]=s);const i=await this._getAppCheckToken();return i&&(n["X-Firebase-AppCheck"]=i),n}async _getAppCheckToken(){var e;if($t(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&q2(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Ls(t){return ut(t)}class sp{constructor(e){this.auth=e,this.observer=null,this.addObserver=Fv(n=>this.observer=n)}get next(){return ie(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xl={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ew(t){xl=t}function a0(t){return xl.loadJS(t)}function Aw(){return xl.recaptchaEnterpriseScript}function Iw(){return xl.gapiScript}function xw(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class Sw{constructor(){this.enterprise=new bw}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class bw{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const Cw="recaptcha-enterprise",l0="NO_RECAPTCHA";class Dw{constructor(e){this.type=Cw,this.auth=Ls(e)}async verify(e="verify",n=!1){async function s(r){if(!n){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(o,a)=>{ow(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const h=new rw(u);return r.tenantId==null?r._agentRecaptchaConfig=h:r._tenantRecaptchaConfigs[r.tenantId]=h,o(h.siteKey)}}).catch(u=>{a(u)})})}function i(r,o,a){const u=window.grecaptcha;Jf(u)?u.enterprise.ready(()=>{u.enterprise.execute(r,{action:e}).then(h=>{o(h)}).catch(()=>{o(l0)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Sw().execute("siteKey",{action:"verify"}):new Promise((r,o)=>{s(this.auth).then(a=>{if(!n&&Jf(window.grecaptcha))i(a,r,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=Aw();u.length!==0&&(u+=a),a0(u).then(()=>{i(a,r,o)}).catch(h=>{o(h)})}}).catch(a=>{o(a)})})}}async function ip(t,e,n,s=!1,i=!1){const r=new Dw(t);let o;if(i)o=l0;else try{o=await r.verify(n)}catch{o=await r.verify(n,!0)}const a=Object.assign({},e);if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const u=a.phoneEnrollmentInfo.phoneNumber,h=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:h,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const u=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return s?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Su(t,e,n,s,i){var r;if(!((r=t._getRecaptchaConfig())===null||r===void 0)&&r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await ip(t,e,n,n==="getOobCode");return s(t,o)}else return s(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await ip(t,e,n,n==="getOobCode");return s(t,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pw(t,e){const n=Dh(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),r=n.getOptions();if(Zs(r,e??{}))return i;nn(i,"already-initialized")}return n.initialize({options:e})}function Rw(t,e){const n=(e==null?void 0:e.persistence)||[],s=(Array.isArray(n)?n:[n]).map(Gn);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function Nw(t,e,n){const s=Ls(t);ie(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const i=!1,r=c0(e),{host:o,port:a}=Mw(e),u=a===null?"":`:${a}`,h={url:`${r}//${o}${u}/`},d=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!s._canInitEmulator){ie(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),ie(Zs(h,s.config.emulator)&&Zs(d,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=h,s.emulatorConfig=d,s.settings.appVerificationDisabledForTesting=!0,$i(o)?(Fm(`${r}//${o}${u}`),Om("Auth",!0)):jw()}function c0(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Mw(t){const e=c0(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(s);if(i){const r=i[1];return{host:r,port:rp(s.substr(r.length+1))}}else{const[r,o]=s.split(":");return{host:r,port:rp(o)}}}function rp(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function jw(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kh{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Xn("not implemented")}_getIdTokenResponse(e){return Xn("not implemented")}_linkToIdToken(e,n){return Xn("not implemented")}_getReauthenticationResolver(e){return Xn("not implemented")}}async function Lw(t,e){return ss(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kw(t,e){return wo(t,"POST","/v1/accounts:signInWithPassword",js(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fw(t,e){return wo(t,"POST","/v1/accounts:signInWithEmailLink",js(t,e))}async function Ow(t,e){return wo(t,"POST","/v1/accounts:signInWithEmailLink",js(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr extends kh{constructor(e,n,s,i=null){super("password",s),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Jr(e,n,"password")}static _fromEmailAndCode(e,n,s=null){return new Jr(e,n,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Su(e,n,"signInWithPassword",kw);case"emailLink":return Fw(e,{email:this._email,oobCode:this._password});default:nn(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const s={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Su(e,s,"signUpPassword",Lw);case"emailLink":return Ow(e,{idToken:n,email:this._email,oobCode:this._password});default:nn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bi(t,e){return wo(t,"POST","/v1/accounts:signInWithIdp",js(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vw="http://localhost";class ti extends kh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new ti(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):nn("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:i}=n,r=Ph(n,["providerId","signInMethod"]);if(!s||!i)return null;const o=new ti(s,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return bi(e,n)}_linkToIdToken(e,n){const s=this.buildRequest();return s.idToken=n,bi(e,s)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,bi(e,n)}buildRequest(){const e={requestUri:Vw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=yo(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bw(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Uw(t){const e=Cr(Dr(t)).link,n=e?Cr(Dr(e)).deep_link_id:null,s=Cr(Dr(t)).deep_link_id;return(s?Cr(Dr(s)).link:null)||s||n||e||t}class Fh{constructor(e){var n,s,i,r,o,a;const u=Cr(Dr(e)),h=(n=u.apiKey)!==null&&n!==void 0?n:null,d=(s=u.oobCode)!==null&&s!==void 0?s:null,p=Bw((i=u.mode)!==null&&i!==void 0?i:null);ie(h&&d&&p,"argument-error"),this.apiKey=h,this.operation=p,this.code=d,this.continueUrl=(r=u.continueUrl)!==null&&r!==void 0?r:null,this.languageCode=(o=u.lang)!==null&&o!==void 0?o:null,this.tenantId=(a=u.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const n=Uw(e);try{return new Fh(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{constructor(){this.providerId=Wi.PROVIDER_ID}static credential(e,n){return Jr._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const s=Fh.parseLink(n);return ie(s,"argument-error"),Jr._fromEmailAndCode(e,s.code,s.tenantId)}}Wi.PROVIDER_ID="password";Wi.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Wi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oh{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To extends Oh{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps extends To{constructor(){super("facebook.com")}static credential(e){return ti._fromParams({providerId:ps.PROVIDER_ID,signInMethod:ps.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ps.credentialFromTaggedObject(e)}static credentialFromError(e){return ps.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ps.credential(e.oauthAccessToken)}catch{return null}}}ps.FACEBOOK_SIGN_IN_METHOD="facebook.com";ps.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn extends To{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return ti._fromParams({providerId:Wn.PROVIDER_ID,signInMethod:Wn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Wn.credentialFromTaggedObject(e)}static credentialFromError(e){return Wn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:s}=e;if(!n&&!s)return null;try{return Wn.credential(n,s)}catch{return null}}}Wn.GOOGLE_SIGN_IN_METHOD="google.com";Wn.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs extends To{constructor(){super("github.com")}static credential(e){return ti._fromParams({providerId:gs.PROVIDER_ID,signInMethod:gs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gs.credentialFromTaggedObject(e)}static credentialFromError(e){return gs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return gs.credential(e.oauthAccessToken)}catch{return null}}}gs.GITHUB_SIGN_IN_METHOD="github.com";gs.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms extends To{constructor(){super("twitter.com")}static credential(e,n){return ti._fromParams({providerId:ms.PROVIDER_ID,signInMethod:ms.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return ms.credentialFromTaggedObject(e)}static credentialFromError(e){return ms.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:s}=e;if(!n||!s)return null;try{return ms.credential(n,s)}catch{return null}}}ms.TWITTER_SIGN_IN_METHOD="twitter.com";ms.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $w(t,e){return wo(t,"POST","/v1/accounts:signUp",js(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,s,i=!1){const r=await an._fromIdTokenResponse(e,s,i),o=op(s);return new ni({user:r,providerId:o,_tokenResponse:s,operationType:n})}static async _forOperation(e,n,s){await e._updateTokensIfNecessary(s,!0);const i=op(s);return new ni({user:e,providerId:i,_tokenResponse:s,operationType:n})}}function op(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa extends ns{constructor(e,n,s,i){var r;super(n.code,n.message),this.operationType=s,this.user=i,Object.setPrototypeOf(this,Xa.prototype),this.customData={appName:e.name,tenantId:(r=e.tenantId)!==null&&r!==void 0?r:void 0,_serverResponse:n.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,n,s,i){return new Xa(e,n,s,i)}}function u0(t,e,n,s){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?Xa._fromErrorAndOperation(t,r,e,s):r})}async function Hw(t,e,n=!1){const s=await ji(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return ni._forOperation(t,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ww(t,e,n=!1){const{auth:s}=t;if($t(s.app))return Promise.reject(Yn(s));const i="reauthenticate";try{const r=await ji(t,u0(s,i,e,t),n);ie(r.idToken,s,"internal-error");const o=jh(r.idToken);ie(o,s,"internal-error");const{sub:a}=o;return ie(t.uid===a,s,"user-mismatch"),ni._forOperation(t,i,r)}catch(r){throw(r==null?void 0:r.code)==="auth/user-not-found"&&nn(s,"user-mismatch"),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h0(t,e,n=!1){if($t(t.app))return Promise.reject(Yn(t));const s="signIn",i=await u0(t,s,e),r=await ni._fromIdTokenResponse(t,s,i);return n||await t._updateCurrentUser(r.user),r}async function Xw(t,e){return h0(Ls(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d0(t){const e=Ls(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Gw(t,e,n){if($t(t.app))return Promise.reject(Yn(t));const s=Ls(t),o=await Su(s,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",$w).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&d0(t),u}),a=await ni._fromIdTokenResponse(s,"signIn",o);return await s._updateCurrentUser(a.user),a}function Yw(t,e,n){return $t(t.app)?Promise.reject(Yn(t)):Xw(ut(t),Wi.credential(e,n)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&d0(t),s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zw(t,e){return ss(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qw(t,{displayName:e,photoURL:n}){if(e===void 0&&n===void 0)return;const s=ut(t),r={idToken:await s.getIdToken(),displayName:e,photoUrl:n,returnSecureToken:!0},o=await ji(s,zw(s.auth,r));s.displayName=o.displayName||null,s.photoURL=o.photoUrl||null;const a=s.providerData.find(({providerId:u})=>u==="password");a&&(a.displayName=s.displayName,a.photoURL=s.photoURL),await s._updateTokensIfNecessary(o)}function Kw(t,e,n,s){return ut(t).onIdTokenChanged(e,n,s)}function Qw(t,e,n){return ut(t).beforeAuthStateChanged(e,n)}function f0(t,e,n,s){return ut(t).onAuthStateChanged(e,n,s)}function Jw(t){return ut(t).signOut()}const Ga="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p0{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Ga,"1"),this.storage.removeItem(Ga),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zw=1e3,eT=10;class g0 extends p0{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=r0(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const s=this.storage.getItem(n),i=this.localCache[n];s!==i&&e(n,i,s)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,u)=>{this.notifyListeners(o,u)});return}const s=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(s);!n&&this.localCache[s]===o||this.notifyListeners(s,o)},r=this.storage.getItem(s);mw()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,eT):i()}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:s}),!0)})},Zw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}g0.type="LOCAL";const tT=g0;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m0 extends p0{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}m0.type="SESSION";const _0=m0;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nT(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const s=new Sl(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:s,eventType:i,data:r}=n.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:s,eventType:i});const a=Array.from(o).map(async h=>h(n.origin,r)),u=await nT(a);n.ports[0].postMessage({status:"done",eventId:s,eventType:i,response:u})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Sl.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vh(t="",e=10){let n="";for(let s=0;s<e;s++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sT{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,s=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,o;return new Promise((a,u)=>{const h=Vh("",20);i.port1.start();const d=setTimeout(()=>{u(new Error("unsupported_event"))},s);o={messageChannel:i,onMessage(p){const m=p;if(m.data.eventId===h)switch(m.data.status){case"ack":clearTimeout(d),r=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(m.data.response);break;default:clearTimeout(d),clearTimeout(r),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:n},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function An(){return window}function iT(t){An().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y0(){return typeof An().WorkerGlobalScope<"u"&&typeof An().importScripts=="function"}async function rT(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function oT(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function aT(){return y0()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v0="firebaseLocalStorageDb",lT=1,Ya="firebaseLocalStorage",w0="fbase_key";class Eo{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function bl(t,e){return t.transaction([Ya],e?"readwrite":"readonly").objectStore(Ya)}function cT(){const t=indexedDB.deleteDatabase(v0);return new Eo(t).toPromise()}function bu(){const t=indexedDB.open(v0,lT);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const s=t.result;try{s.createObjectStore(Ya,{keyPath:w0})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const s=t.result;s.objectStoreNames.contains(Ya)?e(s):(s.close(),await cT(),e(await bu()))})})}async function ap(t,e,n){const s=bl(t,!0).put({[w0]:e,value:n});return new Eo(s).toPromise()}async function uT(t,e){const n=bl(t,!1).get(e),s=await new Eo(n).toPromise();return s===void 0?null:s.value}function lp(t,e){const n=bl(t,!0).delete(e);return new Eo(n).toPromise()}const hT=800,dT=3;class T0{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await bu(),this.db)}async _withRetries(e){let n=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(n++>dT)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return y0()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Sl._getInstance(aT()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await rT(),!this.activeServiceWorker)return;this.sender=new sT(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((n=s[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||oT()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await bu();return await ap(e,Ga,"1"),await lp(e,Ga),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(s=>ap(s,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(s=>uT(s,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>lp(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const r=bl(i,!1).getAll();return new Eo(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],s=new Set;if(e.length!==0)for(const{fbase_key:i,value:r}of e)s.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!s.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),hT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}T0.type="LOCAL";const fT=T0;new vo(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E0(t,e){return e?Gn(e):(ie(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bh extends kh{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return bi(e,this._buildIdpRequest())}_linkToIdToken(e,n){return bi(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return bi(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function pT(t){return h0(t.auth,new Bh(t),t.bypassAuthState)}function gT(t){const{auth:e,user:n}=t;return ie(n,e,"internal-error"),Ww(n,new Bh(t),t.bypassAuthState)}async function mT(t){const{auth:e,user:n}=t;return ie(n,e,"internal-error"),Hw(n,new Bh(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A0{constructor(e,n,s,i,r=!1){this.auth=e,this.resolver=s,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:s,postBody:i,tenantId:r,error:o,type:a}=e;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:n,sessionId:s,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(u))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return pT;case"linkViaPopup":case"linkViaRedirect":return mT;case"reauthViaPopup":case"reauthViaRedirect":return gT;default:nn(this.auth,"internal-error")}}resolve(e){Kn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Kn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _T=new vo(2e3,1e4);async function yT(t,e,n){if($t(t.app))return Promise.reject(un(t,"operation-not-supported-in-this-environment"));const s=Ls(t);K2(t,e,Oh);const i=E0(s,n);return new Ks(s,"signInViaPopup",e,i).executeNotNull()}class Ks extends A0{constructor(e,n,s,i,r){super(e,n,i,r),this.provider=s,this.authWindow=null,this.pollId=null,Ks.currentPopupAction&&Ks.currentPopupAction.cancel(),Ks.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ie(e,this.auth,"internal-error"),e}async onExecution(){Kn(this.filter.length===1,"Popup operations only handle one event");const e=Vh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(un(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(un(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ks.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,s;if(!((s=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(un(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,_T.get())};e()}}Ks.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vT="pendingRedirect",Da=new Map;class wT extends A0{constructor(e,n,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,s),this.eventId=null}async execute(){let e=Da.get(this.auth._key());if(!e){try{const s=await TT(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(n){e=()=>Promise.reject(n)}Da.set(this.auth._key(),e)}return this.bypassAuthState||Da.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function TT(t,e){const n=IT(e),s=AT(t);if(!await s._isAvailable())return!1;const i=await s._get(n)==="true";return await s._remove(n),i}function ET(t,e){Da.set(t._key(),e)}function AT(t){return Gn(t._redirectPersistence)}function IT(t){return Ca(vT,t.config.apiKey,t.name)}async function xT(t,e,n=!1){if($t(t.app))return Promise.reject(Yn(t));const s=Ls(t),i=E0(s,e),o=await new wT(s,i,n).execute();return o&&!n&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ST=10*60*1e3;class bT{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(n=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!CT(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var s;if(e.error&&!I0(e)){const i=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";n.onError(un(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const s=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=ST&&this.cachedEventUids.clear(),this.cachedEventUids.has(cp(e))}saveEventToCache(e){this.cachedEventUids.add(cp(e)),this.lastProcessedEventTime=Date.now()}}function cp(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function I0({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function CT(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return I0(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DT(t,e={}){return ss(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PT=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,RT=/^https?/;async function NT(t){if(t.config.emulator)return;const{authorizedDomains:e}=await DT(t);for(const n of e)try{if(MT(n))return}catch{}nn(t,"unauthorized-domain")}function MT(t){const e=Iu(),{protocol:n,hostname:s}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&s===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===s}if(!RT.test(n))return!1;if(PT.test(t))return s===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jT=new vo(3e4,6e4);function up(){const t=An().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function LT(t){return new Promise((e,n)=>{var s,i,r;function o(){up(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{up(),n(un(t,"network-request-failed"))},timeout:jT.get()})}if(!((i=(s=An().gapi)===null||s===void 0?void 0:s.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((r=An().gapi)===null||r===void 0)&&r.load)o();else{const a=xw("iframefcb");return An()[a]=()=>{gapi.load?o():n(un(t,"network-request-failed"))},a0(`${Iw()}?onload=${a}`).catch(u=>n(u))}}).catch(e=>{throw Pa=null,e})}let Pa=null;function kT(t){return Pa=Pa||LT(t),Pa}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FT=new vo(5e3,15e3),OT="__/auth/iframe",VT="emulator/auth/iframe",BT={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},UT=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function $T(t){const e=t.config;ie(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Mh(e,VT):`https://${t.config.authDomain}/${OT}`,s={apiKey:e.apiKey,appName:t.name,v:Hi},i=UT.get(t.config.apiHost);i&&(s.eid=i);const r=t._getFrameworks();return r.length&&(s.fw=r.join(",")),`${n}?${yo(s).slice(1)}`}async function HT(t){const e=await kT(t),n=An().gapi;return ie(n,t,"internal-error"),e.open({where:document.body,url:$T(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:BT,dontclear:!0},s=>new Promise(async(i,r)=>{await s.restyle({setHideOnLeave:!1});const o=un(t,"network-request-failed"),a=An().setTimeout(()=>{r(o)},FT.get());function u(){An().clearTimeout(a),i(s)}s.ping(u).then(u,()=>{r(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WT={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},XT=500,GT=600,YT="_blank",zT="http://localhost";class hp{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function qT(t,e,n,s=XT,i=GT){const r=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const u=Object.assign(Object.assign({},WT),{width:s.toString(),height:i.toString(),top:r,left:o}),h=bt().toLowerCase();n&&(a=e0(h)?YT:n),Jm(h)&&(e=e||zT,u.scrollbars="yes");const d=Object.entries(u).reduce((m,[_,y])=>`${m}${_}=${y},`,"");if(gw(h)&&a!=="_self")return KT(e||"",a),new hp(null);const p=window.open(e||"",a,d);ie(p,t,"popup-blocked");try{p.focus()}catch{}return new hp(p)}function KT(t,e){const n=document.createElement("a");n.href=t,n.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QT="__/auth/handler",JT="emulator/auth/handler",ZT=encodeURIComponent("fac");async function dp(t,e,n,s,i,r){ie(t.config.authDomain,t,"auth-domain-config-required"),ie(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:s,v:Hi,eventId:i};if(e instanceof Oh){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",kv(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,p]of Object.entries({}))o[d]=p}if(e instanceof To){const d=e.getScopes().filter(p=>p!=="");d.length>0&&(o.scopes=d.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const u=await t._getAppCheckToken(),h=u?`#${ZT}=${encodeURIComponent(u)}`:"";return`${eE(t)}?${yo(a).slice(1)}${h}`}function eE({config:t}){return t.emulator?Mh(t,JT):`https://${t.authDomain}/${QT}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xc="webStorageSupport";class tE{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=_0,this._completeRedirectFn=xT,this._overrideRedirectResult=ET}async _openPopup(e,n,s,i){var r;Kn((r=this.eventManagers[e._key()])===null||r===void 0?void 0:r.manager,"_initialize() not called before _openPopup()");const o=await dp(e,n,s,Iu(),i);return qT(e,o,Vh())}async _openRedirect(e,n,s,i){await this._originValidation(e);const r=await dp(e,n,s,Iu(),i);return iT(r),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:r}=this.eventManagers[n];return i?Promise.resolve(i):(Kn(r,"If manager is not set, promise should be"),r)}const s=this.initAndGetManager(e);return this.eventManagers[n]={promise:s},s.catch(()=>{delete this.eventManagers[n]}),s}async initAndGetManager(e){const n=await HT(e),s=new bT(e);return n.register("authEvent",i=>(ie(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:s.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=n,s}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(xc,{type:xc},i=>{var r;const o=(r=i==null?void 0:i[0])===null||r===void 0?void 0:r[xc];o!==void 0&&n(!!o),nn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=NT(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return r0()||Zm()||Lh()}}const nE=tE;var fp="@firebase/auth",pp="1.10.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sE{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){ie(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iE(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function rE(t){Mi(new ei("auth",(e,{options:n})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;ie(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const u={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:o0(t)},h=new Tw(s,i,r,u);return Rw(h,n),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,s)=>{e.getProvider("auth-internal").initialize()})),Mi(new ei("auth-internal",e=>{const n=Ls(e.getProvider("auth").getImmediate());return(s=>new sE(s))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Es(fp,pp,iE(t)),Es(fp,pp,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oE=5*60,aE=km("authIdTokenMaxAge")||oE;let gp=null;const lE=t=>async e=>{const n=e&&await e.getIdTokenResult(),s=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(s&&s>aE)return;const i=n==null?void 0:n.token;gp!==i&&(gp=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function cE(t=$m()){const e=Dh(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Pw(t,{popupRedirectResolver:nE,persistence:[fT,tT,_0]}),s=km("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(s,location.origin);if(location.origin===r.origin){const o=lE(r.toString());Qw(n,o,()=>o(n.currentUser)),Kw(n,a=>o(a))}}const i=jm("auth");return i&&Nw(n,`http://${i}`),n}function uE(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}Ew({loadJS(t){return new Promise((e,n)=>{const s=document.createElement("script");s.setAttribute("src",t),s.onload=e,s.onerror=i=>{const r=un("internal-error");r.customData=i,n(r)},s.type="text/javascript",s.charset="UTF-8",uE().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});rE("Browser");var hE="firebase",dE="11.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Es(hE,dE,"app");var mp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var As,x0;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(x,T){function E(){}E.prototype=T.prototype,x.D=T.prototype,x.prototype=new E,x.prototype.constructor=x,x.C=function(C,D,P){for(var I=Array(arguments.length-2),$=2;$<arguments.length;$++)I[$-2]=arguments[$];return T.prototype[D].apply(C,I)}}function n(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(s,n),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(x,T,E){E||(E=0);var C=Array(16);if(typeof T=="string")for(var D=0;16>D;++D)C[D]=T.charCodeAt(E++)|T.charCodeAt(E++)<<8|T.charCodeAt(E++)<<16|T.charCodeAt(E++)<<24;else for(D=0;16>D;++D)C[D]=T[E++]|T[E++]<<8|T[E++]<<16|T[E++]<<24;T=x.g[0],E=x.g[1],D=x.g[2];var P=x.g[3],I=T+(P^E&(D^P))+C[0]+3614090360&4294967295;T=E+(I<<7&4294967295|I>>>25),I=P+(D^T&(E^D))+C[1]+3905402710&4294967295,P=T+(I<<12&4294967295|I>>>20),I=D+(E^P&(T^E))+C[2]+606105819&4294967295,D=P+(I<<17&4294967295|I>>>15),I=E+(T^D&(P^T))+C[3]+3250441966&4294967295,E=D+(I<<22&4294967295|I>>>10),I=T+(P^E&(D^P))+C[4]+4118548399&4294967295,T=E+(I<<7&4294967295|I>>>25),I=P+(D^T&(E^D))+C[5]+1200080426&4294967295,P=T+(I<<12&4294967295|I>>>20),I=D+(E^P&(T^E))+C[6]+2821735955&4294967295,D=P+(I<<17&4294967295|I>>>15),I=E+(T^D&(P^T))+C[7]+4249261313&4294967295,E=D+(I<<22&4294967295|I>>>10),I=T+(P^E&(D^P))+C[8]+1770035416&4294967295,T=E+(I<<7&4294967295|I>>>25),I=P+(D^T&(E^D))+C[9]+2336552879&4294967295,P=T+(I<<12&4294967295|I>>>20),I=D+(E^P&(T^E))+C[10]+4294925233&4294967295,D=P+(I<<17&4294967295|I>>>15),I=E+(T^D&(P^T))+C[11]+2304563134&4294967295,E=D+(I<<22&4294967295|I>>>10),I=T+(P^E&(D^P))+C[12]+1804603682&4294967295,T=E+(I<<7&4294967295|I>>>25),I=P+(D^T&(E^D))+C[13]+4254626195&4294967295,P=T+(I<<12&4294967295|I>>>20),I=D+(E^P&(T^E))+C[14]+2792965006&4294967295,D=P+(I<<17&4294967295|I>>>15),I=E+(T^D&(P^T))+C[15]+1236535329&4294967295,E=D+(I<<22&4294967295|I>>>10),I=T+(D^P&(E^D))+C[1]+4129170786&4294967295,T=E+(I<<5&4294967295|I>>>27),I=P+(E^D&(T^E))+C[6]+3225465664&4294967295,P=T+(I<<9&4294967295|I>>>23),I=D+(T^E&(P^T))+C[11]+643717713&4294967295,D=P+(I<<14&4294967295|I>>>18),I=E+(P^T&(D^P))+C[0]+3921069994&4294967295,E=D+(I<<20&4294967295|I>>>12),I=T+(D^P&(E^D))+C[5]+3593408605&4294967295,T=E+(I<<5&4294967295|I>>>27),I=P+(E^D&(T^E))+C[10]+38016083&4294967295,P=T+(I<<9&4294967295|I>>>23),I=D+(T^E&(P^T))+C[15]+3634488961&4294967295,D=P+(I<<14&4294967295|I>>>18),I=E+(P^T&(D^P))+C[4]+3889429448&4294967295,E=D+(I<<20&4294967295|I>>>12),I=T+(D^P&(E^D))+C[9]+568446438&4294967295,T=E+(I<<5&4294967295|I>>>27),I=P+(E^D&(T^E))+C[14]+3275163606&4294967295,P=T+(I<<9&4294967295|I>>>23),I=D+(T^E&(P^T))+C[3]+4107603335&4294967295,D=P+(I<<14&4294967295|I>>>18),I=E+(P^T&(D^P))+C[8]+1163531501&4294967295,E=D+(I<<20&4294967295|I>>>12),I=T+(D^P&(E^D))+C[13]+2850285829&4294967295,T=E+(I<<5&4294967295|I>>>27),I=P+(E^D&(T^E))+C[2]+4243563512&4294967295,P=T+(I<<9&4294967295|I>>>23),I=D+(T^E&(P^T))+C[7]+1735328473&4294967295,D=P+(I<<14&4294967295|I>>>18),I=E+(P^T&(D^P))+C[12]+2368359562&4294967295,E=D+(I<<20&4294967295|I>>>12),I=T+(E^D^P)+C[5]+4294588738&4294967295,T=E+(I<<4&4294967295|I>>>28),I=P+(T^E^D)+C[8]+2272392833&4294967295,P=T+(I<<11&4294967295|I>>>21),I=D+(P^T^E)+C[11]+1839030562&4294967295,D=P+(I<<16&4294967295|I>>>16),I=E+(D^P^T)+C[14]+4259657740&4294967295,E=D+(I<<23&4294967295|I>>>9),I=T+(E^D^P)+C[1]+2763975236&4294967295,T=E+(I<<4&4294967295|I>>>28),I=P+(T^E^D)+C[4]+1272893353&4294967295,P=T+(I<<11&4294967295|I>>>21),I=D+(P^T^E)+C[7]+4139469664&4294967295,D=P+(I<<16&4294967295|I>>>16),I=E+(D^P^T)+C[10]+3200236656&4294967295,E=D+(I<<23&4294967295|I>>>9),I=T+(E^D^P)+C[13]+681279174&4294967295,T=E+(I<<4&4294967295|I>>>28),I=P+(T^E^D)+C[0]+3936430074&4294967295,P=T+(I<<11&4294967295|I>>>21),I=D+(P^T^E)+C[3]+3572445317&4294967295,D=P+(I<<16&4294967295|I>>>16),I=E+(D^P^T)+C[6]+76029189&4294967295,E=D+(I<<23&4294967295|I>>>9),I=T+(E^D^P)+C[9]+3654602809&4294967295,T=E+(I<<4&4294967295|I>>>28),I=P+(T^E^D)+C[12]+3873151461&4294967295,P=T+(I<<11&4294967295|I>>>21),I=D+(P^T^E)+C[15]+530742520&4294967295,D=P+(I<<16&4294967295|I>>>16),I=E+(D^P^T)+C[2]+3299628645&4294967295,E=D+(I<<23&4294967295|I>>>9),I=T+(D^(E|~P))+C[0]+4096336452&4294967295,T=E+(I<<6&4294967295|I>>>26),I=P+(E^(T|~D))+C[7]+1126891415&4294967295,P=T+(I<<10&4294967295|I>>>22),I=D+(T^(P|~E))+C[14]+2878612391&4294967295,D=P+(I<<15&4294967295|I>>>17),I=E+(P^(D|~T))+C[5]+4237533241&4294967295,E=D+(I<<21&4294967295|I>>>11),I=T+(D^(E|~P))+C[12]+1700485571&4294967295,T=E+(I<<6&4294967295|I>>>26),I=P+(E^(T|~D))+C[3]+2399980690&4294967295,P=T+(I<<10&4294967295|I>>>22),I=D+(T^(P|~E))+C[10]+4293915773&4294967295,D=P+(I<<15&4294967295|I>>>17),I=E+(P^(D|~T))+C[1]+2240044497&4294967295,E=D+(I<<21&4294967295|I>>>11),I=T+(D^(E|~P))+C[8]+1873313359&4294967295,T=E+(I<<6&4294967295|I>>>26),I=P+(E^(T|~D))+C[15]+4264355552&4294967295,P=T+(I<<10&4294967295|I>>>22),I=D+(T^(P|~E))+C[6]+2734768916&4294967295,D=P+(I<<15&4294967295|I>>>17),I=E+(P^(D|~T))+C[13]+1309151649&4294967295,E=D+(I<<21&4294967295|I>>>11),I=T+(D^(E|~P))+C[4]+4149444226&4294967295,T=E+(I<<6&4294967295|I>>>26),I=P+(E^(T|~D))+C[11]+3174756917&4294967295,P=T+(I<<10&4294967295|I>>>22),I=D+(T^(P|~E))+C[2]+718787259&4294967295,D=P+(I<<15&4294967295|I>>>17),I=E+(P^(D|~T))+C[9]+3951481745&4294967295,x.g[0]=x.g[0]+T&4294967295,x.g[1]=x.g[1]+(D+(I<<21&4294967295|I>>>11))&4294967295,x.g[2]=x.g[2]+D&4294967295,x.g[3]=x.g[3]+P&4294967295}s.prototype.u=function(x,T){T===void 0&&(T=x.length);for(var E=T-this.blockSize,C=this.B,D=this.h,P=0;P<T;){if(D==0)for(;P<=E;)i(this,x,P),P+=this.blockSize;if(typeof x=="string"){for(;P<T;)if(C[D++]=x.charCodeAt(P++),D==this.blockSize){i(this,C),D=0;break}}else for(;P<T;)if(C[D++]=x[P++],D==this.blockSize){i(this,C),D=0;break}}this.h=D,this.o+=T},s.prototype.v=function(){var x=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);x[0]=128;for(var T=1;T<x.length-8;++T)x[T]=0;var E=8*this.o;for(T=x.length-8;T<x.length;++T)x[T]=E&255,E/=256;for(this.u(x),x=Array(16),T=E=0;4>T;++T)for(var C=0;32>C;C+=8)x[E++]=this.g[T]>>>C&255;return x};function r(x,T){var E=a;return Object.prototype.hasOwnProperty.call(E,x)?E[x]:E[x]=T(x)}function o(x,T){this.h=T;for(var E=[],C=!0,D=x.length-1;0<=D;D--){var P=x[D]|0;C&&P==T||(E[D]=P,C=!1)}this.g=E}var a={};function u(x){return-128<=x&&128>x?r(x,function(T){return new o([T|0],0>T?-1:0)}):new o([x|0],0>x?-1:0)}function h(x){if(isNaN(x)||!isFinite(x))return p;if(0>x)return w(h(-x));for(var T=[],E=1,C=0;x>=E;C++)T[C]=x/E|0,E*=4294967296;return new o(T,0)}function d(x,T){if(x.length==0)throw Error("number format error: empty string");if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(x.charAt(0)=="-")return w(d(x.substring(1),T));if(0<=x.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=h(Math.pow(T,8)),C=p,D=0;D<x.length;D+=8){var P=Math.min(8,x.length-D),I=parseInt(x.substring(D,D+P),T);8>P?(P=h(Math.pow(T,P)),C=C.j(P).add(h(I))):(C=C.j(E),C=C.add(h(I)))}return C}var p=u(0),m=u(1),_=u(16777216);t=o.prototype,t.m=function(){if(v(this))return-w(this).m();for(var x=0,T=1,E=0;E<this.g.length;E++){var C=this.i(E);x+=(0<=C?C:4294967296+C)*T,T*=4294967296}return x},t.toString=function(x){if(x=x||10,2>x||36<x)throw Error("radix out of range: "+x);if(y(this))return"0";if(v(this))return"-"+w(this).toString(x);for(var T=h(Math.pow(x,6)),E=this,C="";;){var D=N(E,T).g;E=b(E,D.j(T));var P=((0<E.g.length?E.g[0]:E.h)>>>0).toString(x);if(E=D,y(E))return P+C;for(;6>P.length;)P="0"+P;C=P+C}},t.i=function(x){return 0>x?0:x<this.g.length?this.g[x]:this.h};function y(x){if(x.h!=0)return!1;for(var T=0;T<x.g.length;T++)if(x.g[T]!=0)return!1;return!0}function v(x){return x.h==-1}t.l=function(x){return x=b(this,x),v(x)?-1:y(x)?0:1};function w(x){for(var T=x.g.length,E=[],C=0;C<T;C++)E[C]=~x.g[C];return new o(E,~x.h).add(m)}t.abs=function(){return v(this)?w(this):this},t.add=function(x){for(var T=Math.max(this.g.length,x.g.length),E=[],C=0,D=0;D<=T;D++){var P=C+(this.i(D)&65535)+(x.i(D)&65535),I=(P>>>16)+(this.i(D)>>>16)+(x.i(D)>>>16);C=I>>>16,P&=65535,I&=65535,E[D]=I<<16|P}return new o(E,E[E.length-1]&-2147483648?-1:0)};function b(x,T){return x.add(w(T))}t.j=function(x){if(y(this)||y(x))return p;if(v(this))return v(x)?w(this).j(w(x)):w(w(this).j(x));if(v(x))return w(this.j(w(x)));if(0>this.l(_)&&0>x.l(_))return h(this.m()*x.m());for(var T=this.g.length+x.g.length,E=[],C=0;C<2*T;C++)E[C]=0;for(C=0;C<this.g.length;C++)for(var D=0;D<x.g.length;D++){var P=this.i(C)>>>16,I=this.i(C)&65535,$=x.i(D)>>>16,K=x.i(D)&65535;E[2*C+2*D]+=I*K,A(E,2*C+2*D),E[2*C+2*D+1]+=P*K,A(E,2*C+2*D+1),E[2*C+2*D+1]+=I*$,A(E,2*C+2*D+1),E[2*C+2*D+2]+=P*$,A(E,2*C+2*D+2)}for(C=0;C<T;C++)E[C]=E[2*C+1]<<16|E[2*C];for(C=T;C<2*T;C++)E[C]=0;return new o(E,0)};function A(x,T){for(;(x[T]&65535)!=x[T];)x[T+1]+=x[T]>>>16,x[T]&=65535,T++}function R(x,T){this.g=x,this.h=T}function N(x,T){if(y(T))throw Error("division by zero");if(y(x))return new R(p,p);if(v(x))return T=N(w(x),T),new R(w(T.g),w(T.h));if(v(T))return T=N(x,w(T)),new R(w(T.g),T.h);if(30<x.g.length){if(v(x)||v(T))throw Error("slowDivide_ only works with positive integers.");for(var E=m,C=T;0>=C.l(x);)E=M(E),C=M(C);var D=k(E,1),P=k(C,1);for(C=k(C,2),E=k(E,2);!y(C);){var I=P.add(C);0>=I.l(x)&&(D=D.add(E),P=I),C=k(C,1),E=k(E,1)}return T=b(x,D.j(T)),new R(D,T)}for(D=p;0<=x.l(T);){for(E=Math.max(1,Math.floor(x.m()/T.m())),C=Math.ceil(Math.log(E)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),P=h(E),I=P.j(T);v(I)||0<I.l(x);)E-=C,P=h(E),I=P.j(T);y(P)&&(P=m),D=D.add(P),x=b(x,I)}return new R(D,x)}t.A=function(x){return N(this,x).h},t.and=function(x){for(var T=Math.max(this.g.length,x.g.length),E=[],C=0;C<T;C++)E[C]=this.i(C)&x.i(C);return new o(E,this.h&x.h)},t.or=function(x){for(var T=Math.max(this.g.length,x.g.length),E=[],C=0;C<T;C++)E[C]=this.i(C)|x.i(C);return new o(E,this.h|x.h)},t.xor=function(x){for(var T=Math.max(this.g.length,x.g.length),E=[],C=0;C<T;C++)E[C]=this.i(C)^x.i(C);return new o(E,this.h^x.h)};function M(x){for(var T=x.g.length+1,E=[],C=0;C<T;C++)E[C]=x.i(C)<<1|x.i(C-1)>>>31;return new o(E,x.h)}function k(x,T){var E=T>>5;T%=32;for(var C=x.g.length-E,D=[],P=0;P<C;P++)D[P]=0<T?x.i(P+E)>>>T|x.i(P+E+1)<<32-T:x.i(P+E);return new o(D,x.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,x0=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=d,As=o}).apply(typeof mp<"u"?mp:typeof self<"u"?self:typeof window<"u"?window:{});var Zo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var S0,Pr,b0,Ra,Cu,C0,D0,P0;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,f,g){return l==Array.prototype||l==Object.prototype||(l[f]=g.value),l};function n(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Zo=="object"&&Zo];for(var f=0;f<l.length;++f){var g=l[f];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var s=n(this);function i(l,f){if(f)e:{var g=s;l=l.split(".");for(var S=0;S<l.length-1;S++){var L=l[S];if(!(L in g))break e;g=g[L]}l=l[l.length-1],S=g[l],f=f(S),f!=S&&f!=null&&e(g,l,{configurable:!0,writable:!0,value:f})}}function r(l,f){l instanceof String&&(l+="");var g=0,S=!1,L={next:function(){if(!S&&g<l.length){var F=g++;return{value:f(F,l[F]),done:!1}}return S=!0,{done:!0,value:void 0}}};return L[Symbol.iterator]=function(){return L},L}i("Array.prototype.values",function(l){return l||function(){return r(this,function(f,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function u(l){var f=typeof l;return f=f!="object"?f:l?Array.isArray(l)?"array":f:"null",f=="array"||f=="object"&&typeof l.length=="number"}function h(l){var f=typeof l;return f=="object"&&l!=null||f=="function"}function d(l,f,g){return l.call.apply(l.bind,arguments)}function p(l,f,g){if(!l)throw Error();if(2<arguments.length){var S=Array.prototype.slice.call(arguments,2);return function(){var L=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(L,S),l.apply(f,L)}}return function(){return l.apply(f,arguments)}}function m(l,f,g){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:p,m.apply(null,arguments)}function _(l,f){var g=Array.prototype.slice.call(arguments,1);return function(){var S=g.slice();return S.push.apply(S,arguments),l.apply(this,S)}}function y(l,f){function g(){}g.prototype=f.prototype,l.aa=f.prototype,l.prototype=new g,l.prototype.constructor=l,l.Qb=function(S,L,F){for(var X=Array(arguments.length-2),Fe=2;Fe<arguments.length;Fe++)X[Fe-2]=arguments[Fe];return f.prototype[L].apply(S,X)}}function v(l){const f=l.length;if(0<f){const g=Array(f);for(let S=0;S<f;S++)g[S]=l[S];return g}return[]}function w(l,f){for(let g=1;g<arguments.length;g++){const S=arguments[g];if(u(S)){const L=l.length||0,F=S.length||0;l.length=L+F;for(let X=0;X<F;X++)l[L+X]=S[X]}else l.push(S)}}class b{constructor(f,g){this.i=f,this.j=g,this.h=0,this.g=null}get(){let f;return 0<this.h?(this.h--,f=this.g,this.g=f.next,f.next=null):f=this.i(),f}}function A(l){return/^[\s\xa0]*$/.test(l)}function R(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function N(l){return N[" "](l),l}N[" "]=function(){};var M=R().indexOf("Gecko")!=-1&&!(R().toLowerCase().indexOf("webkit")!=-1&&R().indexOf("Edge")==-1)&&!(R().indexOf("Trident")!=-1||R().indexOf("MSIE")!=-1)&&R().indexOf("Edge")==-1;function k(l,f,g){for(const S in l)f.call(g,l[S],S,l)}function x(l,f){for(const g in l)f.call(void 0,l[g],g,l)}function T(l){const f={};for(const g in l)f[g]=l[g];return f}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(l,f){let g,S;for(let L=1;L<arguments.length;L++){S=arguments[L];for(g in S)l[g]=S[g];for(let F=0;F<E.length;F++)g=E[F],Object.prototype.hasOwnProperty.call(S,g)&&(l[g]=S[g])}}function D(l){var f=1;l=l.split(":");const g=[];for(;0<f&&l.length;)g.push(l.shift()),f--;return l.length&&g.push(l.join(":")),g}function P(l){a.setTimeout(()=>{throw l},0)}function I(){var l=ne;let f=null;return l.g&&(f=l.g,l.g=l.g.next,l.g||(l.h=null),f.next=null),f}class ${constructor(){this.h=this.g=null}add(f,g){const S=K.get();S.set(f,g),this.h?this.h.next=S:this.g=S,this.h=S}}var K=new b(()=>new _e,l=>l.reset());class _e{constructor(){this.next=this.g=this.h=null}set(f,g){this.h=f,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let we,je=!1,ne=new $,se=()=>{const l=a.Promise.resolve(void 0);we=()=>{l.then(Ce)}};var Ce=()=>{for(var l;l=I();){try{l.h.call(l.g)}catch(g){P(g)}var f=K;f.j(l),100>f.h&&(f.h++,l.next=f.g,f.g=l)}je=!1};function Ie(){this.s=this.s,this.C=this.C}Ie.prototype.s=!1,Ie.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ie.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function de(l,f){this.type=l,this.g=this.target=f,this.defaultPrevented=!1}de.prototype.h=function(){this.defaultPrevented=!0};var Pt=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,f=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const g=()=>{};a.addEventListener("test",g,f),a.removeEventListener("test",g,f)}catch{}return l}();function Z(l,f){if(de.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var g=this.type=l.type,S=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=f,f=l.relatedTarget){if(M){e:{try{N(f.nodeName);var L=!0;break e}catch{}L=!1}L||(f=null)}}else g=="mouseover"?f=l.fromElement:g=="mouseout"&&(f=l.toElement);this.relatedTarget=f,S?(this.clientX=S.clientX!==void 0?S.clientX:S.pageX,this.clientY=S.clientY!==void 0?S.clientY:S.pageY,this.screenX=S.screenX||0,this.screenY=S.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:pe[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&Z.aa.h.call(this)}}y(Z,de);var pe={2:"touch",3:"pen",4:"mouse"};Z.prototype.h=function(){Z.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var We="closure_listenable_"+(1e6*Math.random()|0),ze=0;function Q(l,f,g,S,L){this.listener=l,this.proxy=null,this.src=f,this.type=g,this.capture=!!S,this.ha=L,this.key=++ze,this.da=this.fa=!1}function Te(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Pe(l){this.src=l,this.g={},this.h=0}Pe.prototype.add=function(l,f,g,S,L){var F=l.toString();l=this.g[F],l||(l=this.g[F]=[],this.h++);var X=at(l,f,S,L);return-1<X?(f=l[X],g||(f.fa=!1)):(f=new Q(f,this.src,F,!!S,L),f.fa=g,l.push(f)),f};function ot(l,f){var g=f.type;if(g in l.g){var S=l.g[g],L=Array.prototype.indexOf.call(S,f,void 0),F;(F=0<=L)&&Array.prototype.splice.call(S,L,1),F&&(Te(f),l.g[g].length==0&&(delete l.g[g],l.h--))}}function at(l,f,g,S){for(var L=0;L<l.length;++L){var F=l[L];if(!F.da&&F.listener==f&&F.capture==!!g&&F.ha==S)return L}return-1}var Dn="closure_lm_"+(1e6*Math.random()|0),pn={};function pt(l,f,g,S,L){if(Array.isArray(f)){for(var F=0;F<f.length;F++)pt(l,f[F],g,S,L);return null}return g=Ud(g),l&&l[We]?l.K(f,g,h(S)?!!S.capture:!1,L):di(l,f,g,!1,S,L)}function di(l,f,g,S,L,F){if(!f)throw Error("Invalid event type");var X=h(L)?!!L.capture:!!L,Fe=gn(l);if(Fe||(l[Dn]=Fe=new Pe(l)),g=Fe.add(f,g,S,X,F),g.proxy)return g;if(S=fi(),g.proxy=S,S.src=l,S.listener=g,l.addEventListener)Pt||(L=X),L===void 0&&(L=!1),l.addEventListener(f.toString(),S,L);else if(l.attachEvent)l.attachEvent(le(f.toString()),S);else if(l.addListener&&l.removeListener)l.addListener(S);else throw Error("addEventListener and attachEvent are unavailable.");return g}function fi(){function l(g){return f.call(l.src,l.listener,g)}const f=Ve;return l}function Bs(l,f,g,S,L){if(Array.isArray(f))for(var F=0;F<f.length;F++)Bs(l,f[F],g,S,L);else S=h(S)?!!S.capture:!!S,g=Ud(g),l&&l[We]?(l=l.i,f=String(f).toString(),f in l.g&&(F=l.g[f],g=at(F,g,S,L),-1<g&&(Te(F[g]),Array.prototype.splice.call(F,g,1),F.length==0&&(delete l.g[f],l.h--)))):l&&(l=gn(l))&&(f=l.g[f.toString()],l=-1,f&&(l=at(f,g,S,L)),(g=-1<l?f[l]:null)&&sr(g))}function sr(l){if(typeof l!="number"&&l&&!l.da){var f=l.src;if(f&&f[We])ot(f.i,l);else{var g=l.type,S=l.proxy;f.removeEventListener?f.removeEventListener(g,S,l.capture):f.detachEvent?f.detachEvent(le(g),S):f.addListener&&f.removeListener&&f.removeListener(S),(g=gn(f))?(ot(g,l),g.h==0&&(g.src=null,f[Dn]=null)):Te(l)}}}function le(l){return l in pn?pn[l]:pn[l]="on"+l}function Ve(l,f){if(l.da)l=!0;else{f=new Z(f,this);var g=l.listener,S=l.ha||l.src;l.fa&&sr(l),l=g.call(S,f)}return l}function gn(l){return l=l[Dn],l instanceof Pe?l:null}var ec="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ud(l){return typeof l=="function"?l:(l[ec]||(l[ec]=function(f){return l.handleEvent(f)}),l[ec])}function wt(){Ie.call(this),this.i=new Pe(this),this.M=this,this.F=null}y(wt,Ie),wt.prototype[We]=!0,wt.prototype.removeEventListener=function(l,f,g,S){Bs(this,l,f,g,S)};function Rt(l,f){var g,S=l.F;if(S)for(g=[];S;S=S.F)g.push(S);if(l=l.M,S=f.type||f,typeof f=="string")f=new de(f,l);else if(f instanceof de)f.target=f.target||l;else{var L=f;f=new de(S,l),C(f,L)}if(L=!0,g)for(var F=g.length-1;0<=F;F--){var X=f.g=g[F];L=Lo(X,S,!0,f)&&L}if(X=f.g=l,L=Lo(X,S,!0,f)&&L,L=Lo(X,S,!1,f)&&L,g)for(F=0;F<g.length;F++)X=f.g=g[F],L=Lo(X,S,!1,f)&&L}wt.prototype.N=function(){if(wt.aa.N.call(this),this.i){var l=this.i,f;for(f in l.g){for(var g=l.g[f],S=0;S<g.length;S++)Te(g[S]);delete l.g[f],l.h--}}this.F=null},wt.prototype.K=function(l,f,g,S){return this.i.add(String(l),f,!1,g,S)},wt.prototype.L=function(l,f,g,S){return this.i.add(String(l),f,!0,g,S)};function Lo(l,f,g,S){if(f=l.i.g[String(f)],!f)return!0;f=f.concat();for(var L=!0,F=0;F<f.length;++F){var X=f[F];if(X&&!X.da&&X.capture==g){var Fe=X.listener,gt=X.ha||X.src;X.fa&&ot(l.i,X),L=Fe.call(gt,S)!==!1&&L}}return L&&!S.defaultPrevented}function $d(l,f,g){if(typeof l=="function")g&&(l=m(l,g));else if(l&&typeof l.handleEvent=="function")l=m(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(f)?-1:a.setTimeout(l,f||0)}function Hd(l){l.g=$d(()=>{l.g=null,l.i&&(l.i=!1,Hd(l))},l.l);const f=l.h;l.h=null,l.m.apply(null,f)}class h1 extends Ie{constructor(f,g){super(),this.m=f,this.l=g,this.h=null,this.i=!1,this.g=null}j(f){this.h=arguments,this.g?this.i=!0:Hd(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ir(l){Ie.call(this),this.h=l,this.g={}}y(ir,Ie);var Wd=[];function Xd(l){k(l.g,function(f,g){this.g.hasOwnProperty(g)&&sr(f)},l),l.g={}}ir.prototype.N=function(){ir.aa.N.call(this),Xd(this)},ir.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var tc=a.JSON.stringify,d1=a.JSON.parse,f1=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function nc(){}nc.prototype.h=null;function Gd(l){return l.h||(l.h=l.i())}function Yd(){}var rr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function sc(){de.call(this,"d")}y(sc,de);function ic(){de.call(this,"c")}y(ic,de);var Us={},zd=null;function ko(){return zd=zd||new wt}Us.La="serverreachability";function qd(l){de.call(this,Us.La,l)}y(qd,de);function or(l){const f=ko();Rt(f,new qd(f))}Us.STAT_EVENT="statevent";function Kd(l,f){de.call(this,Us.STAT_EVENT,l),this.stat=f}y(Kd,de);function Nt(l){const f=ko();Rt(f,new Kd(f,l))}Us.Ma="timingevent";function Qd(l,f){de.call(this,Us.Ma,l),this.size=f}y(Qd,de);function ar(l,f){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},f)}function lr(){this.g=!0}lr.prototype.xa=function(){this.g=!1};function p1(l,f,g,S,L,F){l.info(function(){if(l.g)if(F)for(var X="",Fe=F.split("&"),gt=0;gt<Fe.length;gt++){var De=Fe[gt].split("=");if(1<De.length){var Tt=De[0];De=De[1];var Et=Tt.split("_");X=2<=Et.length&&Et[1]=="type"?X+(Tt+"="+De+"&"):X+(Tt+"=redacted&")}}else X=null;else X=F;return"XMLHTTP REQ ("+S+") [attempt "+L+"]: "+f+`
`+g+`
`+X})}function g1(l,f,g,S,L,F,X){l.info(function(){return"XMLHTTP RESP ("+S+") [ attempt "+L+"]: "+f+`
`+g+`
`+F+" "+X})}function pi(l,f,g,S){l.info(function(){return"XMLHTTP TEXT ("+f+"): "+_1(l,g)+(S?" "+S:"")})}function m1(l,f){l.info(function(){return"TIMEOUT: "+f})}lr.prototype.info=function(){};function _1(l,f){if(!l.g)return f;if(!f)return null;try{var g=JSON.parse(f);if(g){for(l=0;l<g.length;l++)if(Array.isArray(g[l])){var S=g[l];if(!(2>S.length)){var L=S[1];if(Array.isArray(L)&&!(1>L.length)){var F=L[0];if(F!="noop"&&F!="stop"&&F!="close")for(var X=1;X<L.length;X++)L[X]=""}}}}return tc(g)}catch{return f}}var Fo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Jd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},rc;function Oo(){}y(Oo,nc),Oo.prototype.g=function(){return new XMLHttpRequest},Oo.prototype.i=function(){return{}},rc=new Oo;function as(l,f,g,S){this.j=l,this.i=f,this.l=g,this.R=S||1,this.U=new ir(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Zd}function Zd(){this.i=null,this.g="",this.h=!1}var ef={},oc={};function ac(l,f,g){l.L=1,l.v=$o(Pn(f)),l.m=g,l.P=!0,tf(l,null)}function tf(l,f){l.F=Date.now(),Vo(l),l.A=Pn(l.v);var g=l.A,S=l.R;Array.isArray(S)||(S=[String(S)]),mf(g.i,"t",S),l.C=0,g=l.j.J,l.h=new Zd,l.g=jf(l.j,g?f:null,!l.m),0<l.O&&(l.M=new h1(m(l.Y,l,l.g),l.O)),f=l.U,g=l.g,S=l.ca;var L="readystatechange";Array.isArray(L)||(L&&(Wd[0]=L.toString()),L=Wd);for(var F=0;F<L.length;F++){var X=pt(g,L[F],S||f.handleEvent,!1,f.h||f);if(!X)break;f.g[X.key]=X}f=l.H?T(l.H):{},l.m?(l.u||(l.u="POST"),f["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,f)):(l.u="GET",l.g.ea(l.A,l.u,null,f)),or(),p1(l.i,l.u,l.A,l.l,l.R,l.m)}as.prototype.ca=function(l){l=l.target;const f=this.M;f&&Rn(l)==3?f.j():this.Y(l)},as.prototype.Y=function(l){try{if(l==this.g)e:{const Et=Rn(this.g);var f=this.g.Ba();const _i=this.g.Z();if(!(3>Et)&&(Et!=3||this.g&&(this.h.h||this.g.oa()||Af(this.g)))){this.J||Et!=4||f==7||(f==8||0>=_i?or(3):or(2)),lc(this);var g=this.g.Z();this.X=g;t:if(nf(this)){var S=Af(this.g);l="";var L=S.length,F=Rn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){$s(this),cr(this);var X="";break t}this.h.i=new a.TextDecoder}for(f=0;f<L;f++)this.h.h=!0,l+=this.h.i.decode(S[f],{stream:!(F&&f==L-1)});S.length=0,this.h.g+=l,this.C=0,X=this.h.g}else X=this.g.oa();if(this.o=g==200,g1(this.i,this.u,this.A,this.l,this.R,Et,g),this.o){if(this.T&&!this.K){t:{if(this.g){var Fe,gt=this.g;if((Fe=gt.g?gt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!A(Fe)){var De=Fe;break t}}De=null}if(g=De)pi(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,cc(this,g);else{this.o=!1,this.s=3,Nt(12),$s(this),cr(this);break e}}if(this.P){g=!0;let sn;for(;!this.J&&this.C<X.length;)if(sn=y1(this,X),sn==oc){Et==4&&(this.s=4,Nt(14),g=!1),pi(this.i,this.l,null,"[Incomplete Response]");break}else if(sn==ef){this.s=4,Nt(15),pi(this.i,this.l,X,"[Invalid Chunk]"),g=!1;break}else pi(this.i,this.l,sn,null),cc(this,sn);if(nf(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Et!=4||X.length!=0||this.h.h||(this.s=1,Nt(16),g=!1),this.o=this.o&&g,!g)pi(this.i,this.l,X,"[Invalid Chunked Response]"),$s(this),cr(this);else if(0<X.length&&!this.W){this.W=!0;var Tt=this.j;Tt.g==this&&Tt.ba&&!Tt.M&&(Tt.j.info("Great, no buffering proxy detected. Bytes received: "+X.length),gc(Tt),Tt.M=!0,Nt(11))}}else pi(this.i,this.l,X,null),cc(this,X);Et==4&&$s(this),this.o&&!this.J&&(Et==4?Pf(this.j,this):(this.o=!1,Vo(this)))}else L1(this.g),g==400&&0<X.indexOf("Unknown SID")?(this.s=3,Nt(12)):(this.s=0,Nt(13)),$s(this),cr(this)}}}catch{}finally{}};function nf(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function y1(l,f){var g=l.C,S=f.indexOf(`
`,g);return S==-1?oc:(g=Number(f.substring(g,S)),isNaN(g)?ef:(S+=1,S+g>f.length?oc:(f=f.slice(S,S+g),l.C=S+g,f)))}as.prototype.cancel=function(){this.J=!0,$s(this)};function Vo(l){l.S=Date.now()+l.I,sf(l,l.I)}function sf(l,f){if(l.B!=null)throw Error("WatchDog timer not null");l.B=ar(m(l.ba,l),f)}function lc(l){l.B&&(a.clearTimeout(l.B),l.B=null)}as.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?(m1(this.i,this.A),this.L!=2&&(or(),Nt(17)),$s(this),this.s=2,cr(this)):sf(this,this.S-l)};function cr(l){l.j.G==0||l.J||Pf(l.j,l)}function $s(l){lc(l);var f=l.M;f&&typeof f.ma=="function"&&f.ma(),l.M=null,Xd(l.U),l.g&&(f=l.g,l.g=null,f.abort(),f.ma())}function cc(l,f){try{var g=l.j;if(g.G!=0&&(g.g==l||uc(g.h,l))){if(!l.K&&uc(g.h,l)&&g.G==3){try{var S=g.Da.g.parse(f)}catch{S=null}if(Array.isArray(S)&&S.length==3){var L=S;if(L[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<l.F)zo(g),Go(g);else break e;pc(g),Nt(18)}}else g.za=L[1],0<g.za-g.T&&37500>L[2]&&g.F&&g.v==0&&!g.C&&(g.C=ar(m(g.Za,g),6e3));if(1>=af(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else Ws(g,11)}else if((l.K||g.g==l)&&zo(g),!A(f))for(L=g.Da.g.parse(f),f=0;f<L.length;f++){let De=L[f];if(g.T=De[0],De=De[1],g.G==2)if(De[0]=="c"){g.K=De[1],g.ia=De[2];const Tt=De[3];Tt!=null&&(g.la=Tt,g.j.info("VER="+g.la));const Et=De[4];Et!=null&&(g.Aa=Et,g.j.info("SVER="+g.Aa));const _i=De[5];_i!=null&&typeof _i=="number"&&0<_i&&(S=1.5*_i,g.L=S,g.j.info("backChannelRequestTimeoutMs_="+S)),S=g;const sn=l.g;if(sn){const Ko=sn.g?sn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ko){var F=S.h;F.g||Ko.indexOf("spdy")==-1&&Ko.indexOf("quic")==-1&&Ko.indexOf("h2")==-1||(F.j=F.l,F.g=new Set,F.h&&(hc(F,F.h),F.h=null))}if(S.D){const mc=sn.g?sn.g.getResponseHeader("X-HTTP-Session-Id"):null;mc&&(S.ya=mc,$e(S.I,S.D,mc))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-l.F,g.j.info("Handshake RTT: "+g.R+"ms")),S=g;var X=l;if(S.qa=Mf(S,S.J?S.ia:null,S.W),X.K){lf(S.h,X);var Fe=X,gt=S.L;gt&&(Fe.I=gt),Fe.B&&(lc(Fe),Vo(Fe)),S.g=X}else Cf(S);0<g.i.length&&Yo(g)}else De[0]!="stop"&&De[0]!="close"||Ws(g,7);else g.G==3&&(De[0]=="stop"||De[0]=="close"?De[0]=="stop"?Ws(g,7):fc(g):De[0]!="noop"&&g.l&&g.l.ta(De),g.v=0)}}or(4)}catch{}}var v1=class{constructor(l,f){this.g=l,this.map=f}};function rf(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function of(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function af(l){return l.h?1:l.g?l.g.size:0}function uc(l,f){return l.h?l.h==f:l.g?l.g.has(f):!1}function hc(l,f){l.g?l.g.add(f):l.h=f}function lf(l,f){l.h&&l.h==f?l.h=null:l.g&&l.g.has(f)&&l.g.delete(f)}rf.prototype.cancel=function(){if(this.i=cf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function cf(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let f=l.i;for(const g of l.g.values())f=f.concat(g.D);return f}return v(l.i)}function w1(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(u(l)){for(var f=[],g=l.length,S=0;S<g;S++)f.push(l[S]);return f}f=[],g=0;for(S in l)f[g++]=l[S];return f}function T1(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||typeof l=="string"){var f=[];l=l.length;for(var g=0;g<l;g++)f.push(g);return f}f=[],g=0;for(const S in l)f[g++]=S;return f}}}function uf(l,f){if(l.forEach&&typeof l.forEach=="function")l.forEach(f,void 0);else if(u(l)||typeof l=="string")Array.prototype.forEach.call(l,f,void 0);else for(var g=T1(l),S=w1(l),L=S.length,F=0;F<L;F++)f.call(void 0,S[F],g&&g[F],l)}var hf=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function E1(l,f){if(l){l=l.split("&");for(var g=0;g<l.length;g++){var S=l[g].indexOf("="),L=null;if(0<=S){var F=l[g].substring(0,S);L=l[g].substring(S+1)}else F=l[g];f(F,L?decodeURIComponent(L.replace(/\+/g," ")):"")}}}function Hs(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof Hs){this.h=l.h,Bo(this,l.j),this.o=l.o,this.g=l.g,Uo(this,l.s),this.l=l.l;var f=l.i,g=new dr;g.i=f.i,f.g&&(g.g=new Map(f.g),g.h=f.h),df(this,g),this.m=l.m}else l&&(f=String(l).match(hf))?(this.h=!1,Bo(this,f[1]||"",!0),this.o=ur(f[2]||""),this.g=ur(f[3]||"",!0),Uo(this,f[4]),this.l=ur(f[5]||"",!0),df(this,f[6]||"",!0),this.m=ur(f[7]||"")):(this.h=!1,this.i=new dr(null,this.h))}Hs.prototype.toString=function(){var l=[],f=this.j;f&&l.push(hr(f,ff,!0),":");var g=this.g;return(g||f=="file")&&(l.push("//"),(f=this.o)&&l.push(hr(f,ff,!0),"@"),l.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&l.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&l.push("/"),l.push(hr(g,g.charAt(0)=="/"?x1:I1,!0))),(g=this.i.toString())&&l.push("?",g),(g=this.m)&&l.push("#",hr(g,b1)),l.join("")};function Pn(l){return new Hs(l)}function Bo(l,f,g){l.j=g?ur(f,!0):f,l.j&&(l.j=l.j.replace(/:$/,""))}function Uo(l,f){if(f){if(f=Number(f),isNaN(f)||0>f)throw Error("Bad port number "+f);l.s=f}else l.s=null}function df(l,f,g){f instanceof dr?(l.i=f,C1(l.i,l.h)):(g||(f=hr(f,S1)),l.i=new dr(f,l.h))}function $e(l,f,g){l.i.set(f,g)}function $o(l){return $e(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function ur(l,f){return l?f?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function hr(l,f,g){return typeof l=="string"?(l=encodeURI(l).replace(f,A1),g&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function A1(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var ff=/[#\/\?@]/g,I1=/[#\?:]/g,x1=/[#\?]/g,S1=/[#\?@]/g,b1=/#/g;function dr(l,f){this.h=this.g=null,this.i=l||null,this.j=!!f}function ls(l){l.g||(l.g=new Map,l.h=0,l.i&&E1(l.i,function(f,g){l.add(decodeURIComponent(f.replace(/\+/g," ")),g)}))}t=dr.prototype,t.add=function(l,f){ls(this),this.i=null,l=gi(this,l);var g=this.g.get(l);return g||this.g.set(l,g=[]),g.push(f),this.h+=1,this};function pf(l,f){ls(l),f=gi(l,f),l.g.has(f)&&(l.i=null,l.h-=l.g.get(f).length,l.g.delete(f))}function gf(l,f){return ls(l),f=gi(l,f),l.g.has(f)}t.forEach=function(l,f){ls(this),this.g.forEach(function(g,S){g.forEach(function(L){l.call(f,L,S,this)},this)},this)},t.na=function(){ls(this);const l=Array.from(this.g.values()),f=Array.from(this.g.keys()),g=[];for(let S=0;S<f.length;S++){const L=l[S];for(let F=0;F<L.length;F++)g.push(f[S])}return g},t.V=function(l){ls(this);let f=[];if(typeof l=="string")gf(this,l)&&(f=f.concat(this.g.get(gi(this,l))));else{l=Array.from(this.g.values());for(let g=0;g<l.length;g++)f=f.concat(l[g])}return f},t.set=function(l,f){return ls(this),this.i=null,l=gi(this,l),gf(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[f]),this.h+=1,this},t.get=function(l,f){return l?(l=this.V(l),0<l.length?String(l[0]):f):f};function mf(l,f,g){pf(l,f),0<g.length&&(l.i=null,l.g.set(gi(l,f),v(g)),l.h+=g.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],f=Array.from(this.g.keys());for(var g=0;g<f.length;g++){var S=f[g];const F=encodeURIComponent(String(S)),X=this.V(S);for(S=0;S<X.length;S++){var L=F;X[S]!==""&&(L+="="+encodeURIComponent(String(X[S]))),l.push(L)}}return this.i=l.join("&")};function gi(l,f){return f=String(f),l.j&&(f=f.toLowerCase()),f}function C1(l,f){f&&!l.j&&(ls(l),l.i=null,l.g.forEach(function(g,S){var L=S.toLowerCase();S!=L&&(pf(this,S),mf(this,L,g))},l)),l.j=f}function D1(l,f){const g=new lr;if(a.Image){const S=new Image;S.onload=_(cs,g,"TestLoadImage: loaded",!0,f,S),S.onerror=_(cs,g,"TestLoadImage: error",!1,f,S),S.onabort=_(cs,g,"TestLoadImage: abort",!1,f,S),S.ontimeout=_(cs,g,"TestLoadImage: timeout",!1,f,S),a.setTimeout(function(){S.ontimeout&&S.ontimeout()},1e4),S.src=l}else f(!1)}function P1(l,f){const g=new lr,S=new AbortController,L=setTimeout(()=>{S.abort(),cs(g,"TestPingServer: timeout",!1,f)},1e4);fetch(l,{signal:S.signal}).then(F=>{clearTimeout(L),F.ok?cs(g,"TestPingServer: ok",!0,f):cs(g,"TestPingServer: server error",!1,f)}).catch(()=>{clearTimeout(L),cs(g,"TestPingServer: error",!1,f)})}function cs(l,f,g,S,L){try{L&&(L.onload=null,L.onerror=null,L.onabort=null,L.ontimeout=null),S(g)}catch{}}function R1(){this.g=new f1}function N1(l,f,g){const S=g||"";try{uf(l,function(L,F){let X=L;h(L)&&(X=tc(L)),f.push(S+F+"="+encodeURIComponent(X))})}catch(L){throw f.push(S+"type="+encodeURIComponent("_badmap")),L}}function Ho(l){this.l=l.Ub||null,this.j=l.eb||!1}y(Ho,nc),Ho.prototype.g=function(){return new Wo(this.l,this.j)},Ho.prototype.i=function(l){return function(){return l}}({});function Wo(l,f){wt.call(this),this.D=l,this.o=f,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}y(Wo,wt),t=Wo.prototype,t.open=function(l,f){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=f,this.readyState=1,pr(this)},t.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const f={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(f.body=l),(this.D||a).fetch(new Request(this.A,f)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,fr(this)),this.readyState=0},t.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,pr(this)),this.g&&(this.readyState=3,pr(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;_f(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function _f(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}t.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var f=l.value?l.value:new Uint8Array(0);(f=this.v.decode(f,{stream:!l.done}))&&(this.response=this.responseText+=f)}l.done?fr(this):pr(this),this.readyState==3&&_f(this)}},t.Ra=function(l){this.g&&(this.response=this.responseText=l,fr(this))},t.Qa=function(l){this.g&&(this.response=l,fr(this))},t.ga=function(){this.g&&fr(this)};function fr(l){l.readyState=4,l.l=null,l.j=null,l.v=null,pr(l)}t.setRequestHeader=function(l,f){this.u.append(l,f)},t.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],f=this.h.entries();for(var g=f.next();!g.done;)g=g.value,l.push(g[0]+": "+g[1]),g=f.next();return l.join(`\r
`)};function pr(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Wo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function yf(l){let f="";return k(l,function(g,S){f+=S,f+=":",f+=g,f+=`\r
`}),f}function dc(l,f,g){e:{for(S in g){var S=!1;break e}S=!0}S||(g=yf(g),typeof l=="string"?g!=null&&encodeURIComponent(String(g)):$e(l,f,g))}function qe(l){wt.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}y(qe,wt);var M1=/^https?$/i,j1=["POST","PUT"];t=qe.prototype,t.Ha=function(l){this.J=l},t.ea=function(l,f,g,S){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);f=f?f.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():rc.g(),this.v=this.o?Gd(this.o):Gd(rc),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(f,String(l),!0),this.B=!1}catch(F){vf(this,F);return}if(l=g||"",g=new Map(this.headers),S)if(Object.getPrototypeOf(S)===Object.prototype)for(var L in S)g.set(L,S[L]);else if(typeof S.keys=="function"&&typeof S.get=="function")for(const F of S.keys())g.set(F,S.get(F));else throw Error("Unknown input type for opt_headers: "+String(S));S=Array.from(g.keys()).find(F=>F.toLowerCase()=="content-type"),L=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(j1,f,void 0))||S||L||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[F,X]of g)this.g.setRequestHeader(F,X);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ef(this),this.u=!0,this.g.send(l),this.u=!1}catch(F){vf(this,F)}};function vf(l,f){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=f,l.m=5,wf(l),Xo(l)}function wf(l){l.A||(l.A=!0,Rt(l,"complete"),Rt(l,"error"))}t.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,Rt(this,"complete"),Rt(this,"abort"),Xo(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Xo(this,!0)),qe.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Tf(this):this.bb())},t.bb=function(){Tf(this)};function Tf(l){if(l.h&&typeof o<"u"&&(!l.v[1]||Rn(l)!=4||l.Z()!=2)){if(l.u&&Rn(l)==4)$d(l.Ea,0,l);else if(Rt(l,"readystatechange"),Rn(l)==4){l.h=!1;try{const X=l.Z();e:switch(X){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var f=!0;break e;default:f=!1}var g;if(!(g=f)){var S;if(S=X===0){var L=String(l.D).match(hf)[1]||null;!L&&a.self&&a.self.location&&(L=a.self.location.protocol.slice(0,-1)),S=!M1.test(L?L.toLowerCase():"")}g=S}if(g)Rt(l,"complete"),Rt(l,"success");else{l.m=6;try{var F=2<Rn(l)?l.g.statusText:""}catch{F=""}l.l=F+" ["+l.Z()+"]",wf(l)}}finally{Xo(l)}}}}function Xo(l,f){if(l.g){Ef(l);const g=l.g,S=l.v[0]?()=>{}:null;l.g=null,l.v=null,f||Rt(l,"ready");try{g.onreadystatechange=S}catch{}}}function Ef(l){l.I&&(a.clearTimeout(l.I),l.I=null)}t.isActive=function(){return!!this.g};function Rn(l){return l.g?l.g.readyState:0}t.Z=function(){try{return 2<Rn(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(l){if(this.g){var f=this.g.responseText;return l&&f.indexOf(l)==0&&(f=f.substring(l.length)),d1(f)}};function Af(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function L1(l){const f={};l=(l.g&&2<=Rn(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let S=0;S<l.length;S++){if(A(l[S]))continue;var g=D(l[S]);const L=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const F=f[L]||[];f[L]=F,F.push(g)}x(f,function(S){return S.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function gr(l,f,g){return g&&g.internalChannelParams&&g.internalChannelParams[l]||f}function If(l){this.Aa=0,this.i=[],this.j=new lr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=gr("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=gr("baseRetryDelayMs",5e3,l),this.cb=gr("retryDelaySeedMs",1e4,l),this.Wa=gr("forwardChannelMaxRetries",2,l),this.wa=gr("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new rf(l&&l.concurrentRequestLimit),this.Da=new R1,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=If.prototype,t.la=8,t.G=1,t.connect=function(l,f,g,S){Nt(0),this.W=l,this.H=f||{},g&&S!==void 0&&(this.H.OSID=g,this.H.OAID=S),this.F=this.X,this.I=Mf(this,null,this.W),Yo(this)};function fc(l){if(xf(l),l.G==3){var f=l.U++,g=Pn(l.I);if($e(g,"SID",l.K),$e(g,"RID",f),$e(g,"TYPE","terminate"),mr(l,g),f=new as(l,l.j,f),f.L=2,f.v=$o(Pn(g)),g=!1,a.navigator&&a.navigator.sendBeacon)try{g=a.navigator.sendBeacon(f.v.toString(),"")}catch{}!g&&a.Image&&(new Image().src=f.v,g=!0),g||(f.g=jf(f.j,null),f.g.ea(f.v)),f.F=Date.now(),Vo(f)}Nf(l)}function Go(l){l.g&&(gc(l),l.g.cancel(),l.g=null)}function xf(l){Go(l),l.u&&(a.clearTimeout(l.u),l.u=null),zo(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function Yo(l){if(!of(l.h)&&!l.s){l.s=!0;var f=l.Ga;we||se(),je||(we(),je=!0),ne.add(f,l),l.B=0}}function k1(l,f){return af(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=f.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=ar(m(l.Ga,l,f),Rf(l,l.B)),l.B++,!0)}t.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const L=new as(this,this.j,l);let F=this.o;if(this.S&&(F?(F=T(F),C(F,this.S)):F=this.S),this.m!==null||this.O||(L.H=F,F=null),this.P)e:{for(var f=0,g=0;g<this.i.length;g++){t:{var S=this.i[g];if("__data__"in S.map&&(S=S.map.__data__,typeof S=="string")){S=S.length;break t}S=void 0}if(S===void 0)break;if(f+=S,4096<f){f=g;break e}if(f===4096||g===this.i.length-1){f=g+1;break e}}f=1e3}else f=1e3;f=bf(this,L,f),g=Pn(this.I),$e(g,"RID",l),$e(g,"CVER",22),this.D&&$e(g,"X-HTTP-Session-Id",this.D),mr(this,g),F&&(this.O?f="headers="+encodeURIComponent(String(yf(F)))+"&"+f:this.m&&dc(g,this.m,F)),hc(this.h,L),this.Ua&&$e(g,"TYPE","init"),this.P?($e(g,"$req",f),$e(g,"SID","null"),L.T=!0,ac(L,g,null)):ac(L,g,f),this.G=2}}else this.G==3&&(l?Sf(this,l):this.i.length==0||of(this.h)||Sf(this))};function Sf(l,f){var g;f?g=f.l:g=l.U++;const S=Pn(l.I);$e(S,"SID",l.K),$e(S,"RID",g),$e(S,"AID",l.T),mr(l,S),l.m&&l.o&&dc(S,l.m,l.o),g=new as(l,l.j,g,l.B+1),l.m===null&&(g.H=l.o),f&&(l.i=f.D.concat(l.i)),f=bf(l,g,1e3),g.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),hc(l.h,g),ac(g,S,f)}function mr(l,f){l.H&&k(l.H,function(g,S){$e(f,S,g)}),l.l&&uf({},function(g,S){$e(f,S,g)})}function bf(l,f,g){g=Math.min(l.i.length,g);var S=l.l?m(l.l.Na,l.l,l):null;e:{var L=l.i;let F=-1;for(;;){const X=["count="+g];F==-1?0<g?(F=L[0].g,X.push("ofs="+F)):F=0:X.push("ofs="+F);let Fe=!0;for(let gt=0;gt<g;gt++){let De=L[gt].g;const Tt=L[gt].map;if(De-=F,0>De)F=Math.max(0,L[gt].g-100),Fe=!1;else try{N1(Tt,X,"req"+De+"_")}catch{S&&S(Tt)}}if(Fe){S=X.join("&");break e}}}return l=l.i.splice(0,g),f.D=l,S}function Cf(l){if(!l.g&&!l.u){l.Y=1;var f=l.Fa;we||se(),je||(we(),je=!0),ne.add(f,l),l.v=0}}function pc(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=ar(m(l.Fa,l),Rf(l,l.v)),l.v++,!0)}t.Fa=function(){if(this.u=null,Df(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=ar(m(this.ab,this),l)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Nt(10),Go(this),Df(this))};function gc(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function Df(l){l.g=new as(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var f=Pn(l.qa);$e(f,"RID","rpc"),$e(f,"SID",l.K),$e(f,"AID",l.T),$e(f,"CI",l.F?"0":"1"),!l.F&&l.ja&&$e(f,"TO",l.ja),$e(f,"TYPE","xmlhttp"),mr(l,f),l.m&&l.o&&dc(f,l.m,l.o),l.L&&(l.g.I=l.L);var g=l.g;l=l.ia,g.L=1,g.v=$o(Pn(f)),g.m=null,g.P=!0,tf(g,l)}t.Za=function(){this.C!=null&&(this.C=null,Go(this),pc(this),Nt(19))};function zo(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function Pf(l,f){var g=null;if(l.g==f){zo(l),gc(l),l.g=null;var S=2}else if(uc(l.h,f))g=f.D,lf(l.h,f),S=1;else return;if(l.G!=0){if(f.o)if(S==1){g=f.m?f.m.length:0,f=Date.now()-f.F;var L=l.B;S=ko(),Rt(S,new Qd(S,g)),Yo(l)}else Cf(l);else if(L=f.s,L==3||L==0&&0<f.X||!(S==1&&k1(l,f)||S==2&&pc(l)))switch(g&&0<g.length&&(f=l.h,f.i=f.i.concat(g)),L){case 1:Ws(l,5);break;case 4:Ws(l,10);break;case 3:Ws(l,6);break;default:Ws(l,2)}}}function Rf(l,f){let g=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(g*=2),g*f}function Ws(l,f){if(l.j.info("Error code "+f),f==2){var g=m(l.fb,l),S=l.Xa;const L=!S;S=new Hs(S||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Bo(S,"https"),$o(S),L?D1(S.toString(),g):P1(S.toString(),g)}else Nt(2);l.G=0,l.l&&l.l.sa(f),Nf(l),xf(l)}t.fb=function(l){l?(this.j.info("Successfully pinged google.com"),Nt(2)):(this.j.info("Failed to ping google.com"),Nt(1))};function Nf(l){if(l.G=0,l.ka=[],l.l){const f=cf(l.h);(f.length!=0||l.i.length!=0)&&(w(l.ka,f),w(l.ka,l.i),l.h.i.length=0,v(l.i),l.i.length=0),l.l.ra()}}function Mf(l,f,g){var S=g instanceof Hs?Pn(g):new Hs(g);if(S.g!="")f&&(S.g=f+"."+S.g),Uo(S,S.s);else{var L=a.location;S=L.protocol,f=f?f+"."+L.hostname:L.hostname,L=+L.port;var F=new Hs(null);S&&Bo(F,S),f&&(F.g=f),L&&Uo(F,L),g&&(F.l=g),S=F}return g=l.D,f=l.ya,g&&f&&$e(S,g,f),$e(S,"VER",l.la),mr(l,S),S}function jf(l,f,g){if(f&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return f=l.Ca&&!l.pa?new qe(new Ho({eb:g})):new qe(l.pa),f.Ha(l.J),f}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Lf(){}t=Lf.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function qo(){}qo.prototype.g=function(l,f){return new Bt(l,f)};function Bt(l,f){wt.call(this),this.g=new If(f),this.l=l,this.h=f&&f.messageUrlParams||null,l=f&&f.messageHeaders||null,f&&f.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=f&&f.initMessageHeaders||null,f&&f.messageContentType&&(l?l["X-WebChannel-Content-Type"]=f.messageContentType:l={"X-WebChannel-Content-Type":f.messageContentType}),f&&f.va&&(l?l["X-WebChannel-Client-Profile"]=f.va:l={"X-WebChannel-Client-Profile":f.va}),this.g.S=l,(l=f&&f.Sb)&&!A(l)&&(this.g.m=l),this.v=f&&f.supportsCrossDomainXhr||!1,this.u=f&&f.sendRawJson||!1,(f=f&&f.httpSessionIdParam)&&!A(f)&&(this.g.D=f,l=this.h,l!==null&&f in l&&(l=this.h,f in l&&delete l[f])),this.j=new mi(this)}y(Bt,wt),Bt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Bt.prototype.close=function(){fc(this.g)},Bt.prototype.o=function(l){var f=this.g;if(typeof l=="string"){var g={};g.__data__=l,l=g}else this.u&&(g={},g.__data__=tc(l),l=g);f.i.push(new v1(f.Ya++,l)),f.G==3&&Yo(f)},Bt.prototype.N=function(){this.g.l=null,delete this.j,fc(this.g),delete this.g,Bt.aa.N.call(this)};function kf(l){sc.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var f=l.__sm__;if(f){e:{for(const g in f){l=g;break e}l=void 0}(this.i=l)&&(l=this.i,f=f!==null&&l in f?f[l]:void 0),this.data=f}else this.data=l}y(kf,sc);function Ff(){ic.call(this),this.status=1}y(Ff,ic);function mi(l){this.g=l}y(mi,Lf),mi.prototype.ua=function(){Rt(this.g,"a")},mi.prototype.ta=function(l){Rt(this.g,new kf(l))},mi.prototype.sa=function(l){Rt(this.g,new Ff)},mi.prototype.ra=function(){Rt(this.g,"b")},qo.prototype.createWebChannel=qo.prototype.g,Bt.prototype.send=Bt.prototype.o,Bt.prototype.open=Bt.prototype.m,Bt.prototype.close=Bt.prototype.close,P0=function(){return new qo},D0=function(){return ko()},C0=Us,Cu={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Fo.NO_ERROR=0,Fo.TIMEOUT=8,Fo.HTTP_ERROR=6,Ra=Fo,Jd.COMPLETE="complete",b0=Jd,Yd.EventType=rr,rr.OPEN="a",rr.CLOSE="b",rr.ERROR="c",rr.MESSAGE="d",wt.prototype.listen=wt.prototype.K,Pr=Yd,qe.prototype.listenOnce=qe.prototype.L,qe.prototype.getLastError=qe.prototype.Ka,qe.prototype.getLastErrorCode=qe.prototype.Ba,qe.prototype.getStatus=qe.prototype.Z,qe.prototype.getResponseJson=qe.prototype.Oa,qe.prototype.getResponseText=qe.prototype.oa,qe.prototype.send=qe.prototype.ea,qe.prototype.setWithCredentials=qe.prototype.Ha,S0=qe}).apply(typeof Zo<"u"?Zo:typeof self<"u"?self:typeof window<"u"?window:{});const _p="@firebase/firestore",yp="4.8.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}xt.UNAUTHENTICATED=new xt(null),xt.GOOGLE_CREDENTIALS=new xt("google-credentials-uid"),xt.FIRST_PARTY=new xt("first-party-uid"),xt.MOCK_USER=new xt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xi="11.10.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const si=new bh("@firebase/firestore");function wi(){return si.logLevel}function q(t,...e){if(si.logLevel<=Ee.DEBUG){const n=e.map(Uh);si.debug(`Firestore (${Xi}): ${t}`,...n)}}function Qn(t,...e){if(si.logLevel<=Ee.ERROR){const n=e.map(Uh);si.error(`Firestore (${Xi}): ${t}`,...n)}}function Ss(t,...e){if(si.logLevel<=Ee.WARN){const n=e.map(Uh);si.warn(`Firestore (${Xi}): ${t}`,...n)}}function Uh(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function re(t,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,R0(t,s,n)}function R0(t,e,n){let s=`FIRESTORE (${Xi}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{s+=" CONTEXT: "+JSON.stringify(n)}catch{s+=" CONTEXT: "+n}throw Qn(s),new Error(s)}function Ne(t,e,n,s){let i="Unexpected state";typeof n=="string"?i=n:s=n,t||R0(e,i,s)}function he(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Y extends ns{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N0{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class fE{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(xt.UNAUTHENTICATED))}shutdown(){}}class pE{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class gE{constructor(e){this.t=e,this.currentUser=xt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Ne(this.o===void 0,42304);let s=this.i;const i=u=>this.i!==s?(s=this.i,n(u)):Promise.resolve();let r=new zn;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new zn,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const u=r;e.enqueueRetryable(async()=>{await u.promise,await i(this.currentUser)})},a=u=>{q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?a(u):(q("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new zn)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(s=>this.i!==e?(q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(Ne(typeof s.accessToken=="string",31837,{l:s}),new N0(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ne(e===null||typeof e=="string",2055,{h:e}),new xt(e)}}class mE{constructor(e,n,s){this.P=e,this.T=n,this.I=s,this.type="FirstParty",this.user=xt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class _E{constructor(e,n,s){this.P=e,this.T=n,this.I=s}getToken(){return Promise.resolve(new mE(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(xt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class vp{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class yE{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,$t(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Ne(this.o===void 0,3512);const s=r=>{r.error!=null&&q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const o=r.token!==this.m;return this.m=r.token,q("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable(()=>s(r))};const i=r=>{q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(r=>i(r)),setTimeout(()=>{if(!this.appCheck){const r=this.V.getImmediate({optional:!0});r?i(r):q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new vp(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Ne(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new vp(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vE(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let s=0;s<t;s++)n[s]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M0(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $h{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const i=vE(40);for(let r=0;r<i.length;++r)s.length<20&&i[r]<n&&(s+=e.charAt(i[r]%62))}return s}}function ve(t,e){return t<e?-1:t>e?1:0}function Du(t,e){let n=0;for(;n<t.length&&n<e.length;){const s=t.codePointAt(n),i=e.codePointAt(n);if(s!==i){if(s<128&&i<128)return ve(s,i);{const r=M0(),o=wE(r.encode(wp(t,n)),r.encode(wp(e,n)));return o!==0?o:ve(s,i)}}n+=s>65535?2:1}return ve(t.length,e.length)}function wp(t,e){return t.codePointAt(e)>65535?t.substring(e,e+2):t.substring(e,e+1)}function wE(t,e){for(let n=0;n<t.length&&n<e.length;++n)if(t[n]!==e[n])return ve(t[n],e[n]);return ve(t.length,e.length)}function Li(t,e,n){return t.length===e.length&&t.every((s,i)=>n(s,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tp="__name__";class wn{constructor(e,n,s){n===void 0?n=0:n>e.length&&re(637,{offset:n,range:e.length}),s===void 0?s=e.length-n:s>e.length-n&&re(1746,{length:s,range:e.length-n}),this.segments=e,this.offset=n,this.len=s}get length(){return this.len}isEqual(e){return wn.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof wn?e.forEach(s=>{n.push(s)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,s=this.limit();n<s;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const s=Math.min(e.length,n.length);for(let i=0;i<s;i++){const r=wn.compareSegments(e.get(i),n.get(i));if(r!==0)return r}return ve(e.length,n.length)}static compareSegments(e,n){const s=wn.isNumericId(e),i=wn.isNumericId(n);return s&&!i?-1:!s&&i?1:s&&i?wn.extractNumericId(e).compare(wn.extractNumericId(n)):Du(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return As.fromString(e.substring(4,e.length-2))}}class Be extends wn{construct(e,n,s){return new Be(e,n,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const s of e){if(s.indexOf("//")>=0)throw new Y(B.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);n.push(...s.split("/").filter(i=>i.length>0))}return new Be(n)}static emptyPath(){return new Be([])}}const TE=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class yt extends wn{construct(e,n,s){return new yt(e,n,s)}static isValidIdentifier(e){return TE.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),yt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Tp}static keyField(){return new yt([Tp])}static fromServerFormat(e){const n=[];let s="",i=0;const r=()=>{if(s.length===0)throw new Y(B.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(s),s=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new Y(B.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new Y(B.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(s+=a,i++):(r(),i++)}if(r(),o)throw new Y(B.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new yt(n)}static emptyPath(){return new yt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J{constructor(e){this.path=e}static fromPath(e){return new J(Be.fromString(e))}static fromName(e){return new J(Be.fromString(e).popFirst(5))}static empty(){return new J(Be.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Be.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Be.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new J(new Be(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j0(t,e,n){if(!n)throw new Y(B.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function EE(t,e,n,s){if(e===!0&&s===!0)throw new Y(B.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Ep(t){if(!J.isDocumentKey(t))throw new Y(B.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Ap(t){if(J.isDocumentKey(t))throw new Y(B.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function L0(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Cl(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":re(12329,{type:typeof t})}function Jn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Y(B.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Cl(t);throw new Y(B.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function it(t,e){const n={typeString:t};return e&&(n.value=e),n}function Ao(t,e){if(!L0(t))throw new Y(B.INVALID_ARGUMENT,"JSON must be an object");let n;for(const s in e)if(e[s]){const i=e[s].typeString,r="value"in e[s]?{value:e[s].value}:void 0;if(!(s in t)){n=`JSON missing required field: '${s}'`;break}const o=t[s];if(i&&typeof o!==i){n=`JSON field '${s}' must be a ${i}.`;break}if(r!==void 0&&o!==r.value){n=`Expected '${s}' field to equal '${r.value}'`;break}}if(n)throw new Y(B.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ip=-62135596800,xp=1e6;class He{static now(){return He.fromMillis(Date.now())}static fromDate(e){return He.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),s=Math.floor((e-1e3*n)*xp);return new He(n,s)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Y(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Y(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Ip)throw new Y(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Y(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/xp}_compareTo(e){return this.seconds===e.seconds?ve(this.nanoseconds,e.nanoseconds):ve(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:He._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ao(e,He._jsonSchema))return new He(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Ip;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}He._jsonSchemaVersion="firestore/timestamp/1.0",He._jsonSchema={type:it("string",He._jsonSchemaVersion),seconds:it("number"),nanoseconds:it("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ae{static fromTimestamp(e){return new ae(e)}static min(){return new ae(new He(0,0))}static max(){return new ae(new He(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zr=-1;function AE(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,i=ae.fromTimestamp(s===1e9?new He(n+1,0):new He(n,s));return new bs(i,J.empty(),e)}function IE(t){return new bs(t.readTime,t.key,Zr)}class bs{constructor(e,n,s){this.readTime=e,this.documentKey=n,this.largestBatchId=s}static min(){return new bs(ae.min(),J.empty(),Zr)}static max(){return new bs(ae.max(),J.empty(),Zr)}}function xE(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=J.comparator(t.documentKey,e.documentKey),n!==0?n:ve(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class bE{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gi(t){if(t.code!==B.FAILED_PRECONDITION||t.message!==SE)throw t;q("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&re(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new U((s,i)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(s,i)},this.catchCallback=r=>{this.wrapFailure(n,r).next(s,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof U?n:U.resolve(n)}catch(n){return U.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):U.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):U.reject(n)}static resolve(e){return new U((n,s)=>{n(e)})}static reject(e){return new U((n,s)=>{s(e)})}static waitFor(e){return new U((n,s)=>{let i=0,r=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++r,o&&r===i&&n()},u=>s(u))}),o=!0,r===i&&n()})}static or(e){let n=U.resolve(!1);for(const s of e)n=n.next(i=>i?U.resolve(i):s());return n}static forEach(e,n){const s=[];return e.forEach((i,r)=>{s.push(n.call(this,i,r))}),this.waitFor(s)}static mapArray(e,n){return new U((s,i)=>{const r=e.length,o=new Array(r);let a=0;for(let u=0;u<r;u++){const h=u;n(e[h]).next(d=>{o[h]=d,++a,a===r&&s(o)},d=>i(d))}})}static doWhile(e,n){return new U((s,i)=>{const r=()=>{e()===!0?n().next(()=>{r()},i):s()};r()})}}function CE(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Yi(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dl{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=s=>this._e(s),this.ae=s=>n.writeSequenceNumber(s))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}Dl.ue=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hh=-1;function Pl(t){return t==null}function za(t){return t===0&&1/t==-1/0}function DE(t){return typeof t=="number"&&Number.isInteger(t)&&!za(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k0="";function PE(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Sp(e)),e=RE(t.get(n),e);return Sp(e)}function RE(t,e){let n=e;const s=t.length;for(let i=0;i<s;i++){const r=t.charAt(i);switch(r){case"\0":n+="";break;case k0:n+="";break;default:n+=r}}return n}function Sp(t){return t+k0+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bp(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ks(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function F0(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ye{constructor(e,n){this.comparator=e,this.root=n||_t.EMPTY}insert(e,n){return new Ye(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,_t.BLACK,null,null))}remove(e){return new Ye(this.comparator,this.root.remove(e,this.comparator).copy(null,null,_t.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(s===0)return n.value;s<0?n=n.left:s>0&&(n=n.right)}return null}indexOf(e){let n=0,s=this.root;for(;!s.isEmpty();){const i=this.comparator(e,s.key);if(i===0)return n+s.left.size;i<0?s=s.left:(n+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,s)=>(e(n,s),!1))}toString(){const e=[];return this.inorderTraversal((n,s)=>(e.push(`${n}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ea(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ea(this.root,e,this.comparator,!1)}getReverseIterator(){return new ea(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ea(this.root,e,this.comparator,!0)}}class ea{constructor(e,n,s,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=n?s(e.key,n):1,n&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class _t{constructor(e,n,s,i,r){this.key=e,this.value=n,this.color=s??_t.RED,this.left=i??_t.EMPTY,this.right=r??_t.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,s,i,r){return new _t(e??this.key,n??this.value,s??this.color,i??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,s){let i=this;const r=s(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,n,s),null):r===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,s)),i.fixUp()}removeMin(){if(this.left.isEmpty())return _t.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let s,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return _t.EMPTY;s=i.right.min(),i=i.copy(s.key,s.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,_t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,_t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw re(43730,{key:this.key,value:this.value});if(this.right.isRed())throw re(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw re(27949);return e+(this.isRed()?0:1)}}_t.EMPTY=null,_t.RED=!0,_t.BLACK=!1;_t.EMPTY=new class{constructor(){this.size=0}get key(){throw re(57766)}get value(){throw re(16141)}get color(){throw re(16727)}get left(){throw re(29726)}get right(){throw re(36894)}copy(e,n,s,i,r){return this}insert(e,n,s){return new _t(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(e){this.comparator=e,this.data=new Ye(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,s)=>(e(n),!1))}forEachInRange(e,n){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const i=s.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let s;for(s=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Cp(this.data.getIterator())}getIteratorFrom(e){return new Cp(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(s=>{n=n.add(s)}),n}isEqual(e){if(!(e instanceof ct)||this.size!==e.size)return!1;const n=this.data.getIterator(),s=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,r=s.getNext().key;if(this.comparator(i,r)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new ct(this.comparator);return n.data=e,n}}class Cp{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(e){this.fields=e,e.sort(yt.comparator)}static empty(){return new Ht([])}unionWith(e){let n=new ct(yt.comparator);for(const s of this.fields)n=n.add(s);for(const s of e)n=n.add(s);return new Ht(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Li(this.fields,e.fields,(n,s)=>n.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O0 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(i){try{return atob(i)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new O0("Invalid base64 string: "+r):r}}(e);return new vt(n)}static fromUint8Array(e){const n=function(i){let r="";for(let o=0;o<i.length;++o)r+=String.fromCharCode(i[o]);return r}(e);return new vt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const s=new Uint8Array(n.length);for(let i=0;i<n.length;i++)s[i]=n.charCodeAt(i);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ve(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}vt.EMPTY_BYTE_STRING=new vt("");const NE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Cs(t){if(Ne(!!t,39018),typeof t=="string"){let e=0;const n=NE.exec(t);if(Ne(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Qe(t.seconds),nanos:Qe(t.nanos)}}function Qe(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ds(t){return typeof t=="string"?vt.fromBase64String(t):vt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V0="server_timestamp",B0="__type__",U0="__previous_value__",$0="__local_write_time__";function Wh(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{})[B0])===null||n===void 0?void 0:n.stringValue)===V0}function Rl(t){const e=t.mapValue.fields[U0];return Wh(e)?Rl(e):e}function eo(t){const e=Cs(t.mapValue.fields[$0].timestampValue);return new He(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ME{constructor(e,n,s,i,r,o,a,u,h,d){this.databaseId=e,this.appId=n,this.persistenceKey=s,this.host=i,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=d}}const qa="(default)";class to{constructor(e,n){this.projectId=e,this.database=n||qa}static empty(){return new to("","")}get isDefaultDatabase(){return this.database===qa}isEqual(e){return e instanceof to&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H0="__type__",jE="__max__",ta={mapValue:{}},W0="__vector__",Ka="value";function Ps(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Wh(t)?4:kE(t)?9007199254740991:LE(t)?10:11:re(28295,{value:t})}function Cn(t,e){if(t===e)return!0;const n=Ps(t);if(n!==Ps(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return eo(t).isEqual(eo(e));case 3:return function(i,r){if(typeof i.timestampValue=="string"&&typeof r.timestampValue=="string"&&i.timestampValue.length===r.timestampValue.length)return i.timestampValue===r.timestampValue;const o=Cs(i.timestampValue),a=Cs(r.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,r){return Ds(i.bytesValue).isEqual(Ds(r.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,r){return Qe(i.geoPointValue.latitude)===Qe(r.geoPointValue.latitude)&&Qe(i.geoPointValue.longitude)===Qe(r.geoPointValue.longitude)}(t,e);case 2:return function(i,r){if("integerValue"in i&&"integerValue"in r)return Qe(i.integerValue)===Qe(r.integerValue);if("doubleValue"in i&&"doubleValue"in r){const o=Qe(i.doubleValue),a=Qe(r.doubleValue);return o===a?za(o)===za(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return Li(t.arrayValue.values||[],e.arrayValue.values||[],Cn);case 10:case 11:return function(i,r){const o=i.mapValue.fields||{},a=r.mapValue.fields||{};if(bp(o)!==bp(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!Cn(o[u],a[u])))return!1;return!0}(t,e);default:return re(52216,{left:t})}}function no(t,e){return(t.values||[]).find(n=>Cn(n,e))!==void 0}function ki(t,e){if(t===e)return 0;const n=Ps(t),s=Ps(e);if(n!==s)return ve(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return ve(t.booleanValue,e.booleanValue);case 2:return function(r,o){const a=Qe(r.integerValue||r.doubleValue),u=Qe(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(t,e);case 3:return Dp(t.timestampValue,e.timestampValue);case 4:return Dp(eo(t),eo(e));case 5:return Du(t.stringValue,e.stringValue);case 6:return function(r,o){const a=Ds(r),u=Ds(o);return a.compareTo(u)}(t.bytesValue,e.bytesValue);case 7:return function(r,o){const a=r.split("/"),u=o.split("/");for(let h=0;h<a.length&&h<u.length;h++){const d=ve(a[h],u[h]);if(d!==0)return d}return ve(a.length,u.length)}(t.referenceValue,e.referenceValue);case 8:return function(r,o){const a=ve(Qe(r.latitude),Qe(o.latitude));return a!==0?a:ve(Qe(r.longitude),Qe(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Pp(t.arrayValue,e.arrayValue);case 10:return function(r,o){var a,u,h,d;const p=r.fields||{},m=o.fields||{},_=(a=p[Ka])===null||a===void 0?void 0:a.arrayValue,y=(u=m[Ka])===null||u===void 0?void 0:u.arrayValue,v=ve(((h=_==null?void 0:_.values)===null||h===void 0?void 0:h.length)||0,((d=y==null?void 0:y.values)===null||d===void 0?void 0:d.length)||0);return v!==0?v:Pp(_,y)}(t.mapValue,e.mapValue);case 11:return function(r,o){if(r===ta.mapValue&&o===ta.mapValue)return 0;if(r===ta.mapValue)return 1;if(o===ta.mapValue)return-1;const a=r.fields||{},u=Object.keys(a),h=o.fields||{},d=Object.keys(h);u.sort(),d.sort();for(let p=0;p<u.length&&p<d.length;++p){const m=Du(u[p],d[p]);if(m!==0)return m;const _=ki(a[u[p]],h[d[p]]);if(_!==0)return _}return ve(u.length,d.length)}(t.mapValue,e.mapValue);default:throw re(23264,{le:n})}}function Dp(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return ve(t,e);const n=Cs(t),s=Cs(e),i=ve(n.seconds,s.seconds);return i!==0?i:ve(n.nanos,s.nanos)}function Pp(t,e){const n=t.values||[],s=e.values||[];for(let i=0;i<n.length&&i<s.length;++i){const r=ki(n[i],s[i]);if(r)return r}return ve(n.length,s.length)}function Fi(t){return Pu(t)}function Pu(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const s=Cs(n);return`time(${s.seconds},${s.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Ds(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return J.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let s="[",i=!0;for(const r of n.values||[])i?i=!1:s+=",",s+=Pu(r);return s+"]"}(t.arrayValue):"mapValue"in t?function(n){const s=Object.keys(n.fields||{}).sort();let i="{",r=!0;for(const o of s)r?r=!1:i+=",",i+=`${o}:${Pu(n.fields[o])}`;return i+"}"}(t.mapValue):re(61005,{value:t})}function Na(t){switch(Ps(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Rl(t);return e?16+Na(e):16;case 5:return 2*t.stringValue.length;case 6:return Ds(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(s){return(s.values||[]).reduce((i,r)=>i+Na(r),0)}(t.arrayValue);case 10:case 11:return function(s){let i=0;return ks(s.fields,(r,o)=>{i+=r.length+Na(o)}),i}(t.mapValue);default:throw re(13486,{value:t})}}function Rp(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Ru(t){return!!t&&"integerValue"in t}function Xh(t){return!!t&&"arrayValue"in t}function Np(t){return!!t&&"nullValue"in t}function Mp(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ma(t){return!!t&&"mapValue"in t}function LE(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{})[H0])===null||n===void 0?void 0:n.stringValue)===W0}function Vr(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ks(t.mapValue.fields,(n,s)=>e.mapValue.fields[n]=Vr(s)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Vr(t.arrayValue.values[n]);return e}return Object.assign({},t)}function kE(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===jE}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e){this.value=e}static empty(){return new Ot({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let s=0;s<e.length-1;++s)if(n=(n.mapValue.fields||{})[e.get(s)],!Ma(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Vr(n)}setAll(e){let n=yt.emptyPath(),s={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const u=this.getFieldsMap(n);this.applyChanges(u,s,i),s={},i=[],n=a.popLast()}o?s[a.lastSegment()]=Vr(o):i.push(a.lastSegment())});const r=this.getFieldsMap(n);this.applyChanges(r,s,i)}delete(e){const n=this.field(e.popLast());Ma(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Cn(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let s=0;s<e.length;++s){let i=n.mapValue.fields[e.get(s)];Ma(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(s)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,s){ks(n,(i,r)=>e[i]=r);for(const i of s)delete e[i]}clone(){return new Ot(Vr(this.value))}}function X0(t){const e=[];return ks(t.fields,(n,s)=>{const i=new yt([n]);if(Ma(s)){const r=X0(s.mapValue).fields;if(r.length===0)e.push(i);else for(const o of r)e.push(i.child(o))}else e.push(i)}),new Ht(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St{constructor(e,n,s,i,r,o,a){this.key=e,this.documentType=n,this.version=s,this.readTime=i,this.createTime=r,this.data=o,this.documentState=a}static newInvalidDocument(e){return new St(e,0,ae.min(),ae.min(),ae.min(),Ot.empty(),0)}static newFoundDocument(e,n,s,i){return new St(e,1,n,ae.min(),s,i,0)}static newNoDocument(e,n){return new St(e,2,n,ae.min(),ae.min(),Ot.empty(),0)}static newUnknownDocument(e,n){return new St(e,3,n,ae.min(),ae.min(),Ot.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(ae.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ot.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ot.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ae.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof St&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new St(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qa{constructor(e,n){this.position=e,this.inclusive=n}}function jp(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(r.field.isKeyField()?s=J.comparator(J.fromName(o.referenceValue),n.key):s=ki(o,n.data.field(r.field)),r.dir==="desc"&&(s*=-1),s!==0)break}return s}function Lp(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Cn(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class so{constructor(e,n="asc"){this.field=e,this.dir=n}}function FE(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G0{}class st extends G0{constructor(e,n,s){super(),this.field=e,this.op=n,this.value=s}static create(e,n,s){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,s):new VE(e,n,s):n==="array-contains"?new $E(e,s):n==="in"?new HE(e,s):n==="not-in"?new WE(e,s):n==="array-contains-any"?new XE(e,s):new st(e,n,s)}static createKeyFieldInFilter(e,n,s){return n==="in"?new BE(e,s):new UE(e,s)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(ki(n,this.value)):n!==null&&Ps(this.value)===Ps(n)&&this.matchesComparison(ki(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return re(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class dn extends G0{constructor(e,n){super(),this.filters=e,this.op=n,this.he=null}static create(e,n){return new dn(e,n)}matches(e){return Y0(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function Y0(t){return t.op==="and"}function z0(t){return OE(t)&&Y0(t)}function OE(t){for(const e of t.filters)if(e instanceof dn)return!1;return!0}function Nu(t){if(t instanceof st)return t.field.canonicalString()+t.op.toString()+Fi(t.value);if(z0(t))return t.filters.map(e=>Nu(e)).join(",");{const e=t.filters.map(n=>Nu(n)).join(",");return`${t.op}(${e})`}}function q0(t,e){return t instanceof st?function(s,i){return i instanceof st&&s.op===i.op&&s.field.isEqual(i.field)&&Cn(s.value,i.value)}(t,e):t instanceof dn?function(s,i){return i instanceof dn&&s.op===i.op&&s.filters.length===i.filters.length?s.filters.reduce((r,o,a)=>r&&q0(o,i.filters[a]),!0):!1}(t,e):void re(19439)}function K0(t){return t instanceof st?function(n){return`${n.field.canonicalString()} ${n.op} ${Fi(n.value)}`}(t):t instanceof dn?function(n){return n.op.toString()+" {"+n.getFilters().map(K0).join(" ,")+"}"}(t):"Filter"}class VE extends st{constructor(e,n,s){super(e,n,s),this.key=J.fromName(s.referenceValue)}matches(e){const n=J.comparator(e.key,this.key);return this.matchesComparison(n)}}class BE extends st{constructor(e,n){super(e,"in",n),this.keys=Q0("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class UE extends st{constructor(e,n){super(e,"not-in",n),this.keys=Q0("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function Q0(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(s=>J.fromName(s.referenceValue))}class $E extends st{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Xh(n)&&no(n.arrayValue,this.value)}}class HE extends st{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&no(this.value.arrayValue,n)}}class WE extends st{constructor(e,n){super(e,"not-in",n)}matches(e){if(no(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!no(this.value.arrayValue,n)}}class XE extends st{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Xh(n)||!n.arrayValue.values)&&n.arrayValue.values.some(s=>no(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GE{constructor(e,n=null,s=[],i=[],r=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=s,this.filters=i,this.limit=r,this.startAt=o,this.endAt=a,this.Pe=null}}function kp(t,e=null,n=[],s=[],i=null,r=null,o=null){return new GE(t,e,n,s,i,r,o)}function Gh(t){const e=he(t);if(e.Pe===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(s=>Nu(s)).join(","),n+="|ob:",n+=e.orderBy.map(s=>function(r){return r.field.canonicalString()+r.dir}(s)).join(","),Pl(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(s=>Fi(s)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(s=>Fi(s)).join(",")),e.Pe=n}return e.Pe}function Yh(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!FE(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!q0(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Lp(t.startAt,e.startAt)&&Lp(t.endAt,e.endAt)}function Mu(t){return J.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(e,n=null,s=[],i=[],r=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=s,this.filters=i,this.limit=r,this.limitType=o,this.startAt=a,this.endAt=u,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function YE(t,e,n,s,i,r,o,a){return new zi(t,e,n,s,i,r,o,a)}function zh(t){return new zi(t)}function Fp(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function J0(t){return t.collectionGroup!==null}function Br(t){const e=he(t);if(e.Te===null){e.Te=[];const n=new Set;for(const r of e.explicitOrderBy)e.Te.push(r),n.add(r.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ct(yt.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(a=a.add(h.field))})}),a})(e).forEach(r=>{n.has(r.canonicalString())||r.isKeyField()||e.Te.push(new so(r,s))}),n.has(yt.keyField().canonicalString())||e.Te.push(new so(yt.keyField(),s))}return e.Te}function In(t){const e=he(t);return e.Ie||(e.Ie=zE(e,Br(t))),e.Ie}function zE(t,e){if(t.limitType==="F")return kp(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const r=i.dir==="desc"?"asc":"desc";return new so(i.field,r)});const n=t.endAt?new Qa(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new Qa(t.startAt.position,t.startAt.inclusive):null;return kp(t.path,t.collectionGroup,e,t.filters,t.limit,n,s)}}function ju(t,e){const n=t.filters.concat([e]);return new zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Lu(t,e,n){return new zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Nl(t,e){return Yh(In(t),In(e))&&t.limitType===e.limitType}function Z0(t){return`${Gh(In(t))}|lt:${t.limitType}`}function Ti(t){return`Query(target=${function(n){let s=n.path.canonicalString();return n.collectionGroup!==null&&(s+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(s+=`, filters: [${n.filters.map(i=>K0(i)).join(", ")}]`),Pl(n.limit)||(s+=", limit: "+n.limit),n.orderBy.length>0&&(s+=`, orderBy: [${n.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),n.startAt&&(s+=", startAt: ",s+=n.startAt.inclusive?"b:":"a:",s+=n.startAt.position.map(i=>Fi(i)).join(",")),n.endAt&&(s+=", endAt: ",s+=n.endAt.inclusive?"a:":"b:",s+=n.endAt.position.map(i=>Fi(i)).join(",")),`Target(${s})`}(In(t))}; limitType=${t.limitType})`}function Ml(t,e){return e.isFoundDocument()&&function(s,i){const r=i.key.path;return s.collectionGroup!==null?i.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(r):J.isDocumentKey(s.path)?s.path.isEqual(r):s.path.isImmediateParentOf(r)}(t,e)&&function(s,i){for(const r of Br(s))if(!r.field.isKeyField()&&i.data.field(r.field)===null)return!1;return!0}(t,e)&&function(s,i){for(const r of s.filters)if(!r.matches(i))return!1;return!0}(t,e)&&function(s,i){return!(s.startAt&&!function(o,a,u){const h=jp(o,a,u);return o.inclusive?h<=0:h<0}(s.startAt,Br(s),i)||s.endAt&&!function(o,a,u){const h=jp(o,a,u);return o.inclusive?h>=0:h>0}(s.endAt,Br(s),i))}(t,e)}function qE(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function e_(t){return(e,n)=>{let s=!1;for(const i of Br(t)){const r=KE(i,e,n);if(r!==0)return r;s=s||i.field.isKeyField()}return 0}}function KE(t,e,n){const s=t.field.isKeyField()?J.comparator(e.key,n.key):function(r,o,a){const u=o.data.field(r),h=a.data.field(r);return u!==null&&h!==null?ki(u,h):re(42886)}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return re(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),s=this.inner[n];if(s!==void 0){for(const[i,r]of s)if(this.equalsFn(i,e))return r}}has(e){return this.get(e)!==void 0}set(e,n){const s=this.mapKeyFn(e),i=this.inner[s];if(i===void 0)return this.inner[s]=[[e,n]],void this.innerSize++;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return void(i[r]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),s=this.inner[n];if(s===void 0)return!1;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return s.length===1?delete this.inner[n]:s.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ks(this.inner,(n,s)=>{for(const[i,r]of s)e(i,r)})}isEmpty(){return F0(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QE=new Ye(J.comparator);function Zn(){return QE}const t_=new Ye(J.comparator);function Rr(...t){let e=t_;for(const n of t)e=e.insert(n.key,n);return e}function n_(t){let e=t_;return t.forEach((n,s)=>e=e.insert(n,s.overlayedDocument)),e}function Qs(){return Ur()}function s_(){return Ur()}function Ur(){return new ai(t=>t.toString(),(t,e)=>t.isEqual(e))}const JE=new Ye(J.comparator),ZE=new ct(J.comparator);function Ae(...t){let e=ZE;for(const n of t)e=e.add(n);return e}const eA=new ct(ve);function tA(){return eA}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qh(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:za(e)?"-0":e}}function i_(t){return{integerValue:""+t}}function nA(t,e){return DE(e)?i_(e):qh(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jl{constructor(){this._=void 0}}function sA(t,e,n){return t instanceof io?function(i,r){const o={fields:{[B0]:{stringValue:V0},[$0]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return r&&Wh(r)&&(r=Rl(r)),r&&(o.fields[U0]=r),{mapValue:o}}(n,e):t instanceof ro?o_(t,e):t instanceof oo?a_(t,e):function(i,r){const o=r_(i,r),a=Op(o)+Op(i.Ee);return Ru(o)&&Ru(i.Ee)?i_(a):qh(i.serializer,a)}(t,e)}function iA(t,e,n){return t instanceof ro?o_(t,e):t instanceof oo?a_(t,e):n}function r_(t,e){return t instanceof Ja?function(s){return Ru(s)||function(r){return!!r&&"doubleValue"in r}(s)}(e)?e:{integerValue:0}:null}class io extends jl{}class ro extends jl{constructor(e){super(),this.elements=e}}function o_(t,e){const n=l_(e);for(const s of t.elements)n.some(i=>Cn(i,s))||n.push(s);return{arrayValue:{values:n}}}class oo extends jl{constructor(e){super(),this.elements=e}}function a_(t,e){let n=l_(e);for(const s of t.elements)n=n.filter(i=>!Cn(i,s));return{arrayValue:{values:n}}}class Ja extends jl{constructor(e,n){super(),this.serializer=e,this.Ee=n}}function Op(t){return Qe(t.integerValue||t.doubleValue)}function l_(t){return Xh(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rA{constructor(e,n){this.field=e,this.transform=n}}function oA(t,e){return t.field.isEqual(e.field)&&function(s,i){return s instanceof ro&&i instanceof ro||s instanceof oo&&i instanceof oo?Li(s.elements,i.elements,Cn):s instanceof Ja&&i instanceof Ja?Cn(s.Ee,i.Ee):s instanceof io&&i instanceof io}(t.transform,e.transform)}class aA{constructor(e,n){this.version=e,this.transformResults=n}}class hn{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new hn}static exists(e){return new hn(void 0,e)}static updateTime(e){return new hn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ja(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Ll{}function c_(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Kh(t.key,hn.none()):new Io(t.key,t.data,hn.none());{const n=t.data,s=Ot.empty();let i=new ct(yt.comparator);for(let r of e.fields)if(!i.has(r)){let o=n.field(r);o===null&&r.length>1&&(r=r.popLast(),o=n.field(r)),o===null?s.delete(r):s.set(r,o),i=i.add(r)}return new Fs(t.key,s,new Ht(i.toArray()),hn.none())}}function lA(t,e,n){t instanceof Io?function(i,r,o){const a=i.value.clone(),u=Bp(i.fieldTransforms,r,o.transformResults);a.setAll(u),r.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof Fs?function(i,r,o){if(!ja(i.precondition,r))return void r.convertToUnknownDocument(o.version);const a=Bp(i.fieldTransforms,r,o.transformResults),u=r.data;u.setAll(u_(i)),u.setAll(a),r.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(t,e,n):function(i,r,o){r.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function $r(t,e,n,s){return t instanceof Io?function(r,o,a,u){if(!ja(r.precondition,o))return a;const h=r.value.clone(),d=Up(r.fieldTransforms,u,o);return h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(t,e,n,s):t instanceof Fs?function(r,o,a,u){if(!ja(r.precondition,o))return a;const h=Up(r.fieldTransforms,u,o),d=o.data;return d.setAll(u_(r)),d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(p=>p.field))}(t,e,n,s):function(r,o,a){return ja(r.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function cA(t,e){let n=null;for(const s of t.fieldTransforms){const i=e.data.field(s.field),r=r_(s.transform,i||null);r!=null&&(n===null&&(n=Ot.empty()),n.set(s.field,r))}return n||null}function Vp(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(s,i){return s===void 0&&i===void 0||!(!s||!i)&&Li(s,i,(r,o)=>oA(r,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Io extends Ll{constructor(e,n,s,i=[]){super(),this.key=e,this.value=n,this.precondition=s,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Fs extends Ll{constructor(e,n,s,i,r=[]){super(),this.key=e,this.data=n,this.fieldMask=s,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function u_(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}}),e}function Bp(t,e,n){const s=new Map;Ne(t.length===n.length,32656,{Ae:n.length,Re:t.length});for(let i=0;i<n.length;i++){const r=t[i],o=r.transform,a=e.data.field(r.field);s.set(r.field,iA(o,a,n[i]))}return s}function Up(t,e,n){const s=new Map;for(const i of t){const r=i.transform,o=n.data.field(i.field);s.set(i.field,sA(r,o,e))}return s}class Kh extends Ll{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class uA extends Ll{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hA{constructor(e,n,s,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=s,this.mutations=i}applyToRemoteDocument(e,n){const s=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const r=this.mutations[i];r.key.isEqual(e.key)&&lA(r,e,s[i])}}applyToLocalView(e,n){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(n=$r(s,e,n,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(n=$r(s,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const s=s_();return this.mutations.forEach(i=>{const r=e.get(i.key),o=r.overlayedDocument;let a=this.applyToLocalView(o,r.mutatedFields);a=n.has(i.key)?null:a;const u=c_(o,a);u!==null&&s.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(ae.min())}),s}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ae())}isEqual(e){return this.batchId===e.batchId&&Li(this.mutations,e.mutations,(n,s)=>Vp(n,s))&&Li(this.baseMutations,e.baseMutations,(n,s)=>Vp(n,s))}}class Qh{constructor(e,n,s,i){this.batch=e,this.commitVersion=n,this.mutationResults=s,this.docVersions=i}static from(e,n,s){Ne(e.mutations.length===s.length,58842,{Ve:e.mutations.length,me:s.length});let i=function(){return JE}();const r=e.mutations;for(let o=0;o<r.length;o++)i=i.insert(r[o].key,s[o].version);return new Qh(e,n,s,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dA{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fA{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tt,Se;function pA(t){switch(t){case B.OK:return re(64938);case B.CANCELLED:case B.UNKNOWN:case B.DEADLINE_EXCEEDED:case B.RESOURCE_EXHAUSTED:case B.INTERNAL:case B.UNAVAILABLE:case B.UNAUTHENTICATED:return!1;case B.INVALID_ARGUMENT:case B.NOT_FOUND:case B.ALREADY_EXISTS:case B.PERMISSION_DENIED:case B.FAILED_PRECONDITION:case B.ABORTED:case B.OUT_OF_RANGE:case B.UNIMPLEMENTED:case B.DATA_LOSS:return!0;default:return re(15467,{code:t})}}function h_(t){if(t===void 0)return Qn("GRPC error has no .code"),B.UNKNOWN;switch(t){case tt.OK:return B.OK;case tt.CANCELLED:return B.CANCELLED;case tt.UNKNOWN:return B.UNKNOWN;case tt.DEADLINE_EXCEEDED:return B.DEADLINE_EXCEEDED;case tt.RESOURCE_EXHAUSTED:return B.RESOURCE_EXHAUSTED;case tt.INTERNAL:return B.INTERNAL;case tt.UNAVAILABLE:return B.UNAVAILABLE;case tt.UNAUTHENTICATED:return B.UNAUTHENTICATED;case tt.INVALID_ARGUMENT:return B.INVALID_ARGUMENT;case tt.NOT_FOUND:return B.NOT_FOUND;case tt.ALREADY_EXISTS:return B.ALREADY_EXISTS;case tt.PERMISSION_DENIED:return B.PERMISSION_DENIED;case tt.FAILED_PRECONDITION:return B.FAILED_PRECONDITION;case tt.ABORTED:return B.ABORTED;case tt.OUT_OF_RANGE:return B.OUT_OF_RANGE;case tt.UNIMPLEMENTED:return B.UNIMPLEMENTED;case tt.DATA_LOSS:return B.DATA_LOSS;default:return re(39323,{code:t})}}(Se=tt||(tt={}))[Se.OK=0]="OK",Se[Se.CANCELLED=1]="CANCELLED",Se[Se.UNKNOWN=2]="UNKNOWN",Se[Se.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Se[Se.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Se[Se.NOT_FOUND=5]="NOT_FOUND",Se[Se.ALREADY_EXISTS=6]="ALREADY_EXISTS",Se[Se.PERMISSION_DENIED=7]="PERMISSION_DENIED",Se[Se.UNAUTHENTICATED=16]="UNAUTHENTICATED",Se[Se.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Se[Se.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Se[Se.ABORTED=10]="ABORTED",Se[Se.OUT_OF_RANGE=11]="OUT_OF_RANGE",Se[Se.UNIMPLEMENTED=12]="UNIMPLEMENTED",Se[Se.INTERNAL=13]="INTERNAL",Se[Se.UNAVAILABLE=14]="UNAVAILABLE",Se[Se.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gA=new As([4294967295,4294967295],0);function $p(t){const e=M0().encode(t),n=new x0;return n.update(e),new Uint8Array(n.digest())}function Hp(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),s=e.getUint32(4,!0),i=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new As([n,s],0),new As([i,r],0)]}class Jh{constructor(e,n,s){if(this.bitmap=e,this.padding=n,this.hashCount=s,n<0||n>=8)throw new Nr(`Invalid padding: ${n}`);if(s<0)throw new Nr(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Nr(`Invalid hash count: ${s}`);if(e.length===0&&n!==0)throw new Nr(`Invalid padding when bitmap length is 0: ${n}`);this.fe=8*e.length-n,this.ge=As.fromNumber(this.fe)}pe(e,n,s){let i=e.add(n.multiply(As.fromNumber(s)));return i.compare(gA)===1&&(i=new As([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;const n=$p(e),[s,i]=Hp(n);for(let r=0;r<this.hashCount;r++){const o=this.pe(s,i,r);if(!this.ye(o))return!1}return!0}static create(e,n,s){const i=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),o=new Jh(r,i,n);return s.forEach(a=>o.insert(a)),o}insert(e){if(this.fe===0)return;const n=$p(e),[s,i]=Hp(n);for(let r=0;r<this.hashCount;r++){const o=this.pe(s,i,r);this.we(o)}}we(e){const n=Math.floor(e/8),s=e%8;this.bitmap[n]|=1<<s}}class Nr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl{constructor(e,n,s,i,r){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=s,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,n,s){const i=new Map;return i.set(e,xo.createSynthesizedTargetChangeForCurrentChange(e,n,s)),new kl(ae.min(),i,new Ye(ve),Zn(),Ae())}}class xo{constructor(e,n,s,i,r){this.resumeToken=e,this.current=n,this.addedDocuments=s,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,n,s){return new xo(s,n,Ae(),Ae(),Ae())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e,n,s,i){this.Se=e,this.removedTargetIds=n,this.key=s,this.be=i}}class d_{constructor(e,n){this.targetId=e,this.De=n}}class f_{constructor(e,n,s=vt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=s,this.cause=i}}class Wp{constructor(){this.ve=0,this.Ce=Xp(),this.Fe=vt.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=Ae(),n=Ae(),s=Ae();return this.Ce.forEach((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:s=s.add(i);break;default:re(38017,{changeType:r})}}),new xo(this.Fe,this.Me,e,n,s)}ke(){this.xe=!1,this.Ce=Xp()}qe(e,n){this.xe=!0,this.Ce=this.Ce.insert(e,n)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,Ne(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class mA{constructor(e){this.We=e,this.Ge=new Map,this.ze=Zn(),this.je=na(),this.Je=na(),this.He=new Ye(ve)}Ye(e){for(const n of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(n,e.be):this.Xe(n,e.key,e.be);for(const n of e.removedTargetIds)this.Xe(n,e.key,e.be)}et(e){this.forEachTarget(e,n=>{const s=this.tt(n);switch(e.state){case 0:this.nt(n)&&s.Be(e.resumeToken);break;case 1:s.Ue(),s.Oe||s.ke(),s.Be(e.resumeToken);break;case 2:s.Ue(),s.Oe||this.removeTarget(n);break;case 3:this.nt(n)&&(s.Ke(),s.Be(e.resumeToken));break;case 4:this.nt(n)&&(this.rt(n),s.Be(e.resumeToken));break;default:re(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Ge.forEach((s,i)=>{this.nt(i)&&n(i)})}it(e){const n=e.targetId,s=e.De.count,i=this.st(n);if(i){const r=i.target;if(Mu(r))if(s===0){const o=new J(r.path);this.Xe(n,o,St.newNoDocument(o,ae.min()))}else Ne(s===1,20013,{expectedCount:s});else{const o=this.ot(n);if(o!==s){const a=this._t(e),u=a?this.ut(a,e,o):1;if(u!==0){this.rt(n);const h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(n,h)}}}}}_t(e){const n=e.De.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:s="",padding:i=0},hashCount:r=0}=n;let o,a;try{o=Ds(s).toUint8Array()}catch(u){if(u instanceof O0)return Ss("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Jh(o,i,r)}catch(u){return Ss(u instanceof Nr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.fe===0?null:a}ut(e,n,s){return n.De.count===s-this.ht(e,n.targetId)?0:2}ht(e,n){const s=this.We.getRemoteKeysForTarget(n);let i=0;return s.forEach(r=>{const o=this.We.lt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${r.path.canonicalString()}`;e.mightContain(a)||(this.Xe(n,r,null),i++)}),i}Pt(e){const n=new Map;this.Ge.forEach((r,o)=>{const a=this.st(o);if(a){if(r.current&&Mu(a.target)){const u=new J(a.target.path);this.Tt(u).has(o)||this.It(o,u)||this.Xe(o,u,St.newNoDocument(u,e))}r.Ne&&(n.set(o,r.Le()),r.ke())}});let s=Ae();this.Je.forEach((r,o)=>{let a=!0;o.forEachWhile(u=>{const h=this.st(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(s=s.add(r))}),this.ze.forEach((r,o)=>o.setReadTime(e));const i=new kl(e,n,this.He,this.ze,s);return this.ze=Zn(),this.je=na(),this.Je=na(),this.He=new Ye(ve),i}Ze(e,n){if(!this.nt(e))return;const s=this.It(e,n.key)?2:0;this.tt(e).qe(n.key,s),this.ze=this.ze.insert(n.key,n),this.je=this.je.insert(n.key,this.Tt(n.key).add(e)),this.Je=this.Je.insert(n.key,this.dt(n.key).add(e))}Xe(e,n,s){if(!this.nt(e))return;const i=this.tt(e);this.It(e,n)?i.qe(n,1):i.Qe(n),this.Je=this.Je.insert(n,this.dt(n).delete(e)),this.Je=this.Je.insert(n,this.dt(n).add(e)),s&&(this.ze=this.ze.insert(n,s))}removeTarget(e){this.Ge.delete(e)}ot(e){const n=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let n=this.Ge.get(e);return n||(n=new Wp,this.Ge.set(e,n)),n}dt(e){let n=this.Je.get(e);return n||(n=new ct(ve),this.Je=this.Je.insert(e,n)),n}Tt(e){let n=this.je.get(e);return n||(n=new ct(ve),this.je=this.je.insert(e,n)),n}nt(e){const n=this.st(e)!==null;return n||q("WatchChangeAggregator","Detected inactive target",e),n}st(e){const n=this.Ge.get(e);return n&&n.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new Wp),this.We.getRemoteKeysForTarget(e).forEach(n=>{this.Xe(e,n,null)})}It(e,n){return this.We.getRemoteKeysForTarget(e).has(n)}}function na(){return new Ye(J.comparator)}function Xp(){return new Ye(J.comparator)}const _A={asc:"ASCENDING",desc:"DESCENDING"},yA={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vA={and:"AND",or:"OR"};class wA{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function ku(t,e){return t.useProto3Json||Pl(e)?e:{value:e}}function Za(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function p_(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function TA(t,e){return Za(t,e.toTimestamp())}function xn(t){return Ne(!!t,49232),ae.fromTimestamp(function(n){const s=Cs(n);return new He(s.seconds,s.nanos)}(t))}function Zh(t,e){return Fu(t,e).canonicalString()}function Fu(t,e){const n=function(i){return new Be(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function g_(t){const e=Be.fromString(t);return Ne(w_(e),10190,{key:e.toString()}),e}function Ou(t,e){return Zh(t.databaseId,e.path)}function Sc(t,e){const n=g_(e);if(n.get(1)!==t.databaseId.projectId)throw new Y(B.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Y(B.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new J(__(n))}function m_(t,e){return Zh(t.databaseId,e)}function EA(t){const e=g_(t);return e.length===4?Be.emptyPath():__(e)}function Vu(t){return new Be(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function __(t){return Ne(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function Gp(t,e,n){return{name:Ou(t,e),fields:n.value.mapValue.fields}}function AA(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:re(39313,{state:h})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(h,d){return h.useProto3Json?(Ne(d===void 0||typeof d=="string",58123),vt.fromBase64String(d||"")):(Ne(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),vt.fromUint8Array(d||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(h){const d=h.code===void 0?B.UNKNOWN:h_(h.code);return new Y(d,h.message||"")}(o);n=new f_(s,i,r,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=Sc(t,s.document.name),r=xn(s.document.updateTime),o=s.document.createTime?xn(s.document.createTime):ae.min(),a=new Ot({mapValue:{fields:s.document.fields}}),u=St.newFoundDocument(i,r,o,a),h=s.targetIds||[],d=s.removedTargetIds||[];n=new La(h,d,u.key,u)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=Sc(t,s.document),r=s.readTime?xn(s.readTime):ae.min(),o=St.newNoDocument(i,r),a=s.removedTargetIds||[];n=new La([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=Sc(t,s.document),r=s.removedTargetIds||[];n=new La([],r,i,null)}else{if(!("filter"in e))return re(11601,{At:e});{e.filter;const s=e.filter;s.targetId;const{count:i=0,unchangedNames:r}=s,o=new fA(i,r),a=s.targetId;n=new d_(a,o)}}return n}function IA(t,e){let n;if(e instanceof Io)n={update:Gp(t,e.key,e.value)};else if(e instanceof Kh)n={delete:Ou(t,e.key)};else if(e instanceof Fs)n={update:Gp(t,e.key,e.data),updateMask:MA(e.fieldMask)};else{if(!(e instanceof uA))return re(16599,{Rt:e.type});n={verify:Ou(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(s=>function(r,o){const a=o.transform;if(a instanceof io)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof ro)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof oo)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Ja)return{fieldPath:o.field.canonicalString(),increment:a.Ee};throw re(20930,{transform:o.transform})}(0,s))),e.precondition.isNone||(n.currentDocument=function(i,r){return r.updateTime!==void 0?{updateTime:TA(i,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:re(27497)}(t,e.precondition)),n}function xA(t,e){return t&&t.length>0?(Ne(e!==void 0,14353),t.map(n=>function(i,r){let o=i.updateTime?xn(i.updateTime):xn(r);return o.isEqual(ae.min())&&(o=xn(r)),new aA(o,i.transformResults||[])}(n,e))):[]}function SA(t,e){return{documents:[m_(t,e.path)]}}function bA(t,e){const n={structuredQuery:{}},s=e.path;let i;e.collectionGroup!==null?(i=s,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=s.popLast(),n.structuredQuery.from=[{collectionId:s.lastSegment()}]),n.parent=m_(t,i);const r=function(h){if(h.length!==0)return v_(dn.create(h,"and"))}(e.filters);r&&(n.structuredQuery.where=r);const o=function(h){if(h.length!==0)return h.map(d=>function(m){return{field:Ei(m.field),direction:PA(m.dir)}}(d))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=ku(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{Vt:n,parent:i}}function CA(t){let e=EA(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){Ne(s===1,65062);const d=n.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let r=[];n.where&&(r=function(p){const m=y_(p);return m instanceof dn&&z0(m)?m.getFilters():[m]}(n.where));let o=[];n.orderBy&&(o=function(p){return p.map(m=>function(y){return new so(Ai(y.field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(m))}(n.orderBy));let a=null;n.limit&&(a=function(p){let m;return m=typeof p=="object"?p.value:p,Pl(m)?null:m}(n.limit));let u=null;n.startAt&&(u=function(p){const m=!!p.before,_=p.values||[];return new Qa(_,m)}(n.startAt));let h=null;return n.endAt&&(h=function(p){const m=!p.before,_=p.values||[];return new Qa(_,m)}(n.endAt)),YE(e,i,o,r,a,"F",u,h)}function DA(t,e){const n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return re(28987,{purpose:i})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function y_(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const s=Ai(n.unaryFilter.field);return st.create(s,"==",{doubleValue:NaN});case"IS_NULL":const i=Ai(n.unaryFilter.field);return st.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ai(n.unaryFilter.field);return st.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ai(n.unaryFilter.field);return st.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return re(61313);default:return re(60726)}}(t):t.fieldFilter!==void 0?function(n){return st.create(Ai(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return re(58110);default:return re(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return dn.create(n.compositeFilter.filters.map(s=>y_(s)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return re(1026)}}(n.compositeFilter.op))}(t):re(30097,{filter:t})}function PA(t){return _A[t]}function RA(t){return yA[t]}function NA(t){return vA[t]}function Ei(t){return{fieldPath:t.canonicalString()}}function Ai(t){return yt.fromServerFormat(t.fieldPath)}function v_(t){return t instanceof st?function(n){if(n.op==="=="){if(Mp(n.value))return{unaryFilter:{field:Ei(n.field),op:"IS_NAN"}};if(Np(n.value))return{unaryFilter:{field:Ei(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Mp(n.value))return{unaryFilter:{field:Ei(n.field),op:"IS_NOT_NAN"}};if(Np(n.value))return{unaryFilter:{field:Ei(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ei(n.field),op:RA(n.op),value:n.value}}}(t):t instanceof dn?function(n){const s=n.getFilters().map(i=>v_(i));return s.length===1?s[0]:{compositeFilter:{op:NA(n.op),filters:s}}}(t):re(54877,{filter:t})}function MA(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function w_(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(e,n,s,i,r=ae.min(),o=ae.min(),a=vt.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=n,this.purpose=s,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new _s(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new _s(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new _s(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new _s(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jA{constructor(e){this.gt=e}}function LA(t){const e=CA({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Lu(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kA{constructor(){this.Dn=new FA}addToCollectionParentIndex(e,n){return this.Dn.add(n),U.resolve()}getCollectionParents(e,n){return U.resolve(this.Dn.getEntries(n))}addFieldIndex(e,n){return U.resolve()}deleteFieldIndex(e,n){return U.resolve()}deleteAllFieldIndexes(e){return U.resolve()}createTargetIndexes(e,n){return U.resolve()}getDocumentsMatchingTarget(e,n){return U.resolve(null)}getIndexType(e,n){return U.resolve(0)}getFieldIndexes(e,n){return U.resolve([])}getNextCollectionGroupToUpdate(e){return U.resolve(null)}getMinOffset(e,n){return U.resolve(bs.min())}getMinOffsetFromCollectionGroup(e,n){return U.resolve(bs.min())}updateCollectionGroup(e,n,s){return U.resolve()}updateIndexEntries(e,n){return U.resolve()}}class FA{constructor(){this.index={}}add(e){const n=e.lastSegment(),s=e.popLast(),i=this.index[n]||new ct(Be.comparator),r=!i.has(s);return this.index[n]=i.add(s),r}has(e){const n=e.lastSegment(),s=e.popLast(),i=this.index[n];return i&&i.has(s)}getEntries(e){return(this.index[e]||new ct(Be.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},T_=41943040;class Ft{static withCacheSize(e){return new Ft(e,Ft.DEFAULT_COLLECTION_PERCENTILE,Ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ft.DEFAULT_COLLECTION_PERCENTILE=10,Ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ft.DEFAULT=new Ft(T_,Ft.DEFAULT_COLLECTION_PERCENTILE,Ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ft.DISABLED=new Ft(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new Oi(0)}static ur(){return new Oi(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zp="LruGarbageCollector",OA=1048576;function qp([t,e],[n,s]){const i=ve(t,n);return i===0?ve(e,s):i}class VA{constructor(e){this.Tr=e,this.buffer=new ct(qp),this.Ir=0}dr(){return++this.Ir}Er(e){const n=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(n);else{const s=this.buffer.last();qp(n,s)<0&&(this.buffer=this.buffer.delete(s).add(n))}}get maxValue(){return this.buffer.last()[0]}}class BA{constructor(e,n,s){this.garbageCollector=e,this.asyncQueue=n,this.localStore=s,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){q(zp,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Yi(n)?q(zp,"Ignoring IndexedDB error during garbage collection: ",n):await Gi(n)}await this.Rr(3e5)})}}class UA{constructor(e,n){this.Vr=e,this.params=n}calculateTargetCount(e,n){return this.Vr.mr(e).next(s=>Math.floor(n/100*s))}nthSequenceNumber(e,n){if(n===0)return U.resolve(Dl.ue);const s=new VA(n);return this.Vr.forEachTarget(e,i=>s.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>s.Er(i))).next(()=>s.maxValue)}removeTargets(e,n,s){return this.Vr.removeTargets(e,n,s)}removeOrphanedDocuments(e,n){return this.Vr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(q("LruGarbageCollector","Garbage collection skipped; disabled"),U.resolve(Yp)):this.getCacheSize(e).next(s=>s<this.params.cacheSizeCollectionThreshold?(q("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Yp):this.pr(e,n))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,n){let s,i,r,o,a,u,h;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(q("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(s=p,a=Date.now(),this.removeTargets(e,s,n))).next(p=>(r=p,u=Date.now(),this.removeOrphanedDocuments(e,s))).next(p=>(h=Date.now(),wi()<=Ee.DEBUG&&q("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${r} targets in `+(u-a)+`ms
	Removed ${p} documents in `+(h-u)+`ms
Total Duration: ${h-d}ms`),U.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:p})))}}function $A(t,e){return new UA(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HA{constructor(){this.changes=new ai(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,St.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const s=this.changes.get(n);return s!==void 0?U.resolve(s):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WA{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XA{constructor(e,n,s,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=s,this.indexManager=i}getDocument(e,n){let s=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(s=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(s!==null&&$r(s.mutation,i,Ht.empty(),He.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(s=>this.getLocalViewOfDocuments(e,s,Ae()).next(()=>s))}getLocalViewOfDocuments(e,n,s=Ae()){const i=Qs();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,s).next(r=>{let o=Rr();return r.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const s=Qs();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,Ae()))}populateOverlays(e,n,s){const i=[];return s.forEach(r=>{n.has(r)||i.push(r)}),this.documentOverlayCache.getOverlays(e,i).next(r=>{r.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,s,i){let r=Zn();const o=Ur(),a=function(){return Ur()}();return n.forEach((u,h)=>{const d=s.get(h.key);i.has(h.key)&&(d===void 0||d.mutation instanceof Fs)?r=r.insert(h.key,h):d!==void 0?(o.set(h.key,d.mutation.getFieldMask()),$r(d.mutation,h,d.mutation.getFieldMask(),He.now())):o.set(h.key,Ht.empty())}),this.recalculateAndSaveOverlays(e,r).next(u=>(u.forEach((h,d)=>o.set(h,d)),n.forEach((h,d)=>{var p;return a.set(h,new WA(d,(p=o.get(h))!==null&&p!==void 0?p:null))}),a))}recalculateAndSaveOverlays(e,n){const s=Ur();let i=new Ye((o,a)=>o-a),r=Ae();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(u=>{const h=n.get(u);if(h===null)return;let d=s.get(u)||Ht.empty();d=a.applyToLocalView(h,d),s.set(u,d);const p=(i.get(a.batchId)||Ae()).add(u);i=i.insert(a.batchId,p)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),h=u.key,d=u.value,p=s_();d.forEach(m=>{if(!r.has(m)){const _=c_(n.get(m),s.get(m));_!==null&&p.set(m,_),r=r.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,p))}return U.waitFor(o)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,n,s,i){return function(o){return J.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):J0(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,s,i):this.getDocumentsMatchingCollectionQuery(e,n,s,i)}getNextDocuments(e,n,s,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,s,i).next(r=>{const o=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,s.largestBatchId,i-r.size):U.resolve(Qs());let a=Zr,u=r;return o.next(h=>U.forEach(h,(d,p)=>(a<p.largestBatchId&&(a=p.largestBatchId),r.get(d)?U.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{u=u.insert(d,m)}))).next(()=>this.populateOverlays(e,h,r)).next(()=>this.computeViews(e,u,h,Ae())).next(d=>({batchId:a,changes:n_(d)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new J(n)).next(s=>{let i=Rr();return s.isFoundDocument()&&(i=i.insert(s.key,s)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,s,i){const r=n.collectionGroup;let o=Rr();return this.indexManager.getCollectionParents(e,r).next(a=>U.forEach(a,u=>{const h=function(p,m){return new zi(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(n,u.child(r));return this.getDocumentsMatchingCollectionQuery(e,h,s,i).next(d=>{d.forEach((p,m)=>{o=o.insert(p,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,s,i){let r;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,s.largestBatchId).next(o=>(r=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,s,r,i))).next(o=>{r.forEach((u,h)=>{const d=h.getKey();o.get(d)===null&&(o=o.insert(d,St.newInvalidDocument(d)))});let a=Rr();return o.forEach((u,h)=>{const d=r.get(u);d!==void 0&&$r(d.mutation,h,Ht.empty(),He.now()),Ml(n,h)&&(a=a.insert(u,h))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GA{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,n){return U.resolve(this.Br.get(n))}saveBundleMetadata(e,n){return this.Br.set(n.id,function(i){return{id:i.id,version:i.version,createTime:xn(i.createTime)}}(n)),U.resolve()}getNamedQuery(e,n){return U.resolve(this.Lr.get(n))}saveNamedQuery(e,n){return this.Lr.set(n.name,function(i){return{name:i.name,query:LA(i.bundledQuery),readTime:xn(i.readTime)}}(n)),U.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YA{constructor(){this.overlays=new Ye(J.comparator),this.kr=new Map}getOverlay(e,n){return U.resolve(this.overlays.get(n))}getOverlays(e,n){const s=Qs();return U.forEach(n,i=>this.getOverlay(e,i).next(r=>{r!==null&&s.set(i,r)})).next(()=>s)}saveOverlays(e,n,s){return s.forEach((i,r)=>{this.wt(e,n,r)}),U.resolve()}removeOverlaysForBatchId(e,n,s){const i=this.kr.get(s);return i!==void 0&&(i.forEach(r=>this.overlays=this.overlays.remove(r)),this.kr.delete(s)),U.resolve()}getOverlaysForCollection(e,n,s){const i=Qs(),r=n.length+1,o=new J(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,h=u.getKey();if(!n.isPrefixOf(h.path))break;h.path.length===r&&u.largestBatchId>s&&i.set(u.getKey(),u)}return U.resolve(i)}getOverlaysForCollectionGroup(e,n,s,i){let r=new Ye((h,d)=>h-d);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===n&&h.largestBatchId>s){let d=r.get(h.largestBatchId);d===null&&(d=Qs(),r=r.insert(h.largestBatchId,d)),d.set(h.getKey(),h)}}const a=Qs(),u=r.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,d)=>a.set(h,d)),!(a.size()>=i)););return U.resolve(a)}wt(e,n,s){const i=this.overlays.get(s.key);if(i!==null){const o=this.kr.get(i.largestBatchId).delete(s.key);this.kr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new dA(n,s));let r=this.kr.get(n);r===void 0&&(r=Ae(),this.kr.set(n,r)),this.kr.set(n,r.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zA{constructor(){this.sessionToken=vt.EMPTY_BYTE_STRING}getSessionToken(e){return U.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,U.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ed{constructor(){this.qr=new ct(ht.Qr),this.$r=new ct(ht.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,n){const s=new ht(e,n);this.qr=this.qr.add(s),this.$r=this.$r.add(s)}Kr(e,n){e.forEach(s=>this.addReference(s,n))}removeReference(e,n){this.Wr(new ht(e,n))}Gr(e,n){e.forEach(s=>this.removeReference(s,n))}zr(e){const n=new J(new Be([])),s=new ht(n,e),i=new ht(n,e+1),r=[];return this.$r.forEachInRange([s,i],o=>{this.Wr(o),r.push(o.key)}),r}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const n=new J(new Be([])),s=new ht(n,e),i=new ht(n,e+1);let r=Ae();return this.$r.forEachInRange([s,i],o=>{r=r.add(o.key)}),r}containsKey(e){const n=new ht(e,0),s=this.qr.firstAfterOrEqual(n);return s!==null&&e.isEqual(s.key)}}class ht{constructor(e,n){this.key=e,this.Hr=n}static Qr(e,n){return J.comparator(e.key,n.key)||ve(e.Hr,n.Hr)}static Ur(e,n){return ve(e.Hr,n.Hr)||J.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qA{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.er=1,this.Yr=new ct(ht.Qr)}checkEmpty(e){return U.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,s,i){const r=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new hA(r,n,s,i);this.mutationQueue.push(o);for(const a of i)this.Yr=this.Yr.add(new ht(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return U.resolve(o)}lookupMutationBatch(e,n){return U.resolve(this.Zr(n))}getNextMutationBatchAfterBatchId(e,n){const s=n+1,i=this.Xr(s),r=i<0?0:i;return U.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return U.resolve(this.mutationQueue.length===0?Hh:this.er-1)}getAllMutationBatches(e){return U.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const s=new ht(n,0),i=new ht(n,Number.POSITIVE_INFINITY),r=[];return this.Yr.forEachInRange([s,i],o=>{const a=this.Zr(o.Hr);r.push(a)}),U.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,n){let s=new ct(ve);return n.forEach(i=>{const r=new ht(i,0),o=new ht(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([r,o],a=>{s=s.add(a.Hr)})}),U.resolve(this.ei(s))}getAllMutationBatchesAffectingQuery(e,n){const s=n.path,i=s.length+1;let r=s;J.isDocumentKey(r)||(r=r.child(""));const o=new ht(new J(r),0);let a=new ct(ve);return this.Yr.forEachWhile(u=>{const h=u.key.path;return!!s.isPrefixOf(h)&&(h.length===i&&(a=a.add(u.Hr)),!0)},o),U.resolve(this.ei(a))}ei(e){const n=[];return e.forEach(s=>{const i=this.Zr(s);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){Ne(this.ti(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Yr;return U.forEach(n.mutations,i=>{const r=new ht(i.key,n.batchId);return s=s.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=s})}rr(e){}containsKey(e,n){const s=new ht(n,0),i=this.Yr.firstAfterOrEqual(s);return U.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,U.resolve()}ti(e,n){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const n=this.Xr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KA{constructor(e){this.ni=e,this.docs=function(){return new Ye(J.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const s=n.key,i=this.docs.get(s),r=i?i.size:0,o=this.ni(n);return this.docs=this.docs.insert(s,{document:n.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const s=this.docs.get(n);return U.resolve(s?s.document.mutableCopy():St.newInvalidDocument(n))}getEntries(e,n){let s=Zn();return n.forEach(i=>{const r=this.docs.get(i);s=s.insert(i,r?r.document.mutableCopy():St.newInvalidDocument(i))}),U.resolve(s)}getDocumentsMatchingQuery(e,n,s,i){let r=Zn();const o=n.path,a=new J(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:h,value:{document:d}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||xE(IE(d),s)<=0||(i.has(d.key)||Ml(n,d))&&(r=r.insert(d.key,d.mutableCopy()))}return U.resolve(r)}getAllFromCollectionGroup(e,n,s,i){re(9500)}ri(e,n){return U.forEach(this.docs,s=>n(s))}newChangeBuffer(e){return new QA(this)}getSize(e){return U.resolve(this.size)}}class QA extends HA{constructor(e){super(),this.Or=e}applyChanges(e){const n=[];return this.changes.forEach((s,i)=>{i.isValidDocument()?n.push(this.Or.addEntry(e,i)):this.Or.removeEntry(s)}),U.waitFor(n)}getFromCache(e,n){return this.Or.getEntry(e,n)}getAllFromCache(e,n){return this.Or.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JA{constructor(e){this.persistence=e,this.ii=new ai(n=>Gh(n),Yh),this.lastRemoteSnapshotVersion=ae.min(),this.highestTargetId=0,this.si=0,this.oi=new ed,this.targetCount=0,this._i=Oi.ar()}forEachTarget(e,n){return this.ii.forEach((s,i)=>n(i)),U.resolve()}getLastRemoteSnapshotVersion(e){return U.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return U.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),U.resolve(this.highestTargetId)}setTargetsMetadata(e,n,s){return s&&(this.lastRemoteSnapshotVersion=s),n>this.si&&(this.si=n),U.resolve()}hr(e){this.ii.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this._i=new Oi(n),this.highestTargetId=n),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,n){return this.hr(n),this.targetCount+=1,U.resolve()}updateTargetData(e,n){return this.hr(n),U.resolve()}removeTargetData(e,n){return this.ii.delete(n.target),this.oi.zr(n.targetId),this.targetCount-=1,U.resolve()}removeTargets(e,n,s){let i=0;const r=[];return this.ii.forEach((o,a)=>{a.sequenceNumber<=n&&s.get(a.targetId)===null&&(this.ii.delete(o),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),U.waitFor(r).next(()=>i)}getTargetCount(e){return U.resolve(this.targetCount)}getTargetData(e,n){const s=this.ii.get(n)||null;return U.resolve(s)}addMatchingKeys(e,n,s){return this.oi.Kr(n,s),U.resolve()}removeMatchingKeys(e,n,s){this.oi.Gr(n,s);const i=this.persistence.referenceDelegate,r=[];return i&&n.forEach(o=>{r.push(i.markPotentiallyOrphaned(e,o))}),U.waitFor(r)}removeMatchingKeysForTargetId(e,n){return this.oi.zr(n),U.resolve()}getMatchingKeysForTargetId(e,n){const s=this.oi.Jr(n);return U.resolve(s)}containsKey(e,n){return U.resolve(this.oi.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E_{constructor(e,n){this.ai={},this.overlays={},this.ui=new Dl(0),this.ci=!1,this.ci=!0,this.li=new zA,this.referenceDelegate=e(this),this.hi=new JA(this),this.indexManager=new kA,this.remoteDocumentCache=function(i){return new KA(i)}(s=>this.referenceDelegate.Pi(s)),this.serializer=new jA(n),this.Ti=new GA(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new YA,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let s=this.ai[e.toKey()];return s||(s=new qA(n,this.referenceDelegate),this.ai[e.toKey()]=s),s}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,n,s){q("MemoryPersistence","Starting transaction:",e);const i=new ZA(this.ui.next());return this.referenceDelegate.Ii(),s(i).next(r=>this.referenceDelegate.di(i).next(()=>r)).toPromise().then(r=>(i.raiseOnCommittedEvent(),r))}Ei(e,n){return U.or(Object.values(this.ai).map(s=>()=>s.containsKey(e,n)))}}class ZA extends bE{constructor(e){super(),this.currentSequenceNumber=e}}class td{constructor(e){this.persistence=e,this.Ai=new ed,this.Ri=null}static Vi(e){return new td(e)}get mi(){if(this.Ri)return this.Ri;throw re(60996)}addReference(e,n,s){return this.Ai.addReference(s,n),this.mi.delete(s.toString()),U.resolve()}removeReference(e,n,s){return this.Ai.removeReference(s,n),this.mi.add(s.toString()),U.resolve()}markPotentiallyOrphaned(e,n){return this.mi.add(n.toString()),U.resolve()}removeTarget(e,n){this.Ai.zr(n.targetId).forEach(i=>this.mi.add(i.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(r=>this.mi.add(r.toString()))}).next(()=>s.removeTargetData(e,n))}Ii(){this.Ri=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return U.forEach(this.mi,s=>{const i=J.fromPath(s);return this.fi(e,i).next(r=>{r||n.removeEntry(i,ae.min())})}).next(()=>(this.Ri=null,n.apply(e)))}updateLimboDocument(e,n){return this.fi(e,n).next(s=>{s?this.mi.delete(n.toString()):this.mi.add(n.toString())})}Pi(e){return 0}fi(e,n){return U.or([()=>U.resolve(this.Ai.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ei(e,n)])}}class el{constructor(e,n){this.persistence=e,this.gi=new ai(s=>PE(s.path),(s,i)=>s.isEqual(i)),this.garbageCollector=$A(this,n)}static Vi(e,n){return new el(e,n)}Ii(){}di(e){return U.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}mr(e){const n=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(s=>n.next(i=>s+i))}yr(e){let n=0;return this.gr(e,s=>{n++}).next(()=>n)}gr(e,n){return U.forEach(this.gi,(s,i)=>this.Sr(e,s,i).next(r=>r?U.resolve():n(i)))}removeTargets(e,n,s){return this.persistence.getTargetCache().removeTargets(e,n,s)}removeOrphanedDocuments(e,n){let s=0;const i=this.persistence.getRemoteDocumentCache(),r=i.newChangeBuffer();return i.ri(e,o=>this.Sr(e,o,n).next(a=>{a||(s++,r.removeEntry(o,ae.min()))})).next(()=>r.apply(e)).next(()=>s)}markPotentiallyOrphaned(e,n){return this.gi.set(n,e.currentSequenceNumber),U.resolve()}removeTarget(e,n){const s=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,n,s){return this.gi.set(s,e.currentSequenceNumber),U.resolve()}removeReference(e,n,s){return this.gi.set(s,e.currentSequenceNumber),U.resolve()}updateLimboDocument(e,n){return this.gi.set(n,e.currentSequenceNumber),U.resolve()}Pi(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Na(e.data.value)),n}Sr(e,n,s){return U.or([()=>this.persistence.Ei(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.gi.get(n);return U.resolve(i!==void 0&&i>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nd{constructor(e,n,s,i){this.targetId=e,this.fromCache=n,this.Is=s,this.ds=i}static Es(e,n){let s=Ae(),i=Ae();for(const r of n.docChanges)switch(r.type){case 0:s=s.add(r.doc.key);break;case 1:i=i.add(r.doc.key)}return new nd(e,n.fromCache,s,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eI{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tI{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return Pv()?8:CE(bt())>0?6:4}()}initialize(e,n){this.gs=e,this.indexManager=n,this.As=!0}getDocumentsMatchingQuery(e,n,s,i){const r={result:null};return this.ps(e,n).next(o=>{r.result=o}).next(()=>{if(!r.result)return this.ys(e,n,i,s).next(o=>{r.result=o})}).next(()=>{if(r.result)return;const o=new eI;return this.ws(e,n,o).next(a=>{if(r.result=a,this.Rs)return this.Ss(e,n,o,a.size)})}).next(()=>r.result)}Ss(e,n,s,i){return s.documentReadCount<this.Vs?(wi()<=Ee.DEBUG&&q("QueryEngine","SDK will not create cache indexes for query:",Ti(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),U.resolve()):(wi()<=Ee.DEBUG&&q("QueryEngine","Query:",Ti(n),"scans",s.documentReadCount,"local documents and returns",i,"documents as results."),s.documentReadCount>this.fs*i?(wi()<=Ee.DEBUG&&q("QueryEngine","The SDK decides to create cache indexes for query:",Ti(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,In(n))):U.resolve())}ps(e,n){if(Fp(n))return U.resolve(null);let s=In(n);return this.indexManager.getIndexType(e,s).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=Lu(n,null,"F"),s=In(n)),this.indexManager.getDocumentsMatchingTarget(e,s).next(r=>{const o=Ae(...r);return this.gs.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,s).next(u=>{const h=this.bs(n,a);return this.Ds(n,h,o,u.readTime)?this.ps(e,Lu(n,null,"F")):this.vs(e,h,n,u)}))})))}ys(e,n,s,i){return Fp(n)||i.isEqual(ae.min())?U.resolve(null):this.gs.getDocuments(e,s).next(r=>{const o=this.bs(n,r);return this.Ds(n,o,s,i)?U.resolve(null):(wi()<=Ee.DEBUG&&q("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ti(n)),this.vs(e,o,n,AE(i,Zr)).next(a=>a))})}bs(e,n){let s=new ct(e_(e));return n.forEach((i,r)=>{Ml(e,r)&&(s=s.add(r))}),s}Ds(e,n,s,i){if(e.limit===null)return!1;if(s.size!==n.size)return!0;const r=e.limitType==="F"?n.last():n.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}ws(e,n,s){return wi()<=Ee.DEBUG&&q("QueryEngine","Using full collection scan to execute query:",Ti(n)),this.gs.getDocumentsMatchingQuery(e,n,bs.min(),s)}vs(e,n,s,i){return this.gs.getDocumentsMatchingQuery(e,s,i).next(r=>(n.forEach(o=>{r=r.insert(o.key,o)}),r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sd="LocalStore",nI=3e8;class sI{constructor(e,n,s,i){this.persistence=e,this.Cs=n,this.serializer=i,this.Fs=new Ye(ve),this.Ms=new ai(r=>Gh(r),Yh),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(s)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new XA(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Fs))}}function iI(t,e,n,s){return new sI(t,e,n,s)}async function A_(t,e){const n=he(t);return await n.persistence.runTransaction("Handle user change","readonly",s=>{let i;return n.mutationQueue.getAllMutationBatches(s).next(r=>(i=r,n.Ns(e),n.mutationQueue.getAllMutationBatches(s))).next(r=>{const o=[],a=[];let u=Ae();for(const h of i){o.push(h.batchId);for(const d of h.mutations)u=u.add(d.key)}for(const h of r){a.push(h.batchId);for(const d of h.mutations)u=u.add(d.key)}return n.localDocuments.getDocuments(s,u).next(h=>({Bs:h,removedBatchIds:o,addedBatchIds:a}))})})}function rI(t,e){const n=he(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const i=e.batch.keys(),r=n.Os.newChangeBuffer({trackRemovals:!0});return function(a,u,h,d){const p=h.batch,m=p.keys();let _=U.resolve();return m.forEach(y=>{_=_.next(()=>d.getEntry(u,y)).next(v=>{const w=h.docVersions.get(y);Ne(w!==null,48541),v.version.compareTo(w)<0&&(p.applyToRemoteDocument(v,h),v.isValidDocument()&&(v.setReadTime(h.commitVersion),d.addEntry(v)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(u,p))}(n,s,e,r).next(()=>r.apply(s)).next(()=>n.mutationQueue.performConsistencyCheck(s)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(s,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(a){let u=Ae();for(let h=0;h<a.mutationResults.length;++h)a.mutationResults[h].transformResults.length>0&&(u=u.add(a.batch.mutations[h].key));return u}(e))).next(()=>n.localDocuments.getDocuments(s,i))})}function I_(t){const e=he(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.hi.getLastRemoteSnapshotVersion(n))}function oI(t,e){const n=he(t),s=e.snapshotVersion;let i=n.Fs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{const o=n.Os.newChangeBuffer({trackRemovals:!0});i=n.Fs;const a=[];e.targetChanges.forEach((d,p)=>{const m=i.get(p);if(!m)return;a.push(n.hi.removeMatchingKeys(r,d.removedDocuments,p).next(()=>n.hi.addMatchingKeys(r,d.addedDocuments,p)));let _=m.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.get(p)!==null?_=_.withResumeToken(vt.EMPTY_BYTE_STRING,ae.min()).withLastLimboFreeSnapshotVersion(ae.min()):d.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(d.resumeToken,s)),i=i.insert(p,_),function(v,w,b){return v.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=nI?!0:b.addedDocuments.size+b.modifiedDocuments.size+b.removedDocuments.size>0}(m,_,d)&&a.push(n.hi.updateTargetData(r,_))});let u=Zn(),h=Ae();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(r,d))}),a.push(aI(r,o,e.documentUpdates).next(d=>{u=d.Ls,h=d.ks})),!s.isEqual(ae.min())){const d=n.hi.getLastRemoteSnapshotVersion(r).next(p=>n.hi.setTargetsMetadata(r,r.currentSequenceNumber,s));a.push(d)}return U.waitFor(a).next(()=>o.apply(r)).next(()=>n.localDocuments.getLocalViewOfDocuments(r,u,h)).next(()=>u)}).then(r=>(n.Fs=i,r))}function aI(t,e,n){let s=Ae(),i=Ae();return n.forEach(r=>s=s.add(r)),e.getEntries(t,s).next(r=>{let o=Zn();return n.forEach((a,u)=>{const h=r.get(a);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(ae.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):q(sd,"Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",u.version)}),{Ls:o,ks:i}})}function lI(t,e){const n=he(t);return n.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=Hh),n.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function cI(t,e){const n=he(t);return n.persistence.runTransaction("Allocate target","readwrite",s=>{let i;return n.hi.getTargetData(s,e).next(r=>r?(i=r,U.resolve(i)):n.hi.allocateTargetId(s).next(o=>(i=new _s(e,o,"TargetPurposeListen",s.currentSequenceNumber),n.hi.addTargetData(s,i).next(()=>i))))}).then(s=>{const i=n.Fs.get(s.targetId);return(i===null||s.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Fs=n.Fs.insert(s.targetId,s),n.Ms.set(e,s.targetId)),s})}async function Bu(t,e,n){const s=he(t),i=s.Fs.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,o=>s.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!Yi(o))throw o;q(sd,`Failed to update sequence numbers for target ${e}: ${o}`)}s.Fs=s.Fs.remove(e),s.Ms.delete(i.target)}function Kp(t,e,n){const s=he(t);let i=ae.min(),r=Ae();return s.persistence.runTransaction("Execute query","readwrite",o=>function(u,h,d){const p=he(u),m=p.Ms.get(d);return m!==void 0?U.resolve(p.Fs.get(m)):p.hi.getTargetData(h,d)}(s,o,In(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,s.hi.getMatchingKeysForTargetId(o,a.targetId).next(u=>{r=u})}).next(()=>s.Cs.getDocumentsMatchingQuery(o,e,n?i:ae.min(),n?r:Ae())).next(a=>(uI(s,qE(e),a),{documents:a,qs:r})))}function uI(t,e,n){let s=t.xs.get(e)||ae.min();n.forEach((i,r)=>{r.readTime.compareTo(s)>0&&(s=r.readTime)}),t.xs.set(e,s)}class Qp{constructor(){this.activeTargetIds=tA()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class hI{constructor(){this.Fo=new Qp,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,s){}addLocalQueryTarget(e,n=!0){return n&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,n,s){this.Mo[e]=n}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new Qp,Promise.resolve()}handleUserChange(e,n,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dI{xo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jp="ConnectivityMonitor";class Zp{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){q(Jp,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){q(Jp,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sa=null;function Uu(){return sa===null?sa=function(){return 268435456+Math.round(2147483648*Math.random())}():sa++,"0x"+sa.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bc="RestConnection",fI={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class pI{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=n+"://"+e.host,this.Uo=`projects/${s}/databases/${i}`,this.Ko=this.databaseId.database===qa?`project_id=${s}`:`project_id=${s}&database_id=${i}`}Wo(e,n,s,i,r){const o=Uu(),a=this.Go(e,n.toUriEncodedString());q(bc,`Sending RPC '${e}' ${o}:`,a,s);const u={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(u,i,r);const{host:h}=new URL(a),d=$i(h);return this.jo(e,a,u,s,d).then(p=>(q(bc,`Received RPC '${e}' ${o}: `,p),p),p=>{throw Ss(bc,`RPC '${e}' ${o} failed with error: `,p,"url: ",a,"request:",s),p})}Jo(e,n,s,i,r,o){return this.Wo(e,n,s,i,r)}zo(e,n,s){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Xi}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,r)=>e[r]=i),s&&s.headers.forEach((i,r)=>e[r]=i)}Go(e,n){const s=fI[e];return`${this.$o}/v1/${n}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gI{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const At="WebChannelConnection";class mI extends pI{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,n,s,i,r){const o=Uu();return new Promise((a,u)=>{const h=new S0;h.setWithCredentials(!0),h.listenOnce(b0.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Ra.NO_ERROR:const p=h.getResponseJson();q(At,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),a(p);break;case Ra.TIMEOUT:q(At,`RPC '${e}' ${o} timed out`),u(new Y(B.DEADLINE_EXCEEDED,"Request time out"));break;case Ra.HTTP_ERROR:const m=h.getStatus();if(q(At,`RPC '${e}' ${o} failed with status:`,m,"response text:",h.getResponseText()),m>0){let _=h.getResponseJson();Array.isArray(_)&&(_=_[0]);const y=_==null?void 0:_.error;if(y&&y.status&&y.message){const v=function(b){const A=b.toLowerCase().replace(/_/g,"-");return Object.values(B).indexOf(A)>=0?A:B.UNKNOWN}(y.status);u(new Y(v,y.message))}else u(new Y(B.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new Y(B.UNAVAILABLE,"Connection failed."));break;default:re(9055,{c_:e,streamId:o,l_:h.getLastErrorCode(),h_:h.getLastError()})}}finally{q(At,`RPC '${e}' ${o} completed.`)}});const d=JSON.stringify(i);q(At,`RPC '${e}' ${o} sending request:`,i),h.send(n,"POST",d,s,15)})}P_(e,n,s){const i=Uu(),r=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=P0(),a=D0(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.zo(u.initMessageHeaders,n,s),u.encodeInitMessageHeaders=!0;const d=r.join("");q(At,`Creating RPC '${e}' stream ${i}: ${d}`,u);const p=o.createWebChannel(d,u);this.T_(p);let m=!1,_=!1;const y=new gI({Ho:w=>{_?q(At,`Not sending because RPC '${e}' stream ${i} is closed:`,w):(m||(q(At,`Opening RPC '${e}' stream ${i} transport.`),p.open(),m=!0),q(At,`RPC '${e}' stream ${i} sending:`,w),p.send(w))},Yo:()=>p.close()}),v=(w,b,A)=>{w.listen(b,R=>{try{A(R)}catch(N){setTimeout(()=>{throw N},0)}})};return v(p,Pr.EventType.OPEN,()=>{_||(q(At,`RPC '${e}' stream ${i} transport opened.`),y.s_())}),v(p,Pr.EventType.CLOSE,()=>{_||(_=!0,q(At,`RPC '${e}' stream ${i} transport closed`),y.__(),this.I_(p))}),v(p,Pr.EventType.ERROR,w=>{_||(_=!0,Ss(At,`RPC '${e}' stream ${i} transport errored. Name:`,w.name,"Message:",w.message),y.__(new Y(B.UNAVAILABLE,"The operation could not be completed")))}),v(p,Pr.EventType.MESSAGE,w=>{var b;if(!_){const A=w.data[0];Ne(!!A,16349);const R=A,N=(R==null?void 0:R.error)||((b=R[0])===null||b===void 0?void 0:b.error);if(N){q(At,`RPC '${e}' stream ${i} received error:`,N);const M=N.status;let k=function(E){const C=tt[E];if(C!==void 0)return h_(C)}(M),x=N.message;k===void 0&&(k=B.INTERNAL,x="Unknown error status: "+M+" with message "+N.message),_=!0,y.__(new Y(k,x)),p.close()}else q(At,`RPC '${e}' stream ${i} received:`,A),y.a_(A)}}),v(a,C0.STAT_EVENT,w=>{w.stat===Cu.PROXY?q(At,`RPC '${e}' stream ${i} detected buffering proxy`):w.stat===Cu.NOPROXY&&q(At,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{y.o_()},0),y}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(n=>n===e)}}function Cc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fl(t){return new wA(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x_{constructor(e,n,s=1e3,i=1.5,r=6e4){this.Fi=e,this.timerId=n,this.d_=s,this.E_=i,this.A_=r,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const n=Math.floor(this.R_+this.p_()),s=Math.max(0,Date.now()-this.m_),i=Math.max(0,n-s);i>0&&q("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${n} ms, last attempt: ${s} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eg="PersistentStream";class S_{constructor(e,n,s,i,r,o,a,u){this.Fi=e,this.w_=s,this.S_=i,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new x_(e,n)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():n&&n.code===B.RESOURCE_EXHAUSTED?(Qn(n.toString()),Qn("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):n&&n.code===B.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(n)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),n=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,i])=>{this.b_===n&&this.W_(s,i)},s=>{e(()=>{const i=new Y(B.UNKNOWN,"Fetching auth token failed: "+s.message);return this.G_(i)})})}W_(e,n){const s=this.K_(this.b_);this.stream=this.z_(e,n),this.stream.Zo(()=>{s(()=>this.listener.Zo())}),this.stream.e_(()=>{s(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{s(()=>this.G_(i))}),this.stream.onMessage(i=>{s(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(e){return q(eg,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return n=>{this.Fi.enqueueAndForget(()=>this.b_===e?n():(q(eg,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class _I extends S_{constructor(e,n,s,i,r,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,s,i,o),this.serializer=r}z_(e,n){return this.connection.P_("Listen",e,n)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const n=AA(this.serializer,e),s=function(r){if(!("targetChange"in r))return ae.min();const o=r.targetChange;return o.targetIds&&o.targetIds.length?ae.min():o.readTime?xn(o.readTime):ae.min()}(e);return this.listener.J_(n,s)}H_(e){const n={};n.database=Vu(this.serializer),n.addTarget=function(r,o){let a;const u=o.target;if(a=Mu(u)?{documents:SA(r,u)}:{query:bA(r,u).Vt},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=p_(r,o.resumeToken);const h=ku(r,o.expectedCount);h!==null&&(a.expectedCount=h)}else if(o.snapshotVersion.compareTo(ae.min())>0){a.readTime=Za(r,o.snapshotVersion.toTimestamp());const h=ku(r,o.expectedCount);h!==null&&(a.expectedCount=h)}return a}(this.serializer,e);const s=DA(this.serializer,e);s&&(n.labels=s),this.k_(n)}Y_(e){const n={};n.database=Vu(this.serializer),n.removeTarget=e,this.k_(n)}}class yI extends S_{constructor(e,n,s,i,r,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,s,i,o),this.serializer=r}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,n){return this.connection.P_("Write",e,n)}j_(e){return Ne(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Ne(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){Ne(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const n=xA(e.writeResults,e.commitTime),s=xn(e.commitTime);return this.listener.ta(s,n)}na(){const e={};e.database=Vu(this.serializer),this.k_(e)}X_(e){const n={streamToken:this.lastStreamToken,writes:e.map(s=>IA(this.serializer,s))};this.k_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vI{}class wI extends vI{constructor(e,n,s,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=s,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new Y(B.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,n,s,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,o])=>this.connection.Wo(e,Fu(n,s),i,r,o)).catch(r=>{throw r.name==="FirebaseError"?(r.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new Y(B.UNKNOWN,r.toString())})}Jo(e,n,s,i,r){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Jo(e,Fu(n,s),i,o,a,r)).catch(o=>{throw o.name==="FirebaseError"?(o.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Y(B.UNKNOWN,o.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class TI{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(Qn(n),this._a=!1):q("OnlineStateTracker",n)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ii="RemoteStore";class EI{constructor(e,n,s,i,r){this.localStore=e,this.datastore=n,this.asyncQueue=s,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=r,this.Ea.xo(o=>{s.enqueueAndForget(async()=>{li(this)&&(q(ii,"Restarting streams for network reachability change."),await async function(u){const h=he(u);h.Ia.add(4),await So(h),h.Aa.set("Unknown"),h.Ia.delete(4),await Ol(h)}(this))})}),this.Aa=new TI(s,i)}}async function Ol(t){if(li(t))for(const e of t.da)await e(!0)}async function So(t){for(const e of t.da)await e(!1)}function b_(t,e){const n=he(t);n.Ta.has(e.targetId)||(n.Ta.set(e.targetId,e),ad(n)?od(n):qi(n).x_()&&rd(n,e))}function id(t,e){const n=he(t),s=qi(n);n.Ta.delete(e),s.x_()&&C_(n,e),n.Ta.size===0&&(s.x_()?s.B_():li(n)&&n.Aa.set("Unknown"))}function rd(t,e){if(t.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ae.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}qi(t).H_(e)}function C_(t,e){t.Ra.$e(e),qi(t).Y_(e)}function od(t){t.Ra=new mA({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>t.Ta.get(e)||null,lt:()=>t.datastore.serializer.databaseId}),qi(t).start(),t.Aa.aa()}function ad(t){return li(t)&&!qi(t).M_()&&t.Ta.size>0}function li(t){return he(t).Ia.size===0}function D_(t){t.Ra=void 0}async function AI(t){t.Aa.set("Online")}async function II(t){t.Ta.forEach((e,n)=>{rd(t,e)})}async function xI(t,e){D_(t),ad(t)?(t.Aa.la(e),od(t)):t.Aa.set("Unknown")}async function SI(t,e,n){if(t.Aa.set("Online"),e instanceof f_&&e.state===2&&e.cause)try{await async function(i,r){const o=r.cause;for(const a of r.targetIds)i.Ta.has(a)&&(await i.remoteSyncer.rejectListen(a,o),i.Ta.delete(a),i.Ra.removeTarget(a))}(t,e)}catch(s){q(ii,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await tl(t,s)}else if(e instanceof La?t.Ra.Ye(e):e instanceof d_?t.Ra.it(e):t.Ra.et(e),!n.isEqual(ae.min()))try{const s=await I_(t.localStore);n.compareTo(s)>=0&&await function(r,o){const a=r.Ra.Pt(o);return a.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){const d=r.Ta.get(h);d&&r.Ta.set(h,d.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,h)=>{const d=r.Ta.get(u);if(!d)return;r.Ta.set(u,d.withResumeToken(vt.EMPTY_BYTE_STRING,d.snapshotVersion)),C_(r,u);const p=new _s(d.target,u,h,d.sequenceNumber);rd(r,p)}),r.remoteSyncer.applyRemoteEvent(a)}(t,n)}catch(s){q(ii,"Failed to raise snapshot:",s),await tl(t,s)}}async function tl(t,e,n){if(!Yi(e))throw e;t.Ia.add(1),await So(t),t.Aa.set("Offline"),n||(n=()=>I_(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{q(ii,"Retrying IndexedDB access"),await n(),t.Ia.delete(1),await Ol(t)})}function P_(t,e){return e().catch(n=>tl(t,n,e))}async function Vl(t){const e=he(t),n=Rs(e);let s=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:Hh;for(;bI(e);)try{const i=await lI(e.localStore,s);if(i===null){e.Pa.length===0&&n.B_();break}s=i.batchId,CI(e,i)}catch(i){await tl(e,i)}R_(e)&&N_(e)}function bI(t){return li(t)&&t.Pa.length<10}function CI(t,e){t.Pa.push(e);const n=Rs(t);n.x_()&&n.Z_&&n.X_(e.mutations)}function R_(t){return li(t)&&!Rs(t).M_()&&t.Pa.length>0}function N_(t){Rs(t).start()}async function DI(t){Rs(t).na()}async function PI(t){const e=Rs(t);for(const n of t.Pa)e.X_(n.mutations)}async function RI(t,e,n){const s=t.Pa.shift(),i=Qh.from(s,e,n);await P_(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await Vl(t)}async function NI(t,e){e&&Rs(t).Z_&&await async function(s,i){if(function(o){return pA(o)&&o!==B.ABORTED}(i.code)){const r=s.Pa.shift();Rs(s).N_(),await P_(s,()=>s.remoteSyncer.rejectFailedWrite(r.batchId,i)),await Vl(s)}}(t,e),R_(t)&&N_(t)}async function tg(t,e){const n=he(t);n.asyncQueue.verifyOperationInProgress(),q(ii,"RemoteStore received new credentials");const s=li(n);n.Ia.add(3),await So(n),s&&n.Aa.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ia.delete(3),await Ol(n)}async function MI(t,e){const n=he(t);e?(n.Ia.delete(2),await Ol(n)):e||(n.Ia.add(2),await So(n),n.Aa.set("Unknown"))}function qi(t){return t.Va||(t.Va=function(n,s,i){const r=he(n);return r.ia(),new _I(s,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,i)}(t.datastore,t.asyncQueue,{Zo:AI.bind(null,t),e_:II.bind(null,t),n_:xI.bind(null,t),J_:SI.bind(null,t)}),t.da.push(async e=>{e?(t.Va.N_(),ad(t)?od(t):t.Aa.set("Unknown")):(await t.Va.stop(),D_(t))})),t.Va}function Rs(t){return t.ma||(t.ma=function(n,s,i){const r=he(n);return r.ia(),new yI(s,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,i)}(t.datastore,t.asyncQueue,{Zo:()=>Promise.resolve(),e_:DI.bind(null,t),n_:NI.bind(null,t),ea:PI.bind(null,t),ta:RI.bind(null,t)}),t.da.push(async e=>{e?(t.ma.N_(),await Vl(t)):(await t.ma.stop(),t.Pa.length>0&&(q(ii,`Stopping write stream with ${t.Pa.length} pending writes`),t.Pa=[]))})),t.ma}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ld{constructor(e,n,s,i,r){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=s,this.op=i,this.removalCallback=r,this.deferred=new zn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,s,i,r){const o=Date.now()+s,a=new ld(e,n,o,i,r);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Y(B.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function cd(t,e){if(Qn("AsyncQueue",`${e}: ${t}`),Yi(t))return new Y(B.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ci{static emptySet(e){return new Ci(e.comparator)}constructor(e){this.comparator=e?(n,s)=>e(n,s)||J.comparator(n.key,s.key):(n,s)=>J.comparator(n.key,s.key),this.keyedMap=Rr(),this.sortedSet=new Ye(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,s)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Ci)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,r=s.getNext().key;if(!i.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const s=new Ci;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=n,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng{constructor(){this.fa=new Ye(J.comparator)}track(e){const n=e.doc.key,s=this.fa.get(n);s?e.type!==0&&s.type===3?this.fa=this.fa.insert(n,e):e.type===3&&s.type!==1?this.fa=this.fa.insert(n,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.fa=this.fa.insert(n,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.fa=this.fa.insert(n,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.fa=this.fa.remove(n):e.type===1&&s.type===2?this.fa=this.fa.insert(n,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.fa=this.fa.insert(n,{type:2,doc:e.doc}):re(63341,{At:e,ga:s}):this.fa=this.fa.insert(n,e)}pa(){const e=[];return this.fa.inorderTraversal((n,s)=>{e.push(s)}),e}}class Vi{constructor(e,n,s,i,r,o,a,u,h){this.query=e,this.docs=n,this.oldDocs=s,this.docChanges=i,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,n,s,i,r){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new Vi(e,n,Ci.emptySet(n),o,s,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Nl(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,s=e.docChanges;if(n.length!==s.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==s[i].type||!n[i].doc.isEqual(s[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jI{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}}class LI{constructor(){this.queries=sg(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(n,s){const i=he(n),r=i.queries;i.queries=sg(),r.forEach((o,a)=>{for(const u of a.wa)u.onError(s)})})(this,new Y(B.ABORTED,"Firestore shutting down"))}}function sg(){return new ai(t=>Z0(t),Nl)}async function M_(t,e){const n=he(t);let s=3;const i=e.query;let r=n.queries.get(i);r?!r.Sa()&&e.ba()&&(s=2):(r=new jI,s=e.ba()?0:1);try{switch(s){case 0:r.ya=await n.onListen(i,!0);break;case 1:r.ya=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(o){const a=cd(o,`Initialization of query '${Ti(e.query)}' failed`);return void e.onError(a)}n.queries.set(i,r),r.wa.push(e),e.va(n.onlineState),r.ya&&e.Ca(r.ya)&&ud(n)}async function j_(t,e){const n=he(t),s=e.query;let i=3;const r=n.queries.get(s);if(r){const o=r.wa.indexOf(e);o>=0&&(r.wa.splice(o,1),r.wa.length===0?i=e.ba()?0:1:!r.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return n.queries.delete(s),n.onUnlisten(s,!0);case 1:return n.queries.delete(s),n.onUnlisten(s,!1);case 2:return n.onLastRemoteStoreUnlisten(s);default:return}}function kI(t,e){const n=he(t);let s=!1;for(const i of e){const r=i.query,o=n.queries.get(r);if(o){for(const a of o.wa)a.Ca(i)&&(s=!0);o.ya=i}}s&&ud(n)}function FI(t,e,n){const s=he(t),i=s.queries.get(e);if(i)for(const r of i.wa)r.onError(n);s.queries.delete(e)}function ud(t){t.Da.forEach(e=>{e.next()})}var $u,ig;(ig=$u||($u={})).Fa="default",ig.Cache="cache";class L_{constructor(e,n,s){this.query=e,this.Ma=n,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=s||{}}Ca(e){if(!this.options.includeMetadataChanges){const s=[];for(const i of e.docChanges)i.type!==3&&s.push(i);e=new Vi(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),n=!0):this.Ba(e,this.onlineState)&&(this.La(e),n=!0),this.Oa=e,n}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let n=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),n=!0),n}Ba(e,n){if(!e.fromCache||!this.ba())return!0;const s=n!=="Offline";return(!this.options.ka||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Na(e){if(e.docChanges.length>0)return!0;const n=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}La(e){e=Vi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==$u.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k_{constructor(e){this.key=e}}class F_{constructor(e){this.key=e}}class OI{constructor(e,n){this.query=e,this.Ha=n,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=Ae(),this.mutatedKeys=Ae(),this.Xa=e_(e),this.eu=new Ci(this.Xa)}get tu(){return this.Ha}nu(e,n){const s=n?n.ru:new ng,i=n?n.eu:this.eu;let r=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1;const u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,p)=>{const m=i.get(d),_=Ml(this.query,p)?p:null,y=!!m&&this.mutatedKeys.has(m.key),v=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let w=!1;m&&_?m.data.isEqual(_.data)?y!==v&&(s.track({type:3,doc:_}),w=!0):this.iu(m,_)||(s.track({type:2,doc:_}),w=!0,(u&&this.Xa(_,u)>0||h&&this.Xa(_,h)<0)&&(a=!0)):!m&&_?(s.track({type:0,doc:_}),w=!0):m&&!_&&(s.track({type:1,doc:m}),w=!0,(u||h)&&(a=!0)),w&&(_?(o=o.add(_),r=v?r.add(d):r.delete(d)):(o=o.delete(d),r=r.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),r=r.delete(d.key),s.track({type:1,doc:d})}return{eu:o,ru:s,Ds:a,mutatedKeys:r}}iu(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,s,i){const r=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const o=e.ru.pa();o.sort((d,p)=>function(_,y){const v=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return re(20277,{At:w})}};return v(_)-v(y)}(d.type,p.type)||this.Xa(d.doc,p.doc)),this.su(s),i=i!=null&&i;const a=n&&!i?this.ou():[],u=this.Za.size===0&&this.current&&!i?1:0,h=u!==this.Ya;return this.Ya=u,o.length!==0||h?{snapshot:new Vi(this.query,e.eu,r,o,e.mutatedKeys,u===0,h,!1,!!s&&s.resumeToken.approximateByteSize()>0),_u:a}:{_u:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new ng,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(n=>this.Ha=this.Ha.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ha=this.Ha.delete(n)),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=Ae(),this.eu.forEach(s=>{this.au(s.key)&&(this.Za=this.Za.add(s.key))});const n=[];return e.forEach(s=>{this.Za.has(s)||n.push(new F_(s))}),this.Za.forEach(s=>{e.has(s)||n.push(new k_(s))}),n}uu(e){this.Ha=e.qs,this.Za=Ae();const n=this.nu(e.documents);return this.applyChanges(n,!0)}cu(){return Vi.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}}const hd="SyncEngine";class VI{constructor(e,n,s){this.query=e,this.targetId=n,this.view=s}}class BI{constructor(e){this.key=e,this.lu=!1}}class UI{constructor(e,n,s,i,r,o){this.localStore=e,this.remoteStore=n,this.eventManager=s,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.hu={},this.Pu=new ai(a=>Z0(a),Nl),this.Tu=new Map,this.Iu=new Set,this.du=new Ye(J.comparator),this.Eu=new Map,this.Au=new ed,this.Ru={},this.Vu=new Map,this.mu=Oi.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}}async function $I(t,e,n=!0){const s=H_(t);let i;const r=s.Pu.get(e);return r?(s.sharedClientState.addLocalQueryTarget(r.targetId),i=r.view.cu()):i=await O_(s,e,n,!0),i}async function HI(t,e){const n=H_(t);await O_(n,e,!0,!1)}async function O_(t,e,n,s){const i=await cI(t.localStore,In(e)),r=i.targetId,o=t.sharedClientState.addLocalQueryTarget(r,n);let a;return s&&(a=await WI(t,e,r,o==="current",i.resumeToken)),t.isPrimaryClient&&n&&b_(t.remoteStore,i),a}async function WI(t,e,n,s,i){t.gu=(p,m,_)=>async function(v,w,b,A){let R=w.view.nu(b);R.Ds&&(R=await Kp(v.localStore,w.query,!1).then(({documents:x})=>w.view.nu(x,R)));const N=A&&A.targetChanges.get(w.targetId),M=A&&A.targetMismatches.get(w.targetId)!=null,k=w.view.applyChanges(R,v.isPrimaryClient,N,M);return og(v,w.targetId,k._u),k.snapshot}(t,p,m,_);const r=await Kp(t.localStore,e,!0),o=new OI(e,r.qs),a=o.nu(r.documents),u=xo.createSynthesizedTargetChangeForCurrentChange(n,s&&t.onlineState!=="Offline",i),h=o.applyChanges(a,t.isPrimaryClient,u);og(t,n,h._u);const d=new VI(e,n,o);return t.Pu.set(e,d),t.Tu.has(n)?t.Tu.get(n).push(e):t.Tu.set(n,[e]),h.snapshot}async function XI(t,e,n){const s=he(t),i=s.Pu.get(e),r=s.Tu.get(i.targetId);if(r.length>1)return s.Tu.set(i.targetId,r.filter(o=>!Nl(o,e))),void s.Pu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(i.targetId),s.sharedClientState.isActiveQueryTarget(i.targetId)||await Bu(s.localStore,i.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(i.targetId),n&&id(s.remoteStore,i.targetId),Hu(s,i.targetId)}).catch(Gi)):(Hu(s,i.targetId),await Bu(s.localStore,i.targetId,!0))}async function GI(t,e){const n=he(t),s=n.Pu.get(e),i=n.Tu.get(s.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(s.targetId),id(n.remoteStore,s.targetId))}async function YI(t,e,n){const s=ex(t);try{const i=await function(o,a){const u=he(o),h=He.now(),d=a.reduce((_,y)=>_.add(y.key),Ae());let p,m;return u.persistence.runTransaction("Locally write mutations","readwrite",_=>{let y=Zn(),v=Ae();return u.Os.getEntries(_,d).next(w=>{y=w,y.forEach((b,A)=>{A.isValidDocument()||(v=v.add(b))})}).next(()=>u.localDocuments.getOverlayedDocuments(_,y)).next(w=>{p=w;const b=[];for(const A of a){const R=cA(A,p.get(A.key).overlayedDocument);R!=null&&b.push(new Fs(A.key,R,X0(R.value.mapValue),hn.exists(!0)))}return u.mutationQueue.addMutationBatch(_,h,b,a)}).next(w=>{m=w;const b=w.applyToLocalDocumentSet(p,v);return u.documentOverlayCache.saveOverlays(_,w.batchId,b)})}).then(()=>({batchId:m.batchId,changes:n_(p)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let h=o.Ru[o.currentUser.toKey()];h||(h=new Ye(ve)),h=h.insert(a,u),o.Ru[o.currentUser.toKey()]=h}(s,i.batchId,n),await bo(s,i.changes),await Vl(s.remoteStore)}catch(i){const r=cd(i,"Failed to persist write");n.reject(r)}}async function V_(t,e){const n=he(t);try{const s=await oI(n.localStore,e);e.targetChanges.forEach((i,r)=>{const o=n.Eu.get(r);o&&(Ne(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.lu=!0:i.modifiedDocuments.size>0?Ne(o.lu,14607):i.removedDocuments.size>0&&(Ne(o.lu,42227),o.lu=!1))}),await bo(n,s,e)}catch(s){await Gi(s)}}function rg(t,e,n){const s=he(t);if(s.isPrimaryClient&&n===0||!s.isPrimaryClient&&n===1){const i=[];s.Pu.forEach((r,o)=>{const a=o.view.va(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const u=he(o);u.onlineState=a;let h=!1;u.queries.forEach((d,p)=>{for(const m of p.wa)m.va(a)&&(h=!0)}),h&&ud(u)}(s.eventManager,e),i.length&&s.hu.J_(i),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function zI(t,e,n){const s=he(t);s.sharedClientState.updateQueryState(e,"rejected",n);const i=s.Eu.get(e),r=i&&i.key;if(r){let o=new Ye(J.comparator);o=o.insert(r,St.newNoDocument(r,ae.min()));const a=Ae().add(r),u=new kl(ae.min(),new Map,new Ye(ve),o,a);await V_(s,u),s.du=s.du.remove(r),s.Eu.delete(e),dd(s)}else await Bu(s.localStore,e,!1).then(()=>Hu(s,e,n)).catch(Gi)}async function qI(t,e){const n=he(t),s=e.batch.batchId;try{const i=await rI(n.localStore,e);U_(n,s,null),B_(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await bo(n,i)}catch(i){await Gi(i)}}async function KI(t,e,n){const s=he(t);try{const i=await function(o,a){const u=he(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let d;return u.mutationQueue.lookupMutationBatch(h,a).next(p=>(Ne(p!==null,37113),d=p.keys(),u.mutationQueue.removeMutationBatch(h,p))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,d,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,d)).next(()=>u.localDocuments.getDocuments(h,d))})}(s.localStore,e);U_(s,e,n),B_(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await bo(s,i)}catch(i){await Gi(i)}}function B_(t,e){(t.Vu.get(e)||[]).forEach(n=>{n.resolve()}),t.Vu.delete(e)}function U_(t,e,n){const s=he(t);let i=s.Ru[s.currentUser.toKey()];if(i){const r=i.get(e);r&&(n?r.reject(n):r.resolve(),i=i.remove(e)),s.Ru[s.currentUser.toKey()]=i}}function Hu(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.Tu.get(e))t.Pu.delete(s),n&&t.hu.pu(s,n);t.Tu.delete(e),t.isPrimaryClient&&t.Au.zr(e).forEach(s=>{t.Au.containsKey(s)||$_(t,s)})}function $_(t,e){t.Iu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(id(t.remoteStore,n),t.du=t.du.remove(e),t.Eu.delete(n),dd(t))}function og(t,e,n){for(const s of n)s instanceof k_?(t.Au.addReference(s.key,e),QI(t,s)):s instanceof F_?(q(hd,"Document no longer in limbo: "+s.key),t.Au.removeReference(s.key,e),t.Au.containsKey(s.key)||$_(t,s.key)):re(19791,{yu:s})}function QI(t,e){const n=e.key,s=n.path.canonicalString();t.du.get(n)||t.Iu.has(s)||(q(hd,"New document in limbo: "+n),t.Iu.add(s),dd(t))}function dd(t){for(;t.Iu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Iu.values().next().value;t.Iu.delete(e);const n=new J(Be.fromString(e)),s=t.mu.next();t.Eu.set(s,new BI(n)),t.du=t.du.insert(n,s),b_(t.remoteStore,new _s(In(zh(n.path)),s,"TargetPurposeLimboResolution",Dl.ue))}}async function bo(t,e,n){const s=he(t),i=[],r=[],o=[];s.Pu.isEmpty()||(s.Pu.forEach((a,u)=>{o.push(s.gu(u,e,n).then(h=>{var d;if((h||n)&&s.isPrimaryClient){const p=h?!h.fromCache:(d=n==null?void 0:n.targetChanges.get(u.targetId))===null||d===void 0?void 0:d.current;s.sharedClientState.updateQueryState(u.targetId,p?"current":"not-current")}if(h){i.push(h);const p=nd.Es(u.targetId,h);r.push(p)}}))}),await Promise.all(o),s.hu.J_(i),await async function(u,h){const d=he(u);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>U.forEach(h,m=>U.forEach(m.Is,_=>d.persistence.referenceDelegate.addReference(p,m.targetId,_)).next(()=>U.forEach(m.ds,_=>d.persistence.referenceDelegate.removeReference(p,m.targetId,_)))))}catch(p){if(!Yi(p))throw p;q(sd,"Failed to update sequence numbers: "+p)}for(const p of h){const m=p.targetId;if(!p.fromCache){const _=d.Fs.get(m),y=_.snapshotVersion,v=_.withLastLimboFreeSnapshotVersion(y);d.Fs=d.Fs.insert(m,v)}}}(s.localStore,r))}async function JI(t,e){const n=he(t);if(!n.currentUser.isEqual(e)){q(hd,"User change. New user:",e.toKey());const s=await A_(n.localStore,e);n.currentUser=e,function(r,o){r.Vu.forEach(a=>{a.forEach(u=>{u.reject(new Y(B.CANCELLED,o))})}),r.Vu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await bo(n,s.Bs)}}function ZI(t,e){const n=he(t),s=n.Eu.get(e);if(s&&s.lu)return Ae().add(s.key);{let i=Ae();const r=n.Tu.get(e);if(!r)return i;for(const o of r){const a=n.Pu.get(o);i=i.unionWith(a.view.tu)}return i}}function H_(t){const e=he(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=V_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ZI.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=zI.bind(null,e),e.hu.J_=kI.bind(null,e.eventManager),e.hu.pu=FI.bind(null,e.eventManager),e}function ex(t){const e=he(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=qI.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=KI.bind(null,e),e}class nl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Fl(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,n){return null}Fu(e,n){return null}vu(e){return iI(this.persistence,new tI,e.initialUser,this.serializer)}Du(e){return new E_(td.Vi,this.serializer)}bu(e){return new hI}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}nl.provider={build:()=>new nl};class tx extends nl{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,n){Ne(this.persistence.referenceDelegate instanceof el,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new BA(s,e.asyncQueue,n)}Du(e){const n=this.cacheSizeBytes!==void 0?Ft.withCacheSize(this.cacheSizeBytes):Ft.DEFAULT;return new E_(s=>el.Vi(s,n),this.serializer)}}class Wu{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>rg(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=JI.bind(null,this.syncEngine),await MI(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new LI}()}createDatastore(e){const n=Fl(e.databaseInfo.databaseId),s=function(r){return new mI(r)}(e.databaseInfo);return function(r,o,a,u){return new wI(r,o,a,u)}(e.authCredentials,e.appCheckCredentials,s,n)}createRemoteStore(e){return function(s,i,r,o,a){return new EI(s,i,r,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>rg(this.syncEngine,n,0),function(){return Zp.C()?new Zp:new dI}())}createSyncEngine(e,n){return function(i,r,o,a,u,h,d){const p=new UI(i,r,o,a,u,h);return d&&(p.fu=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(i){const r=he(i);q(ii,"RemoteStore shutting down."),r.Ia.add(5),await So(r),r.Ea.shutdown(),r.Aa.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}Wu.provider={build:()=>new Wu};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W_{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):Qn("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ns="FirestoreClient";class nx{constructor(e,n,s,i,r){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=s,this.databaseInfo=i,this.user=xt.UNAUTHENTICATED,this.clientId=$h.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(s,async o=>{q(Ns,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(s,o=>(q(Ns,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new zn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const s=cd(n,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function Dc(t,e){t.asyncQueue.verifyOperationInProgress(),q(Ns,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener(async i=>{s.isEqual(i)||(await A_(e.localStore,i),s=i)}),e.persistence.setDatabaseDeletedListener(()=>{Ss("Terminating Firestore due to IndexedDb database deletion"),t.terminate().then(()=>{q("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{Ss("Terminating Firestore due to IndexedDb database deletion failed",i)})}),t._offlineComponents=e}async function ag(t,e){t.asyncQueue.verifyOperationInProgress();const n=await sx(t);q(Ns,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(s=>tg(e.remoteStore,s)),t.setAppCheckTokenChangeListener((s,i)=>tg(e.remoteStore,i)),t._onlineComponents=e}async function sx(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){q(Ns,"Using user provided OfflineComponentProvider");try{await Dc(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(i){return i.name==="FirebaseError"?i.code===B.FAILED_PRECONDITION||i.code===B.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(n))throw n;Ss("Error using user provided cache. Falling back to memory cache: "+n),await Dc(t,new nl)}}else q(Ns,"Using default OfflineComponentProvider"),await Dc(t,new tx(void 0));return t._offlineComponents}async function X_(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(q(Ns,"Using user provided OnlineComponentProvider"),await ag(t,t._uninitializedComponentsProvider._online)):(q(Ns,"Using default OnlineComponentProvider"),await ag(t,new Wu))),t._onlineComponents}function ix(t){return X_(t).then(e=>e.syncEngine)}async function G_(t){const e=await X_(t),n=e.eventManager;return n.onListen=$I.bind(null,e.syncEngine),n.onUnlisten=XI.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=HI.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=GI.bind(null,e.syncEngine),n}function rx(t,e,n={}){const s=new zn;return t.asyncQueue.enqueueAndForget(async()=>function(r,o,a,u,h){const d=new W_({next:m=>{d.Ou(),o.enqueueAndForget(()=>j_(r,p));const _=m.docs.has(a);!_&&m.fromCache?h.reject(new Y(B.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&m.fromCache&&u&&u.source==="server"?h.reject(new Y(B.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(m)},error:m=>h.reject(m)}),p=new L_(zh(a.path),d,{includeMetadataChanges:!0,ka:!0});return M_(r,p)}(await G_(t),t.asyncQueue,e,n,s)),s.promise}function ox(t,e,n={}){const s=new zn;return t.asyncQueue.enqueueAndForget(async()=>function(r,o,a,u,h){const d=new W_({next:m=>{d.Ou(),o.enqueueAndForget(()=>j_(r,p)),m.fromCache&&u.source==="server"?h.reject(new Y(B.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(m)},error:m=>h.reject(m)}),p=new L_(a,d,{includeMetadataChanges:!0,ka:!0});return M_(r,p)}(await G_(t),t.asyncQueue,e,n,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y_(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lg=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z_="firestore.googleapis.com",cg=!0;class ug{constructor(e){var n,s;if(e.host===void 0){if(e.ssl!==void 0)throw new Y(B.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=z_,this.ssl=cg}else this.host=e.host,this.ssl=(n=e.ssl)!==null&&n!==void 0?n:cg;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=T_;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<OA)throw new Y(B.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}EE("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Y_((s=e.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Y(B.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Y(B.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Y(B.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,i){return s.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Bl{constructor(e,n,s,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=s,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ug({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Y(B.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Y(B.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ug(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new fE;switch(s.type){case"firstParty":return new _E(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new Y(B.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const s=lg.get(n);s&&(q("ComponentProvider","Removing Datastore"),lg.delete(n),s.terminate())}(this),Promise.resolve()}}function ax(t,e,n,s={}){var i;t=Jn(t,Bl);const r=$i(e),o=t._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:t._getEmulatorOptions()}),u=`${e}:${n}`;r&&(Fm(`https://${u}`),Om("Firestore",!0)),o.host!==z_&&o.host!==u&&Ss("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h=Object.assign(Object.assign({},o),{host:u,ssl:r,emulatorOptions:s});if(!Zs(h,a)&&(t._setSettings(h),s.mockUserToken)){let d,p;if(typeof s.mockUserToken=="string")d=s.mockUserToken,p=xt.MOCK_USER;else{d=Tv(s.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);const m=s.mockUserToken.sub||s.mockUserToken.user_id;if(!m)throw new Y(B.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new xt(m)}t._authCredentials=new pE(new N0(d,p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci{constructor(e,n,s){this.converter=n,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new ci(this.firestore,e,this._query)}}class rt{constructor(e,n,s){this.converter=n,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Is(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new rt(this.firestore,e,this._key)}toJSON(){return{type:rt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,s){if(Ao(n,rt._jsonSchema))return new rt(e,s||null,new J(Be.fromString(n.referencePath)))}}rt._jsonSchemaVersion="firestore/documentReference/1.0",rt._jsonSchema={type:it("string",rt._jsonSchemaVersion),referencePath:it("string")};class Is extends ci{constructor(e,n,s){super(e,n,zh(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new rt(this.firestore,null,new J(e))}withConverter(e){return new Is(this.firestore,e,this._path)}}function q_(t,e,...n){if(t=ut(t),j0("collection","path",e),t instanceof Bl){const s=Be.fromString(e,...n);return Ap(s),new Is(t,null,s)}{if(!(t instanceof rt||t instanceof Is))throw new Y(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Be.fromString(e,...n));return Ap(s),new Is(t.firestore,null,s)}}function Co(t,e,...n){if(t=ut(t),arguments.length===1&&(e=$h.newId()),j0("doc","path",e),t instanceof Bl){const s=Be.fromString(e,...n);return Ep(s),new rt(t,null,new J(s))}{if(!(t instanceof rt||t instanceof Is))throw new Y(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Be.fromString(e,...n));return Ep(s),new rt(t.firestore,t instanceof Is?t.converter:null,new J(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hg="AsyncQueue";class dg{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new x_(this,"async_queue_retry"),this.oc=()=>{const s=Cc();s&&q(hg,"Visibility state changed to "+s.visibilityState),this.F_.y_()},this._c=e;const n=Cc();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const n=Cc();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});const n=new zn;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!Yi(e))throw e;q(hg,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(e){const n=this._c.then(()=>(this.nc=!0,e().catch(s=>{throw this.tc=s,this.nc=!1,Qn("INTERNAL UNHANDLED ERROR: ",fg(s)),s}).then(s=>(this.nc=!1,s))));return this._c=n,n}enqueueAfterDelay(e,n,s){this.ac(),this.sc.indexOf(e)>-1&&(n=0);const i=ld.createAndSchedule(this,e,n,s,r=>this.lc(r));return this.ec.push(i),i}ac(){this.tc&&re(47125,{hc:fg(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(const n of this.ec)if(n.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((n,s)=>n.targetTimeMs-s.targetTimeMs);for(const n of this.ec)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){const n=this.ec.indexOf(e);this.ec.splice(n,1)}}function fg(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Ki extends Bl{constructor(e,n,s,i){super(e,n,s,i),this.type="firestore",this._queue=new dg,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new dg(e),this._firestoreClient=void 0,await e}}}function lx(t,e){const n=typeof t=="object"?t:$m(),s=typeof t=="string"?t:qa,i=Dh(n,"firestore").getImmediate({identifier:s});if(!i._initialized){const r=vv("firestore");r&&ax(i,...r)}return i}function fd(t){if(t._terminated)throw new Y(B.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||cx(t),t._firestoreClient}function cx(t){var e,n,s;const i=t._freezeSettings(),r=function(a,u,h,d){return new ME(a,u,h,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,Y_(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((s=i.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new nx(t._authCredentials,t._appCheckCredentials,t._queue,r,t._componentsProvider&&function(a){const u=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(u),_online:u}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Zt(vt.fromBase64String(e))}catch(n){throw new Y(B.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Zt(vt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Zt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ao(e,Zt._jsonSchema))return Zt.fromBase64String(e.bytes)}}Zt._jsonSchemaVersion="firestore/bytes/1.0",Zt._jsonSchema={type:it("string",Zt._jsonSchemaVersion),bytes:it("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ul{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Y(B.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new yt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Y(B.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Y(B.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ve(this._lat,e._lat)||ve(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Sn._jsonSchemaVersion}}static fromJSON(e){if(Ao(e,Sn._jsonSchema))return new Sn(e.latitude,e.longitude)}}Sn._jsonSchemaVersion="firestore/geoPoint/1.0",Sn._jsonSchema={type:it("string",Sn._jsonSchemaVersion),latitude:it("number"),longitude:it("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(s,i){if(s.length!==i.length)return!1;for(let r=0;r<s.length;++r)if(s[r]!==i[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:bn._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ao(e,bn._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new bn(e.vectorValues);throw new Y(B.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}bn._jsonSchemaVersion="firestore/vectorValue/1.0",bn._jsonSchema={type:it("string",bn._jsonSchemaVersion),vectorValues:it("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ux=/^__.*__$/;class hx{constructor(e,n,s){this.data=e,this.fieldMask=n,this.fieldTransforms=s}toMutation(e,n){return this.fieldMask!==null?new Fs(e,this.data,this.fieldMask,n,this.fieldTransforms):new Io(e,this.data,n,this.fieldTransforms)}}class K_{constructor(e,n,s){this.data=e,this.fieldMask=n,this.fieldTransforms=s}toMutation(e,n){return new Fs(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function Q_(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw re(40011,{Ec:t})}}class pd{constructor(e,n,s,i,r,o){this.settings=e,this.databaseId=n,this.serializer=s,this.ignoreUndefinedProperties=i,r===void 0&&this.Ac(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new pd(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var n;const s=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.Rc({path:s,mc:!1});return i.fc(e),i}gc(e){var n;const s=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.Rc({path:s,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return sl(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(Q_(this.Ec)&&ux.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class dx{constructor(e,n,s){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=s||Fl(e)}Dc(e,n,s,i=!1){return new pd({Ec:e,methodName:n,bc:s,path:yt.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function gd(t){const e=t._freezeSettings(),n=Fl(t._databaseId);return new dx(t._databaseId,!!e.ignoreUndefinedProperties,n)}function fx(t,e,n,s,i,r={}){const o=t.Dc(r.merge||r.mergeFields?2:0,e,n,i);_d("Data must be an object, but it was:",o,s);const a=J_(s,o);let u,h;if(r.merge)u=new Ht(o.fieldMask),h=o.fieldTransforms;else if(r.mergeFields){const d=[];for(const p of r.mergeFields){const m=Xu(e,p,n);if(!o.contains(m))throw new Y(B.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);ey(d,m)||d.push(m)}u=new Ht(d),h=o.fieldTransforms.filter(p=>u.covers(p.field))}else u=null,h=o.fieldTransforms;return new hx(new Ot(a),u,h)}class Hl extends $l{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Hl}}class md extends $l{_toFieldTransform(e){return new rA(e.path,new io)}isEqual(e){return e instanceof md}}function px(t,e,n,s){const i=t.Dc(1,e,n);_d("Data must be an object, but it was:",i,s);const r=[],o=Ot.empty();ks(s,(u,h)=>{const d=yd(e,u,n);h=ut(h);const p=i.gc(d);if(h instanceof Hl)r.push(d);else{const m=Do(h,p);m!=null&&(r.push(d),o.set(d,m))}});const a=new Ht(r);return new K_(o,a,i.fieldTransforms)}function gx(t,e,n,s,i,r){const o=t.Dc(1,e,n),a=[Xu(e,s,n)],u=[i];if(r.length%2!=0)throw new Y(B.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<r.length;m+=2)a.push(Xu(e,r[m])),u.push(r[m+1]);const h=[],d=Ot.empty();for(let m=a.length-1;m>=0;--m)if(!ey(h,a[m])){const _=a[m];let y=u[m];y=ut(y);const v=o.gc(_);if(y instanceof Hl)h.push(_);else{const w=Do(y,v);w!=null&&(h.push(_),d.set(_,w))}}const p=new Ht(h);return new K_(d,p,o.fieldTransforms)}function mx(t,e,n,s=!1){return Do(n,t.Dc(s?4:3,e))}function Do(t,e){if(Z_(t=ut(t)))return _d("Unsupported field value:",e,t),J_(t,e);if(t instanceof $l)return function(s,i){if(!Q_(i.Ec))throw i.wc(`${s._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${s._methodName}() is not currently supported inside arrays`);const r=s._toFieldTransform(i);r&&i.fieldTransforms.push(r)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return function(s,i){const r=[];let o=0;for(const a of s){let u=Do(a,i.yc(o));u==null&&(u={nullValue:"NULL_VALUE"}),r.push(u),o++}return{arrayValue:{values:r}}}(t,e)}return function(s,i){if((s=ut(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return nA(i.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const r=He.fromDate(s);return{timestampValue:Za(i.serializer,r)}}if(s instanceof He){const r=new He(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Za(i.serializer,r)}}if(s instanceof Sn)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Zt)return{bytesValue:p_(i.serializer,s._byteString)};if(s instanceof rt){const r=i.databaseId,o=s.firestore._databaseId;if(!o.isEqual(r))throw i.wc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:Zh(s.firestore._databaseId||i.databaseId,s._key.path)}}if(s instanceof bn)return function(o,a){return{mapValue:{fields:{[H0]:{stringValue:W0},[Ka]:{arrayValue:{values:o.toArray().map(h=>{if(typeof h!="number")throw a.wc("VectorValues must only contain numeric values.");return qh(a.serializer,h)})}}}}}}(s,i);throw i.wc(`Unsupported field value: ${Cl(s)}`)}(t,e)}function J_(t,e){const n={};return F0(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ks(t,(s,i)=>{const r=Do(i,e.Vc(s));r!=null&&(n[s]=r)}),{mapValue:{fields:n}}}function Z_(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof He||t instanceof Sn||t instanceof Zt||t instanceof rt||t instanceof $l||t instanceof bn)}function _d(t,e,n){if(!Z_(n)||!L0(n)){const s=Cl(n);throw s==="an object"?e.wc(t+" a custom object"):e.wc(t+" "+s)}}function Xu(t,e,n){if((e=ut(e))instanceof Ul)return e._internalPath;if(typeof e=="string")return yd(t,e);throw sl("Field path arguments must be of type string or ",t,!1,void 0,n)}const _x=new RegExp("[~\\*/\\[\\]]");function yd(t,e,n){if(e.search(_x)>=0)throw sl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Ul(...e.split("."))._internalPath}catch{throw sl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function sl(t,e,n,s,i){const r=s&&!s.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(r||o)&&(u+=" (found",r&&(u+=` in field ${s}`),o&&(u+=` in document ${i}`),u+=")"),new Y(B.INVALID_ARGUMENT,a+t+u)}function ey(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ty{constructor(e,n,s,i,r){this._firestore=e,this._userDataWriter=n,this._key=s,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new rt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new yx(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Wl("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class yx extends ty{data(){return super.data()}}function Wl(t,e){return typeof e=="string"?yd(t,e):e instanceof Ul?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vx(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Y(B.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class vd{}class ny extends vd{}function wx(t,e,...n){let s=[];e instanceof vd&&s.push(e),s=s.concat(n),function(r){const o=r.filter(u=>u instanceof wd).length,a=r.filter(u=>u instanceof Xl).length;if(o>1||o>0&&a>0)throw new Y(B.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const i of s)t=i._apply(t);return t}class Xl extends ny{constructor(e,n,s){super(),this._field=e,this._op=n,this._value=s,this.type="where"}static _create(e,n,s){return new Xl(e,n,s)}_apply(e){const n=this._parse(e);return sy(e._query,n),new ci(e.firestore,e.converter,ju(e._query,n))}_parse(e){const n=gd(e.firestore);return function(r,o,a,u,h,d,p){let m;if(h.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new Y(B.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){gg(p,d);const y=[];for(const v of p)y.push(pg(u,r,v));m={arrayValue:{values:y}}}else m=pg(u,r,p)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||gg(p,d),m=mx(a,o,p,d==="in"||d==="not-in");return st.create(h,d,m)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function Tx(t,e,n){const s=e,i=Wl("where",t);return Xl._create(i,s,n)}class wd extends vd{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new wd(e,n)}_parse(e){const n=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return n.length===1?n[0]:dn.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(i,r){let o=i;const a=r.getFlattenedFilters();for(const u of a)sy(o,u),o=ju(o,u)}(e._query,n),new ci(e.firestore,e.converter,ju(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Td extends ny{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new Td(e,n)}_apply(e){const n=function(i,r,o){if(i.startAt!==null)throw new Y(B.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new Y(B.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new so(r,o)}(e._query,this._field,this._direction);return new ci(e.firestore,e.converter,function(i,r){const o=i.explicitOrderBy.concat([r]);return new zi(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,n))}}function Ex(t,e="asc"){const n=e,s=Wl("orderBy",t);return Td._create(s,n)}function pg(t,e,n){if(typeof(n=ut(n))=="string"){if(n==="")throw new Y(B.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!J0(e)&&n.indexOf("/")!==-1)throw new Y(B.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(Be.fromString(n));if(!J.isDocumentKey(s))throw new Y(B.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Rp(t,new J(s))}if(n instanceof rt)return Rp(t,n._key);throw new Y(B.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Cl(n)}.`)}function gg(t,e){if(!Array.isArray(t)||t.length===0)throw new Y(B.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function sy(t,e){const n=function(i,r){for(const o of i)for(const a of o.getFlattenedFilters())if(r.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new Y(B.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Y(B.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class Ax{convertValue(e,n="none"){switch(Ps(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Qe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ds(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw re(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const s={};return ks(e,(i,r)=>{s[i]=this.convertValue(r,n)}),s}convertVectorValue(e){var n,s,i;const r=(i=(s=(n=e.fields)===null||n===void 0?void 0:n[Ka].arrayValue)===null||s===void 0?void 0:s.values)===null||i===void 0?void 0:i.map(o=>Qe(o.doubleValue));return new bn(r)}convertGeoPoint(e){return new Sn(Qe(e.latitude),Qe(e.longitude))}convertArray(e,n){return(e.values||[]).map(s=>this.convertValue(s,n))}convertServerTimestamp(e,n){switch(n){case"previous":const s=Rl(e);return s==null?null:this.convertValue(s,n);case"estimate":return this.convertTimestamp(eo(e));default:return null}}convertTimestamp(e){const n=Cs(e);return new He(n.seconds,n.nanos)}convertDocumentKey(e,n){const s=Be.fromString(e);Ne(w_(s),9688,{name:e});const i=new to(s.get(1),s.get(3)),r=new J(s.popFirst(5));return i.isEqual(n)||Qn(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ix(t,e,n){let s;return s=t?t.toFirestore(e):e,s}class Mr{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Js extends ty{constructor(e,n,s,i,r,o){super(e,n,s,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new ka(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const s=this._document.data.field(Wl("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Y(B.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=Js._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}Js._jsonSchemaVersion="firestore/documentSnapshot/1.0",Js._jsonSchema={type:it("string",Js._jsonSchemaVersion),bundleSource:it("string","DocumentSnapshot"),bundleName:it("string"),bundle:it("string")};class ka extends Js{data(e={}){return super.data(e)}}class Di{constructor(e,n,s,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Mr(i.hasPendingWrites,i.fromCache),this.query=s}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(s=>{e.call(n,new ka(this._firestore,this._userDataWriter,s.key,s,new Mr(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Y(B.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,r){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{const u=new ka(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Mr(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>r||a.type!==3).map(a=>{const u=new ka(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Mr(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,d=-1;return a.type!==0&&(h=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:xx(a.type),doc:u,oldIndex:h,newIndex:d}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Y(B.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Di._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=$h.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],s=[],i=[];return this.docs.forEach(r=>{r._document!==null&&(n.push(r._document),s.push(this._userDataWriter.convertObjectMap(r._document.data.value.mapValue.fields,"previous")),i.push(r.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function xx(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return re(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function il(t){t=Jn(t,rt);const e=Jn(t.firestore,Ki);return rx(fd(e),t._key).then(n=>Dx(e,t,n))}Di._jsonSchemaVersion="firestore/querySnapshot/1.0",Di._jsonSchema={type:it("string",Di._jsonSchemaVersion),bundleSource:it("string","QuerySnapshot"),bundleName:it("string"),bundle:it("string")};class iy extends Ax{constructor(e){super(),this.firestore=e}convertBytes(e){return new Zt(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new rt(this.firestore,null,n)}}function Sx(t){t=Jn(t,ci);const e=Jn(t.firestore,Ki),n=fd(e),s=new iy(e);return vx(t._query),ox(n,t._query).then(i=>new Di(e,s,t,i))}function ry(t,e,n,...s){t=Jn(t,rt);const i=Jn(t.firestore,Ki),r=gd(i);let o;return o=typeof(e=ut(e))=="string"||e instanceof Ul?gx(r,"updateDoc",t._key,e,n,s):px(r,"updateDoc",t._key,e),Ed(i,[o.toMutation(t._key,hn.exists(!0))])}function bx(t){return Ed(Jn(t.firestore,Ki),[new Kh(t._key,hn.none())])}function Cx(t,e){const n=Jn(t.firestore,Ki),s=Co(t),i=Ix(t.converter,e);return Ed(n,[fx(gd(t.firestore),"addDoc",s._key,i,t.converter!==null,{}).toMutation(s._key,hn.exists(!1))]).then(()=>s)}function Ed(t,e){return function(s,i){const r=new zn;return s.asyncQueue.enqueueAndForget(async()=>YI(await ix(s),i,r)),r.promise}(fd(t),e)}function Dx(t,e,n){const s=n.docs.get(e._key),i=new iy(t);return new Js(t,i,e._key,s,new Mr(n.hasPendingWrites,n.fromCache),e.converter)}function Hr(){return new md("serverTimestamp")}(function(e,n=!0){(function(i){Xi=i})(Hi),Mi(new ei("firestore",(s,{instanceIdentifier:i,options:r})=>{const o=s.getProvider("app").getImmediate(),a=new Ki(new gE(s.getProvider("auth-internal")),new yE(o,s.getProvider("app-check-internal")),function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new Y(B.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new to(h.options.projectId,d)}(o,i),o);return r=Object.assign({useFetchStreams:n},r),a._setSettings(r),a},"PUBLIC").setMultipleInstances(!0)),Es(_p,yp,e),Es(_p,yp,"esm2017")})();const Px={apiKey:"AIzaSyDJSUOgDq9-Naz0EWj_xHaEuGIeNbDGkH0",authDomain:"in01-24742.firebaseapp.com",projectId:"in01-24742",storageBucket:"in01-24742.firebasestorage.app",messagingSenderId:"825125559500",appId:"1:825125559500:web:976561b41dbcdd9883b669"},oy=Um(Px),Qi=cE(oy),Ji=lx(oy),ay=new Wn;ay.setCustomParameters({prompt:"select_account"});const Rx=async(t,e)=>{try{return{user:(await Yw(Qi,t,e)).user,error:null}}catch(n){return{user:null,error:n.message}}},Nx=async()=>{try{return{user:(await yT(Qi,ay)).user,error:null}}catch(t){const e=t;let n=e.message;switch(e.code){case"auth/popup-closed-by-user":n="로그인이 취소되었습니다.";break;case"auth/popup-blocked":n="팝업이 차단되었습니다. 팝업을 허용해주세요.";break;case"auth/cancelled-popup-request":n="로그인 요청이 취소되었습니다.";break;case"auth/account-exists-with-different-credential":n="이미 다른 방법으로 가입된 이메일입니다.";break;default:n="구글 로그인 중 오류가 발생했습니다."}return{user:null,error:n}}},Mx=async(t,e,n)=>{try{const s=await Gw(Qi,t,e);return n&&s.user&&await qw(s.user,{displayName:n}),{user:s.user,error:null}}catch(s){return{user:null,error:s.message}}},jx=async()=>{try{return await Jw(Qi),{error:null}}catch(t){return{error:t.message}}},Lx=t=>f0(Qi,t),Po=()=>new Promise(t=>{const e=f0(Qi,n=>{e(),t(n)})}),ly=j.createContext(void 0),kx=({children:t})=>{const[e,n]=j.useState(null),[s,i]=j.useState(!0);j.useEffect(()=>{try{const o=Lx(u=>{n(u),i(!1)}),a=setTimeout(()=>{i(u=>u&&(console.warn("⚠️ Firebase 인증 상태 확인 타임아웃 - 로딩 강제 종료"),!1))},5e3);return()=>{o(),clearTimeout(a)}}catch(o){console.error("❌ Firebase 인증 설정 에러:",o),i(!1)}},[]);const r={user:e,loading:s,isAuthenticated:!!e};return c.jsx(ly.Provider,{value:r,children:t})},cy=()=>{const t=j.useContext(ly);if(t===void 0)throw new Error("useAuth는 AuthProvider 내에서 사용해야 합니다.");return t};class Fx extends j.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){console.error("🚨 ErrorBoundary caught an error:",e,n)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:c.jsx("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",padding:"20px",textAlign:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white"},children:c.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"16px",padding:"40px",maxWidth:"500px",backdropFilter:"blur(10px)"},children:[c.jsx("h1",{style:{fontSize:"48px",marginBottom:"20px"},children:"⚠️"}),c.jsx("h2",{style:{marginBottom:"16px"},children:"문제가 발생했습니다"}),c.jsx("p",{style:{marginBottom:"24px",opacity:.9},children:"예상치 못한 오류가 발생했습니다. 페이지를 새로고침하거나 잠시 후 다시 시도해주세요."}),c.jsx("button",{onClick:()=>window.location.reload(),style:{background:"white",color:"#667eea",border:"none",borderRadius:"8px",padding:"12px 24px",fontSize:"16px",fontWeight:"bold",cursor:"pointer",transition:"opacity 0.2s"},onMouseOver:e=>e.currentTarget.style.opacity="0.8",onMouseOut:e=>e.currentTarget.style.opacity="1",children:"페이지 새로고침"}),!1]})}):this.props.children}}const Ox="_container_j6ddw_2",Vx="_modalContent_j6ddw_18",Bx="_header_j6ddw_30",Ux="_content_j6ddw_51",$x="_formSection_j6ddw_55",Hx="_form_j6ddw_55",Wx="_spaceSettings_j6ddw_134",Xx="_sectionTitle_j6ddw_140",Gx="_spaceSizeSection_j6ddw_148",Yx="_label_j6ddw_152",zx="_inputGroupTwoColumns_j6ddw_161",qx="_dimensionsSummary_j6ddw_175",Kx="_summaryText_j6ddw_185",Qx="_startButtonContainer_j6ddw_193",Jx="_loadingScreen_j6ddw_203",Zx="_loadingSubtext_j6ddw_217",It={container:Ox,modalContent:Vx,header:Bx,content:Ux,formSection:$x,form:Hx,spaceSettings:Wx,sectionTitle:Xx,spaceSizeSection:Gx,label:Yx,inputGroupTwoColumns:zx,dimensionsSummary:qx,summaryText:Kx,startButtonContainer:Qx,loadingScreen:Jx,loadingSubtext:Zx},eS="_button_1gs6k_1",tS="_primary_1gs6k_14",nS="_secondary_1gs6k_28",sS="_small_1gs6k_43",iS="_medium_1gs6k_48",rS="_large_1gs6k_53",oS="_iconButton_1gs6k_59",aS="_toggle_1gs6k_65",lS="_active_1gs6k_72",_r={button:eS,primary:tS,secondary:nS,small:sS,medium:iS,large:rS,iconButton:oS,toggle:aS,active:lS},Gu=({variant:t="primary",size:e="medium",isActive:n=!1,isIconButton:s=!1,className:i="",children:r,...o})=>{const a=[_r.button,_r[t],_r[e],s&&_r.iconButton,t==="toggle"&&n&&_r.active,i].filter(Boolean).join(" ");return c.jsx("button",{className:a,...o,children:r})},cS="_container_1v5y7_2",uS="_spinner_1v5y7_13",hS="_spinnerRing_1v5y7_19",dS="_spin_1v5y7_13",fS="_small_1v5y7_30",pS="_medium_1v5y7_36",gS="_large_1v5y7_42",mS="_dots_1v5y7_49",_S="_dot_1v5y7_49",yS="_bounce_1v5y7_1",vS="_message_1v5y7_76",wS="_fullscreen_1v5y7_106",Nn={container:cS,spinner:uS,spinnerRing:hS,spin:dS,small:fS,medium:pS,large:gS,dots:mS,dot:_S,bounce:yS,message:vS,fullscreen:wS},rl=({message:t="로딩 중...",size:e="medium",type:n="spinner"})=>c.jsxs("div",{className:Nn.container,children:[n==="spinner"?c.jsx("div",{className:`${Nn.spinner} ${Nn[e]}`,children:c.jsx("div",{className:Nn.spinnerRing})}):c.jsxs("div",{className:Nn.dots,children:[c.jsx("div",{className:Nn.dot}),c.jsx("div",{className:Nn.dot}),c.jsx("div",{className:Nn.dot})]}),t&&c.jsx("p",{className:Nn.message,children:t})]}),Pc={basicInfo:{title:"",location:""},isDirty:!1},uy=mo()(t=>({...Pc,setBasicInfo:e=>t(n=>({basicInfo:{...n.basicInfo,...e},isDirty:!0})),resetBasicInfo:()=>t({basicInfo:Pc.basicInfo,isDirty:!0}),resetAll:()=>t({...Pc,isDirty:!1}),markAsSaved:()=>t({isDirty:!1})})),Wr={WIDTH:3600,HEIGHT:2400,DEPTH:1500},Rc={LEFT:50,RIGHT:50,TOP:10},mg={HEIGHT:65,FLOOR_FINISH_HEIGHT:50},_g={INTERIOR_COLOR:"#FFFFFF",DOOR_COLOR:"#FFFFFF"},Jt={WIDTH:{MIN:1200,MAX:8e3},HEIGHT:{MIN:2010,MAX:2410}},Xs={DEPTH:{MIN:130,MAX:780,DEFAULT_FALLBACK:580}},hy={width:Wr.WIDTH,height:Wr.HEIGHT,depth:Wr.DEPTH,installType:"built-in",wallConfig:{left:!0,right:!0},hasFloorFinish:!1,floorFinish:{height:mg.FLOOR_FINISH_HEIGHT},surroundType:"surround",frameSize:{left:Rc.LEFT,right:Rc.RIGHT,top:Rc.TOP},baseConfig:{type:"floor",height:mg.HEIGHT,placementType:"ground"},materialConfig:{interiorColor:_g.INTERIOR_COLOR,doorColor:_g.DOOR_COLOR}},Nc={isDirty:!1,spaceInfo:hy},Ct=mo()(t=>({...Nc,setSpaceInfo:e=>{t(n=>({spaceInfo:{...n.spaceInfo,...e},isDirty:!0}))},resetSpaceInfo:()=>t({spaceInfo:Nc.spaceInfo,isDirty:!0}),resetMaterialConfig:()=>t(e=>({spaceInfo:{...e.spaceInfo,materialConfig:{...e.spaceInfo.materialConfig,doorColor:"#FFFFFF"}},isDirty:!0})),resetAll:()=>t({...Nc,isDirty:!1}),markAsSaved:()=>t({isDirty:!1})})),TS=[{type:"built-in",label:"빌트인",description:"양쪽 벽이 막혀있는 기본형식"},{type:"semi-standing",label:"세미스탠딩",description:"한쪽만 벽으로 막혀있고 한쪽은 오픈된 형식"},{type:"free-standing",label:"프리스탠딩",description:"양쪽 벽이 없는 독립형 형식"}],ES="_container_1ycbi_1",AS="_fullWidth_1ycbi_7",IS="_label_1ycbi_11",xS="_inputWrapper_1ycbi_17",SS="_input_1ycbi_17",bS="_small_1ycbi_47",CS="_medium_1ycbi_52",DS="_large_1ycbi_57",PS="_error_1ycbi_63",RS="_errorMessage_1ycbi_72",NS="_leftIcon_1ycbi_78",MS="_rightIcon_1ycbi_78",jS="_hasLeftIcon_1ycbi_97",LS="_hasRightIcon_1ycbi_101",Wt={container:ES,fullWidth:AS,label:IS,inputWrapper:xS,input:SS,small:bS,medium:CS,large:DS,error:PS,errorMessage:RS,leftIcon:NS,rightIcon:MS,hasLeftIcon:jS,hasRightIcon:LS},Fa=({size:t="medium",error:e,label:n,leftIcon:s,rightIcon:i,className:r="",fullWidth:o=!1,...a})=>{const u=[Wt.container,o&&Wt.fullWidth,r].filter(Boolean).join(" "),h=[Wt.input,Wt[t],e&&Wt.error,s&&Wt.hasLeftIcon,i&&Wt.hasRightIcon].filter(Boolean).join(" ");return c.jsxs("div",{className:u,children:[n&&c.jsx("label",{className:Wt.label,children:n}),c.jsxs("div",{className:Wt.inputWrapper,children:[s&&c.jsx("span",{className:Wt.leftIcon,children:s}),c.jsx("input",{className:h,...a}),i&&c.jsx("span",{className:Wt.rightIcon,children:i})]}),e&&c.jsx("span",{className:Wt.errorMessage,children:e})]})},kS="_container_arbjs_1",FS="_fullWidth_arbjs_7",OS="_label_arbjs_11",VS="_selectWrapper_arbjs_17",BS="_select_arbjs_17",US="_arrow_arbjs_45",$S="_small_arbjs_59",HS="_medium_arbjs_65",WS="_large_arbjs_71",XS="_error_arbjs_78",GS="_errorMessage_arbjs_87",Mn={container:kS,fullWidth:FS,label:OS,selectWrapper:VS,select:BS,arrow:US,small:$S,medium:HS,large:WS,error:XS,errorMessage:GS},YS=({options:t,size:e="medium",error:n,label:s,placeholder:i,className:r="",fullWidth:o=!1,value:a,defaultValue:u,...h})=>{const d=[Mn.container,o&&Mn.fullWidth,r].filter(Boolean).join(" "),p=[Mn.select,Mn[e],n&&Mn.error].filter(Boolean).join(" "),m=a!==void 0,y=m?{value:a,...h}:{defaultValue:!m&&i?"":u,...h};return c.jsxs("div",{className:d,children:[s&&c.jsx("label",{className:Mn.label,children:s}),c.jsxs("div",{className:Mn.selectWrapper,children:[c.jsxs("select",{className:p,...y,children:[i&&c.jsx("option",{value:"",disabled:!0,hidden:!0,children:i}),t.map(v=>c.jsx("option",{value:v.value,disabled:v.disabled,children:v.label},v.value))]}),c.jsx("span",{className:Mn.arrow})]}),n&&c.jsx("span",{className:Mn.errorMessage,children:n})]})},zS="_container_1jg9g_2",qS="_section_1jg9g_9",KS="_inlineLayout_1jg9g_28",QS="_titleField_1jg9g_34",JS="_locationField_1jg9g_38",ZS="_label_1jg9g_43",eb="_inputLabel_1jg9g_49",tb="_inputGroup_1jg9g_56",nb="_inputWrapper_1jg9g_108",sb="_inputWithUnit_1jg9g_114",ib="_input_1jg9g_49",rb="_inputWithUnitField_1jg9g_135",ob="_unit_1jg9g_139",ab="_inputError_1jg9g_148",lb="_errorMessage_1jg9g_153",cb="_radioGroup_1jg9g_166",ub="_toggleButtonGroup_1jg9g_205",hb="_toggleButton_1jg9g_205",db="_toggleButtonActive_1jg9g_239",fb="_button_1jg9g_249",pb="_buttonActive_1jg9g_264",gb="_description_1jg9g_271",mb="_infoBox_1jg9g_278",_b="_infoDetail_1jg9g_289",yb="_disabledLabel_1jg9g_340",vb="_disabledText_1jg9g_345",O={container:zS,section:qS,inlineLayout:KS,titleField:QS,locationField:JS,label:ZS,inputLabel:eb,inputGroup:tb,inputWrapper:nb,inputWithUnit:sb,input:ib,inputWithUnitField:rb,unit:ob,inputError:ab,errorMessage:lb,radioGroup:cb,toggleButtonGroup:ub,toggleButton:hb,toggleButtonActive:db,button:fb,buttonActive:pb,description:gb,infoBox:mb,infoDetail:_b,disabledLabel:yb,disabledText:vb},wb=[{value:"master_bedroom",label:"안방"},{value:"small_bedroom",label:"작은방"},{value:"dressing_room",label:"드레스룸"},{value:"living_room",label:"거실"},{value:"kitchen",label:"주방"},{value:"entrance",label:"현관"},{value:"other",label:"기타"}],Tb=({basicInfo:t,onUpdate:e})=>c.jsx("div",{className:O.container,children:c.jsxs("div",{className:O.inlineLayout,children:[c.jsxs("div",{className:O.titleField,children:[c.jsx("span",{className:O.label,children:"디자인 제목"}),c.jsx(Fa,{placeholder:"디자인 제목을 입력하세요",value:t.title,onChange:n=>e({title:n.target.value})})]}),c.jsxs("div",{className:O.locationField,children:[c.jsx("span",{className:O.label,children:"가구 위치"}),c.jsx(YS,{options:wb,value:t.location,placeholder:"가구 위치를 선택하세요",onChange:n=>e({location:n.target.value})})]})]})}),dy=({spaceInfo:t,onUpdate:e,disabled:n=!1})=>{const[s,i]=j.useState(),r=(t==null?void 0:t.width)||Wr.WIDTH,[o,a]=j.useState(r.toString());j.useEffect(()=>{a(r.toString())},[r]);const u=p=>{(p===""||/^\d+$/.test(p))&&a(p)},h=()=>{const p=o;if(p===""){a(r.toString());return}const m=parseInt(p),_=Jt.WIDTH.MIN,y=Jt.WIDTH.MAX;m<_?i(`최소 ${_}mm 이상이어야 합니다`):m>y?i(`최대 ${y}mm 이하여야 합니다`):(i(""),e({width:m}))},d=p=>{p.key==="Enter"&&h()};return c.jsxs("div",{className:O.inputWrapper,children:[c.jsxs("label",{className:`${O.inputLabel} ${n?O.disabledLabel:""}`,children:["폭 (",Jt.WIDTH.MIN,"mm ~ ",Jt.WIDTH.MAX,"mm)",n&&c.jsx("span",{className:O.disabledText,children:" (스타일러장, 바지걸이장 배치시 수정불가)"})]}),c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:o,onChange:p=>u(p.target.value),onBlur:h,onKeyDown:d,className:`${O.input} ${O.inputWithUnitField} ${s?O.inputError:""}`,placeholder:`${Jt.WIDTH.MIN}-${Jt.WIDTH.MAX}`,disabled:n}),c.jsx("span",{className:O.unit,children:"mm"})]}),s&&c.jsx("div",{className:O.errorMessage,children:s})]})},fy=({spaceInfo:t,onUpdate:e})=>{const[n,s]=j.useState(),i=(t==null?void 0:t.height)||Wr.HEIGHT,[r,o]=j.useState(i.toString());j.useEffect(()=>{o(i.toString())},[i]);const a=d=>{(d===""||/^\d+$/.test(d))&&o(d)},u=()=>{const d=r;if(d===""){o(i.toString());return}const p=parseInt(d),m=Jt.HEIGHT.MIN,_=Jt.HEIGHT.MAX;p<m?s(`최소 ${m}mm 이상이어야 합니다`):p>_?s(`최대 ${_}mm 이하여야 합니다`):(s(""),e({height:p}))},h=d=>{d.key==="Enter"&&u()};return c.jsxs("div",{className:O.inputWrapper,children:[c.jsxs("label",{className:O.inputLabel,children:["높이 (",Jt.HEIGHT.MIN,"mm ~ ",Jt.HEIGHT.MAX,"mm)"]}),c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:r,onChange:d=>a(d.target.value),onBlur:u,onKeyDown:h,className:`${O.input} ${O.inputWithUnitField} ${n?O.inputError:""}`,placeholder:`${Jt.HEIGHT.MIN}-${Jt.HEIGHT.MAX}`}),c.jsx("span",{className:O.unit,children:"mm"})]}),n&&c.jsx("div",{className:O.errorMessage,children:n})]})},py=({spaceInfo:t,onUpdate:e})=>{const n=i=>{let r={...t.wallConfig};switch(i){case"built-in":r={left:!0,right:!0};break;case"semi-standing":r={left:!0,right:!1};break;case"free-standing":r={left:!1,right:!1};break}e({installType:i,wallConfig:r})},s=i=>{e({wallConfig:{left:i==="left",right:i==="right"}})};return c.jsxs("div",{className:O.container,children:[c.jsx("div",{className:O.section,children:c.jsx("div",{className:O.toggleButtonGroup,children:TS.map(i=>c.jsx("button",{className:`${O.toggleButton} ${t.installType===i.type?O.toggleButtonActive:""}`,onClick:()=>n(i.type),children:i.label},i.type))})}),t.installType==="semi-standing"&&c.jsxs("div",{className:O.section,children:[c.jsx("span",{className:O.label,children:"벽 위치"}),c.jsxs("div",{className:O.toggleButtonGroup,children:[c.jsx("button",{className:`${O.toggleButton} ${t.wallConfig.left?O.toggleButtonActive:""}`,onClick:()=>s("left"),children:"좌측"}),c.jsx("button",{className:`${O.toggleButton} ${t.wallConfig.right?O.toggleButtonActive:""}`,onClick:()=>s("right"),children:"우측"})]})]})]})},Eb=({spaceInfo:t,onUpdate:e})=>{var r,o,a,u;const[n,s]=j.useState(((o=(r=t.floorFinish)==null?void 0:r.height)==null?void 0:o.toString())||"20");j.useEffect(()=>{var h,d;s(((d=(h=t.floorFinish)==null?void 0:h.height)==null?void 0:d.toString())||"20")},[(a=t.floorFinish)==null?void 0:a.height]);const i=h=>{if(h)e({hasFloorFinish:!1,floorFinish:void 0});else{const d=parseInt(n)||20;e({hasFloorFinish:!0,floorFinish:{height:d}})}};return t.hasFloorFinish?t.height-(((u=t.floorFinish)==null?void 0:u.height)||0):t.height,c.jsx("div",{className:O.container,children:c.jsx("div",{className:O.section,children:c.jsxs("div",{className:O.toggleButtonGroup,children:[c.jsx("button",{className:`${O.toggleButton} ${t.hasFloorFinish?O.toggleButtonActive:""}`,onClick:()=>i(!1),children:"있음"}),c.jsx("button",{className:`${O.toggleButton} ${t.hasFloorFinish?"":O.toggleButtonActive}`,onClick:()=>i(!0),children:"없음"})]})})})},Ab=580,Ib=10,yr=18,gy=t=>{var i;const e=t.width,n=t.hasFloorFinish?t.height-(((i=t.floorFinish)==null?void 0:i.height)||0):t.height,s=t.depth;return{width:e,height:n,depth:s}},dt=t=>{const e=Ro(t),n=my(t),s=yy(t),i=_y(t);let r;t.surroundType==="no-surround"&&t.gapConfig?r=t.width-t.gapConfig.size*2:r=t.width-e.left-e.right;let o=t.height;t.hasFloorFinish&&(o-=n),o-=s,o-=i;const a=t.depth;let u;return t.surroundType==="no-surround"&&t.gapConfig?u=t.gapConfig.size:u=e.left,t.surroundType==="no-surround"&&t.gapConfig&&console.log(`📐 [내경계산] 이격거리${t.gapConfig.size}mm: 내경너비=${r}, 시작위치X=${u}`),{width:r,height:o,depth:a,startX:u,startY:i+n,startZ:0}},xb=t=>t?t.depth:Ab,Sb=()=>600,my=t=>!t.hasFloorFinish||!t.floorFinish?0:t.floorFinish.height,Ro=t=>{const{installType:e,wallConfig:n,frameSize:s,surroundType:i}=t;if(i==="no-surround")return{left:0,right:0,leftMm:0,rightMm:0};let r=0,o=0;const a=10,u=(s==null?void 0:s.left)||a,h=(s==null?void 0:s.right)||a;switch(e){case"built-in":r=u,o=h;break;case"semi-standing":n.left&&!n.right?(r=u,o=yr):!n.left&&n.right?(r=yr,o=h):(r=u,o=yr);break;case"free-standing":r=yr,o=yr;break;default:r=u,o=h}return{left:r,right:o,leftMm:r,rightMm:o}},bb=t=>{let e;if(t.surroundType==="no-surround"&&t.gapConfig)e=t.width-t.gapConfig.size*2,console.log(`🔧 [프레임폭] 이격거리${t.gapConfig.size}mm: 프레임폭=${e}mm`);else{const n=Ro(t);e=t.width-n.leftMm-n.rightMm}return{width:e,widthMm:e}},_y=t=>{var e;return((e=t.baseConfig)==null?void 0:e.type)==="floor"?t.baseConfig.height||65:0},yy=t=>{var e;return((e=t.frameSize)==null?void 0:e.top)||Ib};class Hn{static mmToThreeUnits(e){return e*.01}static calculateInternalWidth(e){const n=Ro(e),s=e.width;return e.surroundType==="no-surround"&&e.gapConfig?s-e.gapConfig.size*2:s-n.left-n.right}static getColumnCountLimits(e){const o=Math.ceil(e/600),a=Math.floor(e/300.01),u=e<=600,h=e<=1200;return{minColumns:o,maxColumns:a,canUseSingle:u,canUseDual:h,columnWidthWillBe:d=>Math.floor(e/d)}}static validateColumnCount(e,n){const s=Hn.getColumnCountLimits(n),i=Math.floor(n/e);return{isValid:e>=s.minColumns&&e<=s.maxColumns&&i>300,columnWidth:i,limits:s}}static getDefaultColumnCount(e){return e<=600?1:Math.round(e/600)}}class vy{static calculateSpaceIndexing(e){var w;const n=Ro(e),s=e.width,i=Hn.calculateInternalWidth(e);let r;e.customColumnCount?r=e.customColumnCount:r=Hn.getDefaultColumnCount(i);const o=Math.floor(i/r),a=i-o*r,u=Math.floor(a/2);let h;e.surroundType==="no-surround"&&e.gapConfig?h=-(s/2)+e.gapConfig.size+u:h=-(s/2)+n.left+u;const d=[];for(let b=0;b<=r;b++){const A=h+b*o;d.push(A)}const p=[];for(let b=0;b<r;b++){const R=d[b]+o/2;p.push(R)}const m=p.map(b=>Hn.mmToThreeUnits(b)),_=d.map(b=>Hn.mmToThreeUnits(b));e.surroundType==="no-surround"&&e.gapConfig&&console.log(`🎯 [가구위치] 이격거리${e.gapConfig.size}mm: 내경시작X=${h}, 첫번째컬럼=${(w=m[0])==null?void 0:w.toFixed(3)}`);const y=[],v=[];for(let b=0;b<r-1;b++){const A=p[b],R=p[b+1],N=(A+R)/2;y.push(N),v.push(Hn.mmToThreeUnits(N))}return{columnCount:r,columnPositions:p,threeUnitPositions:m,columnBoundaries:d,threeUnitBoundaries:_,dualColumnPositions:y,threeUnitDualPositions:v,columnWidth:o,internalWidth:i,internalStartX:h,threeUnitColumnWidth:Hn.mmToThreeUnits(o)}}static findClosestColumnIndex(e,n){const{threeUnitPositions:s,threeUnitBoundaries:i,columnCount:r}=n,o=i[0],a=i[r];if(e.x<o)return console.log(`위치 (${e.x.toFixed(2)})가 왼쪽 경계 (${o.toFixed(2)}) 밖에 있습니다. 첫 번째 컬럼 선택.`),0;if(e.x>a)return console.log(`위치 (${e.x.toFixed(2)})가 오른쪽 경계 (${a.toFixed(2)}) 밖에 있습니다. 마지막 컬럼 선택.`),r-1;for(let p=0;p<r;p++){const m=i[p],_=i[p+1];if(e.x>=m&&e.x<=_)return console.log(`위치 (${e.x.toFixed(2)})가 컬럼 ${p+1} 내부에 있습니다. 경계: [${m.toFixed(2)}, ${_.toFixed(2)}]`),p}let u=0,h=Number.MAX_VALUE;const d=s.map((p,m)=>{const _=Math.abs(e.x-p);return{index:m,columnX:p,distance:_}});return console.log("컬럼 거리 계산:",d.map(p=>`컬럼 ${p.index+1}: ${p.distance.toFixed(4)} (위치: ${p.columnX.toFixed(2)})`).join(", ")),d.forEach(({index:p,distance:m})=>{m<h&&(h=m,u=p)}),console.log(`가장 가까운 컬럼: ${u+1} (거리: ${h.toFixed(4)})`),u}static findSlotIndexFromPosition(e,n,s=!1){return s&&n.threeUnitDualPositions?n.threeUnitDualPositions.findIndex(r=>Math.abs(r-e.x)<.1):n.threeUnitPositions.findIndex(r=>Math.abs(r-e.x)<.1)}}const ft=vy.calculateSpaceIndexing,Cb=Hn.calculateInternalWidth,Db=vy.findSlotIndexFromPosition,yg={internalWidth:0,columnCount:0,columnWidth:0,internalHeight:0,internalDepth:0,columnPositions:[],threeUnitPositions:[],columnBoundaries:[],dualColumnPositions:[],isCalculated:!1,lastCalculatedSpaceInfo:null},Zi=mo(t=>({...yg,recalculateFromSpaceInfo:e=>{try{const n={...e,width:Math.max(600,e.width),height:Math.max(1e3,e.height)},s=Cb(n),i=ft(n),r=dt(n);t({internalWidth:s,columnCount:i.columnCount,columnWidth:i.columnWidth,internalHeight:r.height,internalDepth:r.depth,columnPositions:i.columnPositions,threeUnitPositions:i.threeUnitPositions,columnBoundaries:i.columnBoundaries,dualColumnPositions:i.dualColumnPositions,isCalculated:!0,lastCalculatedSpaceInfo:n})}catch(n){console.error("❌ [derivedSpaceStore 계산 오류]",n),console.error("파생 상태 계산 중 오류 발생:",n),t({internalWidth:Math.max(0,e.width-100),columnCount:1,columnWidth:Math.max(300,e.width-100),internalHeight:Math.max(0,e.height-200),internalDepth:580,columnPositions:[0],threeUnitPositions:[0],columnBoundaries:[0,Math.max(300,e.width-100)],dualColumnPositions:[],isCalculated:!0,lastCalculatedSpaceInfo:e})}},reset:()=>{t(yg)}})),Pb=(t,e,n)=>{const s=Zi(),i=18,r=j.useMemo(()=>{if(!(t.surroundType==="no-surround")||!t.gapConfig)return null;const h=t.gapConfig.size;return t.width-h*2},[t.surroundType,t.gapConfig,t.width]),o=j.useMemo(()=>{if(!(t.surroundType==="surround")||!t.frameSize)return null;const h=t.width,d=e?t.frameSize.left||10:i,p=n?t.frameSize.right||10:i;return h-d-p},[t.surroundType,t.frameSize,t.width,e,n]),a=j.useMemo(()=>{if(s.isCalculated)return{columnCount:s.columnCount,columnWidth:s.columnWidth};const u=ft(t);return{columnCount:u.columnCount,columnWidth:u.columnWidth}},[s.isCalculated,s.columnCount,s.columnWidth,t]);return{noSurroundFrameWidth:r,surroundFrameWidth:o,columnInfo:a}},Rb=({surroundType:t,onSurroundTypeChange:e,disabled:n=!1})=>{const s=t==="surround",i=t==="no-surround";return c.jsx("div",{className:O.section,children:c.jsxs("div",{className:O.toggleButtonGroup,children:[c.jsx("button",{className:`${O.toggleButton} ${i?O.toggleButtonActive:""}`,onClick:()=>!n&&e("no-surround"),disabled:n,children:"있음"}),c.jsx("button",{className:`${O.toggleButton} ${s?O.toggleButtonActive:""}`,onClick:()=>!n&&e("surround"),disabled:n,children:"없음"})]})})},Nb=({gapSize:t,onGapSizeChange:e})=>c.jsxs("div",{className:O.section,children:[c.jsx("span",{className:O.label,children:"이격거리 설정"}),c.jsx("p",{className:O.description,children:"노서라운드 옵션 선택 시 이격거리를 선택해주세요:"}),c.jsxs("div",{className:O.radioGroup,children:[c.jsx("button",{className:`${O.button} ${t===2?O.buttonActive:""}`,onClick:()=>e(2),children:"2mm"}),c.jsx("button",{className:`${O.button} ${t===3?O.buttonActive:""}`,onClick:()=>e(3),children:"3mm"})]})]}),Mb=({frameSize:t,hasLeftWall:e,hasRightWall:n,isSurround:s,surroundFrameWidth:i,noSurroundFrameWidth:r,gapSize:o,spaceWidth:a,columnInfo:u,onFrameSizeChange:h,onFrameSizeBlur:d,onKeyDown:p})=>s?c.jsxs("div",{className:O.section,children:[c.jsx("span",{className:O.label,children:"프레임 설정"}),c.jsx("div",{className:O.description,children:"벽이 있는 쪽은 40~100mm 범위에서 조정 가능하며, 벽이 없는 쪽은 18mm 엔드패널로 고정됩니다."}),i&&c.jsxs("div",{className:O.infoBox,style:{marginBottom:"12px"},children:[c.jsxs("span",{children:["프레임 폭 내경: ",c.jsxs("strong",{children:[i,"mm"]})]}),c.jsxs("span",{className:O.infoDetail,children:["(전체 폭 ",a,"mm - 좌측 프레임 ",e?t.left:18,"mm - 우측 프레임 ",n?t.right:18,"mm)"]}),c.jsxs("span",{className:O.infoDetail,style:{marginTop:"4px"},children:["슬롯 수: ",c.jsxs("strong",{children:[u.columnCount,"개"]})," / 슬롯당 너비: ",c.jsxs("strong",{children:[u.columnWidth,"mm"]})]})]}),c.jsxs("div",{className:O.inputGroup,style:{gridTemplateColumns:"1fr 1fr 1fr"},children:[c.jsxs("div",{className:O.inputWrapper,children:[c.jsx("label",{className:O.inputLabel,children:"좌측 (40~100mm)"}),c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:e?t.left:18,onChange:_=>h("left",_.target.value),onBlur:()=>d("left"),onKeyDown:_=>p(_,"left"),className:`${O.input} ${O.inputWithUnitField} ${e?"":O.inputError}`,placeholder:"50",disabled:!e}),c.jsx("span",{className:O.unit,children:"mm"})]})]}),c.jsxs("div",{className:O.inputWrapper,children:[c.jsx("label",{className:O.inputLabel,children:"우측 (40~100mm)"}),c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:n?t.right:18,onChange:_=>h("right",_.target.value),onBlur:()=>d("right"),onKeyDown:_=>p(_,"right"),className:`${O.input} ${O.inputWithUnitField} ${n?"":O.inputError}`,placeholder:"50",disabled:!n}),c.jsx("span",{className:O.unit,children:"mm"})]})]}),c.jsxs("div",{className:O.inputWrapper,children:[c.jsx("label",{className:O.inputLabel,children:"상단 (10~200mm)"}),c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:t.top,onChange:_=>h("top",_.target.value),onBlur:()=>d("top"),onKeyDown:_=>p(_,"top"),className:`${O.input} ${O.inputWithUnitField}`,placeholder:"10"}),c.jsx("span",{className:O.unit,children:"mm"})]})]})]})]}):c.jsxs("div",{className:O.section,children:[c.jsx("span",{className:O.label,children:"프레임 설정"}),c.jsxs("p",{className:O.description,children:["노서라운드에서는 좌우 프레임이 제거되고, 선택한 이격거리(",o,"mm)에 따라 상/하단 프레임 폭이 자동 계산됩니다."]}),r&&c.jsxs("div",{className:O.infoBox,style:{marginBottom:"12px"},children:[c.jsxs("span",{children:["프레임 폭 내경: ",c.jsxs("strong",{children:[r,"mm"]})]}),c.jsxs("span",{className:O.infoDetail,children:["(전체 폭 ",a,"mm - 좌우 이격거리 각 ",o,"mm)"]}),c.jsxs("span",{className:O.infoDetail,style:{marginTop:"4px"},children:["슬롯 수: ",c.jsxs("strong",{children:[u.columnCount,"개"]})," / 슬롯당 너비: ",c.jsxs("strong",{children:[u.columnWidth,"mm"]})]})]}),c.jsx("div",{className:O.inputGroup,children:c.jsxs("div",{className:O.inputWrapper,children:[c.jsx("label",{className:O.inputLabel,children:"상단 (mm)"}),c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:t.top,onChange:_=>h("top",_.target.value),onBlur:()=>d("top"),onKeyDown:_=>p(_,"top"),className:`${O.input} ${O.inputWithUnitField}`,placeholder:"50"}),c.jsx("span",{className:O.unit,children:"mm"})]})]})})]}),jb=({spaceInfo:t,onUpdate:e,disabled:n=!1})=>{var k;const s=Zi(),i=j.useRef(t),r=t.surroundType==="surround",o=t.surroundType==="no-surround",a=t.wallConfig.left,u=t.wallConfig.right,h=18,[d,p]=j.useState(()=>t.frameSize?{left:!a&&r?h:t.frameSize.left,right:!u&&r?h:t.frameSize.right,top:t.frameSize.top}:{left:50,right:50,top:50}),[m,_]=j.useState(((k=t.gapConfig)==null?void 0:k.size)||2),{noSurroundFrameWidth:y,surroundFrameWidth:v,columnInfo:w}=Pb(t,a,u);j.useEffect(()=>{const x=i.current,T=t;(x.width!==T.width||x.surroundType!==T.surroundType||JSON.stringify(x.frameSize)!==JSON.stringify(T.frameSize)||JSON.stringify(x.gapConfig)!==JSON.stringify(T.gapConfig)||x.customColumnCount!==T.customColumnCount)&&(s.recalculateFromSpaceInfo(t),i.current=t)},[t,s]),j.useEffect(()=>{if(r&&t.frameSize){let x=!1;const T={...t.frameSize};!a&&T.left!==h&&(T.left=h,x=!0),!u&&T.right!==h&&(T.right=h,x=!0),x&&setTimeout(()=>{e({frameSize:T})},0)}},[r,a,u,t.frameSize,e]);const b=x=>{const T={surroundType:x};x==="surround"?(T.frameSize={left:a?50:h,right:u?50:h,top:10},T.gapConfig=void 0):(T.frameSize={left:0,right:0,top:10},T.gapConfig={size:2}),e(T)},A=(x,T)=>{if(!(x==="left"&&!a||x==="right"&&!u)&&(T===""||/^\d+$/.test(T))){const E={...d,[x]:T===""?"":parseInt(T)};p(E)}},R=x=>{if(!t.frameSize||x==="left"&&!a||x==="right"&&!u)return;let T=d[x];typeof T=="string"&&(T=T===""?10:parseInt(T)),x==="left"||x==="right"?(T<40&&(T=40),T>100&&(T=100)):(T<10&&(T=10),T>200&&(T=200)),p(C=>({...C,[x]:T}));const E=t.frameSize[x];T!==E&&e({frameSize:{...t.frameSize,[x]:T}})},N=(x,T)=>{x.key==="Enter"&&R(T)},M=x=>{_(x),e({gapConfig:{size:x}})};return c.jsxs("div",{className:O.container,children:[c.jsx(Rb,{surroundType:t.surroundType||"surround",onSurroundTypeChange:b,disabled:n}),o&&c.jsx(Nb,{gapSize:m,onGapSizeChange:M}),c.jsx(Mb,{frameSize:d,hasLeftWall:a,hasRightWall:u,isSurround:r,surroundFrameWidth:v,noSurroundFrameWidth:y,gapSize:m,spaceWidth:t.width,columnInfo:w,onFrameSizeChange:A,onFrameSizeBlur:R,onKeyDown:N})]})},Lb=({baseConfig:t,onBaseTypeChange:e})=>{const n=(t==null?void 0:t.type)==="floor"||!t,s=(t==null?void 0:t.type)==="stand";return c.jsx("div",{className:O.section,children:c.jsxs("div",{className:O.toggleButtonGroup,children:[c.jsx("button",{className:`${O.toggleButton} ${n?O.toggleButtonActive:""}`,onClick:()=>e("floor"),children:"있음"}),c.jsx("button",{className:`${O.toggleButton} ${s?O.toggleButtonActive:""}`,onClick:()=>e("stand"),children:"없음"})]})})},kb=({baseConfig:t,baseHeight:e,floatHeight:n,onPlacementTypeChange:s,onHeightChange:i,onFloatHeightChange:r,onHeightBlur:o,onFloatHeightBlur:a,onKeyDown:u,onFloatKeyDown:h})=>{const d=(t==null?void 0:t.type)==="floor"||!t,p=(t==null?void 0:t.type)==="stand",m=(t==null?void 0:t.placementType)==="ground",_=(t==null?void 0:t.placementType)==="float";return c.jsxs(c.Fragment,{children:[d&&c.jsxs("div",{className:O.section,children:[c.jsx("span",{className:O.label,children:"받침대 높이 (mm)"}),c.jsx("p",{className:O.description,children:"받침대는 바닥마감재 위에 적용되며, 기본값은 65mm입니다. (50-100mm)"}),c.jsx("div",{className:O.inputWrapper,children:c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:e,onChange:y=>i(y.target.value),onBlur:o,onKeyDown:u,className:`${O.input} ${O.inputWithUnitField}`,placeholder:"65"}),c.jsx("span",{className:O.unit,children:"mm"})]})}),c.jsxs("p",{className:O.description,children:["받침대는 바닥마감재 위에서부터 ",e,"mm 길이로 설치됩니다."]})]}),p&&c.jsxs("div",{className:O.section,children:[c.jsx("span",{className:O.label,children:"배치 설정"}),c.jsxs("div",{className:O.radioGroup,children:[c.jsx("button",{className:`${O.button} ${m?O.buttonActive:""}`,onClick:()=>s("ground"),children:"바닥에 배치"}),c.jsx("button",{className:`${O.button} ${_?O.buttonActive:""}`,onClick:()=>s("float"),children:"띄워서 배치"})]})]}),p&&_&&c.jsxs("div",{className:O.section,children:[c.jsx("span",{className:O.label,children:"띄움 높이 (mm)"}),c.jsx("div",{className:O.inputWrapper,children:c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:n,onChange:y=>r(y.target.value),onBlur:a,onKeyDown:h,className:`${O.input} ${O.inputWithUnitField}`,placeholder:"60"}),c.jsx("span",{className:O.unit,children:"mm"})]})}),c.jsxs("p",{className:O.description,children:["바닥으로부터 ",n,"mm 높이가 띄워집니다."]})]})]})},Fb=({spaceInfo:t,onUpdate:e,disabled:n=!1})=>{const[s,i]=j.useState(()=>{var v,w;return((w=(v=t.baseConfig)==null?void 0:v.height)==null?void 0:w.toString())||"65"}),[r,o]=j.useState(()=>{var v,w;return((w=(v=t.baseConfig)==null?void 0:v.floatHeight)==null?void 0:w.toString())||"60"});j.useEffect(()=>{t.baseConfig&&(i(t.baseConfig.height),o(t.baseConfig.floatHeight||60))},[t.baseConfig]);const a=v=>{const w=t.baseConfig||{type:"floor",height:65};e({baseConfig:{...w,type:v,...v==="floor"?{}:{placementType:w.placementType||"ground"}}})},u=v=>{const w=t.baseConfig||{type:"stand",height:65};e({baseConfig:{...w,placementType:v,...v==="float"?{floatHeight:w.floatHeight||60}:{}}})},h=v=>{(v===""||/^\d+$/.test(v))&&i(v)},d=v=>{(v===""||/^\d+$/.test(v))&&o(v)},p=()=>{const v=t.baseConfig||{type:"floor",height:65};let w=s;typeof w=="string"&&(w=w===""?65:parseInt(w)),w<50&&(w=50),w>100&&(w=100),i(w),w!==v.height&&e({baseConfig:{...v,height:w}})},m=()=>{const v=t.baseConfig||{type:"stand",height:0,floatHeight:60};let w=r;typeof w=="string"&&(w=w===""?60:parseInt(w)),w<0&&(w=0),w>200&&(w=200),o(w),w!==v.floatHeight&&e({baseConfig:{...v,floatHeight:w}})},_=v=>{v.key==="Enter"&&p()},y=v=>{v.key==="Enter"&&m()};return c.jsxs("div",{className:O.container,children:[c.jsx(Lb,{baseConfig:t.baseConfig,onBaseTypeChange:a}),c.jsx(kb,{baseConfig:t.baseConfig,baseHeight:s,floatHeight:r,onPlacementTypeChange:u,onHeightChange:h,onFloatHeightChange:d,onHeightBlur:p,onFloatHeightBlur:m,onKeyDown:_,onFloatKeyDown:y})]})},be=mo(t=>({placedModules:[],selectedLibraryModuleId:null,selectedPlacedModuleId:null,isFurniturePlacementMode:!1,editMode:!1,editingModuleId:null,currentDragData:null,addModule:e=>{t(n=>({placedModules:[...n.placedModules,e]}))},removeModule:e=>{t(n=>({placedModules:n.placedModules.filter(s=>s.id!==e)}))},moveModule:(e,n)=>{t(s=>({placedModules:s.placedModules.map(i=>i.id===e?{...i,position:n}:i)}))},updatePlacedModule:(e,n)=>{t(s=>({placedModules:s.placedModules.map(i=>i.id===e?{...i,...n}:i)}))},clearAllModules:()=>{t({placedModules:[]})},setPlacedModules:e=>{t(n=>({placedModules:typeof e=="function"?e(n.placedModules):e}))},setSelectedLibraryModuleId:e=>{t({selectedLibraryModuleId:e})},setSelectedPlacedModuleId:e=>{t({selectedPlacedModuleId:e})},clearAllSelections:()=>{t({selectedLibraryModuleId:null,selectedPlacedModuleId:null})},setFurniturePlacementMode:e=>{t({isFurniturePlacementMode:e})},setEditMode:e=>{t({editMode:e})},setEditingModuleId:e=>{t({editingModuleId:e})},exitEditMode:()=>{t({editMode:!1,editingModuleId:null})},setCurrentDragData:e=>{t({currentDragData:e})},clearDragData:()=>{t({currentDragData:null})},setAllDoors:e=>{t(n=>({placedModules:n.placedModules.map(s=>({...s,hasDoor:e}))}))}})),er="projects",Ob=async t=>{try{const e=await Po();if(!e)return{id:null,error:"로그인이 필요합니다."};const n={userId:e.uid,title:t.title,createdAt:Hr(),updatedAt:Hr(),version:"1.0.0",projectData:t.projectData,spaceConfig:t.spaceConfig,furniture:t.furniture,stats:{furnitureCount:t.furniture.placedModules.length,lastOpenedAt:Hr()}};return{id:(await Cx(q_(Ji,er),n)).id,error:null}}catch(e){return console.error("프로젝트 생성 에러:",e),{id:null,error:"프로젝트 생성 중 오류가 발생했습니다."}}},wy=async t=>{try{const e=await Po();if(!e)return{project:null,error:"로그인이 필요합니다."};const n=Co(Ji,er,t),s=await il(n);if(!s.exists())return{project:null,error:"프로젝트를 찾을 수 없습니다."};const i=s.data();if(i.userId!==e.uid)return{project:null,error:"프로젝트에 접근할 권한이 없습니다."};const r={id:s.id,...i};return await Ub(t),{project:r,error:null}}catch(e){return console.error("프로젝트 불러오기 에러:",e),{project:null,error:"프로젝트 불러오기 중 오류가 발생했습니다."}}},Ty=async(t,e,n)=>{var s;try{const i=await Po();if(!i)return{error:"로그인이 필요합니다."};const r=Co(Ji,er,t),o=await il(r);if(!o.exists()||o.data().userId!==i.uid)return{error:"프로젝트에 접근할 권한이 없습니다."};const a={updatedAt:Hr(),...e.title&&{title:e.title},...e.projectData&&{projectData:e.projectData},...e.spaceConfig&&{spaceConfig:e.spaceConfig},...e.furniture&&{furniture:e.furniture,"stats.furnitureCount":e.furniture.placedModules.length},...n&&{thumbnail:n}};e.spaceConfig&&(console.log("🔥 Firebase 저장 - spaceConfig 입력:",e.spaceConfig),console.log("🔥 Firebase 저장 - materialConfig 입력:",e.spaceConfig.materialConfig)),console.log("🔥 Firebase 저장 - 최종 updateData:",a),await ry(r,a);const u=await il(r);if(u.exists()){const h=u.data();console.log("🔥 Firebase 저장 후 확인 - spaceConfig:",h.spaceConfig),console.log("🔥 Firebase 저장 후 확인 - materialConfig:",(s=h.spaceConfig)==null?void 0:s.materialConfig)}return{error:null}}catch(i){return console.error("프로젝트 업데이트 에러:",i),{error:"프로젝트 업데이트 중 오류가 발생했습니다."}}},Vb=async t=>{try{const e=await Po();if(!e)return{error:"로그인이 필요합니다."};const n=Co(Ji,er,t),s=await il(n);return!s.exists()||s.data().userId!==e.uid?{error:"프로젝트에 접근할 권한이 없습니다."}:(await bx(n),{error:null})}catch(e){return console.error("프로젝트 삭제 에러:",e),{error:"프로젝트 삭제 중 오류가 발생했습니다."}}},Bb=async()=>{try{const t=await Po();if(!t)return{projects:[],error:"로그인이 필요합니다."};const e=wx(q_(Ji,er),Tx("userId","==",t.uid),Ex("updatedAt","desc")),n=await Sx(e),s=[];return n.forEach(i=>{var o,a,u,h;const r=i.data();s.push({id:i.id,title:r.title,updatedAt:r.updatedAt,furnitureCount:((o=r.stats)==null?void 0:o.furnitureCount)||0,spaceSize:{width:((a=r.spaceConfig)==null?void 0:a.width)||0,height:((u=r.spaceConfig)==null?void 0:u.height)||0,depth:((h=r.spaceConfig)==null?void 0:h.depth)||0},thumbnail:r.thumbnail})}),{projects:s,error:null}}catch(t){return console.error("프로젝트 목록 가져오기 에러:",t),{projects:[],error:"프로젝트 목록을 가져오는 중 오류가 발생했습니다."}}},Ub=async t=>{try{const e=Co(Ji,er,t);await ry(e,{"stats.lastOpenedAt":Hr()})}catch(e){console.error("마지막 열람 시간 업데이트 에러:",e)}},$b=()=>{const t=document.querySelectorAll("canvas");for(const e of t)if((e.getContext("webgl")||e.getContext("webgl2"))&&e.offsetWidth>100&&e.offsetHeight>100)return e;return null},Hb=(t,e={})=>{try{const{width:n=300,height:s=200,quality:i=.8}=e;if(t.width===0||t.height===0)return console.warn("캔버스 크기가 0입니다."),null;const r=document.createElement("canvas"),o=r.getContext("2d");return o?(r.width=n,r.height=s,o.fillStyle="#f5f5f5",o.fillRect(0,0,n,s),o.drawImage(t,0,0,t.width,t.height,0,0,n,s),r.toDataURL("image/png",i)):(console.error("임시 캔버스 컨텍스트를 생성할 수 없습니다."),null)}catch(n){return console.error("썸네일 캡처 실패:",n),null}},Wb=async()=>{const t=$b();if(!t)return console.warn("3D 캔버스를 찾을 수 없어 썸네일을 생성할 수 없습니다."),null;if(t.offsetWidth===0||t.offsetHeight===0)return console.warn("캔버스가 보이지 않는 상태입니다."),null;console.log("📸 3D 캔버스 썸네일 캡처 시작...",{canvasSize:`${t.width}x${t.height}`,displaySize:`${t.offsetWidth}x${t.offsetHeight}`}),await new Promise(e=>setTimeout(e,500));for(let e=1;e<=3;e++)try{const n=Hb(t,{width:300,height:200,quality:.7});if(n&&n.length>1e3)return console.log(`📸 썸네일 캡처 성공 (${e}번째 시도)`),n;e<3&&await new Promise(s=>setTimeout(s,100))}catch(n){console.warn(`썸네일 캡처 시도 ${e} 실패:`,n)}return console.warn("모든 썸네일 캡처 시도 실패"),null},Ey=(t,e)=>{const n=document.createElement("canvas"),s=n.getContext("2d");if(!s)return"";n.width=300,n.height=200;const i=s.createLinearGradient(0,0,300,200);i.addColorStop(0,"#f3e8d6"),i.addColorStop(1,"#d4b896"),s.fillStyle=i,s.fillRect(0,0,300,200),s.fillStyle="#8B4513",s.font="bold 16px Arial",s.textAlign="center";const r=Math.round(t.width),o=Math.round(t.height),a=Math.round(t.depth);return s.fillText(`${r} × ${o} × ${a}mm`,150,80),s.font="14px Arial",s.fillText(`가구 ${e}개`,150,120),s.fillStyle="#3B82F6",s.fillRect(10,10,40,20),s.fillStyle="white",s.font="bold 12px Arial",s.textAlign="left",s.fillText("V5.0",15,24),n.toDataURL("image/png",.8)},Xb=()=>{const t=Al(),[e]=Sm(),[n,s]=j.useState(!1),[i,r]=j.useState(!1),[o,a]=j.useState(null),{basicInfo:u,setBasicInfo:h,resetAll:d}=uy(),{spaceInfo:p,setSpaceInfo:m,resetAll:_}=Ct(),{clearAllModules:y,setPlacedModules:v,placedModules:w}=be(),b=async k=>{s(!0);try{const{project:x,error:T}=await wy(k);if(T){console.error("프로젝트 로드 에러:",T),alert("프로젝트를 불러오는데 실패했습니다: "+T),t("/");return}x&&(h(x.projectData),m(x.spaceConfig),v(x.furniture.placedModules),a(k),console.log("✅ 프로젝트 로드 성공:",x.title),console.log("🎨 로드된 materialConfig:",x.spaceConfig.materialConfig))}catch(x){console.error("프로젝트 로드 실패:",x),alert("프로젝트 로드 중 오류가 발생했습니다."),t("/")}finally{s(!1)}};j.useEffect(()=>{const k=e.get("projectId");k?b(k):(d(),_(),y(),a(null))},[e]);const A=k=>{h(k)},R=k=>{m(k)},N=async()=>{if(u.title&&u.location){if(o){r(!0);try{const x=Ey(p,w.length),{error:T}=await Ty(o,{title:u.title,projectData:u,spaceConfig:p,furniture:{placedModules:w}},x);if(T){console.error("프로젝트 저장 에러:",T),alert("프로젝트 저장에 실패했습니다: "+T),r(!1);return}console.log("✅ 프로젝트 저장 후 Configurator로 이동");try{new BroadcastChannel("project-updates").postMessage({type:"PROJECT_SAVED",projectId:o,timestamp:Date.now()}),console.log("📡 다른 창에 프로젝트 업데이트 알림 전송 (Step0)")}catch(E){console.warn("BroadcastChannel 전송 실패 (무시 가능):",E)}}catch(x){console.error("프로젝트 저장 실패:",x),alert("프로젝트 저장 중 오류가 발생했습니다."),r(!1);return}r(!1)}const k=o?`/configurator?projectId=${o}`:"/configurator";t(k)}},M=u.title&&u.location;return n?c.jsxs("div",{className:It.loadingScreen,children:[c.jsx(rl,{message:"프로젝트를 불러오는 중...",size:"large",type:"spinner"}),c.jsx("p",{className:It.loadingSubtext,children:"잠시만 기다려주세요."})]}):c.jsx("div",{className:It.container,"data-debug":void 0,"data-component":"Step0",children:c.jsxs("div",{className:It.modalContent,"data-debug-element":"modalContent",children:[c.jsx("div",{className:It.header,"data-debug-element":"header",children:c.jsxs("div",{children:[c.jsx("h1",{children:"벽장 제작"}),c.jsx("p",{children:"기본 정보와 공간 크기를 설정해주세요."})]})}),c.jsx("div",{className:It.content,"data-debug-element":"content",children:c.jsxs("div",{className:It.formSection,"data-debug-element":"formSection",children:[c.jsxs("div",{className:It.form,"data-debug-element":"form",children:[c.jsx(Tb,{basicInfo:u,onUpdate:A}),c.jsxs("div",{className:It.spaceSettings,"data-debug-element":"spaceSettings",children:[c.jsx("h3",{className:It.sectionTitle,children:"공간 정보"}),c.jsxs("div",{className:It.spaceSizeSection,children:[c.jsx("span",{className:It.label,children:"공간 크기"}),c.jsx("div",{className:It.dimensionsSummary,children:c.jsxs("span",{className:It.summaryText,children:[p.width," × ",p.height," mm (깊이: ",p.depth,"mm 고정)"]})}),c.jsxs("div",{className:It.inputGroupTwoColumns,children:[c.jsx(dy,{spaceInfo:p,onUpdate:R}),c.jsx(fy,{spaceInfo:p,onUpdate:R})]})]}),c.jsx(py,{spaceInfo:p,onUpdate:R})]})]}),c.jsx("div",{className:It.startButtonContainer,"data-debug-element":"startButtonContainer",children:c.jsx(Gu,{variant:"primary",size:"large",onClick:N,disabled:!M||i,"data-debug-element":"startButton",children:i?"저장 중...":"벽장 제작 시작하기"})})]})})]})})},vg={viewMode:"2D",view2DDirection:"front",doorsOpen:!0,showDimensions:!0,selectedModuleForProperties:null},tr=mo()(V1(t=>({...vg,setViewMode:e=>t({viewMode:e}),setView2DDirection:e=>t({view2DDirection:e}),toggleDoors:()=>t(e=>({doorsOpen:!e.doorsOpen})),toggleDimensions:()=>t(e=>({showDimensions:!e.showDimensions})),setSelectedModuleForProperties:e=>t({selectedModuleForProperties:e}),resetUI:()=>t(vg)}),{name:"ui-store",partialize:t=>({viewMode:t.viewMode,view2DDirection:t.view2DDirection,showDimensions:t.showDimensions})})),ee={BASIC_THICKNESS:18,DEFAULT_DEPTH:600,TYPE1_DRAWER_HEIGHT:600,TYPE2_BOTTOM_HEIGHT:1025,TYPE4_DRAWER_HEIGHT:1e3,DRAWER_HEIGHTS_2TIER:[255,255],DRAWER_HEIGHTS_4TIER:[255,255,176,176],DRAWER_GAP:24,STYLER_WIDTH:694,PANTSHANGER_WIDTH:564,SAFETY_SHELF_POSITION:2050,SAFETY_SHELF_THRESHOLD:2300,COLORS:{TYPE1:"#8D6E63",TYPE2:"#303F9F",TYPE4:"#0097A7",STYLER:"#4CAF50",PANTSHANGER:"#9C27B0"}},Ms=(t,e,n=ee.SAFETY_SHELF_POSITION,s=ee.SAFETY_SHELF_THRESHOLD)=>{if(e<=s)return t;let i=0;return t.map(r=>{const o=i,a=i+r.height;if(i+=r.height,r.type==="hanging"&&n>=o&&n<a){const u=n-o;return{...r,count:1,shelfPositions:[u]}}return r})},Os=(t,e,n,s,i,r,o,a)=>({id:t,name:e,category:"full",dimensions:{width:n,height:s,depth:i},color:r,description:o,isDynamic:!0,hasDoor:!1,widthOptions:[n],type:"box",defaultDepth:a||ee.DEFAULT_DEPTH,modelConfig:{basicThickness:ee.BASIC_THICKNESS,hasOpenFront:!0}}),Gb=(t,e)=>{const n=ee.TYPE1_DRAWER_HEIGHT,s=e-n,i=[{type:"drawer",heightType:"absolute",height:n,count:2,drawerHeights:ee.DRAWER_HEIGHTS_2TIER,gapHeight:ee.DRAWER_GAP},{type:"hanging",heightType:"absolute",height:s}],r=Ms(i,e),o=Os(`single-2drawer-hanging-${t}`,`2단서랍+옷장 ${t}mm`,t,e,ee.DEFAULT_DEPTH,ee.COLORS.TYPE1,e>ee.SAFETY_SHELF_THRESHOLD?`하단 2단 서랍장 + 상단 옷장 (안전선반 포함) | 폭 ${t}mm`:`하단 2단 서랍장 + 상단 옷장 | 폭 ${t}mm`,ee.DEFAULT_DEPTH);return{...o,modelConfig:{...o.modelConfig,sections:r}}},Yb=(t,e)=>{const n=ee.TYPE2_BOTTOM_HEIGHT,s=e-n,i=[{type:"shelf",heightType:"absolute",height:n,count:1,shelfPositions:[n-18-9]},{type:"hanging",heightType:"absolute",height:s}],r=Ms(i,e),o=Os(`single-2hanging-${t}`,`2단 옷장 ${t}mm`,t,e,ee.DEFAULT_DEPTH,ee.COLORS.TYPE2,e>ee.SAFETY_SHELF_THRESHOLD?`하단 짧은옷장 + 상단 긴옷장 (안전선반 포함) | 폭 ${t}mm`:`하단 짧은옷장 + 상단 긴옷장 | 폭 ${t}mm`);return{...o,modelConfig:{...o.modelConfig,sections:r}}},zb=(t,e)=>{const n=ee.TYPE4_DRAWER_HEIGHT,s=e-n,i=[{type:"drawer",heightType:"absolute",height:n,count:4,drawerHeights:ee.DRAWER_HEIGHTS_4TIER,gapHeight:ee.DRAWER_GAP},{type:"hanging",heightType:"absolute",height:s}],r=Ms(i,e),o=Os(`single-4drawer-hanging-${t}`,`4단서랍+옷장 ${t}mm`,t,e,ee.DEFAULT_DEPTH,ee.COLORS.TYPE4,e>ee.SAFETY_SHELF_THRESHOLD?`4단 서랍장 + 옷장 복합형 (안전선반 포함) | 폭 ${t}mm`:`4단 서랍장 + 옷장 복합형 | 폭 ${t}mm`);return{...o,modelConfig:{...o.modelConfig,sections:r}}},qb=(t,e)=>{const n=ee.TYPE1_DRAWER_HEIGHT,s=e-n,i=[{type:"drawer",heightType:"absolute",height:n,count:2,drawerHeights:ee.DRAWER_HEIGHTS_2TIER,gapHeight:ee.DRAWER_GAP},{type:"hanging",heightType:"absolute",height:s}],r=Ms(i,e),o=Os(`dual-2drawer-hanging-${t}`,`듀얼 2단서랍+옷장 ${t}mm`,t,e,ee.DEFAULT_DEPTH,ee.COLORS.TYPE1,e>ee.SAFETY_SHELF_THRESHOLD?`듀얼 하단 2단 서랍장 + 상단 옷장 (안전선반 포함) | 폭 ${t}mm`:`듀얼 하단 2단 서랍장 + 상단 옷장 | 폭 ${t}mm`);return{...o,modelConfig:{...o.modelConfig,sections:r}}},Kb=(t,e)=>{const n=ee.TYPE2_BOTTOM_HEIGHT,s=e-n,i=[{type:"shelf",heightType:"absolute",height:n,count:1,shelfPositions:[n-18-9]},{type:"hanging",heightType:"absolute",height:s}],r=Ms(i,e),o=Os(`dual-2hanging-${t}`,`듀얼 2단 옷장 ${t}mm`,t,e,ee.DEFAULT_DEPTH,ee.COLORS.TYPE2,e>ee.SAFETY_SHELF_THRESHOLD?`듀얼 하단 짧은옷장 + 상단 긴옷장 (안전선반 포함) | 폭 ${t}mm`:`듀얼 하단 짧은옷장 + 상단 긴옷장 | 폭 ${t}mm`);return{...o,modelConfig:{...o.modelConfig,sections:r}}},Qb=(t,e)=>{const n=ee.TYPE4_DRAWER_HEIGHT,s=e-n,i=[{type:"drawer",heightType:"absolute",height:n,count:4,drawerHeights:ee.DRAWER_HEIGHTS_4TIER,gapHeight:ee.DRAWER_GAP},{type:"hanging",heightType:"absolute",height:s}],r=Ms(i,e),o=Os(`dual-4drawer-hanging-${t}`,`듀얼 4단서랍+옷장 ${t}mm`,t,e,ee.DEFAULT_DEPTH,ee.COLORS.TYPE4,e>ee.SAFETY_SHELF_THRESHOLD?`듀얼 4단 서랍장 + 옷장 복합형 (안전선반 포함) | 폭 ${t}mm`:`듀얼 4단 서랍장 + 옷장 복합형 | 폭 ${t}mm`);return{...o,modelConfig:{...o.modelConfig,sections:r}}},Jb=(t,e)=>{const n=ee.TYPE1_DRAWER_HEIGHT,s=e-n,i=[{type:"drawer",heightType:"absolute",height:n,count:2,drawerHeights:ee.DRAWER_HEIGHTS_2TIER,gapHeight:ee.DRAWER_GAP},{type:"hanging",heightType:"absolute",height:s}],r=[{type:"hanging",heightType:"absolute",height:e}],o=Ms(i,e),a=Ms(r,e),u=Os(`dual-2drawer-styler-${t}`,`듀얼 서랍+스타일러 ${t}mm`,t,e,600,ee.COLORS.STYLER,e>ee.SAFETY_SHELF_THRESHOLD?`좌측 서랍+옷장 + 우측 스타일러장 (안전선반 포함) | 폭 ${t}mm`:`좌측 서랍+옷장 + 우측 스타일러장 | 폭 ${t}mm`,600);return{...u,modelConfig:{...u.modelConfig,rightAbsoluteWidth:ee.STYLER_WIDTH,rightAbsoluteDepth:660,hasSharedMiddlePanel:!1,leftSections:o,rightSections:a}}},Zb=(t,e)=>{const n=ee.TYPE4_DRAWER_HEIGHT,s=e-n,i=Os(`dual-4drawer-pantshanger-${t}`,`듀얼 서랍+바지걸이 ${t}mm`,t,e,ee.DEFAULT_DEPTH,ee.COLORS.PANTSHANGER,e>ee.SAFETY_SHELF_THRESHOLD?`좌측 4단서랍+옷장 + 우측 바지걸이+옷장 (통합 안전선반) | 폭 ${t}mm`:`좌측 4단서랍+옷장 + 우측 바지걸이+옷장 | 폭 ${t}mm`);return{...i,modelConfig:{...i.modelConfig,rightAbsoluteWidth:ee.PANTSHANGER_WIDTH,hasSharedMiddlePanel:!0,middlePanelHeight:n,hasSharedSafetyShelf:e>ee.SAFETY_SHELF_THRESHOLD,safetyShelfHeight:ee.SAFETY_SHELF_POSITION,leftSections:[{type:"drawer",heightType:"absolute",height:n,count:4,drawerHeights:ee.DRAWER_HEIGHTS_4TIER,gapHeight:ee.DRAWER_GAP},{type:"hanging",heightType:"absolute",height:s}],rightSections:[{type:"hanging",heightType:"absolute",height:n},{type:"hanging",heightType:"absolute",height:s}]}}},eC=(t,e)=>{const{height:n}=t;let s;e?s=e:s={width:3600,height:2400,depth:580,installType:"built-in",wallConfig:{left:!0,right:!0},hasFloorFinish:!1,surroundType:"surround"};const i=ft(s),r=i.columnWidth,o=i.columnCount,a=[];if(a.push(Gb(r,n)),a.push(Yb(r,n)),a.push(zb(r,n)),o>=2){const u=r*2;a.push(qb(u,n)),a.push(Kb(u,n)),a.push(Qb(u,n)),a.push(Jb(u,n)),a.push(Zb(u,n))}return a},Ay=(t,e)=>[...eC(t,e)],Iy=[],tC=(t,e,n)=>{const s=Ay(e,n),i=Iy;return[...s,...i].filter(r=>r.category===t)},Dt=(t,e,n)=>{if(e){const i=Ay(e,n).find(r=>r.id===t);if(i)return i}return Iy.find(s=>s.id===t)},ao=(t,e,n,s,i)=>{const r=ft(s),o=dt(s);if(t<0||e&&t>=r.columnCount-1||!e&&t>=r.columnCount)return!1;const a=e?[t,t+1]:[t];for(const u of n){if(i&&u.id===i)continue;const h=Dt(u.moduleId,o,s);if(!h)continue;const d=Math.abs(h.dimensions.width-r.columnWidth*2)<50;let p=-1;if(d&&r.threeUnitDualPositions?p=r.threeUnitDualPositions.findIndex(m=>Math.abs(m-u.position.x)<.1):p=r.threeUnitPositions.findIndex(m=>Math.abs(m-u.position.x)<.1),p>=0){const m=d?[p,p+1]:[p];if(a.some(y=>m.includes(y)))return!1}}return!0},Bi=(t,e,n,s,i,r)=>{const o=ft(i),a=e==="left"?-1:1,u=o.columnCount-(n?1:0);for(let h=t+a;e==="right"?h<=u:h>=0;h+=a)if(ao(h,n,s,i,r))return h;return null},nC=({setPlacedModules:t})=>{const[e,n]=j.useState(!1),s=j.useCallback((i,r)=>{t(o=>{if(o.length===0)return o;const a=ft(i),u=ft(r);(a.columnCount!==u.columnCount||a.columnWidth!==u.columnWidth)&&console.log(`🔄 컬럼 변경: ${a.columnCount}개(${a.columnWidth}mm) → ${u.columnCount}개(${u.columnWidth}mm)`);const h=[];return o.forEach(d=>{const p=dt(i),m=Dt(d.moduleId,p,i);let _;if(m){const A=Math.abs(m.dimensions.width-a.columnWidth*2)<50;_=Db(d.position,a,A)}if(_===void 0||_<0){h.push({...d,isValidInCurrentSpace:!1});return}let y=d.moduleId,v=!1;const w=[/^dual-([^-]+(?:-[^-]+)*)-(\d+)$/];for(const A of w){const R=d.moduleId.match(A);if(R){const N=parseInt(R[2]);if(Math.abs(N-a.columnWidth*2)<50){y=d.moduleId.replace(A,`dual-$1-${u.columnWidth*2}`),v=!0;break}}}if(!v){const A=[/^single-([^-]+(?:-[^-]+)*)-(\d+)$/];let R=!1;for(const N of A)if(d.moduleId.match(N)){y=d.moduleId.replace(N,`single-$1-${u.columnWidth}`),R=!0;break}R||(y=`single-open-${u.columnWidth}`)}if(_>=u.columnCount){const A=u.columnCount-(v?2:1);if(A>=0)_=A;else{h.push({...d,isValidInCurrentSpace:!1});return}}if(v&&_+1>=u.columnCount&&(y=y.replace(/^dual-/,"single-").replace(/-(\d+)$/,`-${u.columnWidth}`),v=!1),!ao(_,v,h,r,d.id)){let A=Bi(_,"right",v,h,r,d.id);if(A===null&&(A=Bi(_,"left",v,h,r,d.id)),A!==null)_=A;else{h.push({...d,isValidInCurrentSpace:!1});return}}let b;v&&u.threeUnitDualPositions?b=u.threeUnitDualPositions[_]:b=u.threeUnitPositions[_],h.push({...d,moduleId:y,position:{...d.position,x:b},slotIndex:_,isDualSlot:y.includes("dual"),isValidInCurrentSpace:!0})}),h})},[t]);return{spaceChangeMode:e,setSpaceChangeMode:n,updateFurnitureForNewSpace:s}},sC="_header_vaqh0_1",iC="_container_vaqh0_19",rC="_logoSection_vaqh0_39",oC="_logo_vaqh0_39",aC="_title_vaqh0_73",lC="_centerActions_vaqh0_91",cC="_actionButton_vaqh0_103",uC="_doorNotInstalled_vaqh0_167",hC="_doorInstalled_vaqh0_189",dC="_rightActions_vaqh0_211",fC="_convertButton_vaqh0_223",pC="_logoutButton_vaqh0_267",gC="_profileButton_vaqh0_313",mC="_saveSuccess_vaqh0_351",_C="_saveError_vaqh0_383",lt={header:sC,container:iC,logoSection:rC,logo:oC,title:aC,centerActions:lC,actionButton:cC,doorNotInstalled:uC,doorInstalled:hC,rightActions:dC,convertButton:fC,logoutButton:pC,profileButton:gC,saveSuccess:mC,saveError:_C},yC=({title:t,onSave:e,onPrevious:n,onNext:s,onHelp:i,onConvert:r,onLogout:o,onProfile:a,saving:u=!1,saveStatus:h="idle",hasDoorsInstalled:d=!1,onDoorInstallationToggle:p})=>c.jsxs("header",{className:lt.header,children:[c.jsxs("div",{className:lt.container,children:[c.jsxs("div",{className:lt.logoSection,children:[c.jsx("div",{className:lt.logo,children:c.jsx("img",{src:"/inshow.svg",alt:"Logo"})}),c.jsx("h1",{className:lt.title,children:t})]}),c.jsxs("div",{className:lt.centerActions,children:[c.jsxs("button",{className:lt.actionButton,onClick:e,disabled:u,children:[c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"17,21 17,13 7,13 7,21",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"7,3 7,8 15,8",stroke:"currentColor",strokeWidth:"2"})]}),u?"저장 중...":"저장"]}),p&&c.jsxs("button",{className:`${lt.actionButton} ${d?lt.doorInstalled:lt.doorNotInstalled}`,onClick:p,children:[c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),c.jsx("circle",{cx:"9",cy:"12",r:"1",fill:"currentColor"}),d&&c.jsx("path",{d:"M8 12l2 2 4-4",stroke:"currentColor",strokeWidth:"2",fill:"none"})]}),"도어설치"]}),n&&c.jsxs("button",{className:lt.actionButton,onClick:n,children:[c.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:c.jsx("polyline",{points:"15,18 9,12 15,6",stroke:"currentColor",strokeWidth:"2"})}),"이전"]}),s&&c.jsxs("button",{className:lt.actionButton,onClick:s,children:[c.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:c.jsx("polyline",{points:"9,18 15,12 9,6",stroke:"currentColor",strokeWidth:"2"})}),"다음"]}),i&&c.jsxs("button",{className:lt.actionButton,onClick:i,children:[c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),c.jsx("path",{d:"m9,9a3,3 0 1 1 5.83,1c0,2-3,3-3,3",stroke:"currentColor",strokeWidth:"2"}),c.jsx("circle",{cx:"12",cy:"17",r:"1",fill:"currentColor"})]}),"도움말"]})]}),c.jsxs("div",{className:lt.rightActions,children:[r&&c.jsxs("button",{className:lt.convertButton,onClick:r,children:["컨버팅",c.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:c.jsx("polyline",{points:"9,18 15,12 9,6",stroke:"currentColor",strokeWidth:"2"})})]}),o&&c.jsxs("button",{className:lt.logoutButton,onClick:o,children:[c.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"16,17 21,12 16,7",stroke:"currentColor",strokeWidth:"2"}),c.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12",stroke:"currentColor",strokeWidth:"2"})]}),"로그아웃"]}),a&&c.jsx("button",{className:lt.profileButton,onClick:a,children:c.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"}),c.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z",stroke:"currentColor",strokeWidth:"2"})]})})]})]}),h==="success"&&c.jsx("div",{className:lt.saveSuccess,children:"✓ 저장되었습니다"}),h==="error"&&c.jsx("div",{className:lt.saveError,children:"✕ 저장에 실패했습니다"})]}),vC="_sidebar_6s7kp_1",wC="_open_6s7kp_25",TC="_tabList_6s7kp_33",EC="_tabButton_6s7kp_49",AC="_active_6s7kp_87",IC="_tabIcon_6s7kp_119",xC="_tabLabel_6s7kp_151",SC="_userSection_6s7kp_189",bC="_userAvatar_6s7kp_199",CC="_avatar_6s7kp_211",DC="_onlineIndicator_6s7kp_237",rn={sidebar:vC,open:wC,tabList:TC,tabButton:EC,active:AC,tabIcon:IC,tabLabel:xC,userSection:SC,userAvatar:bC,avatar:CC,onlineIndicator:DC},PC=({activeTab:t,onTabClick:e,isOpen:n})=>{const s=[{id:"module",icon:c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),c.jsx("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),c.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),c.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"})]}),label:"모듈"},{id:"material",icon:c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"7.5,4.21 12,6.81 16.5,4.21",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"7.5,19.79 7.5,14.6 3,12",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"21,12 16.5,14.6 16.5,19.79",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"3.27,6.96 12,12.01 20.73,6.96",stroke:"currentColor",strokeWidth:"2"}),c.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12",stroke:"currentColor",strokeWidth:"2"})]}),label:"재질"},{id:"structure",icon:c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"9,22 9,12 15,12 15,22",stroke:"currentColor",strokeWidth:"2"})]}),label:"구조물"},{id:"etc",icon:c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"}),c.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z",stroke:"currentColor",strokeWidth:"2"})]}),label:"기타"}];return c.jsxs("aside",{className:`${rn.sidebar} ${n?rn.open:""}`,children:[c.jsx("div",{className:rn.tabList,children:s.map(i=>c.jsxs("button",{className:`${rn.tabButton} ${t===i.id?rn.active:""}`,onClick:()=>e(i.id),title:i.label,children:[c.jsx("div",{className:rn.tabIcon,children:i.icon}),c.jsx("span",{className:rn.tabLabel,children:i.label})]},i.id))}),c.jsx("div",{className:rn.userSection,children:c.jsxs("div",{className:rn.userAvatar,children:[c.jsx("div",{className:rn.avatar,children:c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2"}),c.jsx("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"})]})}),c.jsx("div",{className:rn.onlineIndicator,children:c.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",children:c.jsx("path",{d:"M9 12l2 2 4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})})]})},RC="_viewerControls_7nn0n_1",NC="_leftControls_7nn0n_29",MC="_toggleGroup_7nn0n_41",jC="_toggleIcon_7nn0n_53",LC="_toggleLabel_7nn0n_61",kC="_on_7nn0n_103",FC="_off_7nn0n_111",OC="_switchHandle_7nn0n_119",VC="_checkboxGroup_7nn0n_157",BC="_checkboxLabel_7nn0n_169",UC="_checkbox_7nn0n_157",$C="_checkmark_7nn0n_201",HC="_rightControls_7nn0n_257",WC="_renderModeGroup_7nn0n_271",XC="_renderModeButton_7nn0n_287",GC="_active_7nn0n_329",YC="_viewModeGroup_7nn0n_349",zC="_viewModeButton_7nn0n_363",qC="_viewDirectionGroup_7nn0n_427",KC="_viewDirectionButton_7nn0n_441",Me={viewerControls:RC,leftControls:NC,toggleGroup:MC,toggleIcon:jC,toggleLabel:LC,switch:"_switch_7nn0n_81",on:kC,off:FC,switchHandle:OC,checkboxGroup:VC,checkboxLabel:BC,checkbox:UC,checkmark:$C,rightControls:HC,renderModeGroup:WC,renderModeButton:XC,active:GC,viewModeGroup:YC,viewModeButton:zC,viewDirectionGroup:qC,viewDirectionButton:KC},QC=({viewMode:t,onViewModeChange:e,viewDirection:n,onViewDirectionChange:s,renderMode:i,onRenderModeChange:r,showAll:o,onShowAllToggle:a,showDimensions:u,onShowDimensionsToggle:h,showGuides:d,onShowGuidesToggle:p,doorsOpen:m,onDoorsToggle:_})=>{const{view2DDirection:y,setView2DDirection:v}=tr(),w=[{id:"3D",label:"3D"},{id:"2D",label:"2D"}],b=[{id:"front",label:"정면"},{id:"top",label:"상부"},{id:"left",label:"좌측면"},{id:"right",label:"우측면"}],A=[{id:"solid",label:"Solid"},{id:"wireframe",label:"Wireframe"}],R=N=>{v(N),s(N)};return c.jsxs("div",{className:Me.viewerControls,children:[c.jsxs("div",{className:Me.leftControls,children:[c.jsxs("div",{className:Me.toggleGroup,children:[c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",className:Me.toggleIcon,children:[c.jsx("path",{d:"M3 17h18M3 12h18M3 7h18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),c.jsx("circle",{cx:"21",cy:"7",r:"1",fill:"currentColor"}),c.jsx("circle",{cx:"21",cy:"12",r:"1",fill:"currentColor"}),c.jsx("circle",{cx:"21",cy:"17",r:"1",fill:"currentColor"})]}),c.jsx("span",{className:Me.toggleLabel,children:u?"ON":"OFF"}),c.jsx("button",{className:`${Me.switch} ${u?Me.on:Me.off}`,onClick:h,children:c.jsx("div",{className:Me.switchHandle})})]}),c.jsxs("div",{className:Me.checkboxGroup,children:[c.jsxs("label",{className:Me.checkboxLabel,children:[c.jsx("input",{type:"checkbox",checked:o,onChange:a,className:Me.checkbox}),c.jsx("span",{className:Me.checkmark}),"모두"]}),c.jsxs("label",{className:Me.checkboxLabel,children:[c.jsx("input",{type:"checkbox",checked:u,onChange:h,className:Me.checkbox}),c.jsx("span",{className:Me.checkmark}),"치수"]}),c.jsxs("label",{className:Me.checkboxLabel,children:[c.jsx("input",{type:"checkbox",checked:d,onChange:p,className:Me.checkbox}),c.jsx("span",{className:Me.checkmark}),"가이드"]})]})]}),c.jsxs("div",{className:Me.rightControls,children:[c.jsx("div",{className:Me.renderModeGroup,children:A.map(N=>c.jsx("button",{className:`${Me.renderModeButton} ${i===N.id?Me.active:""}`,onClick:()=>r(N.id),children:N.label},N.id))}),c.jsx("div",{className:Me.viewModeGroup,children:w.map(N=>c.jsx("button",{className:`${Me.viewModeButton} ${t===N.id?Me.active:""}`,onClick:()=>e(N.id),children:N.label},N.id))}),c.jsx("div",{className:Me.viewDirectionGroup,children:b.map(N=>c.jsx("button",{className:`${Me.viewDirectionButton} ${y===N.id?Me.active:""}`,onClick:()=>R(N.id),children:N.label},N.id))})]})]})},JC=()=>({room:{floor:{color:"#e2e8f0",roughness:.5},walls:{color:"#f8fafc",roughness:.3}},furniture:{color:"#64748b",roughness:.2}}),xy=j.createContext(null),ZC=({spaceInfo:t,svgSize:e,renderMode:n="wireframe",children:s})=>{const i=JC(),r=gy(t),o={spaceInfo:t,canvasSize:e,styles:i,renderMode:n,roomDimensions:r};return c.jsx(xy.Provider,{value:o,children:s})},e5=.01,t5={BASE_FOV:50,SMALL_WIDTH_THRESHOLD:1e3,MEDIUM_WIDTH_THRESHOLD:1500,LARGE_WIDTH_THRESHOLD:2e3,SMALL_ADJUSTMENT:5,MEDIUM_ADJUSTMENT:0,LARGE_ADJUSTMENT:-5,XLARGE_ADJUSTMENT:-10},n5=t=>{const{BASE_FOV:e,SMALL_WIDTH_THRESHOLD:n,MEDIUM_WIDTH_THRESHOLD:s,LARGE_WIDTH_THRESHOLD:i,SMALL_ADJUSTMENT:r,MEDIUM_ADJUSTMENT:o,LARGE_ADJUSTMENT:a,XLARGE_ADJUSTMENT:u}=t5;return t<=n?e+r:t<=s?e+o:t<=i?e+a:e+u},ol=t=>t*e5,s5=(t,e,n,s=0)=>{const i=Math.sqrt(t*t+e*e+n*n),r=1.2,a=50*Math.PI/180,h=Math.max(t,e,n)/2/Math.tan(a/2),d=i/2/Math.tan(a/2),p=Math.max(h,d),m=ol(p*r);return Math.max(8,Math.min(150,m))},i5=t=>[0,ol(t*.5),0],r5=(t="3D",e=[0,5,10])=>{const{spaceInfo:n}=Ct(),{placedModules:s}=be();return j.useMemo(()=>{const r=t==="2D",o=e,a=i5(n.height),u=n5(n.width);return{position:o,target:a,fov:u,is2DMode:r,spaceWidth:n.width,spaceHeight:n.height}},[t,n.height,n.width,n.depth,e,s.length])},o5=()=>{const t=j.useCallback(s=>{s.preventDefault()},[]),e=j.useCallback(s=>{s.preventDefault()},[]),n=j.useCallback(s=>{s.preventDefault()},[]);return{handleDrop:t,handleDragOver:e,handleDragLeave:n}},qt={NEAR_PLANE:.1,FAR_PLANE:1e3,MIN_DISTANCE:5,MAX_DISTANCE:200,POLAR_ANGLE_MIN:Math.PI/2-Math.PI/18,POLAR_ANGLE_MAX:Math.PI/2+Math.PI/18,AZIMUTH_ANGLE_MIN:-Math.PI/12,AZIMUTH_ANGLE_MAX:Math.PI/12},ia={BACKGROUND_COLOR:"#ffffff"},a5=(t,e="3D",n,s)=>{const[i,r]=j.useState(!1);j.useEffect(()=>{const u=p=>{p.altKey&&r(!0)},h=p=>{p.altKey||r(!1)};window.addEventListener("keydown",u),window.addEventListener("keyup",h);const d=()=>r(!1);return window.addEventListener("blur",d),()=>{window.removeEventListener("keydown",u),window.removeEventListener("keyup",h),window.removeEventListener("blur",d)}},[]);const o=j.useMemo(()=>{if(!n||!s)return{minDistance:qt.MIN_DISTANCE,maxDistance:qt.MAX_DISTANCE};const u=Math.max(n,s),h=_=>_*.01,d=qt.MIN_DISTANCE,p=h(u*8),m=Math.max(qt.MAX_DISTANCE,p);return{minDistance:d,maxDistance:m}},[n,s]);return j.useMemo(()=>{const u=e==="2D";return{enabled:!0,target:t,minPolarAngle:u?void 0:qt.POLAR_ANGLE_MIN,maxPolarAngle:u?void 0:qt.POLAR_ANGLE_MAX,minAzimuthAngle:u?void 0:qt.AZIMUTH_ANGLE_MIN,maxAzimuthAngle:u?void 0:qt.AZIMUTH_ANGLE_MAX,enablePan:!0,enableZoom:!0,enableRotate:!u,minDistance:o.minDistance,maxDistance:o.maxDistance,mouseButtons:{LEFT:i?yc.PAN:void 0,MIDDLE:yc.PAN,RIGHT:u?void 0:yc.ROTATE},touches:{ONE:void 0,TWO:Q1.PAN}}},[t,e,i,o])},wg=t=>{const e=["map","normalMap","bumpMap","displacementMap","specularMap","emissiveMap","metalnessMap","roughnessMap","aoMap","envMap"],n=t;e.forEach(s=>{const i=n[s];i instanceof J1&&i.dispose()}),t.dispose()},l5=()=>{const{gl:t,scene:e}=xh();return j.useEffect(()=>()=>{e.traverse(n=>{n instanceof Cm&&(n.geometry&&n.geometry.dispose(),n.material&&(Array.isArray(n.material)?n.material.forEach(s=>{wg(s)}):wg(n.material)))});try{t.dispose(),console.log("Three.js resources cleaned up")}catch(n){console.warn("Failed to clean up Three.js resources:",n)}console.log("Scene cleanup completed")},[e,t]),null};function c5(t){return t!==null&&typeof t=="object"&&"connect"in t&&"disconnect"in t}const u5=({children:t,cameraPosition:e,viewMode:n="3D",renderMode:s="wireframe"})=>{const[i,r]=j.useState(!1),[o,a]=j.useState(()=>`canvas-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),[u,h]=j.useState(0),d=j.useRef(null),p=j.useRef(null),m=j.useRef(null),_=r5(n,e),y=o5(),v=a5(_.target,n,_.spaceWidth,_.spaceHeight),w=j.useCallback(()=>{if(console.log("Force cleaning up WebGL context..."),p.current){try{p.current.dispose(),p.current.forceContextLoss()}catch(A){console.warn("Error disposing renderer:",A)}p.current=null}if(d.current){try{const A=d.current.getContext("webgl"),R=d.current.getContext("webgl2"),N=d.current.getContext("experimental-webgl");[A,R,N].forEach(M=>{if(M){const k=M.getExtension("WEBGL_lose_context");k&&k.loseContext()}}),d.current.width=1,d.current.height=1,d.current.style.display="none"}catch(A){console.warn("Error cleaning up canvas context:",A)}d.current.parentNode&&d.current.parentNode.removeChild(d.current),d.current=null}m.current&&m.current.querySelectorAll("canvas").forEach(R=>{try{const N=R.getContext("webgl")||R.getContext("webgl2");if(N){const M=N.getExtension("WEBGL_lose_context");M&&M.loseContext()}R.parentNode&&R.parentNode.removeChild(R)}catch(N){console.warn("Error cleaning up stray canvas:",N)}})},[]),b=j.useCallback(()=>{w();const A=Date.now(),R=Math.random().toString(36).substr(2,9),N=`canvas-${n}-${A}-${R}`;console.log("Regenerating canvas with key:",N),a(N),h(M=>M+1)},[n,w]);return j.useEffect(()=>(r(!0),()=>{r(!1),w()}),[w]),j.useEffect(()=>{i&&(console.log("ViewMode changed, regenerating canvas..."),b())},[n,i,b]),j.useEffect(()=>{const A=N=>{console.warn("WebGL context lost event triggered"),N.preventDefault(),b()},R=()=>{console.log("WebGL context restored")};if(d.current)return d.current.addEventListener("webglcontextlost",A),d.current.addEventListener("webglcontextrestored",R),()=>{d.current&&(d.current.removeEventListener("webglcontextlost",A),d.current.removeEventListener("webglcontextrestored",R))}},[b]),i?c.jsx("div",{ref:m,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,right:0,bottom:0,touchAction:"none"},onDrop:y.handleDrop,onDragOver:y.handleDragOver,onDragLeave:y.handleDragLeave,children:c.jsxs(B1,{shadows:!0,style:{background:ia.BACKGROUND_COLOR,cursor:"default",touchAction:"none"},dpr:[1,2],gl:{powerPreference:"high-performance",antialias:!0,alpha:!1,stencil:!0,depth:!0,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!1,logarithmicDepthBuffer:!0,precision:"highp"},onCreated:({gl:A,events:R,scene:N})=>{if(console.log("Canvas created with key:",o),d.current=A.domElement,p.current=A,A.setPixelRatio(Math.min(window.devicePixelRatio,2)),A.shadowMap.enabled=!0,A.shadowMap.type=Z1,A.shadowMap.autoUpdate=!0,A.shadowMap.needsUpdate=!0,A.capabilities.maxTextureSize=4096,A.setRenderTarget(null),A.clear(!0,!0,!0),A.toneMapping=ev,A.toneMappingExposure=1,A.outputColorSpace=tv,A.setClearColor(new nt(ia.BACKGROUND_COLOR),1),A.autoClear=!0,A.autoClearColor=!0,A.autoClearDepth=!0,A.autoClearStencil=!0,A.sortObjects=!0,A.localClippingEnabled=!0,A.domElement.style.display="block",A.domElement.setAttribute("data-canvas-key",o),N&&(N.background=new nt(ia.BACKGROUND_COLOR),N.fog=null,console.log("Scene environment setup - allowing Environment component to set scene.environment")),R&&c5(R))try{R.disconnect(),R.connect(A.domElement)}catch(M){console.warn("Error connecting events:",M)}console.log("Professional-grade canvas setup completed successfully")},onPointerMissed:()=>{console.log("Canvas pointer event working")},children:[c.jsx(l5,{}),_.is2DMode?c.jsx(U1,{makeDefault:!0,position:_.position,left:-_.spaceWidth*.01*.8,right:_.spaceWidth*.01*.8,top:_.spaceHeight*.01*.8,bottom:-_.spaceHeight*.01*.8,near:qt.NEAR_PLANE,far:qt.FAR_PLANE}):c.jsx($1,{makeDefault:!0,position:_.position,fov:_.fov,near:qt.NEAR_PLANE,far:qt.FAR_PLANE}),c.jsx(H1,{enabled:v.enabled,target:v.target,minPolarAngle:v.minPolarAngle,maxPolarAngle:v.maxPolarAngle,minAzimuthAngle:v.minAzimuthAngle,maxAzimuthAngle:v.maxAzimuthAngle,enablePan:v.enablePan,enableZoom:v.enableZoom,enableRotate:v.enableRotate,minDistance:v.minDistance,maxDistance:v.maxDistance,mouseButtons:v.mouseButtons,touches:v.touches,makeDefault:!0}),t]},`${o}-${u}`)}):c.jsx("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",background:ia.BACKGROUND_COLOR},children:c.jsx("p",{children:"Loading 3D viewer..."})})};class jn{static createCanvas(e=256,n=256){const s=document.createElement("canvas");s.width=e,s.height=n;const i=s.getContext("2d");return{canvas:s,context:i}}static createVerticalGradient(e,n,s){const i=e.createLinearGradient(0,0,0,n);return s.forEach(({position:r,color:o})=>{i.addColorStop(r,o)}),i}static createHorizontalGradient(e,n,s){const i=e.createLinearGradient(0,0,n,0);return s.forEach(({position:r,color:o})=>{i.addColorStop(r,o)}),i}static createWallGradientTexture(){const{canvas:e,context:n}=this.createCanvas(),s=this.createVerticalGradient(n,256,[{position:0,color:"#e0e0e0"},{position:.3,color:"#d8d8d8"},{position:.7,color:"#d0d0d0"},{position:1,color:"#c8c8c8"}]);return n.fillStyle=s,n.fillRect(0,0,256,256),new Ut(e)}static createOuterWallGradientTexture(){const{canvas:e,context:n}=this.createCanvas(),s=this.createVerticalGradient(n,256,[{position:0,color:"#f8f8f8"},{position:.3,color:"#f4f4f4"},{position:.7,color:"#f0f0f0"},{position:1,color:"#ececec"}]);return n.fillStyle=s,n.fillRect(0,0,256,256),new Ut(e)}static createFloorGradientTexture(){const{canvas:e,context:n}=this.createCanvas(),s=this.createHorizontalGradient(n,256,[{position:0,color:"#ffffff"},{position:.2,color:"#ffffff"},{position:.3,color:"#dddddd"},{position:.6,color:"#aaaaaa"},{position:1,color:"#888888"}]);return n.fillStyle=s,n.fillRect(0,0,256,256),new Ut(e)}static createDepthBasedWallGradientTexture(){const{canvas:e,context:n}=this.createCanvas(1024,512),s=this.createHorizontalGradient(n,1024,[{position:0,color:"#555555"},{position:.1,color:"#777777"},{position:.25,color:"#999999"},{position:.4,color:"#bbbbbb"},{position:.6,color:"#dddddd"},{position:.8,color:"#eeeeee"},{position:.95,color:"#f8f8f8"},{position:1,color:"#fafafa"}]);return n.fillStyle=s,n.fillRect(0,0,1024,512),new Ut(e)}static createDepthTransparencyTexture(){const{canvas:e,context:n}=this.createCanvas(512,256),s=this.createHorizontalGradient(n,512,[{position:0,color:"rgba(100, 100, 100, 1.0)"},{position:.3,color:"rgba(120, 120, 120, 0.8)"},{position:.5,color:"rgba(150, 150, 150, 0.6)"},{position:.7,color:"rgba(180, 180, 180, 0.4)"},{position:.85,color:"rgba(220, 220, 220, 0.2)"},{position:1,color:"rgba(250, 250, 250, 0.0)"}]);return n.fillStyle=s,n.fillRect(0,0,512,256),new Ut(e)}static createLeftWallDepthTransparencyTexture(){const{canvas:e,context:n}=this.createCanvas(512,256),s=this.createHorizontalGradient(n,512,[{position:0,color:"#ffffff"},{position:.3,color:"#e0e0e0"},{position:.6,color:"#999999"},{position:.8,color:"#666666"},{position:1,color:"#444444"}]);return n.fillStyle=s,n.fillRect(0,0,512,256),new Ut(e)}static createTopWallDepthTransparencyTexture(){const{canvas:e,context:n}=this.createCanvas(512,256),s=this.createVerticalGradient(n,256,[{position:0,color:"#ffffff"},{position:.3,color:"#e0e0e0"},{position:.6,color:"#999999"},{position:.8,color:"#666666"},{position:1,color:"#444444"}]);return n.fillStyle=s,n.fillRect(0,0,512,256),new Ut(e)}static createRightWallDepthTransparencyTexture(){const{canvas:e,context:n}=this.createCanvas(512,256),s=this.createHorizontalGradient(n,512,[{position:0,color:"#ffffff"},{position:.3,color:"#e0e0e0"},{position:.6,color:"#999999"},{position:.8,color:"#666666"},{position:1,color:"#444444"}]);return n.fillStyle=s,n.fillRect(0,0,512,256),new Ut(e)}static createSideFrameGradientTexture(){const{canvas:e,context:n}=this.createCanvas(),s=this.createVerticalGradient(n,256,[{position:0,color:"#f0f0f0"},{position:.2,color:"#e8e8e8"},{position:.5,color:"#e0e0e0"},{position:.8,color:"#d8d8d8"},{position:1,color:"#d0d0d0"}]);return n.fillStyle=s,n.fillRect(0,0,256,256),new Ut(e)}static createFrontToBackGradientTexture(){const{canvas:e,context:n}=this.createCanvas(),s=this.createHorizontalGradient(n,256,[{position:0,color:"#e8e8e8"},{position:.3,color:"#e0e0e0"},{position:.7,color:"#d8d8d8"},{position:1,color:"#d0d0d0"}]);return n.fillStyle=s,n.fillRect(0,0,256,256),new Ut(e)}static createHorizontalGradientTexture(){const{canvas:e,context:n}=this.createCanvas(),s=this.createHorizontalGradient(n,256,[{position:0,color:"#f0f0f0"},{position:.25,color:"#e8e8e8"},{position:.5,color:"#e0e0e0"},{position:.75,color:"#d8d8d8"},{position:1,color:"#d0d0d0"}]);return n.fillStyle=s,n.fillRect(0,0,256,256),new Ut(e)}static createLeftHorizontalGradientTexture(){const{canvas:e,context:n}=this.createCanvas(),s=this.createHorizontalGradient(n,256,[{position:0,color:"#d0d0d0"},{position:.25,color:"#d8d8d8"},{position:.5,color:"#e0e0e0"},{position:.75,color:"#e8e8e8"},{position:1,color:"#f0f0f0"}]);return n.fillStyle=s,n.fillRect(0,0,256,256),new Ut(e)}}class mt{static getCachedMaterial(e,n){return this.materialCache.has(e)||this.materialCache.set(e,n()),this.materialCache.get(e)}static optimizeTexture(e){e.wrapS=Of,e.wrapT=Of,e.magFilter=nv,e.minFilter=sv,e.generateMipmaps=!0}static createBasicMaterial(e,n={}){return this.optimizeTexture(e),new Dm({map:e,transparent:n.transparent||!1,opacity:n.opacity||1,side:n.side||iv,fog:n.fog!==void 0?n.fog:!1,...n.alphaTest&&{alphaTest:n.alphaTest},...n.emissive&&{emissive:n.emissive}})}static createWallMaterial(e="#e0e0e0"){return this.getCachedMaterial(`wall_${e}`,()=>{const n=jn.createWallGradientTexture();return new Qt({map:n,color:e,roughness:.9,metalness:0,side:vn,envMapIntensity:.3,bumpScale:.02,transparent:!1,opacity:1})})}static createOuterWallMaterial(){return this.getCachedMaterial("outerWall",()=>{const e=jn.createOuterWallGradientTexture();return new Qt({map:e,color:"#f8f8f8",roughness:.85,metalness:0,side:vn,envMapIntensity:.2,transparent:!1,opacity:1})})}static createFloorMaterial(){return this.getCachedMaterial("floor",()=>{const e=jn.createFloorGradientTexture();return this.createBasicMaterial(e)})}static createDepthBasedWallMaterial(){return this.getCachedMaterial("depthWall",()=>{const e=jn.createDepthBasedWallGradientTexture();return new Qt({map:e,transparent:!0,opacity:.95,side:vn,fog:!1,roughness:.8,metalness:0})})}static createDepthTransparencyMaterial(){return this.getCachedMaterial("depthTransparency",()=>{const e=jn.createDepthTransparencyTexture();return this.createBasicMaterial(e,{transparent:!0,opacity:1,side:vn,fog:!1,alphaTest:.01,emissive:new nt(.2,.2,.2)})})}static createDirectionalTransparencyMaterial(e){let n;switch(e){case"left":n=jn.createLeftWallDepthTransparencyTexture();break;case"top":n=jn.createTopWallDepthTransparencyTexture();break;case"right":n=jn.createRightWallDepthTransparencyTexture();break;default:n=jn.createDepthTransparencyTexture()}return this.optimizeTexture(n),new Qt({map:n,transparent:!1,opacity:1,side:vn,fog:!1,roughness:.8,metalness:0})}static createFlatMaterial(e="#ffffff"){return this.getCachedMaterial(`flat-${e}`,()=>new yu({color:new nt(e),transparent:!1,fog:!1}))}static createEdgeLineMaterial(e="#000000"){return this.getCachedMaterial(`edge-${e}`,()=>new rv({color:new nt(e),linewidth:1}))}static createSolidFrameMaterial(e="#d0d0d0"){const n=new nt(e);return new Qt({color:n,transparent:!1,metalness:0,roughness:.4,envMapIntensity:.6,emissive:n.clone().multiplyScalar(.015)})}static createSolidWallMaterial(e="#e8e8e8"){return this.getCachedMaterial(`solidWall-${e}`,()=>new Qt({color:new nt(e),roughness:.8,metalness:0,side:vn,transparent:!1,opacity:1}))}static createShaderGradientWallMaterial(e="horizontal"){const n=`
      varying vec2 vUv;
      varying vec3 vPosition;
      
      void main() {
        vUv = uv;
        vPosition = position;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,s=`
        uniform vec3 colorStart;
        uniform vec3 colorEnd;
        uniform float direction;
        uniform float reverse;
        
        varying vec2 vUv;
        varying vec3 vPosition;
        
        void main() {
          float gradientFactor;
          
          if (direction < 0.5) {
            // 수평 그라데이션 (0.0 = 왼쪽/앞쪽, 1.0 = 오른쪽/뒤쪽)
            gradientFactor = vUv.x;
          } else {
            // 수직 그라데이션 (0.0 = 아래/앞쪽, 1.0 = 위/뒤쪽)
            gradientFactor = vUv.y;
          }
          
          // reverse가 1.0이면 그라데이션 방향 반전
          if (reverse > 0.5) {
            gradientFactor = 1.0 - gradientFactor;
          }
          
          vec3 color = mix(colorStart, colorEnd, gradientFactor);
          gl_FragColor = vec4(color, 1.0);
        }
      `,i=e==="horizontal-reverse"||e==="vertical-reverse",r=e==="vertical"||e==="vertical-reverse"?1:0;return new Vf({vertexShader:n,fragmentShader:s,uniforms:{colorStart:{value:new nt("#ffffff")},colorEnd:{value:new nt("#d0d0d0")},direction:{value:r},reverse:{value:i?1:0}},side:vn,transparent:!1})}static createCornerShaderMaterial(){const e=`
      varying vec2 vUv;
      varying vec3 vPosition;
      varying vec3 vNormal;
      
      void main() {
        vUv = uv;
        vPosition = position;
        vNormal = normalMatrix * normal;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,n=`
      uniform vec3 centerColor;
      uniform vec3 edgeColor;
      uniform float intensity;
      
      varying vec2 vUv;
      varying vec3 vPosition;
      varying vec3 vNormal;
      
      void main() {
        // UV 좌표를 이용한 거리 계산 (중앙에서 가장자리로)
        vec2 center = vec2(0.5, 0.5);
        float distanceFromCenter = distance(vUv, center);
        
        // 0.0 (중앙)에서 0.707 (코너)까지의 거리를 0-1로 정규화
        float normalizedDistance = min(distanceFromCenter / 0.707, 1.0);
        
        // 강도 조절
        float gradientFactor = pow(normalizedDistance, intensity);
        
        vec3 color = mix(centerColor, edgeColor, gradientFactor);
        gl_FragColor = vec4(color, 1.0);
      }
    `;return new Vf({vertexShader:e,fragmentShader:n,uniforms:{centerColor:{value:new nt("#ffffff")},edgeColor:{value:new nt("#dddddd")},intensity:{value:1.5}},side:vn,transparent:!1})}static createEdgeShadowMaterial(){return new yu({color:"#888888",transparent:!0,opacity:.3,side:vn})}static clearCache(){this.materialCache.forEach(e=>{e.dispose()}),this.materialCache.clear()}static getGlobalEdgeLineMaterial(){return this.globalEdgeLineMaterial||(this.globalEdgeLineMaterial=this.createEdgeLineMaterial("#000000")),this.globalEdgeLineMaterial}}_c(mt,"materialCache",new Map),_c(mt,"globalEdgeLineMaterial",null);const xe=()=>{const t=j.useContext(xy);if(!t)throw new Error("useSpace3DView must be used within a Space3DViewProvider");return t},Yu=(t,e,n,s,i,r)=>{var o;try{const a=n.getBoundingClientRect(),u=new ov;u.x=(t-a.left)/a.width*2-1,u.y=-((e-a.top)/a.height)*2+1;const h=new av;h.setFromCamera(u,s);const d=[];i.traverse(m=>{var _;((_=m.userData)==null?void 0:_.type)==="slot-collider"&&d.push(m)});const p=h.intersectObjects(d);if(p.length>0){const _=(o=p[0].object.userData)==null?void 0:o.slotIndex,y=ft(r);if(typeof _=="number"&&_>=0&&_<y.columnCount)return _}return null}catch(a){return console.error("Slot raycast detection error:",a),null}},Oa=(t,e)=>{const n=dt(e),s=ft(e),i=Dt(t,n,e);return i?Math.abs(i.dimensions.width-s.columnWidth*2)<50:!1},h5=t=>{const e=dt(t),n=ft(t),s=i=>i*.01;return{width:s(n.columnWidth)-1,height:s(e.height),depth:s(e.depth)+1}},d5=t=>{var i;const e=r=>r*.01,n=t.hasFloorFinish&&t.floorFinish?t.floorFinish.height:0,s=((i=t.baseConfig)==null?void 0:i.height)||0;if(!t.baseConfig||t.baseConfig.type==="floor")return e(n+s);if(t.baseConfig.type==="stand")if(t.baseConfig.placementType==="float"){const r=t.baseConfig.floatHeight||0;return e(n+r)}else return e(n);else return e(n)},f5=(t,e,n)=>{const s=ft(n);return Oa(e,n)?s.threeUnitDualPositions&&s.threeUnitDualPositions[t]!==void 0?s.threeUnitDualPositions[t]:(console.error("Dual position not available for slot:",t),null):s.threeUnitPositions[t]},p5=({spaceInfo:t})=>{const e=be(_=>_.placedModules),n=be(_=>_.moveModule),s=be(_=>_.setFurniturePlacementMode),[i,r]=j.useState(null),o=j.useRef(!1),{camera:a,scene:u}=xh(),h=dt(t),d=(_,y)=>{if(console.log("🖱️ 드래그 시작:",y,"button:",_.button),_.button!==0){console.log("❌ 왼쪽 버튼이 아님, 드래그 취소");return}_.stopPropagation(),r(y),o.current=!0,console.log("✅ 드래그 상태 설정 완료:",{draggingModuleId:y,isDragging:o.current}),s(!0);const v=_.target;v&&v.setPointerCapture&&(v.setPointerCapture(_.pointerId),console.log("📌 포인터 캡처 설정")),document.body.style.cursor="grabbing"},p=_=>{if(!o.current||!i)return;const y=_.nativeEvent.target;let v=Yu(_.nativeEvent.clientX,_.nativeEvent.clientY,y,a,u,t);if(console.log("🎯 드래그 중 레이캐스팅:",{mouseX:_.nativeEvent.clientX,mouseY:_.nativeEvent.clientY,detectedSlot:v}),v!==null){console.log("✅ 슬롯 감지됨:",v);const w=e.find(k=>k.id===i);if(!w)return;const b=Dt(w.moduleId,h,t);if(!b)return;const A=ft(t),R=A.columnWidth,N=Math.abs(b.dimensions.width-R*2)<50;if(!ao(v,N,e,t,i)){let k=Bi(v,"right",N,e,t,i);if(k===null&&(k=Bi(v,"left",N,e,t,i)),k!==null)v=k;else return}let M;if(N)if(A.threeUnitDualPositions&&A.threeUnitDualPositions[v]!==void 0)M=A.threeUnitDualPositions[v];else return;else M=A.threeUnitPositions[v];console.log("📍 가구 이동:",{slotIndex:v,finalX:M,currentX:w.position.x,isDualFurniture:N}),n(i,{x:M,y:w.position.y,z:w.position.z})}else console.log("❌ 슬롯 감지 실패")},m=()=>{o.current&&(o.current=!1,r(null),s(!1))};return{draggingModuleId:i,isDragging:o.current,handlePointerDown:d,handlePointerMove:p,handlePointerUp:m}},g5=()=>{const t=be(h=>h.editMode),e=be(h=>h.editingModuleId),n=be(h=>h.setEditMode),s=be(h=>h.setEditingModuleId),i=be(h=>h.removeModule),[r,o]=j.useState(!1),a=j.useRef(!1);return{dragMode:r,setDragMode:o,editMode:t,setEditMode:n,editingModuleId:e,setEditingModuleId:s,handleFurnitureClick:(h,d)=>{a.current||(h.stopPropagation(),r?(i(d),o(!1)):(n(!0),s(d)))},isDragging:a}},m5=({spaceInfo:t})=>{const e=be(d=>d.placedModules),n=be(d=>d.removeModule),s=be(d=>d.moveModule),i=be(d=>d.editMode),r=be(d=>d.editingModuleId),o=be(d=>d.setEditMode),a=be(d=>d.setEditingModuleId),u=dt(t),h=ft(t);j.useEffect(()=>{const d=p=>{if(!i||!r)return;const m=e.find(b=>b.id===r);if(!m)return;const _=Dt(m.moduleId,u,t);if(!_)return;const y=h.columnWidth,v=Math.abs(_.dimensions.width-y*2)<50;let w=-1;if(v?h.threeUnitDualPositions&&(w=h.threeUnitDualPositions.findIndex(b=>Math.abs(b-m.position.x)<.1)):w=h.threeUnitPositions.findIndex(b=>Math.abs(b-m.position.x)<.1),w!==-1)switch(p.key){case"Delete":case"Backspace":n(r),o(!1),a(null),p.preventDefault();break;case"ArrowLeft":{const b=Bi(w,"left",v,e,t,r);if(b!==null){let A;v&&h.threeUnitDualPositions?A=h.threeUnitDualPositions[b]:A=h.threeUnitPositions[b],s(r,{...m.position,x:A})}p.preventDefault();break}case"ArrowRight":{const b=Bi(w,"right",v,e,t,r);if(b!==null){let A;v&&h.threeUnitDualPositions?A=h.threeUnitDualPositions[b]:A=h.threeUnitPositions[b],s(r,{...m.position,x:A})}p.preventDefault();break}case"Escape":o(!1),a(null),p.preventDefault();break;case"Enter":o(!1),a(null),p.preventDefault();break}};if(i)return document.addEventListener("keydown",d),()=>{document.removeEventListener("keydown",d)}},[i,r,e,h,n,s,u,t,o,a])},_5=9,Ln=t=>t*.01,is=(t,e={})=>{const{color:n,internalHeight:s,customDepth:i,isDragging:r=!1}=e,{spaceInfo:o}=Ct(),a=o.materialConfig||{interiorColor:"#FFFFFF",doorColor:"#FFFFFF"},u=t.modelConfig||{basicThickness:18,hasOpenFront:!0,hasShelf:!1,shelfCount:0},h=Ln(u.basicThickness||18),d=Ln(_5),p=Ln(t.dimensions.width),m=Ln(s||t.dimensions.height),_=i||t.dimensions.depth,y=Ln(_),v=p-h*2,w=m-h*2,b=y-Ln(8),A=Ln(4),R=new Pm({color:new nt(n||a.interiorColor),clearcoat:.1,clearcoatRoughness:.8,metalness:0,roughness:.7,reflectivity:.2,transparent:r,opacity:r?.4:1}),N=n||a.doorColor,M=(T,E)=>{switch(T.heightType||"percentage"){case"absolute":{const D=Ln(T.height);return Math.min(D,E)}case"percentage":default:return E*(T.height/100)}};return{material:R,doorColor:N,width:p,height:m,depth:y,innerWidth:v,innerHeight:w,actualDepthMm:_,basicThickness:h,backPanelThickness:d,adjustedDepthForShelves:b,shelfZOffset:A,calculateSectionHeight:M,isMultiSectionFurniture:()=>{const{sections:T}=u;return!!(T&&T.length>=2)},getSectionHeights:()=>{const{sections:T}=u;if(!T||T.length===0)return[];const E=m-h*2,D=T.filter(I=>I.heightType==="absolute").reduce((I,$)=>I+M($,E),0),P=E-D;return T.map(I=>I.heightType==="absolute"?M(I,E):M(I,P))},mmToThreeUnits:Ln,modelConfig:u}},ds=({args:t,position:e,material:n,renderMode:s,isInternalSurface:i=!1})=>{const r=j.useMemo(()=>new oi(...t),[t]),o=j.useMemo(()=>new Sh(r),[r]),a=j.useMemo(()=>{if(i&&n instanceof Qt){const u=n.clone();return u.emissive=new nt(0),u.roughness=.8,u.envMapIntensity=0,u}return n},[n,i]);return c.jsxs("group",{position:e,children:[s==="solid"&&c.jsx("mesh",{geometry:r,receiveShadow:!0,castShadow:!0,children:c.jsx("primitive",{object:a})}),c.jsx("lineSegments",{geometry:o,children:c.jsx("lineBasicMaterial",{color:"#888888",linewidth:1})})]})},ui=({width:t,height:e,depth:n,innerWidth:s,innerHeight:i,basicThickness:r,backPanelThickness:o,adjustedDepthForShelves:a,shelfZOffset:u,material:h,isMultiSectionFurniture:d,getSectionHeights:p,mmToThreeUnits:m,children:_})=>{const{renderMode:y}=xe();return c.jsxs("group",{children:[d()?c.jsx(c.Fragment,{children:p().map((v,w)=>{let b=-e/2+r;for(let R=0;R<w;R++)b+=p()[R];const A=b+v/2-r;return c.jsxs(Je.Fragment,{children:[c.jsx(ds,{args:[r,v,n],position:[-t/2+r/2,A,0],material:h,renderMode:y}),c.jsx(ds,{args:[r,v,n],position:[t/2-r/2,A,0],material:h,renderMode:y}),w<p().length-1&&c.jsx(ds,{args:[s,r,a-r],position:[0,A+v/2+r/2,r/2+u],material:h,renderMode:y})]},`side-panels-${w}`)})}):c.jsxs(c.Fragment,{children:[c.jsx(ds,{args:[r,e,n],position:[-t/2+r/2,0,0],material:h,renderMode:y}),c.jsx(ds,{args:[r,e,n],position:[t/2-r/2,0,0],material:h,renderMode:y})]}),c.jsx(ds,{args:[s,r,n],position:[0,e/2-r/2,0],material:h,renderMode:y,isInternalSurface:!0}),c.jsx(ds,{args:[s,r,n],position:[0,-e/2+r/2,0],material:h,renderMode:y,isInternalSurface:!0}),c.jsx(ds,{args:[s+m(10),i+m(10),o],position:[0,0,-n/2+o/2+m(17)],material:h,renderMode:y,isInternalSurface:!0}),_]})},Mc=({args:t,position:e,material:n,renderMode:s})=>{const r=(o=>{if(o instanceof Qt){const a=o.clone();return a.roughness=.6,a.envMapIntensity=0,a.emissive=new nt(0),a}return n})(n);return c.jsxs("group",{position:e,children:[s==="solid"&&c.jsxs("mesh",{receiveShadow:!0,castShadow:!0,children:[c.jsx("boxGeometry",{args:t}),c.jsx("primitive",{object:r})]}),c.jsxs("lineSegments",{children:[c.jsx("edgesGeometry",{args:[new oi(...t)]}),c.jsx("lineBasicMaterial",{color:"#888888",linewidth:1})]})]})},Ii=({shelfCount:t,innerWidth:e,innerHeight:n,depth:s,basicThickness:i,material:r,yOffset:o=0,zOffset:a=0,shelfPositions:u,isTopFinishPanel:h,renderMode:d})=>{if(t<=0)return null;const p=_=>_*.01;if(h&&t===1){const _=n/2-i/2;return c.jsx("group",{position:[0,o,0],children:c.jsx(Mc,{args:[e,i,s-i],position:[0,_,i/2+a],material:r,renderMode:d})})}if(u&&u.length===t)return c.jsx("group",{position:[0,o,0],children:u.map((_,y)=>{const v=-n/2+p(_);return c.jsx(Mc,{args:[e,i,s-i],position:[0,v,i/2+a],material:r,renderMode:d},`shelf-${y}`)})});const m=n/(t+1);return c.jsx("group",{position:[0,o,0],children:Array.from({length:t},(_,y)=>{const v=-n/2+m*(y+1);return c.jsx(Mc,{args:[e,i,s-i],position:[0,v,i/2+a],material:r,renderMode:d},`shelf-${y}`)})})},yi=({args:t,position:e,material:n,renderMode:s})=>{const r=(o=>{if(o instanceof Qt){const a=o.clone();return a.roughness=.6,a.envMapIntensity=0,a.emissive=new nt(0),a}return n})(n);return c.jsxs("group",{position:e,children:[s==="solid"&&c.jsxs("mesh",{receiveShadow:!0,castShadow:!0,children:[c.jsx("boxGeometry",{args:t}),c.jsx("primitive",{object:r})]}),c.jsxs("lineSegments",{children:[c.jsx("edgesGeometry",{args:[new oi(...t)]}),c.jsx("lineBasicMaterial",{color:"#888888",linewidth:1})]})]})},Ad=({drawerCount:t,innerWidth:e,innerHeight:n,depth:s,basicThickness:i,yOffset:r=0,drawerHeights:o,gapHeight:a=0,material:u,renderMode:h})=>{if(t<=0)return null;const d=y=>y*.01,p=d(0),m=d(20),_=(y,v,w,b,A)=>{const[R,N,M]=b,k=w-d(47),x=k-m,T=M-m/2;return c.jsxs("group",{children:[c.jsx(yi,{args:[y-d(76)-d(26),d(5),x-d(26)],position:[R,N-v/2+i+d(15)+d(5)/2,T],material:u,renderMode:h}),c.jsx(yi,{args:[y-d(76),v-d(30),i],position:[R,N,T+x/2-i/2],material:u,renderMode:h}),c.jsx(yi,{args:[y-d(76),v-d(30),i],position:[R,N,T-x/2+i/2],material:u,renderMode:h}),c.jsx(yi,{args:[i,v-d(30),x-i*2],position:[R-y/2+i/2+d(38),N,T],material:u,renderMode:h}),c.jsx(yi,{args:[i,v-d(30),x-i*2],position:[R+y/2-i/2-d(38),N,T],material:u,renderMode:h}),c.jsx(yi,{args:[y,v,m],position:[R,N,M+k/2-m/2],material:u,renderMode:h})]},A)};if(o&&o.length===t&&a>0){let y=-n/2;return y+=d(a),c.jsx("group",{position:[0,r,p],children:o.map((v,w)=>{const b=y+d(v)/2,A=_(e-d(24),d(v)-i/2,s-i,[0,b,i/2],`custom-drawer-${w}`);return y+=d(v+a),A})})}else{const y=n/t;return c.jsx("group",{position:[0,r,p],children:Array.from({length:t},(v,w)=>{const b=-n/2+(w+.5)*y;return _(e-d(24),y-i/2,s-i,[0,b,i/2],`drawer-${w}`)})})}},hi=({modelConfig:t,height:e,innerWidth:n,depth:s,adjustedDepthForShelves:i,basicThickness:r,shelfZOffset:o,material:a,renderMode:u,calculateSectionHeight:h})=>{const d=()=>{const{sections:p}=t;if(!p||p.length===0)return null;const m=e-r*2,y=p.filter(A=>A.heightType==="absolute").reduce((A,R)=>A+h(R,m),0),v=m-y,w=p.map(A=>({...A,calculatedHeight:A.heightType==="absolute"?h(A,m):h(A,v)}));let b=-e/2+r;return w.map((A,R)=>{const N=A.calculatedHeight,M=b+N/2;let k=null;switch(A.type){case"shelf":A.count&&A.count>0&&(k=c.jsx(Ii,{shelfCount:A.count,innerWidth:n,innerHeight:N,depth:i,basicThickness:r,material:a,yOffset:M,zOffset:o,shelfPositions:A.shelfPositions,isTopFinishPanel:A.isTopFinishPanel,renderMode:u}));break;case"hanging":A.count&&A.count>0&&(k=c.jsx(Ii,{shelfCount:A.count,innerWidth:n,innerHeight:N,depth:i,basicThickness:r,material:a,yOffset:M,zOffset:o,shelfPositions:A.shelfPositions,isTopFinishPanel:A.isTopFinishPanel,renderMode:u}));break;case"drawer":A.count&&A.count>0&&(k=c.jsx(Ad,{drawerCount:A.count,innerWidth:n,innerHeight:N,depth:s,basicThickness:r,yOffset:M,drawerHeights:A.drawerHeights,gapHeight:A.gapHeight,material:a,renderMode:u}));break}return b+=N,c.jsx("group",{children:k},`section-${R}`)})};return c.jsx(c.Fragment,{children:d()})};var Id=Mo(),ue=t=>No(t,Id),xd=Mo();ue.write=t=>No(t,xd);var Gl=Mo();ue.onStart=t=>No(t,Gl);var Sd=Mo();ue.onFrame=t=>No(t,Sd);var bd=Mo();ue.onFinish=t=>No(t,bd);var Pi=[];ue.setTimeout=(t,e)=>{const n=ue.now()+e,s=()=>{const r=Pi.findIndex(o=>o.cancel==s);~r&&Pi.splice(r,1),vs-=~r?1:0},i={time:n,handler:t,cancel:s};return Pi.splice(Sy(n),0,i),vs+=1,by(),i};var Sy=t=>~(~Pi.findIndex(e=>e.time>t)||~Pi.length);ue.cancel=t=>{Gl.delete(t),Sd.delete(t),bd.delete(t),Id.delete(t),xd.delete(t)};ue.sync=t=>{zu=!0,ue.batchedUpdates(t),zu=!1};ue.throttle=t=>{let e;function n(){try{t(...e)}finally{e=null}}function s(...i){e=i,ue.onStart(n)}return s.handler=t,s.cancel=()=>{Gl.delete(n),e=null},s};var Cd=typeof window<"u"?window.requestAnimationFrame:()=>{};ue.use=t=>Cd=t;ue.now=typeof performance<"u"?()=>performance.now():Date.now;ue.batchedUpdates=t=>t();ue.catch=console.error;ue.frameLoop="always";ue.advance=()=>{ue.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):Dy()};var ys=-1,vs=0,zu=!1;function No(t,e){zu?(e.delete(t),t(0)):(e.add(t),by())}function by(){ys<0&&(ys=0,ue.frameLoop!=="demand"&&Cd(Cy))}function y5(){ys=-1}function Cy(){~ys&&(Cd(Cy),ue.batchedUpdates(Dy))}function Dy(){const t=ys;ys=ue.now();const e=Sy(ys);if(e&&(Py(Pi.splice(0,e),n=>n.handler()),vs-=e),!vs){y5();return}Gl.flush(),Id.flush(t?Math.min(64,ys-t):16.667),Sd.flush(),xd.flush(),bd.flush()}function Mo(){let t=new Set,e=t;return{add(n){vs+=e==t&&!t.has(n)?1:0,t.add(n)},delete(n){return vs-=e==t&&t.has(n)?1:0,t.delete(n)},flush(n){e.size&&(t=new Set,vs-=e.size,Py(e,s=>s(n)&&t.add(s)),vs+=t.size,e=t)}}}function Py(t,e){t.forEach(n=>{try{e(n)}catch(s){ue.catch(s)}})}var v5=Object.defineProperty,w5=(t,e)=>{for(var n in e)v5(t,n,{get:e[n],enumerable:!0})},fn={};w5(fn,{assign:()=>E5,colors:()=>xs,createStringInterpolator:()=>Pd,skipAnimation:()=>Ny,to:()=>Ry,willAdvance:()=>Rd});function qu(){}var T5=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),G={arr:Array.isArray,obj:t=>!!t&&t.constructor.name==="Object",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",und:t=>t===void 0};function $n(t,e){if(G.arr(t)){if(!G.arr(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return t===e}var Re=(t,e)=>t.forEach(e);function es(t,e,n){if(G.arr(t)){for(let s=0;s<t.length;s++)e.call(n,t[s],`${s}`);return}for(const s in t)t.hasOwnProperty(s)&&e.call(n,t[s],s)}var tn=t=>G.und(t)?[]:G.arr(t)?t:[t];function Xr(t,e){if(t.size){const n=Array.from(t);t.clear(),Re(n,e)}}var jr=(t,...e)=>Xr(t,n=>n(...e)),Dd=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Pd,Ry,xs=null,Ny=!1,Rd=qu,E5=t=>{t.to&&(Ry=t.to),t.now&&(ue.now=t.now),t.colors!==void 0&&(xs=t.colors),t.skipAnimation!=null&&(Ny=t.skipAnimation),t.createStringInterpolator&&(Pd=t.createStringInterpolator),t.requestAnimationFrame&&ue.use(t.requestAnimationFrame),t.batchedUpdates&&(ue.batchedUpdates=t.batchedUpdates),t.willAdvance&&(Rd=t.willAdvance),t.frameLoop&&(ue.frameLoop=t.frameLoop)},Gr=new Set,en=[],jc=[],al=0,Yl={get idle(){return!Gr.size&&!en.length},start(t){al>t.priority?(Gr.add(t),ue.onStart(A5)):(My(t),ue(Ku))},advance:Ku,sort(t){if(al)ue.onFrame(()=>Yl.sort(t));else{const e=en.indexOf(t);~e&&(en.splice(e,1),jy(t))}},clear(){en=[],Gr.clear()}};function A5(){Gr.forEach(My),Gr.clear(),ue(Ku)}function My(t){en.includes(t)||jy(t)}function jy(t){en.splice(I5(en,e=>e.priority>t.priority),0,t)}function Ku(t){const e=jc;for(let n=0;n<en.length;n++){const s=en[n];al=s.priority,s.idle||(Rd(s),s.advance(t),s.idle||e.push(s))}return al=0,jc=en,jc.length=0,en=e,en.length>0}function I5(t,e){const n=t.findIndex(e);return n<0?t.length:n}var x5={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},ln="[-+]?\\d*\\.?\\d+",ll=ln+"%";function zl(...t){return"\\(\\s*("+t.join(")\\s*,\\s*(")+")\\s*\\)"}var S5=new RegExp("rgb"+zl(ln,ln,ln)),b5=new RegExp("rgba"+zl(ln,ln,ln,ln)),C5=new RegExp("hsl"+zl(ln,ll,ll)),D5=new RegExp("hsla"+zl(ln,ll,ll,ln)),P5=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,R5=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,N5=/^#([0-9a-fA-F]{6})$/,M5=/^#([0-9a-fA-F]{8})$/;function j5(t){let e;return typeof t=="number"?t>>>0===t&&t>=0&&t<=4294967295?t:null:(e=N5.exec(t))?parseInt(e[1]+"ff",16)>>>0:xs&&xs[t]!==void 0?xs[t]:(e=S5.exec(t))?(vi(e[1])<<24|vi(e[2])<<16|vi(e[3])<<8|255)>>>0:(e=b5.exec(t))?(vi(e[1])<<24|vi(e[2])<<16|vi(e[3])<<8|Ag(e[4]))>>>0:(e=P5.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=M5.exec(t))?parseInt(e[1],16)>>>0:(e=R5.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=C5.exec(t))?(Tg(Eg(e[1]),ra(e[2]),ra(e[3]))|255)>>>0:(e=D5.exec(t))?(Tg(Eg(e[1]),ra(e[2]),ra(e[3]))|Ag(e[4]))>>>0:null}function Lc(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function Tg(t,e,n){const s=n<.5?n*(1+e):n+e-n*e,i=2*n-s,r=Lc(i,s,t+1/3),o=Lc(i,s,t),a=Lc(i,s,t-1/3);return Math.round(r*255)<<24|Math.round(o*255)<<16|Math.round(a*255)<<8}function vi(t){const e=parseInt(t,10);return e<0?0:e>255?255:e}function Eg(t){return(parseFloat(t)%360+360)%360/360}function Ag(t){const e=parseFloat(t);return e<0?0:e>1?255:Math.round(e*255)}function ra(t){const e=parseFloat(t);return e<0?0:e>100?1:e/100}function Ig(t){let e=j5(t);if(e===null)return t;e=e||0;const n=(e&4278190080)>>>24,s=(e&16711680)>>>16,i=(e&65280)>>>8,r=(e&255)/255;return`rgba(${n}, ${s}, ${i}, ${r})`}var lo=(t,e,n)=>{if(G.fun(t))return t;if(G.arr(t))return lo({range:t,output:e,extrapolate:n});if(G.str(t.output[0]))return Pd(t);const s=t,i=s.output,r=s.range||[0,1],o=s.extrapolateLeft||s.extrapolate||"extend",a=s.extrapolateRight||s.extrapolate||"extend",u=s.easing||(h=>h);return h=>{const d=k5(h,r);return L5(h,r[d],r[d+1],i[d],i[d+1],u,o,a,s.map)}};function L5(t,e,n,s,i,r,o,a,u){let h=u?u(t):t;if(h<e){if(o==="identity")return h;o==="clamp"&&(h=e)}if(h>n){if(a==="identity")return h;a==="clamp"&&(h=n)}return s===i?s:e===n?t<=e?s:i:(e===-1/0?h=-h:n===1/0?h=h-e:h=(h-e)/(n-e),h=r(h),s===-1/0?h=-h:i===1/0?h=h+s:h=h*(i-s)+s,h)}function k5(t,e){for(var n=1;n<e.length-1&&!(e[n]>=t);++n);return n-1}var F5={linear:t=>t},co=Symbol.for("FluidValue.get"),Ui=Symbol.for("FluidValue.observers"),En=t=>!!(t&&t[co]),Kt=t=>t&&t[co]?t[co]():t,xg=t=>t[Ui]||null;function O5(t,e){t.eventObserved?t.eventObserved(e):t(e)}function cl(t,e){const n=t[Ui];n&&n.forEach(s=>{O5(s,e)})}var V5=class{constructor(t){if(!t&&!(t=this.get))throw Error("Unknown getter");B5(this,t)}},B5=(t,e)=>Ly(t,co,e);function jo(t,e){if(t[co]){let n=t[Ui];n||Ly(t,Ui,n=new Set),n.has(e)||(n.add(e),t.observerAdded&&t.observerAdded(n.size,e))}return e}function ul(t,e){const n=t[Ui];if(n&&n.has(e)){const s=n.size-1;s?n.delete(e):t[Ui]=null,t.observerRemoved&&t.observerRemoved(s,e)}}var Ly=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),Va=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,U5=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,Sg=new RegExp(`(${Va.source})(%|[a-z]+)`,"i"),$5=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,ql=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,ky=t=>{const[e,n]=H5(t);if(!e||Dd())return t;const s=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(s)return s.trim();if(n&&n.startsWith("--")){const i=window.getComputedStyle(document.documentElement).getPropertyValue(n);return i||t}else{if(n&&ql.test(n))return ky(n);if(n)return n}return t},H5=t=>{const e=ql.exec(t);if(!e)return[,];const[,n,s]=e;return[n,s]},kc,W5=(t,e,n,s,i)=>`rgba(${Math.round(e)}, ${Math.round(n)}, ${Math.round(s)}, ${i})`,Fy=t=>{kc||(kc=xs?new RegExp(`(${Object.keys(xs).join("|")})(?!\\w)`,"g"):/^\b$/);const e=t.output.map(r=>Kt(r).replace(ql,ky).replace(U5,Ig).replace(kc,Ig)),n=e.map(r=>r.match(Va).map(Number)),i=n[0].map((r,o)=>n.map(a=>{if(!(o in a))throw Error('The arity of each "output" value must be equal');return a[o]})).map(r=>lo({...t,output:r}));return r=>{var u;const o=!Sg.test(e[0])&&((u=e.find(h=>Sg.test(h)))==null?void 0:u.replace(Va,""));let a=0;return e[0].replace(Va,()=>`${i[a++](r)}${o||""}`).replace($5,W5)}},Nd="react-spring: ",Oy=t=>{const e=t;let n=!1;if(typeof e!="function")throw new TypeError(`${Nd}once requires a function parameter`);return(...s)=>{n||(e(...s),n=!0)}},X5=Oy(console.warn);function G5(){X5(`${Nd}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var Y5=Oy(console.warn);function z5(){Y5(`${Nd}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function Kl(t){return G.str(t)&&(t[0]=="#"||/\d/.test(t)||!Dd()&&ql.test(t)||t in(xs||{}))}var Md=Dd()?j.useEffect:j.useLayoutEffect,q5=()=>{const t=j.useRef(!1);return Md(()=>(t.current=!0,()=>{t.current=!1}),[]),t};function Vy(){const t=j.useState()[1],e=q5();return()=>{e.current&&t(Math.random())}}var By=t=>j.useEffect(t,K5),K5=[];function bg(t){const e=j.useRef(void 0);return j.useEffect(()=>{e.current=t}),e.current}var uo=Symbol.for("Animated:node"),Q5=t=>!!t&&t[uo]===t,Tn=t=>t&&t[uo],jd=(t,e)=>T5(t,uo,e),Ql=t=>t&&t[uo]&&t[uo].getPayload(),Uy=class{constructor(){jd(this,this)}getPayload(){return this.payload||[]}},Jl=class $y extends Uy{constructor(e){super(),this._value=e,this.done=!0,this.durationProgress=0,G.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new $y(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,n){return G.num(e)&&(this.lastPosition=e,n&&(e=Math.round(e/n)*n,this.done&&(this.lastPosition=e))),this._value===e?!1:(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,G.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}},hl=class Hy extends Jl{constructor(e){super(0),this._string=null,this._toString=lo({output:[e,e]})}static create(e){return new Hy(e)}getValue(){const e=this._string;return e??(this._string=this._toString(this._value))}setValue(e){if(G.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else if(super.setValue(e))this._string=null;else return!1;return!0}reset(e){e&&(this._toString=lo({output:[this.getValue(),e]})),this._value=0,super.reset()}},dl={dependencies:null},Ld=class extends Uy{constructor(t){super(),this.source=t,this.setValue(t)}getValue(t){const e={};return es(this.source,(n,s)=>{Q5(n)?e[s]=n.getValue(t):En(n)?e[s]=Kt(n):t||(e[s]=n)}),e}setValue(t){this.source=t,this.payload=this._makePayload(t)}reset(){this.payload&&Re(this.payload,t=>t.reset())}_makePayload(t){if(t){const e=new Set;return es(t,this._addToPayload,e),Array.from(e)}}_addToPayload(t){dl.dependencies&&En(t)&&dl.dependencies.add(t);const e=Ql(t);e&&Re(e,n=>this.add(n))}},J5=class Wy extends Ld{constructor(e){super(e)}static create(e){return new Wy(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){const n=this.getPayload();return e.length==n.length?n.map((s,i)=>s.setValue(e[i])).some(Boolean):(super.setValue(e.map(Z5)),!0)}};function Z5(t){return(Kl(t)?hl:Jl).create(t)}function Qu(t){const e=Tn(t);return e?e.constructor:G.arr(t)?J5:Kl(t)?hl:Jl}var Cg=(t,e)=>{const n=!G.fun(t)||t.prototype&&t.prototype.isReactComponent;return j.forwardRef((s,i)=>{const r=j.useRef(null),o=n&&j.useCallback(y=>{r.current=n4(i,y)},[i]),[a,u]=t4(s,e),h=Vy(),d=()=>{const y=r.current;if(n&&!y)return;(y?e.applyAnimatedValues(y,a.getValue(!0)):!1)===!1&&h()},p=new e4(d,u),m=j.useRef(void 0);Md(()=>(m.current=p,Re(u,y=>jo(y,p)),()=>{m.current&&(Re(m.current.deps,y=>ul(y,m.current)),ue.cancel(m.current.update))})),j.useEffect(d,[]),By(()=>()=>{const y=m.current;Re(y.deps,v=>ul(v,y))});const _=e.getComponentProps(a.getValue());return j.createElement(t,{..._,ref:o})})},e4=class{constructor(t,e){this.update=t,this.deps=e}eventObserved(t){t.type=="change"&&ue.write(this.update)}};function t4(t,e){const n=new Set;return dl.dependencies=n,t.style&&(t={...t,style:e.createAnimatedStyle(t.style)}),t=new Ld(t),dl.dependencies=null,[t,n]}function n4(t,e){return t&&(G.fun(t)?t(e):t.current=e),e}var Dg=Symbol.for("AnimatedComponent"),s4=(t,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:n=i=>new Ld(i),getComponentProps:s=i=>i}={})=>{const i={applyAnimatedValues:e,createAnimatedStyle:n,getComponentProps:s},r=o=>{const a=Pg(o)||"Anonymous";return G.str(o)?o=r[o]||(r[o]=Cg(o,i)):o=o[Dg]||(o[Dg]=Cg(o,i)),o.displayName=`Animated(${a})`,o};return es(t,(o,a)=>{G.arr(t)&&(a=Pg(o)),r[a]=r(o)}),{animated:r}},Pg=t=>G.str(t)?t:t&&G.str(t.displayName)?t.displayName:G.fun(t)&&t.name||null;function qs(t,...e){return G.fun(t)?t(...e):t}var Yr=(t,e)=>t===!0||!!(e&&t&&(G.fun(t)?t(e):tn(t).includes(e))),Xy=(t,e)=>G.obj(t)?e&&t[e]:t,Gy=(t,e)=>t.default===!0?t[e]:t.default?t.default[e]:void 0,i4=t=>t,kd=(t,e=i4)=>{let n=r4;t.default&&t.default!==!0&&(t=t.default,n=Object.keys(t));const s={};for(const i of n){const r=e(t[i],i);G.und(r)||(s[i]=r)}return s},r4=["config","onProps","onStart","onChange","onPause","onResume","onRest"],o4={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function a4(t){const e={};let n=0;if(es(t,(s,i)=>{o4[i]||(e[i]=s,n++)}),n)return e}function Yy(t){const e=a4(t);if(e){const n={to:e};return es(t,(s,i)=>i in e||(n[i]=s)),n}return{...t}}function ho(t){return t=Kt(t),G.arr(t)?t.map(ho):Kl(t)?fn.createStringInterpolator({range:[0,1],output:[t,t]})(1):t}function l4(t){for(const e in t)return!0;return!1}function Ju(t){return G.fun(t)||G.arr(t)&&G.obj(t[0])}function c4(t,e){var n;(n=t.ref)==null||n.delete(t),e==null||e.delete(t)}function u4(t,e){var n;e&&t.ref!==e&&((n=t.ref)==null||n.delete(t),e.add(t),t.ref=e)}var h4={default:{tension:170,friction:26}},Zu={...h4.default,mass:1,damping:1,easing:F5.linear,clamp:!1},d4=class{constructor(){this.velocity=0,Object.assign(this,Zu)}};function f4(t,e,n){n&&(n={...n},Rg(n,e),e={...n,...e}),Rg(t,e),Object.assign(t,e);for(const o in Zu)t[o]==null&&(t[o]=Zu[o]);let{frequency:s,damping:i}=t;const{mass:r}=t;return G.und(s)||(s<.01&&(s=.01),i<0&&(i=0),t.tension=Math.pow(2*Math.PI/s,2)*r,t.friction=4*Math.PI*i*r/s),t}function Rg(t,e){if(!G.und(e.decay))t.duration=void 0;else{const n=!G.und(e.tension)||!G.und(e.friction);(n||!G.und(e.frequency)||!G.und(e.damping)||!G.und(e.mass))&&(t.duration=void 0,t.decay=void 0),n&&(t.frequency=void 0)}}var Ng=[],p4=class{constructor(){this.changed=!1,this.values=Ng,this.toValues=null,this.fromValues=Ng,this.config=new d4,this.immediate=!1}};function zy(t,{key:e,props:n,defaultProps:s,state:i,actions:r}){return new Promise((o,a)=>{let u,h,d=Yr(n.cancel??(s==null?void 0:s.cancel),e);if(d)_();else{G.und(n.pause)||(i.paused=Yr(n.pause,e));let y=s==null?void 0:s.pause;y!==!0&&(y=i.paused||Yr(y,e)),u=qs(n.delay||0,e),y?(i.resumeQueue.add(m),r.pause()):(r.resume(),m())}function p(){i.resumeQueue.add(m),i.timeouts.delete(h),h.cancel(),u=h.time-ue.now()}function m(){u>0&&!fn.skipAnimation?(i.delayed=!0,h=ue.setTimeout(_,u),i.pauseQueue.add(p),i.timeouts.add(h)):_()}function _(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(p),i.timeouts.delete(h),t<=(i.cancelId||0)&&(d=!0);try{r.start({...n,callId:t,cancel:d},o)}catch(y){a(y)}}})}var Fd=(t,e)=>e.length==1?e[0]:e.some(n=>n.cancelled)?Ri(t.get()):e.every(n=>n.noop)?qy(t.get()):on(t.get(),e.every(n=>n.finished)),qy=t=>({value:t,noop:!0,finished:!0,cancelled:!1}),on=(t,e,n=!1)=>({value:t,finished:e,cancelled:n}),Ri=t=>({value:t,cancelled:!0,finished:!1});function Ky(t,e,n,s){const{callId:i,parentId:r,onRest:o}=e,{asyncTo:a,promise:u}=n;return!r&&t===a&&!e.reset?u:n.promise=(async()=>{n.asyncId=i,n.asyncTo=t;const h=kd(e,(w,b)=>b==="onRest"?void 0:w);let d,p;const m=new Promise((w,b)=>(d=w,p=b)),_=w=>{const b=i<=(n.cancelId||0)&&Ri(s)||i!==n.asyncId&&on(s,!1);if(b)throw w.result=b,p(w),w},y=(w,b)=>{const A=new Mg,R=new jg;return(async()=>{if(fn.skipAnimation)throw fo(n),R.result=on(s,!1),p(R),R;_(A);const N=G.obj(w)?{...w}:{...b,to:w};N.parentId=i,es(h,(k,x)=>{G.und(N[x])&&(N[x]=k)});const M=await s.start(N);return _(A),n.paused&&await new Promise(k=>{n.resumeQueue.add(k)}),M})()};let v;if(fn.skipAnimation)return fo(n),on(s,!1);try{let w;G.arr(t)?w=(async b=>{for(const A of b)await y(A)})(t):w=Promise.resolve(t(y,s.stop.bind(s))),await Promise.all([w.then(d),m]),v=on(s.get(),!0,!1)}catch(w){if(w instanceof Mg)v=w.result;else if(w instanceof jg)v=w.result;else throw w}finally{i==n.asyncId&&(n.asyncId=r,n.asyncTo=r?a:void 0,n.promise=r?u:void 0)}return G.fun(o)&&ue.batchedUpdates(()=>{o(v,s,s.item)}),v})()}function fo(t,e){Xr(t.timeouts,n=>n.cancel()),t.pauseQueue.clear(),t.resumeQueue.clear(),t.asyncId=t.asyncTo=t.promise=void 0,e&&(t.cancelId=e)}var Mg=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},jg=class extends Error{constructor(){super("SkipAnimationSignal")}},eh=t=>t instanceof Od,g4=1,Od=class extends V5{constructor(){super(...arguments),this.id=g4++,this._priority=0}get priority(){return this._priority}set priority(t){this._priority!=t&&(this._priority=t,this._onPriorityChange(t))}get(){const t=Tn(this);return t&&t.getValue()}to(...t){return fn.to(this,t)}interpolate(...t){return G5(),fn.to(this,t)}toJSON(){return this.get()}observerAdded(t){t==1&&this._attach()}observerRemoved(t){t==0&&this._detach()}_attach(){}_detach(){}_onChange(t,e=!1){cl(this,{type:"change",parent:this,value:t,idle:e})}_onPriorityChange(t){this.idle||Yl.sort(this),cl(this,{type:"priority",parent:this,priority:t})}},ri=Symbol.for("SpringPhase"),Qy=1,th=2,nh=4,Fc=t=>(t[ri]&Qy)>0,fs=t=>(t[ri]&th)>0,vr=t=>(t[ri]&nh)>0,Lg=(t,e)=>e?t[ri]|=th|Qy:t[ri]&=~th,kg=(t,e)=>e?t[ri]|=nh:t[ri]&=~nh,m4=class extends Od{constructor(t,e){if(super(),this.animation=new p4,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!G.und(t)||!G.und(e)){const n=G.obj(t)?{...t}:{...e,from:t};G.und(n.default)&&(n.default=!0),this.start(n)}}get idle(){return!(fs(this)||this._state.asyncTo)||vr(this)}get goal(){return Kt(this.animation.to)}get velocity(){const t=Tn(this);return t instanceof Jl?t.lastVelocity||0:t.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return Fc(this)}get isAnimating(){return fs(this)}get isPaused(){return vr(this)}get isDelayed(){return this._state.delayed}advance(t){let e=!0,n=!1;const s=this.animation;let{toValues:i}=s;const{config:r}=s,o=Ql(s.to);!o&&En(s.to)&&(i=tn(Kt(s.to))),s.values.forEach((h,d)=>{if(h.done)return;const p=h.constructor==hl?1:o?o[d].lastPosition:i[d];let m=s.immediate,_=p;if(!m){if(_=h.lastPosition,r.tension<=0){h.done=!0;return}let y=h.elapsedTime+=t;const v=s.fromValues[d],w=h.v0!=null?h.v0:h.v0=G.arr(r.velocity)?r.velocity[d]:r.velocity;let b;const A=r.precision||(v==p?.005:Math.min(1,Math.abs(p-v)*.001));if(G.und(r.duration))if(r.decay){const R=r.decay===!0?.998:r.decay,N=Math.exp(-(1-R)*y);_=v+w/(1-R)*(1-N),m=Math.abs(h.lastPosition-_)<=A,b=w*N}else{b=h.lastVelocity==null?w:h.lastVelocity;const R=r.restVelocity||A/10,N=r.clamp?0:r.bounce,M=!G.und(N),k=v==p?h.v0>0:v<p;let x,T=!1;const E=1,C=Math.ceil(t/E);for(let D=0;D<C&&(x=Math.abs(b)>R,!(!x&&(m=Math.abs(p-_)<=A,m)));++D){M&&(T=_==p||_>p==k,T&&(b=-b*N,_=p));const P=-r.tension*1e-6*(_-p),I=-r.friction*.001*b,$=(P+I)/r.mass;b=b+$*E,_=_+b*E}}else{let R=1;r.duration>0&&(this._memoizedDuration!==r.duration&&(this._memoizedDuration=r.duration,h.durationProgress>0&&(h.elapsedTime=r.duration*h.durationProgress,y=h.elapsedTime+=t)),R=(r.progress||0)+y/this._memoizedDuration,R=R>1?1:R<0?0:R,h.durationProgress=R),_=v+r.easing(R)*(p-v),b=(_-h.lastPosition)/t,m=R==1}h.lastVelocity=b,Number.isNaN(_)&&(console.warn("Got NaN while animating:",this),m=!0)}o&&!o[d].done&&(m=!1),m?h.done=!0:e=!1,h.setValue(_,r.round)&&(n=!0)});const a=Tn(this),u=a.getValue();if(e){const h=Kt(s.to);(u!==h||n)&&!r.decay?(a.setValue(h),this._onChange(h)):n&&r.decay&&this._onChange(u),this._stop()}else n&&this._onChange(u)}set(t){return ue.batchedUpdates(()=>{this._stop(),this._focus(t),this._set(t)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(fs(this)){const{to:t,config:e}=this.animation;ue.batchedUpdates(()=>{this._onStart(),e.decay||this._set(t,!1),this._stop()})}return this}update(t){return(this.queue||(this.queue=[])).push(t),this}start(t,e){let n;return G.und(t)?(n=this.queue||[],this.queue=[]):n=[G.obj(t)?t:{...e,to:t}],Promise.all(n.map(s=>this._update(s))).then(s=>Fd(this,s))}stop(t){const{to:e}=this.animation;return this._focus(this.get()),fo(this._state,t&&this._lastCallId),ue.batchedUpdates(()=>this._stop(e,t)),this}reset(){this._update({reset:!0})}eventObserved(t){t.type=="change"?this._start():t.type=="priority"&&(this.priority=t.priority+1)}_prepareNode(t){const e=this.key||"";let{to:n,from:s}=t;n=G.obj(n)?n[e]:n,(n==null||Ju(n))&&(n=void 0),s=G.obj(s)?s[e]:s,s==null&&(s=void 0);const i={to:n,from:s};return Fc(this)||(t.reverse&&([n,s]=[s,n]),s=Kt(s),G.und(s)?Tn(this)||this._set(n):this._set(s)),i}_update({...t},e){const{key:n,defaultProps:s}=this;t.default&&Object.assign(s,kd(t,(o,a)=>/^on/.test(a)?Xy(o,n):o)),Og(this,t,"onProps"),Tr(this,"onProps",t,this);const i=this._prepareNode(t);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const r=this._state;return zy(++this._lastCallId,{key:n,props:t,defaultProps:s,state:r,actions:{pause:()=>{vr(this)||(kg(this,!0),jr(r.pauseQueue),Tr(this,"onPause",on(this,wr(this,this.animation.to)),this))},resume:()=>{vr(this)&&(kg(this,!1),fs(this)&&this._resume(),jr(r.resumeQueue),Tr(this,"onResume",on(this,wr(this,this.animation.to)),this))},start:this._merge.bind(this,i)}}).then(o=>{if(t.loop&&o.finished&&!(e&&o.noop)){const a=Jy(t);if(a)return this._update(a,!0)}return o})}_merge(t,e,n){if(e.cancel)return this.stop(!0),n(Ri(this));const s=!G.und(t.to),i=!G.und(t.from);if(s||i)if(e.callId>this._lastToId)this._lastToId=e.callId;else return n(Ri(this));const{key:r,defaultProps:o,animation:a}=this,{to:u,from:h}=a;let{to:d=u,from:p=h}=t;i&&!s&&(!e.default||G.und(d))&&(d=p),e.reverse&&([d,p]=[p,d]);const m=!$n(p,h);m&&(a.from=p),p=Kt(p);const _=!$n(d,u);_&&this._focus(d);const y=Ju(e.to),{config:v}=a,{decay:w,velocity:b}=v;(s||i)&&(v.velocity=0),e.config&&!y&&f4(v,qs(e.config,r),e.config!==o.config?qs(o.config,r):void 0);let A=Tn(this);if(!A||G.und(d))return n(on(this,!0));const R=G.und(e.reset)?i&&!e.default:!G.und(p)&&Yr(e.reset,r),N=R?p:this.get(),M=ho(d),k=G.num(M)||G.arr(M)||Kl(M),x=!y&&(!k||Yr(o.immediate||e.immediate,r));if(_){const D=Qu(d);if(D!==A.constructor)if(x)A=this._set(M);else throw Error(`Cannot animate between ${A.constructor.name} and ${D.name}, as the "to" prop suggests`)}const T=A.constructor;let E=En(d),C=!1;if(!E){const D=R||!Fc(this)&&m;(_||D)&&(C=$n(ho(N),M),E=!C),(!$n(a.immediate,x)&&!x||!$n(v.decay,w)||!$n(v.velocity,b))&&(E=!0)}if(C&&fs(this)&&(a.changed&&!R?E=!0:E||this._stop(u)),!y&&((E||En(u))&&(a.values=A.getPayload(),a.toValues=En(d)?null:T==hl?[1]:tn(M)),a.immediate!=x&&(a.immediate=x,!x&&!R&&this._set(u)),E)){const{onRest:D}=a;Re(y4,I=>Og(this,e,I));const P=on(this,wr(this,u));jr(this._pendingCalls,P),this._pendingCalls.add(n),a.changed&&ue.batchedUpdates(()=>{var I;a.changed=!R,D==null||D(P,this),R?qs(o.onRest,P):(I=a.onStart)==null||I.call(a,P,this)})}R&&this._set(N),y?n(Ky(e.to,e,this._state,this)):E?this._start():fs(this)&&!_?this._pendingCalls.add(n):n(qy(N))}_focus(t){const e=this.animation;t!==e.to&&(xg(this)&&this._detach(),e.to=t,xg(this)&&this._attach())}_attach(){let t=0;const{to:e}=this.animation;En(e)&&(jo(e,this),eh(e)&&(t=e.priority+1)),this.priority=t}_detach(){const{to:t}=this.animation;En(t)&&ul(t,this)}_set(t,e=!0){const n=Kt(t);if(!G.und(n)){const s=Tn(this);if(!s||!$n(n,s.getValue())){const i=Qu(n);!s||s.constructor!=i?jd(this,i.create(n)):s.setValue(n),s&&ue.batchedUpdates(()=>{this._onChange(n,e)})}}return Tn(this)}_onStart(){const t=this.animation;t.changed||(t.changed=!0,Tr(this,"onStart",on(this,wr(this,t.to)),this))}_onChange(t,e){e||(this._onStart(),qs(this.animation.onChange,t,this)),qs(this.defaultProps.onChange,t,this),super._onChange(t,e)}_start(){const t=this.animation;Tn(this).reset(Kt(t.to)),t.immediate||(t.fromValues=t.values.map(e=>e.lastPosition)),fs(this)||(Lg(this,!0),vr(this)||this._resume())}_resume(){fn.skipAnimation?this.finish():Yl.start(this)}_stop(t,e){if(fs(this)){Lg(this,!1);const n=this.animation;Re(n.values,i=>{i.done=!0}),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),cl(this,{type:"idle",parent:this});const s=e?Ri(this.get()):on(this.get(),wr(this,t??n.to));jr(this._pendingCalls,s),n.changed&&(n.changed=!1,Tr(this,"onRest",s,this))}}};function wr(t,e){const n=ho(e),s=ho(t.get());return $n(s,n)}function Jy(t,e=t.loop,n=t.to){const s=qs(e);if(s){const i=s!==!0&&Yy(s),r=(i||t).reverse,o=!i||i.reset;return po({...t,loop:e,default:!1,pause:void 0,to:!r||Ju(n)?n:void 0,from:o?t.from:void 0,reset:o,...i})}}function po(t){const{to:e,from:n}=t=Yy(t),s=new Set;return G.obj(e)&&Fg(e,s),G.obj(n)&&Fg(n,s),t.keys=s.size?Array.from(s):null,t}function _4(t){const e=po(t);return G.und(e.default)&&(e.default=kd(e)),e}function Fg(t,e){es(t,(n,s)=>n!=null&&e.add(s))}var y4=["onStart","onRest","onChange","onPause","onResume"];function Og(t,e,n){t.animation[n]=e[n]!==Gy(e,n)?Xy(e[n],t.key):void 0}function Tr(t,e,...n){var s,i,r,o;(i=(s=t.animation)[e])==null||i.call(s,...n),(o=(r=t.defaultProps)[e])==null||o.call(r,...n)}var v4=["onStart","onChange","onRest"],w4=1,T4=class{constructor(t,e){this.id=w4++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),e&&(this._flush=e),t&&this.start({default:!0,...t})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(t=>t.idle&&!t.isDelayed&&!t.isPaused)}get item(){return this._item}set item(t){this._item=t}get(){const t={};return this.each((e,n)=>t[n]=e.get()),t}set(t){for(const e in t){const n=t[e];G.und(n)||this.springs[e].set(n)}}update(t){return t&&this.queue.push(po(t)),this}start(t){let{queue:e}=this;return t?e=tn(t).map(po):this.queue=[],this._flush?this._flush(this,e):(s1(this,e),sh(this,e))}stop(t,e){if(t!==!!t&&(e=t),e){const n=this.springs;Re(tn(e),s=>n[s].stop(!!t))}else fo(this._state,this._lastAsyncId),this.each(n=>n.stop(!!t));return this}pause(t){if(G.und(t))this.start({pause:!0});else{const e=this.springs;Re(tn(t),n=>e[n].pause())}return this}resume(t){if(G.und(t))this.start({pause:!1});else{const e=this.springs;Re(tn(t),n=>e[n].resume())}return this}each(t){es(this.springs,t)}_onFrame(){const{onStart:t,onChange:e,onRest:n}=this._events,s=this._active.size>0,i=this._changed.size>0;(s&&!this._started||i&&!this._started)&&(this._started=!0,Xr(t,([a,u])=>{u.value=this.get(),a(u,this,this._item)}));const r=!s&&this._started,o=i||r&&n.size?this.get():null;i&&e.size&&Xr(e,([a,u])=>{u.value=o,a(u,this,this._item)}),r&&(this._started=!1,Xr(n,([a,u])=>{u.value=o,a(u,this,this._item)}))}eventObserved(t){if(t.type=="change")this._changed.add(t.parent),t.idle||this._active.add(t.parent);else if(t.type=="idle")this._active.delete(t.parent);else return;ue.onFrame(this._onFrame)}};function sh(t,e){return Promise.all(e.map(n=>Zy(t,n))).then(n=>Fd(t,n))}async function Zy(t,e,n){const{keys:s,to:i,from:r,loop:o,onRest:a,onResolve:u}=e,h=G.obj(e.default)&&e.default;o&&(e.loop=!1),i===!1&&(e.to=null),r===!1&&(e.from=null);const d=G.arr(i)||G.fun(i)?i:void 0;d?(e.to=void 0,e.onRest=void 0,h&&(h.onRest=void 0)):Re(v4,v=>{const w=e[v];if(G.fun(w)){const b=t._events[v];e[v]=({finished:A,cancelled:R})=>{const N=b.get(w);N?(A||(N.finished=!1),R&&(N.cancelled=!0)):b.set(w,{value:null,finished:A||!1,cancelled:R||!1})},h&&(h[v]=e[v])}});const p=t._state;e.pause===!p.paused?(p.paused=e.pause,jr(e.pause?p.pauseQueue:p.resumeQueue)):p.paused&&(e.pause=!0);const m=(s||Object.keys(t.springs)).map(v=>t.springs[v].start(e)),_=e.cancel===!0||Gy(e,"cancel")===!0;(d||_&&p.asyncId)&&m.push(zy(++t._lastAsyncId,{props:e,state:p,actions:{pause:qu,resume:qu,start(v,w){_?(fo(p,t._lastAsyncId),w(Ri(t))):(v.onRest=a,w(Ky(d,v,p,t)))}}})),p.paused&&await new Promise(v=>{p.resumeQueue.add(v)});const y=Fd(t,await Promise.all(m));if(o&&y.finished&&!(n&&y.noop)){const v=Jy(e,o,i);if(v)return s1(t,[v]),Zy(t,v,!0)}return u&&ue.batchedUpdates(()=>u(y,t,t.item)),y}function Vg(t,e){const n={...t.springs};return e&&Re(tn(e),s=>{G.und(s.keys)&&(s=po(s)),G.obj(s.to)||(s={...s,to:void 0}),n1(n,s,i=>t1(i))}),e1(t,n),n}function e1(t,e){es(e,(n,s)=>{t.springs[s]||(t.springs[s]=n,jo(n,t))})}function t1(t,e){const n=new m4;return n.key=t,e&&jo(n,e),n}function n1(t,e,n){e.keys&&Re(e.keys,s=>{(t[s]||(t[s]=n(s)))._prepareNode(e)})}function s1(t,e){Re(e,n=>{n1(t.springs,n,s=>t1(s,t))})}var E4=j.createContext({pause:!1,immediate:!1}),A4=()=>{const t=[],e=function(s){z5();const i=[];return Re(t,(r,o)=>{if(G.und(s))i.push(r.start());else{const a=n(s,r,o);a&&i.push(r.start(a))}}),i};e.current=t,e.add=function(s){t.includes(s)||t.push(s)},e.delete=function(s){const i=t.indexOf(s);~i&&t.splice(i,1)},e.pause=function(){return Re(t,s=>s.pause(...arguments)),this},e.resume=function(){return Re(t,s=>s.resume(...arguments)),this},e.set=function(s){Re(t,(i,r)=>{const o=G.fun(s)?s(r,i):s;o&&i.set(o)})},e.start=function(s){const i=[];return Re(t,(r,o)=>{if(G.und(s))i.push(r.start());else{const a=this._getProps(s,r,o);a&&i.push(r.start(a))}}),i},e.stop=function(){return Re(t,s=>s.stop(...arguments)),this},e.update=function(s){return Re(t,(i,r)=>i.update(this._getProps(s,i,r))),this};const n=function(s,i,r){return G.fun(s)?s(r,i):s};return e._getProps=n,e};function I4(t,e,n){const s=G.fun(e)&&e;s&&!n&&(n=[]);const i=j.useMemo(()=>s||arguments.length==3?A4():void 0,[]),r=j.useRef(0),o=Vy(),a=j.useMemo(()=>({ctrls:[],queue:[],flush(b,A){const R=Vg(b,A);return r.current>0&&!a.queue.length&&!Object.keys(R).some(M=>!b.springs[M])?sh(b,A):new Promise(M=>{e1(b,R),a.queue.push(()=>{M(sh(b,A))}),o()})}}),[]),u=j.useRef([...a.ctrls]),h=j.useRef([]),d=bg(t)||0;j.useMemo(()=>{Re(u.current.slice(t,d),b=>{c4(b,i),b.stop(!0)}),u.current.length=t,p(d,t)},[t]),j.useMemo(()=>{p(0,Math.min(d,t))},n);function p(b,A){for(let R=b;R<A;R++){const N=u.current[R]||(u.current[R]=new T4(null,a.flush)),M=s?s(R,N):e[R];M&&(h.current[R]=_4(M))}}const m=u.current.map((b,A)=>Vg(b,h.current[A])),_=j.useContext(E4),y=bg(_),v=_!==y&&l4(_);Md(()=>{r.current++,a.ctrls=u.current;const{queue:b}=a;b.length&&(a.queue=[],Re(b,A=>A())),Re(u.current,(A,R)=>{i==null||i.add(A),v&&A.start({default:_});const N=h.current[R];N&&(u4(A,N.ref),A.ref?A.queue.push(N):A.start(N))})}),By(()=>()=>{Re(a.ctrls,b=>b.stop(!0))});const w=m.map(b=>({...b}));return i?[w,i]:w}function oa(t,e){const n=G.fun(t),[[s],i]=I4(1,n?t:[t],n?[]:e);return n||arguments.length==2?[s,i]:s}var x4=class extends Od{constructor(t,e){super(),this.source=t,this.idle=!0,this._active=new Set,this.calc=lo(...e);const n=this._get(),s=Qu(n);jd(this,s.create(n))}advance(t){const e=this._get(),n=this.get();$n(e,n)||(Tn(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&Bg(this._active)&&Oc(this)}_get(){const t=G.arr(this.source)?this.source.map(Kt):tn(Kt(this.source));return this.calc(...t)}_start(){this.idle&&!Bg(this._active)&&(this.idle=!1,Re(Ql(this),t=>{t.done=!1}),fn.skipAnimation?(ue.batchedUpdates(()=>this.advance()),Oc(this)):Yl.start(this))}_attach(){let t=1;Re(tn(this.source),e=>{En(e)&&jo(e,this),eh(e)&&(e.idle||this._active.add(e),t=Math.max(t,e.priority+1))}),this.priority=t,this._start()}_detach(){Re(tn(this.source),t=>{En(t)&&ul(t,this)}),this._active.clear(),Oc(this)}eventObserved(t){t.type=="change"?t.idle?this.advance():(this._active.add(t.parent),this._start()):t.type=="idle"?this._active.delete(t.parent):t.type=="priority"&&(this.priority=tn(this.source).reduce((e,n)=>Math.max(e,(eh(n)?n.priority:0)+1),0))}};function S4(t){return t.idle!==!1}function Bg(t){return!t.size||Array.from(t).every(S4)}function Oc(t){t.idle||(t.idle=!0,Re(Ql(t),e=>{e.done=!0}),cl(t,{type:"idle",parent:t}))}fn.assign({createStringInterpolator:Fy,to:(t,e)=>new x4(t,e)});var b4=["primitive"].concat(Object.keys(lv).filter(t=>/^[A-Z]/.test(t)).map(t=>t[0].toLowerCase()+t.slice(1)));fn.assign({createStringInterpolator:Fy,colors:x5,frameLoop:"demand"});W1(()=>{ue.advance()});var C4=s4(b4,{applyAnimatedValues:X1}),aa=C4.animated;const la=({args:t,position:e,material:n,renderMode:s})=>{const i=j.useMemo(()=>new oi(...t),[t]),r=j.useMemo(()=>new Sh(i),[i]);return c.jsxs("group",{position:e,children:[s==="solid"&&c.jsx("mesh",{geometry:i,receiveShadow:!0,castShadow:!0,children:c.jsx("primitive",{object:n})}),c.jsx("lineSegments",{geometry:r,children:c.jsx("lineBasicMaterial",{color:"#666666",linewidth:1})})]})},rs=({moduleWidth:t,moduleDepth:e,hingePosition:n="right",spaceInfo:s,color:i})=>{var _e,we,je,ne;const{spaceInfo:r}=Ct(),{doorsOpen:o}=tr(),{renderMode:a}=xe(),u=s||r,h=u.materialConfig||{interiorColor:"#FFFFFF",doorColor:"#FFFFFF"};let d=i||h.doorColor;if(typeof d=="string"&&(/^#([0-9a-fA-F]{8})$/.test(d)&&(d="#"+d.slice(1,7)),/^rgba\(/.test(d))){const se=d.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);se&&(d=`#${(+se[1]).toString(16).padStart(2,"0")}${(+se[2]).toString(16).padStart(2,"0")}${(+se[3]).toString(16).padStart(2,"0")}`)}const p=a!=="solid"&&!!i,m=()=>a==="solid"?new Qt({color:d,metalness:0,roughness:.6,envMapIntensity:0,emissive:new nt(0),transparent:!1,opacity:1}):p?new Qt({color:d,metalness:0,roughness:.6,envMapIntensity:0,emissive:new nt(0),transparent:!0,opacity:.4}):new Qt({color:d,metalness:0,roughness:.6,envMapIntensity:0,emissive:new nt(0),transparent:!0,opacity:.3});console.log("🚪 DoorModule 렌더링:",{propColor:i,propSpaceInfo:s==null?void 0:s.materialConfig,storeSpaceInfo:r.materialConfig,currentSpaceInfo:u.materialConfig,materialConfig:h,finalDoorColor:d});const y=ft(s).columnWidth,v=Math.abs(t-y*2)<50,w=se=>se*.01,A=w(20),R=s.height,N=s.hasFloorFinish&&((_e=s.floorFinish)==null?void 0:_e.height)||0,M=R-N,k=w(M-30);let x;if(((we=s.baseConfig)==null?void 0:we.type)==="floor"){const se=((je=s.frameSize)==null?void 0:je.top)||50,Ce=s.baseConfig.height||65;x=(N>0,w(se)/2-w(Ce)/2)}else{const se=((ne=s.frameSize)==null?void 0:ne.top)||50;x=(N>0,w(se)/2)}const T=w(e)+w(20),C=18/2,D=w(C),P=oa({rotation:o?-4*Math.PI/9:0,config:{tension:70,friction:20}}),I=oa({rotation:o?4*Math.PI/9:0,config:{tension:70,friction:20}}),$=oa({rotation:o?-4*Math.PI/9:0,config:{tension:70,friction:20}}),K=oa({rotation:o?4*Math.PI/9:0,config:{tension:70,friction:20}});if(v){const se=t,Ce=(se-1.5-1.5-3)/2,Ie=w(Ce),de=w(-se/2+1.5+Ce/2),Pt=w(se/2-1.5-Ce/2);return c.jsxs("group",{children:[c.jsx("group",{position:[de-Ie/2+D,x,T/2],children:c.jsx(aa.group,{"rotation-y":$.rotation,children:c.jsx(la,{position:[Ie/2-D,.1,0],args:[Ie,k,A],material:m(),renderMode:a})})}),c.jsx("group",{position:[Pt+Ie/2-D,x,T/2],children:c.jsx(aa.group,{"rotation-y":K.rotation,children:c.jsx(la,{position:[-Ie/2+D,.1,0],args:[Ie,k,A],material:m(),renderMode:a})})})]})}else{const se=t-1.5-1.5,Ce=w(se);return n==="left"?c.jsx("group",{position:[-w(t)/2+w(1.5)+D,x,T/2],children:c.jsx(aa.group,{"rotation-y":P.rotation,children:c.jsx(la,{position:[Ce/2-D,.1,0],args:[Ce,k,A],material:m(),renderMode:a})})}):c.jsx("group",{position:[w(t)/2-w(1.5)-D,x,T/2],children:c.jsx(aa.group,{"rotation-y":I.rotation,children:c.jsx(la,{position:[-Ce/2+D,.1,0],args:[Ce,k,A],material:m(),renderMode:a})})})}},D4=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=is(t,{color:e,internalHeight:n,customDepth:i,isDragging:a});return c.jsxs(ui,{...u,children:[c.jsx(hi,{modelConfig:u.modelConfig,height:u.height,innerWidth:u.innerWidth,depth:u.depth,adjustedDepthForShelves:u.adjustedDepthForShelves,basicThickness:u.basicThickness,shelfZOffset:u.shelfZOffset,material:u.material,calculateSectionHeight:u.calculateSectionHeight,renderMode:xe().renderMode}),s&&o&&c.jsx(rs,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},P4=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=is(t,{color:e,internalHeight:n,customDepth:i,isDragging:a});return c.jsxs(ui,{...u,children:[c.jsx(hi,{modelConfig:u.modelConfig,height:u.height,innerWidth:u.innerWidth,depth:u.depth,adjustedDepthForShelves:u.adjustedDepthForShelves,basicThickness:u.basicThickness,shelfZOffset:u.shelfZOffset,material:u.material,calculateSectionHeight:u.calculateSectionHeight,renderMode:xe().renderMode}),s&&o&&c.jsx(rs,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},R4=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=is(t,{color:e,internalHeight:n,customDepth:i,isDragging:a});return c.jsxs(ui,{...u,children:[c.jsx(hi,{modelConfig:u.modelConfig,height:u.height,innerWidth:u.innerWidth,depth:u.depth,adjustedDepthForShelves:u.adjustedDepthForShelves,basicThickness:u.basicThickness,shelfZOffset:u.shelfZOffset,material:u.material,calculateSectionHeight:u.calculateSectionHeight,renderMode:xe().renderMode}),s&&o&&c.jsx(rs,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},N4=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=is(t,{color:e,internalHeight:n,customDepth:i,isDragging:a});return c.jsxs(ui,{...u,children:[c.jsx(hi,{modelConfig:u.modelConfig,height:u.height,innerWidth:u.innerWidth,depth:u.depth,adjustedDepthForShelves:u.adjustedDepthForShelves,basicThickness:u.basicThickness,shelfZOffset:u.shelfZOffset,material:u.material,calculateSectionHeight:u.calculateSectionHeight,renderMode:xe().renderMode}),s&&o&&c.jsx(rs,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},M4=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=is(t,{color:e,internalHeight:n,customDepth:i,isDragging:a});return c.jsxs(ui,{...u,children:[c.jsx(hi,{modelConfig:u.modelConfig,height:u.height,innerWidth:u.innerWidth,depth:u.depth,adjustedDepthForShelves:u.adjustedDepthForShelves,basicThickness:u.basicThickness,shelfZOffset:u.shelfZOffset,material:u.material,calculateSectionHeight:u.calculateSectionHeight,renderMode:xe().renderMode}),s&&o&&c.jsx(rs,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},j4=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=is(t,{color:e,internalHeight:n,customDepth:i,isDragging:a});return c.jsxs(ui,{...u,children:[c.jsx(hi,{modelConfig:u.modelConfig,height:u.height,innerWidth:u.innerWidth,depth:u.depth,adjustedDepthForShelves:u.adjustedDepthForShelves,basicThickness:u.basicThickness,shelfZOffset:u.shelfZOffset,material:u.material,calculateSectionHeight:u.calculateSectionHeight,renderMode:xe().renderMode}),s&&o&&c.jsx(rs,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},mn=({args:t,position:e,material:n,renderMode:s="solid"})=>c.jsxs("group",{position:e,children:[s==="solid"&&c.jsxs("mesh",{receiveShadow:!0,castShadow:!0,children:[c.jsx("boxGeometry",{args:t}),c.jsx("primitive",{object:n})]}),c.jsxs("lineSegments",{children:[c.jsx("edgesGeometry",{args:[new oi(...t)]}),c.jsx("lineBasicMaterial",{color:"#666666",linewidth:2})]})]}),L4=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=is(t,{color:e,internalHeight:n,customDepth:i,isDragging:a}),{width:h,height:d,innerWidth:p,innerHeight:m,basicThickness:_,backPanelThickness:y,material:v,calculateSectionHeight:w,mmToThreeUnits:b,modelConfig:A}=u,R=A.rightAbsoluteWidth;let N,M,k,x;R?(M=b(R),N=p-M-_,k=-(M+_)/2,x=(N+_)/2):(N=p/2,M=p/2,k=-p/4,x=p/4);const T=A.rightAbsoluteDepth;let E,C,D,P;T?(D=i||600,E=b(D),P=T,C=b(P)):(D=P=i||600,E=C=b(D));const I=()=>{const K=A.leftSections||[];if(K.length===0)return[d-_*2];const _e=d-_*2,je=K.filter(se=>se.heightType==="absolute").reduce((se,Ce)=>se+w(Ce,_e),0),ne=_e-je;return K.map(se=>se.heightType==="absolute"?w(se,_e):w(se,ne))},$=()=>{const K=A.leftSections||[],_e=A.rightSections||[];if(K.length===0&&_e.length===0)return null;const we=E-_,je=_/2,ne=b(642),se=b(18)/2+(E-C)/2,Ce=()=>{if(K.length===0)return null;const de=d-_*2,Z=K.filter(Q=>Q.heightType==="absolute").reduce((Q,Te)=>Q+w(Te,de),0),pe=de-Z,We=K.map(Q=>({...Q,calculatedHeight:Q.heightType==="absolute"?w(Q,de):w(Q,pe)}));let ze=-d/2;return We.map((Q,Te)=>{const Pe=Q.calculatedHeight,ot=ze+Pe/2;let at=null;switch(Q.type){case"shelf":Q.count&&Q.count>0&&(at=c.jsx(Ii,{shelfCount:Q.count,innerWidth:N,innerHeight:Pe,depth:we,basicThickness:_,material:v,yOffset:ot,zOffset:je,shelfPositions:Q.shelfPositions,isTopFinishPanel:Q.isTopFinishPanel,renderMode:xe().renderMode}));break;case"hanging":Q.count&&Q.count>0?at=c.jsx(Ii,{shelfCount:Q.count,innerWidth:N,innerHeight:Pe,depth:we,basicThickness:_,material:v,yOffset:ot,zOffset:je,shelfPositions:Q.shelfPositions,isTopFinishPanel:Q.isTopFinishPanel,renderMode:xe().renderMode}):at=null;break;case"drawer":Q.count&&Q.count>0&&(at=c.jsx(Ad,{drawerCount:Q.count,innerWidth:N,innerHeight:Pe,depth:E,basicThickness:_,yOffset:ot,drawerHeights:Q.drawerHeights,gapHeight:Q.gapHeight,material:v,renderMode:xe().renderMode}));break}let Dn=null;return Te<We.length-1&&(Dn=c.jsx(mn,{args:[N,_,we-_],position:[0,ot+Pe/2+_/2,_/2+je],material:v,renderMode:xe().renderMode})),ze+=Pe,c.jsxs("group",{children:[at,Dn]},`left-section-${Te}`)})},Ie=()=>{if(_e.length===0)return null;const de=d-_*2,Z=_e.filter(Q=>Q.heightType==="absolute").reduce((Q,Te)=>Q+w(Te,de),0),pe=de-Z,We=_e.map(Q=>({...Q,calculatedHeight:Q.heightType==="absolute"?w(Q,de):w(Q,pe)}));let ze=-d/2;return We.map((Q,Te)=>{const Pe=Q.calculatedHeight,ot=ze+Pe/2;let at=null;switch(Q.type){case"hanging":Q.count&&Q.count>0?at=c.jsx(Ii,{shelfCount:Q.count,innerWidth:M,innerHeight:Pe,depth:ne,basicThickness:_,material:v,yOffset:ot,zOffset:se,shelfPositions:Q.shelfPositions,isTopFinishPanel:Q.isTopFinishPanel,renderMode:xe().renderMode}):at=null;break;case"shelf":Q.count&&Q.count>0&&(at=c.jsx(Ii,{shelfCount:Q.count,innerWidth:M,innerHeight:Pe,depth:ne,basicThickness:_,material:v,yOffset:ot,zOffset:se,shelfPositions:Q.shelfPositions,isTopFinishPanel:Q.isTopFinishPanel,renderMode:xe().renderMode}));break}return ze+=Pe,c.jsx("group",{children:at},`right-section-${Te}`)})};return c.jsxs(c.Fragment,{children:[c.jsx("group",{position:[k,0,0],children:Ce()}),c.jsx("group",{position:[x,0,0],children:Ie()}),I().map((de,Pt)=>{let Z=-d/2;for(let Q=0;Q<Pt;Q++)Z+=I()[Q];const pe=Z+de/2,We=Math.max(E,C),ze=E>C?0:(E-C)/2;return c.jsx(mn,{args:[_,de,We],position:[(N-M)/2,pe,ze],material:v,renderMode:xe().renderMode},`middle-panel-${Pt}`)})]})};return c.jsxs("group",{children:[I().map((K,_e)=>{let we=-d/2;for(let ne=0;ne<_e;ne++)we+=I()[ne];const je=we+K/2;return c.jsx(mn,{args:[_,K,E],position:[-h/2+_/2,je,0],material:v,renderMode:xe().renderMode},`left-side-panel-${_e}`)}),c.jsx(mn,{args:[_,d,C],position:[h/2-_/2,0,(E-C)/2],material:v,renderMode:xe().renderMode}),c.jsxs(c.Fragment,{children:[c.jsx(mn,{args:[N,_,E],position:[k,d/2-_/2,0],material:v,renderMode:xe().renderMode}),c.jsx(mn,{args:[M,_,C],position:[x,d/2-_/2,(E-C)/2],material:v,renderMode:xe().renderMode})]}),c.jsxs(c.Fragment,{children:[c.jsx(mn,{args:[N,_,E],position:[k,-d/2+_/2,0],material:v,renderMode:xe().renderMode}),c.jsx(mn,{args:[M,_,C],position:[x,-d/2+_/2,(E-C)/2],material:v,renderMode:xe().renderMode})]}),c.jsxs(c.Fragment,{children:[c.jsx(mn,{args:[N+b(10),m+b(10),y],position:[k,0,-E/2+y/2+b(17)],material:v,renderMode:xe().renderMode}),c.jsx(mn,{args:[M+b(10),m+b(10),y],position:[x,0,-C/2+y/2+b(17)+(E-C)/2],material:v,renderMode:xe().renderMode})]}),$(),s&&o&&c.jsx(rs,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},kn=({args:t,position:e,material:n,renderMode:s="solid"})=>c.jsxs("group",{position:e,children:[s==="solid"&&c.jsxs("mesh",{receiveShadow:!0,castShadow:!0,children:[c.jsx("boxGeometry",{args:t}),c.jsx("primitive",{object:n})]}),c.jsxs("lineSegments",{children:[c.jsx("edgesGeometry",{args:[new oi(...t)]}),c.jsx("lineBasicMaterial",{color:"#666666",linewidth:2})]})]}),k4=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=is(t,{color:e,internalHeight:n,customDepth:i,isDragging:a}),{width:h,height:d,depth:p,innerWidth:m,innerHeight:_,basicThickness:y,backPanelThickness:v,adjustedDepthForShelves:w,shelfZOffset:b,material:A,calculateSectionHeight:R,mmToThreeUnits:N,modelConfig:M}=u,k=M.rightAbsoluteWidth;let x,T,E,C;k?(T=N(k),x=m-T-y,E=-(T+y)/2,C=(x+y)/2):(x=m/2,T=m/2,E=-m/4,C=m/4);const D=M.hasSharedMiddlePanel||!1,P=M.middlePanelHeight||0,I=M.hasSharedSafetyShelf||!1,$=M.safetyShelfHeight||0,K=()=>{const _e=M.leftSections||[],we=M.rightSections||[];if(_e.length===0&&we.length===0)return null;const je=()=>{if(_e.length===0)return null;const se=d-y*2,Ie=_e.filter(pe=>pe.heightType==="absolute").reduce((pe,We)=>pe+R(We,se),0),de=se-Ie,Pt=_e.map(pe=>({...pe,calculatedHeight:pe.heightType==="absolute"?R(pe,se):R(pe,de)}));let Z=-d/2+y;return Pt.map((pe,We)=>{const ze=pe.calculatedHeight,Q=Z+ze/2;let Te=null;switch(pe.type){case"drawer":pe.count&&pe.count>0&&(Te=c.jsx(Ad,{drawerCount:pe.count,innerWidth:x,innerHeight:ze,depth:p,basicThickness:y,yOffset:Q,drawerHeights:pe.drawerHeights,gapHeight:pe.gapHeight,material:A,renderMode:xe().renderMode}));break;case"hanging":Te=null;break}return Z+=ze,c.jsx("group",{children:Te},`left-section-${We}`)})},ne=()=>{if(we.length===0)return null;const se=d-y*2,Ie=we.filter(Z=>Z.heightType==="absolute").reduce((Z,pe)=>Z+R(pe,se),0),de=se-Ie;return we.map(Z=>({...Z,calculatedHeight:Z.heightType==="absolute"?R(Z,se):R(Z,de)})).map((Z,pe)=>{let We=null;switch(Z.type){case"hanging":We=null;break}return c.jsx("group",{children:We},`right-section-${pe}`)})};return c.jsxs(c.Fragment,{children:[c.jsx("group",{position:[E,0,0],children:je()}),c.jsx("group",{position:[C,0,0],children:ne()}),D&&P>0&&c.jsx(kn,{args:[y,N(P+9),w-y],position:[(x-T)/2,-d/2+y+N(P+9)/2-N(18),y/2+b],material:A,renderMode:xe().renderMode}),D&&P>0&&c.jsx(kn,{args:[m,y,w-y],position:[0,-d/2+y+N(P),y/2+b],material:A,renderMode:xe().renderMode}),I&&$>0&&c.jsx(kn,{args:[m,y,w-y],position:[0,-d/2+y+N($),y/2+b],material:A,renderMode:xe().renderMode})]})};return c.jsxs("group",{children:[c.jsx(kn,{args:[y,d,p],position:[-h/2+y/2,0,0],material:A,renderMode:xe().renderMode}),c.jsx(kn,{args:[y,d,p],position:[h/2-y/2,0,0],material:A,renderMode:xe().renderMode}),c.jsx(kn,{args:[m,y,p],position:[0,d/2-y/2,0],material:A,renderMode:xe().renderMode}),c.jsxs(c.Fragment,{children:[c.jsx(kn,{args:[x,y,p],position:[E,-d/2+y/2,0],material:A,renderMode:xe().renderMode}),c.jsx(kn,{args:[T,y,p],position:[C,-d/2+y/2,0],material:A,renderMode:xe().renderMode})]}),c.jsx(kn,{args:[m+N(10),_+N(10),v],position:[0,0,-p/2+v/2+N(17)],material:A,renderMode:xe().renderMode}),K(),s&&o&&c.jsx(rs,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},i1=({moduleData:t,color:e,isDragging:n=!1,internalHeight:s,hasDoor:i,customDepth:r,hingePosition:o="right",spaceInfo:a})=>{Ct();const u=is(t,{color:e,internalHeight:s,customDepth:r,isDragging:n});return t.id.includes("dual-4drawer-hanging")?c.jsx(j4,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):t.id.includes("dual-2drawer-hanging")?c.jsx(N4,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):t.id.includes("dual-2hanging")?c.jsx(M4,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):t.id.includes("single-4drawer-hanging")?c.jsx(R4,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):t.id.includes("single-2drawer-hanging")?c.jsx(D4,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):t.id.includes("single-2hanging")?c.jsx(P4,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):t.id.includes("dual-2drawer-styler")?c.jsx(L4,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):t.id.includes("dual-4drawer-pantshanger")?c.jsx(k4,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):c.jsxs(ui,{...u,children:[c.jsx(hi,{modelConfig:u.modelConfig,height:u.height,innerWidth:u.innerWidth,depth:u.depth,adjustedDepthForShelves:u.adjustedDepthForShelves,basicThickness:u.basicThickness,shelfZOffset:u.shelfZOffset,material:u.material,calculateSectionHeight:u.calculateSectionHeight,renderMode:xe().renderMode}),i&&a&&c.jsx(rs,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:o,spaceInfo:a,color:n?u.doorColor:void 0})]})},F4=({placedModule:t,spaceInfo:e,furnitureStartY:n,isDragMode:s,isEditMode:i,isDraggingThis:r,onPointerDown:o,onPointerMove:a,onPointerUp:u,onDoubleClick:h})=>{var I;const d=dt(e),p=Dt(t.moduleId,d,e);if(!p)return null;const m=$=>$*.01,_=m(p.dimensions.width);let y=d.height;if(((I=e.baseConfig)==null?void 0:I.type)==="stand"&&e.baseConfig.placementType==="float"){const $=e.baseConfig.floatHeight||0;y=d.height-$}const v=m(y),w=t.customDepth||p.dimensions.depth,b=m(w),R=m(20),N=1500,M=600,k=m(N),x=m(M),C=-k/2+(k-x)/2+x/2-R-b/2,P=r||i||s?r?"#66ff66":i?"#ffaa00":s?"#ff6666":void 0:void 0;return c.jsxs("group",{position:[t.position.x,n+v/2,C],rotation:[0,t.rotation*Math.PI/180,0],onDoubleClick:$=>h($,t.id),onPointerDown:$=>o($,t.id),onPointerMove:$=>a($),onPointerUp:u,onPointerOver:()=>{document.body.style.cursor=s?"grab":r?"grabbing":"grab"},onPointerOut:()=>{document.body.style.cursor="default"},children:[e.surroundType==="no-surround"&&e.gapConfig&&(console.log(`🪑 [가구위치] 이격거리${e.gapConfig.size}mm: X=${t.position.x.toFixed(3)}, 폭=${p.dimensions.width}mm`),null),p.type==="box"?c.jsx(i1,{moduleData:p,isDragging:s||r||i,color:P,internalHeight:y,hasDoor:t.hasDoor??!1,customDepth:w,hingePosition:t.hingePosition||"right",spaceInfo:e}):c.jsxs(c.Fragment,{children:[c.jsx(G1,{args:[_,v,b],children:c.jsx("meshPhysicalMaterial",{color:P,clearcoat:.1,clearcoatRoughness:.8,metalness:0,roughness:.7,reflectivity:.2,transparent:s||r||i,opacity:s||r||i?.8:1})}),c.jsx(Y1,{color:r?"#00ff00":i?"#ff8800":s?"#ff0000":"#cccccc",threshold:1,scale:1.001}),i&&c.jsx("primitive",{object:(()=>{const $=document.createElement("canvas"),K=$.getContext("2d");$.width=256,$.height=128,K.fillStyle="rgba(255, 140, 0, 0.9)",K.fillRect(0,0,256,128),K.fillStyle="#ffffff",K.font="16px Arial",K.textAlign="center",K.fillText("편집 모드",128,25),K.font="12px Arial",K.fillText("더블클릭으로 진입",128,40),K.fillText("드래그: 이동",128,55),K.fillText("←→: 이동",128,70),K.fillText("Del: 삭제",128,85),K.fillText("Esc: 해제",128,100);const _e=new Ut($),we=new yu({map:_e,transparent:!0,depthTest:!1}),je=new cv(3,1.5),ne=new Cm(je,we);return ne.position.set(0,v+2,0),ne.renderOrder=1002,ne})()})]})]})},O4=()=>{var u;const{spaceInfo:t}=Ct(),e=be(h=>h.placedModules),n=h=>h*.01,s=t.hasFloorFinish&&t.floorFinish?t.floorFinish.height:0,i=((u=t.baseConfig)==null?void 0:u.height)||0;let r;if(!t.baseConfig||t.baseConfig.type==="floor")r=n(s+i);else if(t.baseConfig.type==="stand")if(t.baseConfig.placementType==="float"){const h=t.baseConfig.floatHeight||0;r=n(s+h)}else r=n(s);else r=n(s);const o=g5(),a=p5({spaceInfo:t});return m5({spaceInfo:t}),c.jsx("group",{children:e.map(h=>{const d=o.dragMode,p=o.editMode&&o.editingModuleId===h.id,m=a.draggingModuleId===h.id;return c.jsx(F4,{placedModule:h,spaceInfo:t,furnitureStartY:r,isDragMode:d,isEditMode:p,isDraggingThis:m,onPointerDown:a.handlePointerDown,onPointerMove:a.handlePointerMove,onPointerUp:a.handlePointerUp,onDoubleClick:o.handleFurnitureClick},h.id)})})},oe=t=>t*.01,et=18,Fn=({args:t,position:e,material:n,renderMode:s})=>{const i=j.useMemo(()=>new oi(...t),[t]),r=j.useMemo(()=>new Sh(i),[i]);return c.jsxs("group",{position:e,children:[s==="solid"&&c.jsx("mesh",{geometry:i,receiveShadow:!0,castShadow:!0,children:c.jsx("primitive",{object:n})}),c.jsx("lineSegments",{geometry:r,children:c.jsx("lineBasicMaterial",{color:"#666666",linewidth:1})})]})},V4=({spaceInfo:t,floorColor:e="#FF9966",viewMode:n="3D",materialConfig:s})=>{var di,fi;const{renderMode:i}=xe(),{width:r,height:o}=gy(t),a=my(t),u=xb(t),h=Sb(),d=Ro(t),p=bb(t),m=yy(t),_=_y(t),y=oe(r),v=oe(o),w=oe(u),b=oe(h),A=oe(a),R={left:oe(d.left),right:oe(d.right)},N={width:oe(p.width)},M=oe(m),k=oe(_),x=j.useCallback(()=>{const Bs=(s==null?void 0:s.doorColor)||"#FFFFFF";return new Pm({color:new nt(Bs),transparent:i==="wireframe",opacity:i==="wireframe"?.3:1,clearcoat:.1,clearcoatRoughness:.8,metalness:0,roughness:.7,reflectivity:.2,envMapIntensity:0,emissive:new nt(0)})},[s==null?void 0:s.doorColor,i]),T=j.useMemo(()=>x(),[x]),E=j.useMemo(()=>x(),[x]),C=j.useMemo(()=>x(),[x]),D=j.useMemo(()=>x(),[x]),P=j.useMemo(()=>x(),[x]),I=j.useMemo(()=>x(),[x]),$=j.useMemo(()=>x(),[x]),K=j.useMemo(()=>x(),[x]),_e=j.useMemo(()=>mt.createWallMaterial(),[]),we=j.useMemo(()=>mt.createWallMaterial(),[]),je=j.useMemo(()=>mt.createWallMaterial(),[]),ne=-y/2,se=0,Ce=-w/2,Ie=Ce+(w-b)/2,de=0,Pt=oe(300),Z=w+Pt,pe=Ce,We=N.width,ze=N.width,Q=t.surroundType==="no-surround"?0:ne+R.left+We/2,Te=t.hasFloorFinish&&A>0?A:0,Pe=((di=t.baseConfig)==null?void 0:di.type)==="stand"&&((fi=t.baseConfig)==null?void 0:fi.placementType)==="float"?oe(t.baseConfig.floatHeight||0):0,ot=v-Pe,at=Te+v-M/2,pn=Te+Pe+ot/2,{wallConfig:pt}=t;return c.jsxs("group",{position:[0,0,de],children:[n==="3D"&&c.jsxs(c.Fragment,{children:[c.jsxs("mesh",{position:[-y/2-.001,Te+v/2,pe+Z/2],rotation:[0,Math.PI/2,0],children:[c.jsx("planeGeometry",{args:[Z,v]}),c.jsx("primitive",{object:mt.createShaderGradientWallMaterial("horizontal")})]}),c.jsxs("mesh",{position:[y/2+.001,Te+v/2,pe+Z/2],rotation:[0,-Math.PI/2,0],children:[c.jsx("planeGeometry",{args:[Z,v]}),c.jsx("primitive",{object:mt.createShaderGradientWallMaterial("horizontal-reverse")})]}),c.jsxs("mesh",{position:[ne+y/2,Te+v+.001,pe+Z/2],rotation:[Math.PI/2,0,0],children:[c.jsx("planeGeometry",{args:[y,Z]}),c.jsx("primitive",{object:mt.createShaderGradientWallMaterial("vertical-reverse")})]}),c.jsxs("mesh",{position:[ne+y/2,Te-.001,pe+Z/2],rotation:[-Math.PI/2,0,0],children:[c.jsx("planeGeometry",{args:[y,Z]}),c.jsx("primitive",{object:mt.createShaderGradientWallMaterial("vertical")})]}),!1,c.jsxs("mesh",{position:[ne+y/2,Te+v/2,Ce-.01],children:[c.jsx("planeGeometry",{args:[y,v]}),c.jsx("meshStandardMaterial",{color:"#ffffff",transparent:!0,opacity:0,side:vn})]}),c.jsxs("mesh",{position:[-y/2,Te+v/2,Ce+w/2],rotation:[0,0,0],children:[c.jsx("planeGeometry",{args:[.02,v]}),c.jsx("primitive",{object:mt.createEdgeShadowMaterial()})]}),c.jsxs("mesh",{position:[y/2,Te+v/2,Ce+w/2],rotation:[0,0,0],children:[c.jsx("planeGeometry",{args:[.02,v]}),c.jsx("primitive",{object:mt.createEdgeShadowMaterial()})]}),c.jsxs("mesh",{position:[ne+y/2,Te+v,Ce+w/2],rotation:[0,0,Math.PI/2],children:[c.jsx("planeGeometry",{args:[.02,y]}),c.jsx("primitive",{object:mt.createEdgeShadowMaterial()})]}),c.jsxs("mesh",{position:[ne+y/2,Te,Ce+w/2],rotation:[0,0,Math.PI/2],children:[c.jsx("planeGeometry",{args:[.02,y]}),c.jsx("primitive",{object:mt.createEdgeShadowMaterial()})]}),c.jsxs("mesh",{position:[-y/2,Te+v,pe+Z/2],rotation:[Math.PI/2,0,0],children:[c.jsx("planeGeometry",{args:[.02,Z]}),c.jsx("primitive",{object:mt.createEdgeShadowMaterial()})]}),c.jsxs("mesh",{position:[y/2,Te+v,pe+Z/2],rotation:[Math.PI/2,0,0],children:[c.jsx("planeGeometry",{args:[.02,Z]}),c.jsx("primitive",{object:mt.createEdgeShadowMaterial()})]}),c.jsxs("mesh",{position:[-y/2,Te,pe+Z/2],rotation:[Math.PI/2,0,0],children:[c.jsx("planeGeometry",{args:[.02,Z]}),c.jsx("primitive",{object:mt.createEdgeShadowMaterial()})]}),c.jsxs("mesh",{position:[y/2,Te,pe+Z/2],rotation:[Math.PI/2,0,0],children:[c.jsx("planeGeometry",{args:[.02,Z]}),c.jsx("primitive",{object:mt.createEdgeShadowMaterial()})]})]}),t.hasFloorFinish&&A>0&&c.jsx(Fn,{args:[y,A,Z],position:[ne+y/2,se+A/2,pe+Z/2],material:new Dm({color:e,transparent:!0,opacity:.3}),renderMode:i}),t.surroundType!=="no-surround"&&(t.installType==="built-in"||t.installType==="semi-standing"||t.installType==="free-standing")&&c.jsx(Fn,{args:[R.left,ot,t.installType==="semi-standing"&&!(pt!=null&&pt.left)||t.installType==="free-standing"?b-oe(et):oe(et)],position:[ne+R.left/2,pn,Ie+b/2-oe(et)/2],material:E,renderMode:i}),t.surroundType!=="no-surround"&&(t.installType==="built-in"||t.installType==="semi-standing"||t.installType==="free-standing")&&c.jsx(Fn,{args:[R.right,ot,t.installType==="semi-standing"&&!(pt!=null&&pt.right)||t.installType==="free-standing"?b-oe(et):oe(et)],position:[ne+y-R.right/2,pn,Ie+b/2-oe(et)/2],material:D,renderMode:i}),m>0&&c.jsxs(c.Fragment,{children:[t.surroundType==="no-surround"&&t.gapConfig&&console.log(`🔧 [상단프레임] 이격거리${t.gapConfig.size}mm: 실제폭=${p.width}mm, Three.js=${ze.toFixed(2)}`),c.jsx(Fn,{args:[ze,M,oe(et)],position:[Q,at,Ie+b/2-oe(et)/2-oe(30)],material:I,renderMode:i})]}),m>18&&c.jsx("group",{position:[Q,at-M/2+oe(et)/2,Ie+b/2-oe(et)/2],rotation:[Math.PI/2,0,0],children:c.jsx(Fn,{args:[ze,oe(40),oe(et)],position:[0,0,0],material:$,renderMode:i})}),t.surroundType!=="no-surround"&&(t.installType==="built-in"||t.installType==="semi-standing"&&(pt==null?void 0:pt.left))&&c.jsx("group",{position:[ne+R.left+oe(40)/2-oe(29),pn,Ie+b/2-oe(et)/2-oe(30)],rotation:[0,Math.PI/2,0],children:c.jsx(Fn,{args:[oe(40),ot,oe(et)],position:[0,0,0],material:C,renderMode:i})}),t.surroundType!=="no-surround"&&(t.installType==="built-in"||t.installType==="semi-standing"&&(pt==null?void 0:pt.right))&&c.jsx("group",{position:[ne+y-R.right-oe(40)/2+oe(29),pn,Ie+b/2-oe(et)/2-oe(30)],rotation:[0,Math.PI/2,0],children:c.jsx(Fn,{args:[oe(40),ot,oe(et)],position:[0,0,0],material:P,renderMode:i})}),_>0&&c.jsxs(c.Fragment,{children:[t.surroundType==="no-surround"&&t.gapConfig&&console.log(`🔧 [하부프레임] 이격거리${t.gapConfig.size}mm: 실제폭=${p.width}mm, Three.js=${ze.toFixed(2)}`),c.jsx(Fn,{args:[ze,k,oe(et)],position:[Q,Te+k/2,Ie+b/2-oe(et)/2-oe(30)],material:T,renderMode:i})]}),_>0&&c.jsx("group",{position:[Q,Te+k-oe(et)/2,Ie+b/2-oe(et)/2-oe(30)],rotation:[-Math.PI/2,0,0],children:c.jsx(Fn,{args:[ze,oe(40),oe(et)],position:[0,0,0],material:K,renderMode:i})}),c.jsx(O4,{})]})},B4=({columnIndex:t,columnWidth:e,position:n,internalSpace:s})=>{const i=s.height*.01,r=e*.01,o=s.depth*.01;return c.jsx("mesh",{position:[n.x,n.y+i/2,n.z],userData:{columnIndex:t,isDropTarget:!0},visible:!1,children:c.jsx("boxGeometry",{args:[r,i,o]})})},U4=()=>{var _;const{spaceInfo:t}=Ct(),e=ft(t),{columnCount:n,threeUnitBoundaries:s}=e;if(n<=1)return null;const i=dt(t),r=y=>y*.01,o=r(i.startY),a=o+r(i.height),h=-r(i.depth/2),d=t.hasFloorFinish&&t.floorFinish?t.floorFinish.height:0,p=((_=t.baseConfig)==null?void 0:_.height)||0,m=(d+p)*.01;return c.jsxs("group",{children:[c.jsx(te,{points:[new Yt(s[0],o,h),new Yt(s[s.length-1],o,h)],color:"#2ECC71",lineWidth:1,dashed:!0,dashSize:.2,gapSize:.1}),c.jsx(te,{points:[new Yt(s[0],a,h),new Yt(s[s.length-1],a,h)],color:"#2ECC71",lineWidth:1,dashed:!0,dashSize:.2,gapSize:.1}),s.map((y,v)=>c.jsxs(Je.Fragment,{children:[c.jsx(te,{points:[new Yt(y,o,h),new Yt(y,a,h)],color:"#2ECC71",lineWidth:1,dashed:!0,dashSize:.2,gapSize:.1},`vertical-guide-${v}`),c.jsx(te,{points:[new Yt(y,o,h),new Yt(y,o,h+r(700))],color:"#2ECC71",lineWidth:1,dashed:!0,dashSize:.2,gapSize:.1},`z-guide-floor-${v}`),c.jsx(te,{points:[new Yt(y,a,h),new Yt(y,a,h+r(700))],color:"#2ECC71",lineWidth:1,dashed:!0,dashSize:.2,gapSize:.1},`z-guide-ceiling-${v}`)]},`vertical-guide-group-${v}`)),e.threeUnitPositions.map((y,v)=>c.jsx(B4,{columnIndex:v,columnWidth:e.columnWidth,position:{x:y,y:m,z:0},internalSpace:i},`column-${v}`))]})},$4=({viewDirection:t})=>{const{spaceInfo:e}=Ct(),{placedModules:n}=be(),{view2DDirection:s,showDimensions:i}=tr(),r=j.useRef(null),o=t||s;if(j.useEffect(()=>{r.current&&(r.current.renderOrder=999999,r.current.traverse(E=>{"material"in E&&E.material&&(E.renderOrder=999999,E.material instanceof uv&&(E.material.depthTest=!1,E.material.depthWrite=!1,E.material.needsUpdate=!0))}))},[o,i,n]),!i)return null;const a=E=>E*.01,u=a(e.height),h=ft(e),{threeUnitBoundaries:d,columnCount:p}=h,m=n.length>0,_=o==="3D",y=u+a(m?_?350:280:_?270:200),v=-a(_?250:200),w=-a(e.width/2),b=e.frameSize||{left:50,right:50,top:50},A=(E,C,D=.015)=>{const P=new Yt(C[0]-E[0],C[1]-E[1],C[2]-E[2]).normalize(),I=new Yt(-P.y,P.x,0).multiplyScalar(D);return[[E[0]+P.x*D+I.x,E[1]+P.y*D+I.y,E[2]],E,[E[0]+P.x*D-I.x,E[1]+P.y*D-I.y,E[2]]]},R=()=>{switch(o){case"3D":case"front":return M();case"left":return k();case"right":return x();case"top":return T();default:return M()}},N=_?.5:0,M=()=>c.jsxs("group",{position:[0,0,N],renderOrder:9999,children:[c.jsxs("group",{children:[c.jsx(te,{points:[[w,y,.002],[a(e.width)+w,y,.002]],color:"#666666",lineWidth:1}),c.jsx(te,{points:A([w,y,.002],[w+.05,y,.002]),color:"#666666",lineWidth:1}),c.jsx(te,{points:A([a(e.width)+w,y,.002],[a(e.width)+w-.05,y,.002]),color:"#666666",lineWidth:1}),c.jsx(jt,{position:[a(e.width)/2+w,y+a(40),.01],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",children:e.width}),c.jsx(te,{points:[[w,0,.001],[w,y+a(20),.001]],color:"#666666",lineWidth:1}),c.jsx(te,{points:[[a(e.width)+w,0,.001],[a(e.width)+w,y+a(20),.001]],color:"#666666",lineWidth:1})]}),c.jsxs("group",{children:[c.jsx(te,{points:[[w,y-a(60),.002],[w+a(b.left),y-a(60),.002]],color:"#666666",lineWidth:1}),c.jsx(te,{points:A([w,y-a(60),.002],[w+.02,y-a(60),.002]),color:"#666666",lineWidth:1}),c.jsx(te,{points:A([w+a(b.left),y-a(60),.002],[w+a(b.left)-.02,y-a(60),.002]),color:"#666666",lineWidth:1}),c.jsx(jt,{position:[w+a(b.left)/2,y-a(30),.01],fontSize:.5,color:"black",anchorX:"center",anchorY:"middle",children:b.left}),c.jsx(te,{points:[[w,u,.001],[w,y-a(40),.001]],color:"#666666",lineWidth:1}),c.jsx(te,{points:[[w+a(b.left),u,.001],[w+a(b.left),y-a(40),.001]],color:"#666666",lineWidth:1})]}),c.jsxs("group",{children:[c.jsx(te,{points:[[a(e.width)+w-a(b.right),y-a(60),.002],[a(e.width)+w,y-a(60),.002]],color:"#666666",lineWidth:1}),c.jsx(te,{points:A([a(e.width)+w-a(b.right),y-a(60),.002],[a(e.width)+w-a(b.right)+.02,y-a(60),.002]),color:"#666666",lineWidth:1}),c.jsx(te,{points:A([a(e.width)+w,y-a(60),.002],[a(e.width)+w-.02,y-a(60),.002]),color:"#666666",lineWidth:1}),c.jsx(jt,{position:[a(e.width)+w-a(b.right)/2,y-a(30),.01],fontSize:.5,color:"black",anchorX:"center",anchorY:"middle",children:b.right}),c.jsx(te,{points:[[a(e.width)+w-a(b.right),u,.001],[a(e.width)+w-a(b.right),y-a(40),.001]],color:"#666666",lineWidth:1}),c.jsx(te,{points:[[a(e.width)+w,u,.001],[a(e.width)+w,y-a(40),.001]],color:"#666666",lineWidth:1})]}),!1,c.jsxs("group",{children:[c.jsx(te,{points:[[v+w,0,.002],[v+w,u,.002]],color:"#666666",lineWidth:1}),c.jsx(te,{points:A([v+w,0,.002],[v+w,.05,.002]),color:"#666666",lineWidth:1}),c.jsx(te,{points:A([v+w,u,.002],[v+w,u-.05,.002]),color:"#666666",lineWidth:1}),c.jsx(jt,{position:[v+w-a(60),u/2,.01],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:e.height}),c.jsx(te,{points:[[w,0,.001],[v+w-a(20),0,.001]],color:"#666666",lineWidth:1}),c.jsx(te,{points:[[w,u,.001],[v+w-a(20),u,.001]],color:"#666666",lineWidth:1})]}),c.jsx("group",{children:(()=>{var we;const E=a(e.width)+w+a(_?120:200),C=b.top,D=((we=e.baseConfig)==null?void 0:we.height)||65,P=e.height-C-D,I=0,$=a(D),K=a(D+P),_e=u;return c.jsxs(c.Fragment,{children:[c.jsxs("group",{children:[c.jsx(te,{points:[[E,I,.002],[E,$,.002]],color:"#666666",lineWidth:1}),c.jsx(te,{points:A([E,I,.002],[E,.03,.002]),color:"#666666",lineWidth:1}),c.jsx(te,{points:A([E,$,.002],[E,$-.03,.002]),color:"#666666",lineWidth:1}),c.jsx(jt,{position:[E+a(_?30:60),a(D/2),.01],fontSize:.5,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:D})]}),c.jsxs("group",{children:[c.jsx(te,{points:[[E,$,.002],[E,K,.002]],color:"#666666",lineWidth:1}),c.jsx(te,{points:A([E,$,.002],[E,$+.03,.002]),color:"#666666",lineWidth:1}),c.jsx(te,{points:A([E,K,.002],[E,K-.03,.002]),color:"#666666",lineWidth:1}),c.jsx(jt,{position:[E+a(_?30:60),a(D+P/2),.01],fontSize:.5,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:P})]}),c.jsxs("group",{children:[c.jsx(te,{points:[[E,K,.002],[E,_e,.002]],color:"#666666",lineWidth:1}),c.jsx(te,{points:A([E,K,.002],[E,K+.03,.002]),color:"#666666",lineWidth:1}),c.jsx(te,{points:A([E,_e,.002],[E,_e-.03,.002]),color:"#666666",lineWidth:1}),c.jsx(jt,{position:[E+a(_?30:60),a(e.height-C/2),.01],fontSize:.5,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:C})]}),c.jsx(te,{points:[[a(e.width)+w,I,.001],[E+a(_?10:20),I,.001]],color:"#666666",lineWidth:1}),c.jsx(te,{points:[[a(e.width)+w,$,.001],[E+a(_?10:20),$,.001]],color:"#666666",lineWidth:1}),c.jsx(te,{points:[[a(e.width)+w,K,.001],[E+a(_?10:20),K,.001]],color:"#666666",lineWidth:1}),c.jsx(te,{points:[[a(e.width)+w,_e,.001],[E+a(_?10:20),_e,.001]],color:"#666666",lineWidth:1})]})})()}),n.length>0&&n.map((E,C)=>{var je,ne,se,Ce,Ie,de;const D=Dt(E.moduleId,{width:e.width,height:e.height,depth:e.depth},e);if(!D)return null;const P=a(D.dimensions.width),I=E.position.x-P/2,$=E.position.x+P/2,K=y-a(120),_e=D.id.includes("dual");_e?(je=D.modelConfig)!=null&&je.leftSections||(ne=D.modelConfig)!=null&&ne.sections:(se=D.modelConfig)!=null&&se.sections,_e&&((Ce=D.modelConfig)!=null&&Ce.rightSections||(Ie=D.modelConfig)!=null&&Ie.sections);let we;return _e?(de=D.modelConfig)!=null&&de.rightAbsoluteWidth?(we=D.modelConfig.rightAbsoluteWidth,D.dimensions.width-we):(D.dimensions.width/2,we=D.dimensions.width/2):(D.dimensions.width,we=0),c.jsxs("group",{renderOrder:999999,children:[c.jsx(te,{points:[[I,u,.001],[I,u,.001]],color:"#cccccc",lineWidth:1,dashed:!0,dashSize:.02,gapSize:.01,renderOrder:999999}),c.jsx(te,{points:[[$,u,.001],[$,u,.001]],color:"#cccccc",lineWidth:1,dashed:!0,dashSize:.02,gapSize:.01,renderOrder:999999}),c.jsx(te,{points:[[I,K,.002],[$,K,.002]],color:"#666666",lineWidth:1,renderOrder:999999}),c.jsx(te,{points:A([I,K,.002],[I+.02,K,.002],.01),color:"#666666",lineWidth:1,renderOrder:999999}),c.jsx(te,{points:A([$,K,.002],[$-.02,K,.002],.01),color:"#666666",lineWidth:1,renderOrder:999999}),c.jsx(jt,{position:[E.position.x,K-a(30),.01],fontSize:.5,color:"#666666",anchorX:"center",anchorY:"middle",renderOrder:999999,children:D.dimensions.width}),c.jsx(te,{points:[[I,u,.001],[I,y+a(20),.001]],color:"#666666",lineWidth:1,renderOrder:999999}),c.jsx(te,{points:[[$,u,.001],[$,y+a(20),.001]],color:"#666666",lineWidth:1,renderOrder:999999})]},`module-guide-${C}`)})]}),k=()=>c.jsxs("group",{children:[c.jsx(te,{points:[[0,u+a(100),0],[0,u+a(100),a(e.depth)]],color:"#666666",lineWidth:1}),c.jsx(jt,{position:[0,u+a(140),a(e.depth)/2],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",children:e.depth}),c.jsx(te,{points:[[-a(100),0,0],[-a(100),u,0]],color:"#666666",lineWidth:1}),c.jsx(jt,{position:[-a(140),u/2,0],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:e.height})]}),x=()=>c.jsxs("group",{children:[c.jsx(te,{points:[[a(e.width),u+a(100),0],[a(e.width),u+a(100),a(e.depth)]],color:"#666666",lineWidth:1}),c.jsx(jt,{position:[a(e.width),u+a(140),a(e.depth)/2],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",children:e.depth}),c.jsx(te,{points:[[a(e.width)+a(100),0,0],[a(e.width)+a(100),u,0]],color:"#666666",lineWidth:1}),c.jsx(jt,{position:[a(e.width)+a(140),u/2,0],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:e.height})]}),T=()=>c.jsxs("group",{children:[c.jsx(te,{points:[[0,u,-a(100)],[a(e.width),u,-a(100)]],color:"#666666",lineWidth:1}),c.jsx(jt,{position:[a(e.width)/2,u,-a(140)],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",children:e.width}),c.jsx(te,{points:[[-a(100),u,0],[-a(100),u,a(e.depth)]],color:"#666666",lineWidth:1}),c.jsx(jt,{position:[-a(140),u,a(e.depth)/2],fontSize:.4,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:e.depth})]});return c.jsx("group",{ref:r,renderOrder:999999,children:R()})},H4=({spaceInfo:t})=>{const e=be(y=>y.placedModules),n=be(y=>y.addModule),s=be(y=>y.currentDragData),i=be(y=>y.setCurrentDragData),{camera:r,scene:o}=xh(),[a,u]=j.useState(null),h=dt(t),d=ft(t),p=Je.useCallback((y,v)=>{var E;if(!s)return!1;let w;try{const C=(E=y.dataTransfer)==null?void 0:E.getData("application/json");if(!C)return!1;w=JSON.parse(C)}catch(C){return console.error("Error parsing drag data:",C),!1}if(!w||w.type!=="furniture")return!1;const b=Yu(y.clientX,y.clientY,v,r,o,t);if(b===null)return!1;const A=Oa(w.moduleData.id,t);if(!ao(b,A,e,t))return!1;const R=f5(b,w.moduleData.id,t);if(R===null)return!1;const N=`placed-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,M=Dt(w.moduleData.id,h,t),x=(C=>{if(console.log("⚙️ [SlotDropZones] getDefaultDepth 계산:",{moduleId:C==null?void 0:C.id,moduleName:C==null?void 0:C.name,moduleDefaultDepth:C==null?void 0:C.defaultDepth,spaceDepth:t.depth}),C!=null&&C.defaultDepth){const I=Math.min(C.defaultDepth,t.depth);return console.log("✅ [SlotDropZones] defaultDepth 사용:",{moduleDefaultDepth:C.defaultDepth,spaceDepth:t.depth,finalResult:I}),I}const D=Math.floor(t.depth*.9),P=Math.min(D,580);return console.log("⚠️ [SlotDropZones] fallback 사용:",{spaceBasedDepth:D,fallbackLimit:580,finalResult:P,reason:"moduleData?.defaultDepth가 없음"}),P})(M),T={id:N,moduleId:w.moduleData.id,position:{x:R,y:0,z:0},rotation:0,hasDoor:w.moduleData.hasDoor??!1,customDepth:x,slotIndex:b,isDualSlot:A,isValidInCurrentSpace:!0};return n(T),i(null),!0},[s,r,o,t,h,e,n,i]);j.useEffect(()=>(window.handleSlotDrop=p,()=>{delete window.handleSlotDrop}),[p]),j.useEffect(()=>{var b;if(!s)return;const y=A=>{A.preventDefault();const R=document.querySelector("canvas");if(!R)return;const N=Yu(A.clientX,A.clientY,R,r,o,t);if(N!==null&&s){const M=Oa(s.moduleData.id,t);ao(N,M,e,t)?u(N):u(null)}else u(N)},v=()=>{u(null)},w=(b=document.querySelector("canvas"))==null?void 0:b.parentElement;return w&&(w.addEventListener("dragover",y),w.addEventListener("dragleave",v)),()=>{w&&(w.removeEventListener("dragover",y),w.removeEventListener("dragleave",v))}},[s,r,o,t,e]);const m=h5(t),_=d5(t);return c.jsxs("group",{children:[d.threeUnitPositions.map((y,v)=>c.jsxs("mesh",{position:[y,_+m.height/2,0],userData:{slotIndex:v,isSlotCollider:!0,type:"slot-collider"},visible:!1,children:[c.jsx("boxGeometry",{args:[m.width,m.height,m.depth]}),c.jsx("meshBasicMaterial",{transparent:!0,opacity:0})]},`slot-collider-${v}`)),d.threeUnitPositions.map((y,v)=>{let w=!1;s&&(w=Oa(s.moduleData.id,t));let b=!1;if(a!==null&&s&&(w?b=v===a||v===a+1:b=v===a),!b||!s)return null;const A=Dt(s.moduleData.id,h,t);if(!A)return null;const N=(ne=>{if(ne!=null&&ne.defaultDepth)return Math.min(ne.defaultDepth,t.depth);const se=Math.floor(t.depth*.9);return Math.min(se,580)})(A),M=A.dimensions.height*.01,k=_+M/2;let x=y;if(w&&a!==null&&v===a){const ne=d.threeUnitPositions[v+1];ne!==void 0&&(x=(y+ne)/2)}else if(w&&a!==null&&v===a+1)return null;const T=ne=>ne*.01,C=T(20),D=1500,P=600,I=T(D),$=T(P),_e=-I/2+(I-$)/2,we=T(N),je=_e+$/2-C-we/2;return c.jsx("group",{position:[x,k,je],children:c.jsx(i1,{moduleData:A,color:"#88ff88",isDragging:!0,internalHeight:A.dimensions.height,hasDoor:!1,customDepth:N,spaceInfo:t})},`furniture-preview-${v}`)})]})},W4="_shortcutsPanel_c1pi5_1",X4="_collapsed_c1pi5_14",G4="_expanded_c1pi5_25",Y4="_header_c1pi5_31",z4="_title_c1pi5_40",q4="_expandButton_c1pi5_51",K4="_expandIcon_c1pi5_72",Q4="_collapseButton_c1pi5_79",J4="_shortcuts_c1pi5_1",Z4="_shortcutItem_c1pi5_111",e6="_key_c1pi5_119",t6="_action_c1pi5_136",Xt={shortcutsPanel:W4,collapsed:X4,expanded:G4,header:Y4,title:z4,expandButton:q4,expandIcon:K4,collapseButton:Q4,shortcuts:J4,shortcutItem:Z4,key:e6,action:t6},n6=()=>{const[t,e]=j.useState(!1),n=[{key:"좌클릭",action:"가구 선택/이동"},{key:"더블클릭",action:"가구 편집모드"},{key:"휠클릭",action:"화면 이동"},{key:"Option+드래그",action:"화면 이동"},{key:"우클릭",action:"카메라 회전"},{key:"휠스크롤",action:"줌 인/아웃"},{key:"←/→",action:"가구 이동"},{key:"Del",action:"가구 삭제"},{key:"Esc",action:"편집 종료"}],s=()=>{e(!t)};return c.jsx("div",{className:`${Xt.shortcutsPanel} ${t?Xt.expanded:Xt.collapsed}`,children:t?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:Xt.header,children:[c.jsx("div",{className:Xt.title,children:"조작법"}),c.jsx("button",{className:Xt.collapseButton,onClick:s,"aria-label":"조작법 접기",title:"접기",children:"↑"})]}),c.jsx("div",{className:Xt.shortcuts,children:n.map((i,r)=>c.jsxs("div",{className:Xt.shortcutItem,children:[c.jsx("span",{className:Xt.key,children:i.key}),c.jsx("span",{className:Xt.action,children:i.action})]},r))})]}):c.jsx("button",{className:Xt.expandButton,onClick:s,"aria-label":"조작법 보기",title:"조작법 보기",children:c.jsx("span",{className:Xt.expandIcon,children:"↓"})})})},s6=t=>{const{spaceInfo:e,svgSize:n,viewMode:s="3D",setViewMode:i,renderMode:r="wireframe"}=t,o=bm(),{spaceInfo:a}=Ct(),{placedModules:u}=be(),{view2DDirection:h}=tr(),d=a.materialConfig||{interiorColor:"#FFFFFF",doorColor:"#FFFFFF"},p=j.useMemo(()=>{const{width:v,height:w,depth:b=600}=e,A=s5(v,w,b,u.length),R=0,N=ol(w*.5),M=0,k=[R,N,A];if(s==="3D")return k;switch(h){case"front":return k;case"left":return[-A,N,M];case"right":return[A,N,M];case"top":return[R,ol(w+A*10),M];default:return k}},[e,s,h,u.length]),m=j.useMemo(()=>`${o.pathname}-${s}-${h}`,[o.pathname,s,h]),_=v=>{v.preventDefault(),v.stopPropagation();const w=v.currentTarget.querySelector("canvas");if(!w)return;const b=window.handleSlotDrop;typeof b=="function"&&b(v.nativeEvent,w)},y=v=>{v.preventDefault()};return j.useEffect(()=>()=>{(()=>{document.querySelectorAll("canvas").forEach(b=>{const A=b.getContext("2d");A&&A.clearRect(0,0,b.width,b.height);const R=b.getContext("webgl")||b.getContext("webgl2");if(R&&!R.isContextLost())try{const N=R.getExtension("WEBGL_lose_context");N&&N.loseContext()}catch(N){console.log("WebGL context cleanup error:",N)}})})()},[]),c.jsx(ZC,{spaceInfo:e,svgSize:n,renderMode:r,children:c.jsxs("div",{style:{width:"100%",height:"100%",minHeight:"400px",position:"relative"},onDrop:_,onDragOver:y,children:[c.jsx(u5,{cameraPosition:p,viewMode:s,renderMode:r,children:c.jsxs(Je.Suspense,{fallback:null,children:[c.jsx("directionalLight",{position:[5,15,20],intensity:2.5,color:"#ffffff",castShadow:!0,"shadow-mapSize-width":4096,"shadow-mapSize-height":4096,"shadow-camera-far":50,"shadow-camera-left":-25,"shadow-camera-right":25,"shadow-camera-top":25,"shadow-camera-bottom":-25,"shadow-bias":-1e-4,"shadow-radius":8,"shadow-normalBias":.015}),c.jsx("directionalLight",{position:[-8,10,15],intensity:.6,color:"#ffffff"}),c.jsx("directionalLight",{position:[8,10,15],intensity:.6,color:"#ffffff"}),c.jsx("ambientLight",{intensity:.5,color:"#ffffff"}),c.jsx(V4,{spaceInfo:e,viewMode:s,materialConfig:d}),s==="3D"&&c.jsx(U4,{}),c.jsx($4,{viewDirection:s==="3D"?"3D":h}),c.jsx(H4,{spaceInfo:e})]})}),c.jsx(n6,{})]},m)})},i6=Je.memo(s6),r6="_container_4zesp_1",o6="_tabMenu_4zesp_7",a6="_tabButton_4zesp_16",l6="_activeTab_4zesp_33",c6="_thumbnailGrid_4zesp_41",u6="_thumbnailItem_4zesp_49",h6="_disabled_4zesp_76",d6="_thumbnailImage_4zesp_89",f6="_disabledOverlay_4zesp_105",p6="_emptyMessage_4zesp_124",kt={container:r6,tabMenu:o6,tabButton:a6,activeTab:l6,thumbnailGrid:c6,thumbnailItem:u6,disabled:h6,thumbnailImage:d6,disabledOverlay:f6,emptyMessage:p6},Ug={"single-2drawer-hanging":"/images/furniture-thumbnails/single-2drawer-hanging.png","single-2hanging":"/images/furniture-thumbnails/single-2hanging.png","single-4drawer-hanging":"/images/furniture-thumbnails/single-4drawer-hanging.png","dual-2drawer-hanging":"/images/furniture-thumbnails/dual-2drawer-hanging.png","dual-2hanging":"/images/furniture-thumbnails/dual-2hanging.png","dual-4drawer-hanging":"/images/furniture-thumbnails/dual-4drawer-hanging.png","dual-2drawer-styler":"/images/furniture-thumbnails/dual-2drawer-styler.png","dual-4drawer-pantshanger":"/images/furniture-thumbnails/dual-4drawer-pantshanger.png"},g6=({module:t,iconPath:e,isValid:n})=>{const s=be(a=>a.setFurniturePlacementMode),i=be(a=>a.setCurrentDragData),r=a=>{if(!n){a.preventDefault();return}s(!0);const u={type:"furniture",moduleData:{id:t.id,name:t.name,dimensions:t.dimensions,type:t.type||"default",color:t.color,hasDoor:t.hasDoor||!1}};a.dataTransfer.setData("application/json",JSON.stringify(u)),a.dataTransfer.setData("text/plain",t.id),a.dataTransfer.effectAllowed="copy",i(u)},o=()=>{s(!1),i(null)};return c.jsxs("div",{className:`${kt.thumbnailItem} ${n?"":kt.disabled}`,draggable:n,onDragStart:r,onDragEnd:o,title:n?`드래그하여 배치: ${t.name}`:"현재 공간에 배치할 수 없습니다",children:[c.jsx("div",{className:kt.thumbnailImage,children:c.jsx("img",{src:e,alt:t.name,onError:a=>{const u=a.target;u.dataset.fallbackAttempted||(u.dataset.fallbackAttempted="true",u.src="/images/furniture-thumbnails/single-2drawer-hanging.png")}})}),!n&&c.jsx("div",{className:kt.disabledOverlay})]})},m6=()=>{const[t,e]=j.useState("all"),{spaceInfo:n}=Ct(),s=dt(n),i=ft(n),r=i.columnWidth,o=tC("full",s,n),{singleModules:a,dualModules:u}=j.useMemo(()=>i.columnCount<=1?{singleModules:o,dualModules:[]}:o.reduce((_,y)=>{const v=y.dimensions.width;if(Math.abs(v-r)<=30)_.singleModules.push(y);else if(Math.abs(v-r*2)<=30){if((y.id.includes("dual-2drawer-styler-")||y.id.includes("dual-4drawer-pantshanger-"))&&r<550)return _;_.dualModules.push(y)}else if(v<r*1.5)_.singleModules.push(y);else{if((y.id.includes("dual-2drawer-styler-")||y.id.includes("dual-4drawer-pantshanger-"))&&r<550)return _;_.dualModules.push(y)}return _},{singleModules:[],dualModules:[]}),[o,r,i.columnCount]),h=t==="all"?[...a,...u]:t==="single"?a:u,d=m=>{const _=m.replace(/-\d+$/,"");return Ug[_]||Ug["single-2drawer-hanging"]},p=m=>m.dimensions.width<=s.width&&m.dimensions.height<=s.height&&m.dimensions.depth<=s.depth;return c.jsxs("div",{className:kt.container,children:[c.jsxs("div",{className:kt.tabMenu,children:[c.jsxs("button",{className:`${kt.tabButton} ${t==="all"?kt.activeTab:""}`,onClick:()=>e("all"),children:["전체 (",a.length+u.length,")"]}),c.jsxs("button",{className:`${kt.tabButton} ${t==="single"?kt.activeTab:""}`,onClick:()=>e("single"),children:["싱글 (",a.length,")"]}),c.jsxs("button",{className:`${kt.tabButton} ${t==="dual"?kt.activeTab:""}`,onClick:()=>e("dual"),children:["듀얼 (",u.length,")"]})]}),c.jsx("div",{className:kt.thumbnailGrid,children:h.length>0?h.map(m=>{const _=d(m.id),y=p(m);return c.jsx(g6,{module:m,iconPath:_,isValid:y},m.id)}):c.jsx("div",{className:kt.emptyMessage,children:"이 유형에 맞는 가구가 없습니다"})})]})},_6="_overlay_yemqx_1",y6="_panel_yemqx_14",v6="_header_yemqx_26",w6="_title_yemqx_35",T6="_closeButton_yemqx_42",E6="_content_yemqx_62",A6="_moduleInfo_yemqx_68",I6="_modulePreview_yemqx_74",x6="_moduleBox_yemqx_86",S6="_moduleDetails_yemqx_93",b6="_moduleName_yemqx_97",C6="_property_yemqx_104",D6="_propertyLabel_yemqx_114",P6="_propertyValue_yemqx_122",R6="_placeholder_yemqx_129",Oe={overlay:_6,panel:y6,header:v6,title:w6,closeButton:T6,content:E6,moduleInfo:A6,modulePreview:I6,moduleBox:x6,moduleDetails:S6,moduleName:b6,property:C6,propertyLabel:D6,propertyValue:P6,placeholder:R6},N6=()=>{const{spaceInfo:t}=Ct(),{selectedModuleForProperties:e,setSelectedModuleForProperties:n}=tr();if(!e)return null;const s=dt(t),i=Dt(e,s,t);if(!i)return null;const r=()=>{n(null)},o=a=>{a.target===a.currentTarget&&r()};return c.jsx("div",{className:Oe.overlay,onClick:o,children:c.jsxs("div",{className:Oe.panel,children:[c.jsxs("div",{className:Oe.header,children:[c.jsx("h3",{className:Oe.title,children:"가구 속성"}),c.jsx("button",{className:Oe.closeButton,onClick:r,children:"✕"})]}),c.jsxs("div",{className:Oe.content,children:[c.jsxs("div",{className:Oe.moduleInfo,children:[c.jsx("div",{className:Oe.modulePreview,children:c.jsx("div",{className:Oe.moduleBox,style:{backgroundColor:i.color,aspectRatio:`${i.dimensions.width} / ${i.dimensions.height}`}})}),c.jsxs("div",{className:Oe.moduleDetails,children:[c.jsx("h4",{className:Oe.moduleName,children:i.name}),c.jsxs("div",{className:Oe.property,children:[c.jsx("span",{className:Oe.propertyLabel,children:"크기:"}),c.jsxs("span",{className:Oe.propertyValue,children:[i.dimensions.width," × ",i.dimensions.height," × ",i.dimensions.depth,"mm"]})]}),c.jsxs("div",{className:Oe.property,children:[c.jsx("span",{className:Oe.propertyLabel,children:"타입:"}),c.jsx("span",{className:Oe.propertyValue,children:i.type||"기본"})]}),c.jsxs("div",{className:Oe.property,children:[c.jsx("span",{className:Oe.propertyLabel,children:"도어:"}),c.jsx("span",{className:Oe.propertyValue,children:i.hasDoor?"있음":"없음"})]}),i.description&&c.jsxs("div",{className:Oe.property,children:[c.jsx("span",{className:Oe.propertyLabel,children:"설명:"}),c.jsx("span",{className:Oe.propertyValue,children:i.description})]}),i.isDynamic&&c.jsxs("div",{className:Oe.property,children:[c.jsx("span",{className:Oe.propertyLabel,children:"맞춤형:"}),c.jsx("span",{className:Oe.propertyValue,children:"예"})]})]})]}),c.jsx("div",{className:Oe.placeholder,children:c.jsx("p",{children:"추가 속성 설정은 곧 추가될 예정입니다."})})]})]})})},M6="_overlay_pi4u7_1",j6="_panel_pi4u7_15",L6="_header_pi4u7_38",k6="_title_pi4u7_48",F6="_closeButton_pi4u7_54",O6="_content_pi4u7_73",V6="_moduleInfo_pi4u7_79",B6="_modulePreview_pi4u7_87",U6="_moduleBox_pi4u7_99",$6="_moduleDetails_pi4u7_106",H6="_moduleName_pi4u7_110",W6="_property_pi4u7_117",X6="_propertyLabel_pi4u7_127",G6="_propertyValue_pi4u7_135",Y6="_propertySection_pi4u7_142",z6="_sectionTitle_pi4u7_150",q6="_depthInputWrapper_pi4u7_160",K6="_inputWithUnit_pi4u7_166",Q6="_depthInput_pi4u7_160",J6="_inputError_pi4u7_188",Z6="_unit_pi4u7_193",e3="_errorMessage_pi4u7_201",t3="_depthRange_pi4u7_207",n3="_doorSelector_pi4u7_247",s3="_hingeSubSection_pi4u7_255",i3="_subSectionTitle_pi4u7_260",r3="_hingeSelector_pi4u7_267",o3="_radioLabel_pi4u7_273",a3="_radioText_pi4u7_293",l3="_editGuide_pi4u7_304",me={overlay:M6,panel:j6,header:L6,title:k6,closeButton:F6,content:O6,moduleInfo:V6,modulePreview:B6,moduleBox:U6,moduleDetails:$6,moduleName:H6,property:W6,propertyLabel:X6,propertyValue:G6,propertySection:Y6,sectionTitle:z6,depthInputWrapper:q6,inputWithUnit:K6,depthInput:Q6,inputError:J6,unit:Z6,errorMessage:e3,depthRange:t3,doorSelector:n3,hingeSubSection:s3,subSectionTitle:i3,hingeSelector:r3,radioLabel:o3,radioText:a3,editGuide:l3},c3=()=>{const{spaceInfo:t}=Ct(),e=be(I=>I.placedModules),n=be(I=>I.updatePlacedModule),s=be(I=>I.editMode),i=be(I=>I.editingModuleId),r=be(I=>I.setEditMode),o=be(I=>I.setEditingModuleId),a=e.find(I=>I.id===i),u=j.useCallback(I=>{if(I!=null&&I.defaultDepth)return Math.min(I.defaultDepth,t.depth);const $=Math.floor(t.depth*.9);return Math.min($,Xs.DEPTH.DEFAULT_FALLBACK)},[t.depth]),[h,d]=j.useState(580),[p,m]=j.useState("580"),[_,y]=j.useState(""),[v,w]=j.useState("right"),[b,A]=j.useState(!1);if(j.useEffect(()=>{if(a){const I=dt(t),$=Dt(a.moduleId,I,t),K=a.customDepth||u($||void 0);d(K),m(K.toString()),w(a.hingePosition||"right"),A(a.hasDoor??!1)}},[a,t,u]),!s||!i||!a)return null;const R=dt(t),N=Dt(a.moduleId,R,t);if(!N)return null;const M=a.moduleId.includes("dual"),k=()=>{r(!1),o(null)},x=I=>{d(I),i&&n(i,{customDepth:I})},T=I=>{(I===""||/^\d+$/.test(I))&&(m(I),y(""))},E=()=>{const I=p;if(I===""){m(h.toString());return}const $=parseInt(I),K=Xs.DEPTH.MIN,_e=Math.min(t.depth,Xs.DEPTH.MAX);$<K?y(`최소 ${K}mm 이상이어야 합니다`):$>_e?y(`최대 ${_e}mm 이하여야 합니다`):(y(""),x($))},C=I=>{I.key==="Enter"&&E()},D=I=>{w(I),i&&n(i,{hingePosition:I})},P=I=>{A(I),i&&n(i,{hasDoor:I})};return c.jsx("div",{className:me.overlay,children:c.jsxs("div",{className:me.panel,children:[c.jsxs("div",{className:me.header,children:[c.jsx("h3",{className:me.title,children:"가구 편집"}),c.jsx("button",{className:me.closeButton,onClick:k,children:"✕"})]}),c.jsxs("div",{className:me.content,children:[c.jsxs("div",{className:me.moduleInfo,children:[c.jsx("div",{className:me.modulePreview,children:c.jsx("div",{className:me.moduleBox,style:{backgroundColor:N.color,aspectRatio:`${N.dimensions.width} / ${N.dimensions.height}`}})}),c.jsxs("div",{className:me.moduleDetails,children:[c.jsx("h4",{className:me.moduleName,children:N.name}),c.jsxs("div",{className:me.property,children:[c.jsx("span",{className:me.propertyLabel,children:"크기:"}),c.jsxs("span",{className:me.propertyValue,children:[N.dimensions.width," × ",N.dimensions.height," × ",h,"mm"]})]}),c.jsxs("div",{className:me.property,children:[c.jsx("span",{className:me.propertyLabel,children:"위치:"}),c.jsxs("span",{className:me.propertyValue,children:["X: ",Math.round(a.position.x*100),"mm, Z: ",Math.round(a.position.z*100),"mm"]})]})]})]}),c.jsxs("div",{className:me.propertySection,children:[c.jsx("h5",{className:me.sectionTitle,children:"가구 깊이"}),c.jsxs("div",{className:me.depthInputWrapper,children:[c.jsxs("div",{className:me.inputWithUnit,children:[c.jsx("input",{type:"text",value:p,onChange:I=>T(I.target.value),onBlur:E,onKeyDown:C,className:`${me.depthInput} ${_?me.inputError:""}`,placeholder:`${Xs.DEPTH.MIN}-${Xs.DEPTH.MAX}`}),c.jsx("span",{className:me.unit,children:"mm"})]}),_&&c.jsx("div",{className:me.errorMessage,children:_}),c.jsxs("div",{className:me.depthRange,children:["범위: ",Xs.DEPTH.MIN,"mm ~ ",Math.min(t.depth,Xs.DEPTH.MAX),"mm"]})]})]}),N.hasDoor&&c.jsxs("div",{className:me.propertySection,children:[c.jsx("h5",{className:me.sectionTitle,children:"도어 유무"}),c.jsxs("div",{className:me.doorSelector,children:[c.jsxs("label",{className:me.radioLabel,children:[c.jsx("input",{type:"radio",name:"doorOption",value:"none",checked:!b,onChange:()=>P(!1)}),c.jsx("span",{className:me.radioText,children:"없음 (오픈형으로 설치)"})]}),c.jsxs("label",{className:me.radioLabel,children:[c.jsx("input",{type:"radio",name:"doorOption",value:"with-door",checked:b,onChange:()=>P(!0)}),c.jsx("span",{className:me.radioText,children:"있음 (문짝으로 설치)"})]})]}),b&&!M&&c.jsxs("div",{className:me.hingeSubSection,children:[c.jsx("h6",{className:me.subSectionTitle,children:"힌지 위치"}),c.jsxs("div",{className:me.hingeSelector,children:[c.jsxs("label",{className:me.radioLabel,children:[c.jsx("input",{type:"radio",name:"hingePosition",value:"left",checked:v==="left",onChange:()=>D("left")}),c.jsx("span",{className:me.radioText,children:"왼쪽 (오른쪽으로 열림)"})]}),c.jsxs("label",{className:me.radioLabel,children:[c.jsx("input",{type:"radio",name:"hingePosition",value:"right",checked:v==="right",onChange:()=>D("right")}),c.jsx("span",{className:me.radioText,children:"오른쪽 (왼쪽으로 열림)"})]})]})]})]}),c.jsxs("div",{className:me.editGuide,children:[c.jsx("p",{children:"• 가구를 더블클릭하여 편집모드에 진입할 수 있습니다"}),c.jsx("p",{children:"• 마우스 드래그로 가구를 이동할 수 있습니다"}),c.jsx("p",{children:"• 키보드 화살표로 가구를 이동할 수 있습니다"}),c.jsx("p",{children:"• Delete 키로 가구를 삭제할 수 있습니다"}),c.jsx("p",{children:"• Esc 키로 편집을 종료할 수 있습니다"})]})]})]})})};function Zl(){return(Zl=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t}).apply(this,arguments)}function r1(t,e){if(t==null)return{};var n,s,i={},r=Object.keys(t);for(s=0;s<r.length;s++)e.indexOf(n=r[s])>=0||(i[n]=t[n]);return i}function ih(t){var e=j.useRef(t),n=j.useRef(function(s){e.current&&e.current(s)});return e.current=t,n.current}var go=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=1),t>n?n:t<e?e:t},zr=function(t){return"touches"in t},rh=function(t){return t&&t.ownerDocument.defaultView||self},$g=function(t,e,n){var s=t.getBoundingClientRect(),i=zr(e)?function(r,o){for(var a=0;a<r.length;a++)if(r[a].identifier===o)return r[a];return r[0]}(e.touches,n):e;return{left:go((i.pageX-(s.left+rh(t).pageXOffset))/s.width),top:go((i.pageY-(s.top+rh(t).pageYOffset))/s.height)}},Hg=function(t){!zr(t)&&t.preventDefault()},o1=Je.memo(function(t){var e=t.onMove,n=t.onKey,s=r1(t,["onMove","onKey"]),i=j.useRef(null),r=ih(e),o=ih(n),a=j.useRef(null),u=j.useRef(!1),h=j.useMemo(function(){var _=function(w){Hg(w),(zr(w)?w.touches.length>0:w.buttons>0)&&i.current?r($g(i.current,w,a.current)):v(!1)},y=function(){return v(!1)};function v(w){var b=u.current,A=rh(i.current),R=w?A.addEventListener:A.removeEventListener;R(b?"touchmove":"mousemove",_),R(b?"touchend":"mouseup",y)}return[function(w){var b=w.nativeEvent,A=i.current;if(A&&(Hg(b),!function(N,M){return M&&!zr(N)}(b,u.current)&&A)){if(zr(b)){u.current=!0;var R=b.changedTouches||[];R.length&&(a.current=R[0].identifier)}A.focus(),r($g(A,b,a.current)),v(!0)}},function(w){var b=w.which||w.keyCode;b<37||b>40||(w.preventDefault(),o({left:b===39?.05:b===37?-.05:0,top:b===40?.05:b===38?-.05:0}))},v]},[o,r]),d=h[0],p=h[1],m=h[2];return j.useEffect(function(){return m},[m]),Je.createElement("div",Zl({},s,{onTouchStart:d,onMouseDown:d,className:"react-colorful__interactive",ref:i,onKeyDown:p,tabIndex:0,role:"slider"}))}),Vd=function(t){return t.filter(Boolean).join(" ")},a1=function(t){var e=t.color,n=t.left,s=t.top,i=s===void 0?.5:s,r=Vd(["react-colorful__pointer",t.className]);return Je.createElement("div",{className:r,style:{top:100*i+"%",left:100*n+"%"}},Je.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:e}}))},cn=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=Math.pow(10,e)),Math.round(n*t)/n},u3=function(t){var e=t.s,n=t.v,s=t.a,i=(200-e)*n/100;return{h:cn(t.h),s:cn(i>0&&i<200?e*n/100/(i<=100?i:200-i)*100:0),l:cn(i/2),a:cn(s,2)}},oh=function(t){var e=u3(t);return"hsl("+e.h+", "+e.s+"%, "+e.l+"%)"},h3=function(t){return{h:cn(t.h),s:cn(t.s),v:cn(t.v),a:cn(t.a,2)}},d3=Je.memo(function(t){var e=t.hue,n=t.onChange,s=Vd(["react-colorful__hue",t.className]);return Je.createElement("div",{className:s},Je.createElement(o1,{onMove:function(i){n({h:360*i.left})},onKey:function(i){n({h:go(e+360*i.left,0,360)})},"aria-label":"Hue","aria-valuenow":cn(e),"aria-valuemax":"360","aria-valuemin":"0"},Je.createElement(a1,{className:"react-colorful__hue-pointer",left:e/360,color:oh({h:e,s:100,v:100,a:1})})))}),f3=Je.memo(function(t){var e=t.hsva,n=t.onChange,s={backgroundColor:oh({h:e.h,s:100,v:100,a:1})};return Je.createElement("div",{className:"react-colorful__saturation",style:s},Je.createElement(o1,{onMove:function(i){n({s:100*i.left,v:100-100*i.top})},onKey:function(i){n({s:go(e.s+100*i.left,0,100),v:go(e.v-100*i.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+cn(e.s)+"%, Brightness "+cn(e.v)+"%"},Je.createElement(a1,{className:"react-colorful__saturation-pointer",top:1-e.v/100,left:e.s/100,color:oh(e)})))}),l1=function(t,e){if(t===e)return!0;for(var n in t)if(t[n]!==e[n])return!1;return!0};function p3(t,e,n){var s=ih(n),i=j.useState(function(){return t.toHsva(e)}),r=i[0],o=i[1],a=j.useRef({color:e,hsva:r});j.useEffect(function(){if(!t.equal(e,a.current.color)){var h=t.toHsva(e);a.current={hsva:h,color:e},o(h)}},[e,t]),j.useEffect(function(){var h;l1(r,a.current.hsva)||t.equal(h=t.fromHsva(r),a.current.color)||(a.current={hsva:r,color:h},s(h))},[r,t,s]);var u=j.useCallback(function(h){o(function(d){return Object.assign({},d,h)})},[]);return[r,u]}var g3=typeof window<"u"?j.useLayoutEffect:j.useEffect,m3=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},Wg=new Map,_3=function(t){g3(function(){var e=t.current?t.current.ownerDocument:document;if(e!==void 0&&!Wg.has(e)){var n=e.createElement("style");n.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,Wg.set(e,n);var s=m3();s&&n.setAttribute("nonce",s),e.head.appendChild(n)}},[])},y3=function(t){var e=t.className,n=t.colorModel,s=t.color,i=s===void 0?n.defaultColor:s,r=t.onChange,o=r1(t,["className","colorModel","color","onChange"]),a=j.useRef(null);_3(a);var u=p3(n,i,r),h=u[0],d=u[1],p=Vd(["react-colorful",e]);return Je.createElement("div",Zl({},o,{ref:a,className:p}),Je.createElement(f3,{hsva:h,onChange:d}),Je.createElement(d3,{hue:h.h,onChange:d,className:"react-colorful__last-control"}))},v3={defaultColor:{h:0,s:0,v:0},toHsva:function(t){return{h:t.h,s:t.s,v:t.v,a:1}},fromHsva:function(t){var e=h3(t);return{h:e.h,s:e.s,v:e.v}},equal:l1},Xg=function(t){return Je.createElement(y3,Zl({},t,{colorModel:v3}))};const w3="_container_auesn_1",T3="_header_auesn_8",E3="_title_auesn_14",A3="_tabNavigation_auesn_22",I3="_tab_auesn_22",x3="_activeTab_auesn_48",S3="_tabIcon_auesn_55",b3="_tabLabel_auesn_59",C3="_content_auesn_65",D3="_tabContent_auesn_71",P3="_section_auesn_76",R3="_sectionTitle_auesn_84",N3="_sectionDescription_auesn_93",M3="_colorSection_auesn_101",j3="_colorPicker_auesn_108",L3="_controlLabel_auesn_121",k3="_colorPalette_auesn_128",F3="_savedColors_auesn_134",O3="_colorButton_auesn_140",V3="_addColorButton_auesn_159",B3="_currentColor_auesn_193",U3="_currentColorDisplay_auesn_201",$3="_colorPreview_auesn_208",H3="_colorCode_auesn_216",W3="_selectedColor_auesn_228",fe={container:w3,header:T3,title:E3,tabNavigation:A3,tab:I3,activeTab:x3,tabIcon:S3,tabLabel:b3,content:C3,tabContent:D3,section:P3,sectionTitle:R3,sectionDescription:N3,colorSection:M3,colorPicker:j3,controlLabel:L3,colorPalette:k3,savedColors:F3,colorButton:O3,addColorButton:V3,currentColor:B3,currentColorDisplay:U3,colorPreview:$3,colorCode:H3,selectedColor:W3},Vc=t=>{(!t||typeof t!="string")&&(t="#FFFFFF");const e=parseInt(t.slice(1,3),16)/255,n=parseInt(t.slice(3,5),16)/255,s=parseInt(t.slice(5,7),16)/255,i=Math.max(e,n,s),r=Math.min(e,n,s),o=i-r;let a=0;const u=i===0?0:o/i,h=i;return o!==0&&(i===e?a=(n-s)/o%6:i===n?a=(s-e)/o+2:a=(e-n)/o+4),a=a*60,a<0&&(a+=360),{h:a,s:u*100,v:h*100}},X3=t=>{const{h:e,s:n,v:s}=t,i=n/100,r=s/100,o=r*i,a=o*(1-Math.abs(e/60%2-1)),u=r-o;let h,d,p;return e>=0&&e<60?(h=o,d=a,p=0):e>=60&&e<120?(h=a,d=o,p=0):e>=120&&e<180?(h=0,d=o,p=a):e>=180&&e<240?(h=0,d=a,p=o):e>=240&&e<300?(h=a,d=0,p=o):(h=o,d=0,p=a),h=Math.round((h+u)*255),d=Math.round((d+u)*255),p=Math.round((p+u)*255),`#${h.toString(16).padStart(2,"0")}${d.toString(16).padStart(2,"0")}${p.toString(16).padStart(2,"0")}`},G3=()=>{const[t,e]=j.useState("interior"),{spaceInfo:n,setSpaceInfo:s}=Ct(),i=n.materialConfig||{interiorColor:"#FFFFFF",doorColor:"#FFFFFF"},r=t==="interior"?i.interiorColor||"#FFFFFF":i.doorColor||"#FFFFFF",[o,a]=j.useState(()=>Vc(r)),[u,h]=j.useState(!1);j.useMemo(()=>{const b=Vc(r);a(b)},[r]);const d=b=>{const A=t==="interior"?"interiorColor":"doorColor",R={...i,[A]:b};console.log("🎨 MaterialPanel 색상 업데이트 시작:",{activeTab:t,propertyKey:A,oldColor:i[A],newColor:b,oldMaterialConfig:i,newMaterialConfig:R}),s({materialConfig:R}),setTimeout(()=>{var M;const N=Ct.getState().spaceInfo;console.log("🎨 MaterialPanel 업데이트 후 Store 상태:",{updatedMaterialConfig:N.materialConfig,expectedColor:b,actualColor:(M=N.materialConfig)==null?void 0:M[A]})},100)},p=b=>{a(b)},m=()=>{console.log("🎨 MaterialPanel 드래그 시작:",{activeTab:t}),h(!0)},_=()=>{if(console.log("🎨 MaterialPanel 드래그 완료:",{isDragging:u,activeTab:t,localHsv:o}),u){const b=X3(o);console.log("🎨 MaterialPanel HSV → HEX 변환:",{localHsv:o,hexColor:b,activeTab:t}),d(b),h(!1)}},y=b=>{console.log("🎨 MaterialPanel 색상 선택:",{color:b,activeTab:t});const A=Vc(b);a(A),d(b)},v=[{id:"interior",label:"내부",icon:"🟫"},{id:"door",label:"도어",icon:"🚪"}],w=()=>{switch(t){case"interior":return c.jsx("div",{className:fe.tabContent,children:c.jsxs("div",{className:fe.section,children:[c.jsx("h4",{className:fe.sectionTitle,children:"내부 색상"}),c.jsx("p",{className:fe.sectionDescription,children:"모든 가구의 내부 색상이 동일하게 적용됩니다."}),c.jsxs("div",{className:fe.currentColor,children:[c.jsx("label",{className:fe.controlLabel,children:"현재 색상"}),c.jsxs("div",{className:fe.currentColorDisplay,children:[c.jsx("div",{className:fe.colorPreview,style:{backgroundColor:r}}),c.jsx("span",{className:fe.colorCode,children:r})]})]}),c.jsxs("div",{className:fe.colorSection,children:[c.jsx("div",{className:fe.colorPicker,children:c.jsx(Xg,{color:o,onChange:p,onMouseDown:m,onMouseUp:_})}),c.jsxs("div",{className:fe.colorPalette,children:[c.jsx("label",{className:fe.controlLabel,children:"저장된 색상"}),c.jsxs("div",{className:fe.savedColors,children:[["#333333","#666666","#999999","#CCCCCC","#F5F5F5","#FFFFFF"].map((b,A)=>c.jsx("button",{className:`${fe.colorButton} ${r===b?fe.selectedColor:""}`,style:{backgroundColor:b},title:b,onClick:()=>y(b)},A)),c.jsx("button",{className:fe.addColorButton,title:"색상 추가",children:"+"})]})]})]})]})});case"door":return c.jsx("div",{className:fe.tabContent,children:c.jsxs("div",{className:fe.section,children:[c.jsx("h4",{className:fe.sectionTitle,children:"도어 색상"}),c.jsx("p",{className:fe.sectionDescription,children:"모든 가구의 도어 색상이 동일하게 적용됩니다."}),c.jsxs("div",{className:fe.currentColor,children:[c.jsx("label",{className:fe.controlLabel,children:"현재 색상"}),c.jsxs("div",{className:fe.currentColorDisplay,children:[c.jsx("div",{className:fe.colorPreview,style:{backgroundColor:r}}),c.jsx("span",{className:fe.colorCode,children:r})]})]}),c.jsxs("div",{className:fe.colorSection,children:[c.jsx("div",{className:fe.colorPicker,children:c.jsx(Xg,{color:o,onChange:p,onMouseDown:m,onMouseUp:_})}),c.jsxs("div",{className:fe.colorPalette,children:[c.jsx("label",{className:fe.controlLabel,children:"저장된 색상"}),c.jsxs("div",{className:fe.savedColors,children:[["#000000","#8B4513","#654321","#D2691E","#F4A460","#DEB887"].map((b,A)=>c.jsx("button",{className:`${fe.colorButton} ${r===b?fe.selectedColor:""}`,style:{backgroundColor:b},title:b,onClick:()=>y(b)},A)),c.jsx("button",{className:fe.addColorButton,title:"색상 추가",children:"+"})]})]})]})]})});default:return null}};return c.jsxs("div",{className:fe.container,children:[c.jsx("div",{className:fe.header,children:c.jsx("h3",{className:fe.title,children:"재질"})}),c.jsx("div",{className:fe.tabNavigation,children:v.map(b=>c.jsxs("button",{className:`${fe.tab} ${t===b.id?fe.activeTab:""}`,onClick:()=>{console.log("🎨 MaterialPanel 탭 변경:",{from:t,to:b.id,currentMaterialConfig:i}),e(b.id)},children:[c.jsx("span",{className:fe.tabIcon,children:b.icon}),c.jsx("span",{className:fe.tabLabel,children:b.label})]},b.id))}),c.jsx("div",{className:fe.content,children:w()})]})};function Y3(t){const e=Math.sqrt(Math.pow(t,2)+Math.pow(t,2))/2;return-(t-Math.sqrt(Math.pow(t,2)-Math.pow(e,2)))/e}function V(t,e,n){return{x:t??0,y:e??0,z:n??0}}function Xe(t,e){return{x:t??0,y:e??0}}class Vt{static next(){return(++Vt.seed).toString(16).toUpperCase()}static peek(){return(Vt.seed+1).toString(16).toUpperCase()}static clear(){Vt.seed=0}}Vt.seed=0;class z3{constructor(){this.handle=Vt.next()}dxfy(e){e.type("ENDBLK"),e.handle(this.handle),e.push(330,this.ownerObjectHandle),e.subclassMarker("AcDbEntity"),e.layerName("0"),e.subclassMarker("AcDbBlockEnd")}}const ca=(t,e)=>({tl:t,br:e});class Ue{static centerRadiusBBox(e,n){return ca(V(e.x-n,e.y+n),V(e.x+n,e.y-n))}static pointBBox(e){return ca(V(e.x-100,e.y+100),V(e.x+100,e.y-100))}static lineBBox(e,n){const s=e.x>n.x?e.x:n.x,i=e.x<n.x?e.x:n.x,r=e.y>n.y?e.y:n.y,o=e.y<n.y?e.y:n.y,a=e.z>n.z?e.z:n.z,u=e.z<n.z?e.z:n.z;return ca(V(i,r,u),V(s,o,a))}static verticesBBox(e){let n=-1/0,s=-1/0,i=1/0,r=1/0;for(let o=0;o<e.length;o++){const{x:a,y:u}=e[o];n<a&&(n=a),s<u&&(s=u),i>a&&(i=a),r>u&&(r=u)}return ca(V(i,s),V(n,r))}static boundingBox(e){if(e.length===0)return Ue.pointBBox(V());const n=[];for(let s=0;s<e.length;s++){const i=e[s];n.push(i.tl,i.br)}return Ue.verticesBBox(n)}static boundingBoxCenter(e){return V(e.tl.x+(e.br.x-e.tl.x)/2,e.br.y+(e.tl.y-e.br.y)/2,0)}static boundingBoxHeight(e){return e.tl.y-e.br.y}}var fl,ah,lh;(function(t){t[t.None=0]="None",t[t.Frozen=1]="Frozen",t[t.FrozenInNewViewports=2]="FrozenInNewViewports",t[t.Locked=4]="Locked",t[t.XRefDependent=16]="XRefDependent",t[t.XRefResolved=32]="XRefResolved"})(fl||(fl={})),function(t){t[t.None=0]="None",t[t.DescribeShape=1]="DescribeShape",t[t.VerticalText=4]="VerticalText",t[t.XRefDependent=16]="XRefDependent",t[t.XRefResolved=32]="XRefResolved"}(ah||(ah={})),function(t){t[t.None=0]="None",t[t.PaperSpace=1]="PaperSpace",t[t.XRefDependent=16]="XRefDependent",t[t.XRefResolved=32]="XRefResolved"}(lh||(lh={}));class Vs{constructor(e){this.type=e,this.handle=Vt.next()}dxfy(e){e.type(this.type),e.handle(this.handle),e.push(330,this.ownerObjectHandle),e.subclassMarker("AcDbSymbolTableRecord")}}class Ni extends Vs{constructor(e,n,s,i){super("LAYER"),this.name=e,this.colorNumber=n,this.lineType=s,this.flags=i??fl.None}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbLayerTableRecord"),e.name(this.name),e.push(70,this.flags),e.colorNumber(this.colorNumber),e.push(420,this.trueColor),e.lineType(this.lineType),e.push(370,0),e.push(390,0),e.push(347,this.materialObject)}}Ni.layerZeroName="0";const q3=[[["00","00","00"],0,["0","0","0"]],[["FF","00","00"],1,["255","0","0"]],[["FF","FF","00"],2,["255","255","0"]],[["00","FF","00"],3,["0","255","0"]],[["00","FF","FF"],4,["0","255","255"]],[["00","00","FF"],5,["0","0","255"]],[["FF","00","FF"],6,["255","0","255"]],[["FF","FF","FF"],7,["255","255","255"]],[["41","41","41"],8,["65","65","65"]],[["80","80","80"],9,["128","128","128"]],[["FF","00","00"],10,["255","0","0"]],[["FF","AA","AA"],11,["255","170","170"]],[["BD","00","00"],12,["189","0","0"]],[["BD","7E","7E"],13,["189","126","126"]],[["81","00","00"],14,["129","0","0"]],[["81","56","56"],15,["129","86","86"]],[["68","00","00"],16,["104","0","0"]],[["68","45","45"],17,["104","69","69"]],[["4F","00","00"],18,["79","0","0"]],[["4F","35","35"],19,["79","53","53"]],[["FF","3F","00"],20,["255","63","0"]],[["FF","BF","AA"],21,["255","191","170"]],[["BD","2E","00"],22,["189","46","0"]],[["BD","8D","7E"],23,["189","141","126"]],[["81","1F","00"],24,["129","31","0"]],[["81","60","56"],25,["129","96","86"]],[["68","19","00"],26,["104","25","0"]],[["68","4E","45"],27,["104","78","69"]],[["4F","13","00"],28,["79","19","0"]],[["4F","3B","35"],29,["79","59","53"]],[["FF","7F","00"],30,["255","127","0"]],[["FF","D4","AA"],31,["255","212","170"]],[["BD","5E","00"],32,["189","94","0"]],[["BD","9D","7E"],33,["189","157","126"]],[["81","40","00"],34,["129","64","0"]],[["81","6B","56"],35,["129","107","86"]],[["68","34","00"],36,["104","52","0"]],[["68","56","45"],37,["104","86","69"]],[["4F","27","00"],38,["79","39","0"]],[["4F","42","35"],39,["79","66","53"]],[["FF","BF","00"],40,["255","191","0"]],[["FF","EA","AA"],41,["255","234","170"]],[["BD","8D","00"],42,["189","141","0"]],[["BD","AD","7E"],43,["189","173","126"]],[["81","60","00"],44,["129","96","0"]],[["81","76","56"],45,["129","118","86"]],[["68","4E","00"],46,["104","78","0"]],[["68","5F","45"],47,["104","95","69"]],[["4F","3B","00"],48,["79","59","0"]],[["4F","49","35"],49,["79","73","53"]],[["FF","FF","00"],50,["255","255","0"]],[["FF","FF","AA"],51,["255","255","170"]],[["BD","BD","00"],52,["189","189","0"]],[["BD","BD","7E"],53,["189","189","126"]],[["81","81","00"],54,["129","129","0"]],[["81","81","56"],55,["129","129","86"]],[["68","68","00"],56,["104","104","0"]],[["68","68","45"],57,["104","104","69"]],[["4F","4F","00"],58,["79","79","0"]],[["4F","4F","35"],59,["79","79","53"]],[["BF","FF","00"],60,["191","255","0"]],[["EA","FF","AA"],61,["234","255","170"]],[["8D","BD","00"],62,["141","189","0"]],[["AD","BD","7E"],63,["173","189","126"]],[["60","81","00"],64,["96","129","0"]],[["76","81","56"],65,["118","129","86"]],[["4E","68","00"],66,["78","104","0"]],[["5F","68","45"],67,["95","104","69"]],[["3B","4F","00"],68,["59","79","0"]],[["49","4F","35"],69,["73","79","53"]],[["7F","FF","00"],70,["127","255","0"]],[["D4","FF","AA"],71,["212","255","170"]],[["5E","BD","00"],72,["94","189","0"]],[["9D","BD","7E"],73,["157","189","126"]],[["40","81","00"],74,["64","129","0"]],[["6B","81","56"],75,["107","129","86"]],[["34","68","00"],76,["52","104","0"]],[["56","68","45"],77,["86","104","69"]],[["27","4F","00"],78,["39","79","0"]],[["42","4F","35"],79,["66","79","53"]],[["3F","FF","00"],80,["63","255","0"]],[["BF","FF","AA"],81,["191","255","170"]],[["2E","BD","00"],82,["46","189","0"]],[["8D","BD","7E"],83,["141","189","126"]],[["1F","81","00"],84,["31","129","0"]],[["60","81","56"],85,["96","129","86"]],[["19","68","00"],86,["25","104","0"]],[["4E","68","45"],87,["78","104","69"]],[["13","4F","00"],88,["19","79","0"]],[["3B","4F","35"],89,["59","79","53"]],[["00","FF","00"],90,["0","255","0"]],[["AA","FF","AA"],91,["170","255","170"]],[["00","BD","00"],92,["0","189","0"]],[["7E","BD","7E"],93,["126","189","126"]],[["00","81","00"],94,["0","129","0"]],[["56","81","56"],95,["86","129","86"]],[["00","68","00"],96,["0","104","0"]],[["45","68","45"],97,["69","104","69"]],[["00","4F","00"],98,["0","79","0"]],[["35","4F","35"],99,["53","79","53"]],[["00","FF","3F"],100,["0","255","63"]],[["AA","FF","BF"],101,["170","255","191"]],[["00","BD","2E"],102,["0","189","46"]],[["7E","BD","8D"],103,["126","189","141"]],[["00","81","1F"],104,["0","129","31"]],[["56","81","60"],105,["86","129","96"]],[["00","68","19"],106,["0","104","25"]],[["45","68","4E"],107,["69","104","78"]],[["00","4F","13"],108,["0","79","19"]],[["35","4F","3B"],109,["53","79","59"]],[["00","FF","7F"],110,["0","255","127"]],[["AA","FF","D4"],111,["170","255","212"]],[["00","BD","5E"],112,["0","189","94"]],[["7E","BD","9D"],113,["126","189","157"]],[["00","81","40"],114,["0","129","64"]],[["56","81","6B"],115,["86","129","107"]],[["00","68","34"],116,["0","104","52"]],[["45","68","56"],117,["69","104","86"]],[["00","4F","27"],118,["0","79","39"]],[["35","4F","42"],119,["53","79","66"]],[["00","FF","BF"],120,["0","255","191"]],[["AA","FF","EA"],121,["170","255","234"]],[["00","BD","8D"],122,["0","189","141"]],[["7E","BD","AD"],123,["126","189","173"]],[["00","81","60"],124,["0","129","96"]],[["56","81","76"],125,["86","129","118"]],[["00","68","4E"],126,["0","104","78"]],[["45","68","5F"],127,["69","104","95"]],[["00","4F","3B"],128,["0","79","59"]],[["35","4F","49"],129,["53","79","73"]],[["00","FF","FF"],130,["0","255","255"]],[["AA","FF","FF"],131,["170","255","255"]],[["00","BD","BD"],132,["0","189","189"]],[["7E","BD","BD"],133,["126","189","189"]],[["00","81","81"],134,["0","129","129"]],[["56","81","81"],135,["86","129","129"]],[["00","68","68"],136,["0","104","104"]],[["45","68","68"],137,["69","104","104"]],[["00","4F","4F"],138,["0","79","79"]],[["35","4F","4F"],139,["53","79","79"]],[["00","BF","FF"],140,["0","191","255"]],[["AA","EA","FF"],141,["170","234","255"]],[["00","8D","BD"],142,["0","141","189"]],[["7E","AD","BD"],143,["126","173","189"]],[["00","60","81"],144,["0","96","129"]],[["56","76","81"],145,["86","118","129"]],[["00","4E","68"],146,["0","78","104"]],[["45","5F","68"],147,["69","95","104"]],[["00","3B","4F"],148,["0","59","79"]],[["35","49","4F"],149,["53","73","79"]],[["00","7F","FF"],150,["0","127","255"]],[["AA","D4","FF"],151,["170","212","255"]],[["00","5E","BD"],152,["0","94","189"]],[["7E","9D","BD"],153,["126","157","189"]],[["00","40","81"],154,["0","64","129"]],[["56","6B","81"],155,["86","107","129"]],[["00","34","68"],156,["0","52","104"]],[["45","56","68"],157,["69","86","104"]],[["00","27","4F"],158,["0","39","79"]],[["35","42","4F"],159,["53","66","79"]],[["00","3F","FF"],160,["0","63","255"]],[["AA","BF","FF"],161,["170","191","255"]],[["00","2E","BD"],162,["0","46","189"]],[["7E","8D","BD"],163,["126","141","189"]],[["00","1F","81"],164,["0","31","129"]],[["56","60","81"],165,["86","96","129"]],[["00","19","68"],166,["0","25","104"]],[["45","4E","68"],167,["69","78","104"]],[["00","13","4F"],168,["0","19","79"]],[["35","3B","4F"],169,["53","59","79"]],[["00","00","FF"],170,["0","0","255"]],[["AA","AA","FF"],171,["170","170","255"]],[["00","00","BD"],172,["0","0","189"]],[["7E","7E","BD"],173,["126","126","189"]],[["00","00","81"],174,["0","0","129"]],[["56","56","81"],175,["86","86","129"]],[["00","00","68"],176,["0","0","104"]],[["45","45","68"],177,["69","69","104"]],[["00","00","4F"],178,["0","0","79"]],[["35","35","4F"],179,["53","53","79"]],[["3F","00","FF"],180,["63","0","255"]],[["BF","AA","FF"],181,["191","170","255"]],[["2E","00","BD"],182,["46","0","189"]],[["8D","7E","BD"],183,["141","126","189"]],[["1F","00","81"],184,["31","0","129"]],[["60","56","81"],185,["96","86","129"]],[["19","00","68"],186,["25","0","104"]],[["4E","45","68"],187,["78","69","104"]],[["13","00","4F"],188,["19","0","79"]],[["3B","35","4F"],189,["59","53","79"]],[["7F","00","FF"],190,["127","0","255"]],[["D4","AA","FF"],191,["212","170","255"]],[["5E","00","BD"],192,["94","0","189"]],[["9D","7E","BD"],193,["157","126","189"]],[["40","00","81"],194,["64","0","129"]],[["6B","56","81"],195,["107","86","129"]],[["34","00","68"],196,["52","0","104"]],[["56","45","68"],197,["86","69","104"]],[["27","00","4F"],198,["39","0","79"]],[["42","35","4F"],199,["66","53","79"]],[["BF","00","FF"],200,["191","0","255"]],[["EA","AA","FF"],201,["234","170","255"]],[["8D","00","BD"],202,["141","0","189"]],[["AD","7E","BD"],203,["173","126","189"]],[["60","00","81"],204,["96","0","129"]],[["76","56","81"],205,["118","86","129"]],[["4E","00","68"],206,["78","0","104"]],[["5F","45","68"],207,["95","69","104"]],[["3B","00","4F"],208,["59","0","79"]],[["49","35","4F"],209,["73","53","79"]],[["FF","00","FF"],210,["255","0","255"]],[["FF","AA","FF"],211,["255","170","255"]],[["BD","00","BD"],212,["189","0","189"]],[["BD","7E","BD"],213,["189","126","189"]],[["81","00","81"],214,["129","0","129"]],[["81","56","81"],215,["129","86","129"]],[["68","00","68"],216,["104","0","104"]],[["68","45","68"],217,["104","69","104"]],[["4F","00","4F"],218,["79","0","79"]],[["4F","35","4F"],219,["79","53","79"]],[["FF","00","BF"],220,["255","0","191"]],[["FF","AA","EA"],221,["255","170","234"]],[["BD","00","8D"],222,["189","0","141"]],[["BD","7E","AD"],223,["189","126","173"]],[["81","00","60"],224,["129","0","96"]],[["81","56","76"],225,["129","86","118"]],[["68","00","4E"],226,["104","0","78"]],[["68","45","5F"],227,["104","69","95"]],[["4F","00","3B"],228,["79","0","59"]],[["4F","35","49"],229,["79","53","73"]],[["FF","00","7F"],230,["255","0","127"]],[["FF","AA","D4"],231,["255","170","212"]],[["BD","00","5E"],232,["189","0","94"]],[["BD","7E","9D"],233,["189","126","157"]],[["81","00","40"],234,["129","0","64"]],[["81","56","6B"],235,["129","86","107"]],[["68","00","34"],236,["104","0","52"]],[["68","45","56"],237,["104","69","86"]],[["4F","00","27"],238,["79","0","39"]],[["4F","35","42"],239,["79","53","66"]],[["FF","00","3F"],240,["255","0","63"]],[["FF","AA","BF"],241,["255","170","191"]],[["BD","00","2E"],242,["189","0","46"]],[["BD","7E","8D"],243,["189","126","141"]],[["81","00","1F"],244,["129","0","31"]],[["81","56","60"],245,["129","86","96"]],[["68","00","19"],246,["104","0","25"]],[["68","45","4E"],247,["104","69","78"]],[["4F","00","13"],248,["79","0","19"]],[["4F","35","3B"],249,["79","53","59"]],[["33","33","33"],250,["51","51","51"]],[["50","50","50"],251,["80","80","80"]],[["69","69","69"],252,["105","105","105"]],[["82","82","82"],253,["130","130","130"]],[["BE","BE","BE"],254,["190","190","190"]],[["FF","FF","FF"],255,["255","255","255"]]];function Gg(t){let e="";const n=q3.find(s=>{const[,i]=s;return i===t});if(n){const[s]=n,[i,r,o]=s;e=`${i}${r}${o}`}return e}class K3{constructor(e){this.name=e,this.tags=[]}add(e,n){this.tags.push({code:e,value:n})}dxfy(e){e.push(102,`{${this.name}`);for(const n of this.tags)e.push(n.code,n.value);e.push(102,"}")}}class Q3{constructor(){this.lines=[]}push(e,n){n!=null&&this.lines.push(e,n)}stringify(){return this.lines.join(`
`)}start(e){this.push(0,"SECTION"),this.push(2,e)}end(){this.push(0,"ENDSEC")}variableName(e){this.push(9,e)}type(e){this.push(0,e)}primaryText(e){this.push(1,e)}name(e,n=2){this.push(n,e)}handle(e){this.push(5,e)}lineType(e){this.push(6,e)}textStyle(e){this.push(7,e)}layerName(e){this.push(8,e)}point2d(e,n=0){this.push(10+n,e==null?void 0:e.x),this.push(20+n,e==null?void 0:e.y)}point3d(e,n=0){this.point2d(e,n),this.push(30+n,e==null?void 0:e.z)}elevation(e){this.push(38,e)}thickness(e){this.push(39,e)}visibilty(e){e!=null&&this.push(60,e?0:1)}colorNumber(e){this.push(62,e)}subclassMarker(e){this.push(100,e)}}var ch,pl,gl,Le;function ke(t,e,n,s){if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)}function Lr(t,e,n,s,i){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n}function Ge(t,e){return{code:t,value:e}}function Yg(t,e=255){const n=[],s=[];for(let i=0;i<t.length;i++){const r=t[i];s.length===e||i===t.length-1?(n.push(s.join("")),s.length=0):s.push(r)}return n}(function(t){t[t.Red=1]="Red",t[t.Green=3]="Green",t[t.Cyan=4]="Cyan",t[t.Blue=5]="Blue",t[t.Magenta=6]="Magenta",t[t.White=7]="White",t[t.Black=0]="Black",t[t.Yellow=2]="Yellow"})(ch||(ch={})),function(t){t[t.Unitless=0]="Unitless",t[t.Inches=1]="Inches",t[t.Feet=2]="Feet",t[t.Miles=3]="Miles",t[t.Millimeters=4]="Millimeters",t[t.Centimeters=5]="Centimeters",t[t.Meters=6]="Meters",t[t.Kilometers=7]="Kilometers",t[t.Microinches=8]="Microinches",t[t.Mils=9]="Mils",t[t.Yards=10]="Yards",t[t.Angstroms=11]="Angstroms",t[t.Nanometers=12]="Nanometers",t[t.Microns=13]="Microns",t[t.Decimeters=14]="Decimeters",t[t.Decameters=15]="Decameters",t[t.Hectometers=16]="Hectometers",t[t.Gigameters=17]="Gigameters",t[t.AstronomicalUnits=18]="AstronomicalUnits",t[t.LightYears=19]="LightYears",t[t.Parsecs=20]="Parsecs",t[t.USSurveyFeet=21]="USSurveyFeet",t[t.USSurveyInch=22]="USSurveyInch",t[t.USSurveyYard=23]="USSurveyYard",t[t.USSurveyMile=24]="USSurveyMile"}(pl||(pl={})),function(t){t.Continuous="Continuous"}(gl||(gl={})),typeof SuppressedError=="function"&&SuppressedError;class J3{constructor(e){Le.set(this,void 0),this.name=e,Lr(this,Le,[])}clear(){ke(this,Le,"f").length=0}string(e){Yg(e).forEach(n=>ke(this,Le,"f").push(Ge(1e3,n)))}beginList(){ke(this,Le,"f").push(Ge(1002,"{"))}endList(){ke(this,Le,"f").push(Ge(1002,"}"))}layerName(e){ke(this,Le,"f").push(Ge(1003,e))}binaryData(e){Yg(e).forEach(n=>ke(this,Le,"f").push(Ge(1004,n)))}databaseHandle(e){ke(this,Le,"f").push(Ge(1005,e))}point(e){ke(this,Le,"f").push(Ge(1010,e.x)),ke(this,Le,"f").push(Ge(1020,e.y)),ke(this,Le,"f").push(Ge(1030,e.z))}position(e){ke(this,Le,"f").push(Ge(1011,e.x)),ke(this,Le,"f").push(Ge(1021,e.y)),ke(this,Le,"f").push(Ge(1031,e.z))}displacement(e){ke(this,Le,"f").push(Ge(1012,e.x)),ke(this,Le,"f").push(Ge(1022,e.y)),ke(this,Le,"f").push(Ge(1032,e.z))}direction(e){ke(this,Le,"f").push(Ge(1013,e.x)),ke(this,Le,"f").push(Ge(1023,e.y)),ke(this,Le,"f").push(Ge(1033,e.z))}real(e){ke(this,Le,"f").push(Ge(1040,e))}distance(e){ke(this,Le,"f").push(Ge(1041,e))}scale(e){ke(this,Le,"f").push(Ge(1042,e))}integer(e){ke(this,Le,"f").push(Ge(1070,e))}long(e){ke(this,Le,"f").push(Ge(1071,e))}dxfy(e){e.push(1001,this.name),e.push(1002,"{"),ke(this,Le,"f").forEach(n=>e.push(n.code,n.value)),e.push(1002,"}")}}Le=new WeakMap;class W{set angle(e){this.patternsData.forEach(n=>n.lineAngle=e)}constructor(e){this.name=e,this.patternsData=[],this.scale=1}dxfy(e){e.push(78,this.patternsData.length);for(const n of this.patternsData){e.push(53,n.lineAngle),e.push(43,n.x),e.push(44,n.y),e.push(45,n.offsetX*this.scale),e.push(46,n.offsetY*this.scale),e.push(79,n.dashLengthItems.length);for(const s of n.dashLengthItems)e.push(49,s*this.scale)}}add(e){this.patternsData.push(e)}}const H=new Map,Bc=new W("ANGLE");Bc.add({lineAngle:0,x:0,y:0,offsetX:.275,offsetY:.2,dashLengthItems:[-.075]}),Bc.add({lineAngle:90,x:0,y:0,offsetX:.275,offsetY:.2,dashLengthItems:[-.075]}),H.set("ANGLE",Bc);const zg=new W("ANSI31");zg.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:1.25,dashLengthItems:[]}),H.set("ANSI31",zg);const qg=new W("ANSI32");qg.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),H.set("ANSI32",qg);const Uc=new W("ANSI33");Uc.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:9.525,dashLengthItems:[]}),Uc.add({lineAngle:45,x:4.49013,y:0,offsetX:0,offsetY:9.525,dashLengthItems:[]}),H.set("ANSI33",Uc);const $c=new W("ANSI34");$c.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),$c.add({lineAngle:45,x:4.49013,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[3.175,-1.5875]}),H.set("ANSI34",$c);const Er=new W("ANSI35");Er.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:19.05,dashLengthItems:[]}),Er.add({lineAngle:45,x:4.49013,y:0,offsetX:0,offsetY:19.05,dashLengthItems:[]}),Er.add({lineAngle:45,x:8.98026,y:0,offsetX:0,offsetY:19.05,dashLengthItems:[]}),Er.add({lineAngle:45,x:13.4704,y:0,offsetX:0,offsetY:19.05,dashLengthItems:[]}),H.set("ANSI35",Er);const Hc=new W("ANSI36");Hc.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),Hc.add({lineAngle:45,x:4.49013,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[7.9375,-1.5875,0,-1.5875]}),H.set("ANSI36",Hc);const Kg=new W("ANSI37");Kg.add({lineAngle:45,x:0,y:0,offsetX:5.55625,offsetY:3.175,dashLengthItems:[7.9375,-1.5875,0,-1.5875]}),H.set("ANSI37",Kg);const Wc=new W("ANSI38");Wc.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),Wc.add({lineAngle:135,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),H.set("ANSI38",Wc);const Xc=new W("AR_B816");Xc.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),Xc.add({lineAngle:135,x:0,y:0,offsetX:6.35,offsetY:3.175,dashLengthItems:[7.9375,-4.7625]}),H.set("AR_B816",Xc);const Gc=new W("AR_B816C");Gc.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:203.2,dashLengthItems:[]}),Gc.add({lineAngle:90,x:0,y:0,offsetX:203.2,offsetY:203.2,dashLengthItems:[203.2,-203.2]}),H.set("AR_B816C",Gc);const Ar=new W("AR_B88");Ar.add({lineAngle:0,x:0,y:0,offsetX:203.2,offsetY:203.2,dashLengthItems:[396.875,-9.525]}),Ar.add({lineAngle:0,x:-203.2,y:9.525,offsetX:203.2,offsetY:203.2,dashLengthItems:[396.875,-9.525]}),Ar.add({lineAngle:90,x:0,y:0,offsetX:203.2,offsetY:203.2,dashLengthItems:[-212.725,193.675]}),Ar.add({lineAngle:90,x:-9.525,y:0,offsetX:203.2,offsetY:203.2,dashLengthItems:[-212.725,193.675]}),H.set("AR_B88",Ar);const Yc=new W("AR_BRELM");Yc.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:203.2,dashLengthItems:[]}),Yc.add({lineAngle:90,x:0,y:0,offsetX:203.2,offsetY:101.6,dashLengthItems:[203.2,-203.2]}),H.set("AR_BRELM",Yc);const On=new W("AR_BRSTD");On.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:135.484,dashLengthItems:[193.675,-9.525]}),On.add({lineAngle:0,x:0,y:57.15,offsetX:0,offsetY:135.484,dashLengthItems:[193.675,-9.525]}),On.add({lineAngle:0,x:50.8,y:67.7418,offsetX:0,offsetY:135.484,dashLengthItems:[92.075,-9.525]}),On.add({lineAngle:0,x:50.8,y:124.892,offsetX:0,offsetY:135.484,dashLengthItems:[92.075,-9.525]}),On.add({lineAngle:90,x:0,y:0,offsetX:0,offsetY:203.2,dashLengthItems:[57.15,-78.334]}),On.add({lineAngle:90,x:-9.525,y:0,offsetX:0,offsetY:203.2,dashLengthItems:[57.15,-78.334]}),On.add({lineAngle:90,x:50.8,y:67.7418,offsetX:0,offsetY:101.6,dashLengthItems:[57.15,-78.334]}),On.add({lineAngle:90,x:41.275,y:67.7418,offsetX:0,offsetY:101.6,dashLengthItems:[57.15,-78.334]}),H.set("AR_BRSTD",On);const zc=new W("AR_CONC");zc.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:67.7418,dashLengthItems:[]}),zc.add({lineAngle:90,x:0,y:0,offsetX:67.7418,offsetY:101.6,dashLengthItems:[67.7418,-67.7418]}),H.set("AR_CONC",zc);const Lt=new W("AR_HBONE");Lt.add({lineAngle:50,x:0,y:0,offsetX:104.896,offsetY:-149.807,dashLengthItems:[19.05,-209.55]}),Lt.add({lineAngle:355,x:0,y:0,offsetX:-51.76101082,offsetY:187.25814969,dashLengthItems:[15.24,-167.64058417]}),Lt.add({lineAngle:100.4514447,x:15.182007,y:-1.3282535,offsetX:145.5569059,offsetY:-176.270089,dashLengthItems:[16.1900088,-178.0902446]}),Lt.add({lineAngle:46.1842,x:0,y:50.8,offsetX:157.343,offsetY:-224.71,dashLengthItems:[28.575,-314.325]}),Lt.add({lineAngle:96.63555761,x:22.5899,y:47.2965,offsetX:218.33577212,offsetY:-264.40480444,dashLengthItems:[24.28502314,-267.13560816]}),Lt.add({lineAngle:351.18415117,x:0,y:50.8,offsetX:196.67912063,offsetY:280.88740361,dashLengthItems:[22.85996707,-251.45973192]}),Lt.add({lineAngle:21,x:25.4,y:38.1,offsetX:104.89565868,offsetY:-149.80652586,dashLengthItems:[19.05,-209.55]}),Lt.add({lineAngle:326,x:25.4,y:38.1,offsetX:-51.7604,offsetY:187.258,dashLengthItems:[15.24,-167.64]}),Lt.add({lineAngle:71.451445,x:38.0345326,y:29.5779001,offsetX:145.5567546,offsetY:-176.2700748,dashLengthItems:[16.1900088,-178.0899376]}),Lt.add({lineAngle:37.5,x:0,y:0,offsetX:53.9242,offsetY:65.2018,dashLengthItems:[0,-165.608,0,-170.18,0,-168.275]}),Lt.add({lineAngle:7.5,x:0,y:0,offsetX:79.3242,offsetY:90.6018,dashLengthItems:[0,-97.028,0,-161.798,0,-64.135]}),Lt.add({lineAngle:-32.5,x:-56.642,y:0,offsetX:117.434,offsetY:68.0212,dashLengthItems:[0,-63.5,0,-198.12,0,-262.89]}),Lt.add({lineAngle:-42.5,x:-82.042,y:0,offsetX:92.0344,offsetY:118.821,dashLengthItems:[0,-82.55,0,-131.572,0,-186.69]}),H.set("AR_HBONE",Lt);const qc=new W("AR_PARQ1");qc.add({lineAngle:45,x:0,y:0,offsetX:101.6,offsetY:101.6,dashLengthItems:[304.8,-101.6]}),qc.add({lineAngle:135,x:71.842,y:71.842,offsetX:101.6,offsetY:-101.6,dashLengthItems:[304.8,-101.6]}),H.set("AR_PARQ1",qc);const Mt=new W("AR_RROOF");Mt.add({lineAngle:90,x:0,y:0,offsetX:304.8,offsetY:304.8,dashLengthItems:[304.8,-304.8]}),Mt.add({lineAngle:90,x:50.8,y:0,offsetX:304.8,offsetY:304.8,dashLengthItems:[304.8,-304.8]}),Mt.add({lineAngle:90,x:101.6,y:0,offsetX:304.8,offsetY:304.8,dashLengthItems:[304.8,-304.8]}),Mt.add({lineAngle:90,x:152.4,y:0,offsetX:304.8,offsetY:304.8,dashLengthItems:[304.8,-304.8]}),Mt.add({lineAngle:90,x:203.2,y:0,offsetX:304.8,offsetY:304.8,dashLengthItems:[304.8,-304.8]}),Mt.add({lineAngle:90,x:254,y:0,offsetX:304.8,offsetY:304.8,dashLengthItems:[304.8,-304.8]}),Mt.add({lineAngle:90,x:304.8,y:0,offsetX:304.8,offsetY:304.8,dashLengthItems:[304.8,-304.8]}),Mt.add({lineAngle:0,x:0,y:304.8,offsetX:304.8,offsetY:-304.8,dashLengthItems:[304.8,-304.8]}),Mt.add({lineAngle:0,x:0,y:355.6,offsetX:304.8,offsetY:-304.8,dashLengthItems:[304.8,-304.8]}),Mt.add({lineAngle:0,x:0,y:406.4,offsetX:304.8,offsetY:-304.8,dashLengthItems:[304.8,-304.8]}),Mt.add({lineAngle:0,x:0,y:457.2,offsetX:304.8,offsetY:-304.8,dashLengthItems:[304.8,-304.8]}),Mt.add({lineAngle:0,x:0,y:508,offsetX:304.8,offsetY:-304.8,dashLengthItems:[304.8,-304.8]}),Mt.add({lineAngle:0,x:0,y:558.8,offsetX:304.8,offsetY:-304.8,dashLengthItems:[304.8,-304.8]}),Mt.add({lineAngle:0,x:0,y:609.6,offsetX:304.8,offsetY:-304.8,dashLengthItems:[304.8,-304.8]}),H.set("AR_RROOF",Mt);const ua=new W("AR_RSHKE");ua.add({lineAngle:0,x:0,y:0,offsetX:55.88,offsetY:25.4,dashLengthItems:[381,-50.8,127,-25.4]}),ua.add({lineAngle:0,x:33.782,y:12.7,offsetX:-25.4,offsetY:33.782,dashLengthItems:[76.2,-8.382,152.4,-19.05]}),ua.add({lineAngle:0,x:12.7,y:21.59,offsetX:132.08,offsetY:17.018,dashLengthItems:[203.2,-35.56,101.6,-25.4]}),H.set("AR_RSHKE",ua);const _n=new W("AR_SAND");_n.add({lineAngle:0,x:0,y:0,offsetX:647.7,offsetY:304.8,dashLengthItems:[152.4,-127,177.8,-76.2,228.6,-101.6]}),_n.add({lineAngle:0,x:152.4,y:12.7,offsetX:647.7,offsetY:304.8,dashLengthItems:[127,-482.6,101.6,-152.4]}),_n.add({lineAngle:0,x:457.2,y:-19.05,offsetX:647.7,offsetY:304.8,dashLengthItems:[76.2,-787.4]}),_n.add({lineAngle:90,x:0,y:0,offsetX:304.8,offsetY:215.9,dashLengthItems:[292.1,-927.1]}),_n.add({lineAngle:90,x:152.4,y:0,offsetX:304.8,offsetY:215.9,dashLengthItems:[285.75,-933.45]}),_n.add({lineAngle:90,x:279.4,y:0,offsetX:304.8,offsetY:215.9,dashLengthItems:[266.7,-952.5]}),_n.add({lineAngle:90,x:457.2,y:-19.05,offsetX:304.8,offsetY:215.9,dashLengthItems:[292.1,-927.1]}),_n.add({lineAngle:90,x:533.4,y:-19.05,offsetX:304.8,offsetY:215.9,dashLengthItems:[292.1,-927.1]}),_n.add({lineAngle:90,x:762,y:0,offsetX:304.8,offsetY:215.9,dashLengthItems:[279.4,-939.8]}),H.set("AR_SAND",_n);const Ir=new W("BOX");Ir.add({lineAngle:37.5,x:0,y:0,offsetX:28.5242,offsetY:39.8018,dashLengthItems:[0,-38.608,0,-43.18,0,-41.275]}),Ir.add({lineAngle:7.5,x:0,y:0,offsetX:53.9242,offsetY:65.2018,dashLengthItems:[0,-20.828,0,-34.798,0,-13.335]}),Ir.add({lineAngle:-32.5,x:-31.242,y:0,offsetX:66.6344,offsetY:42.6212,dashLengthItems:[0,-12.7,0,-45.72,0,-59.69]}),Ir.add({lineAngle:-42.5,x:-31.242,y:0,offsetX:41.2344,offsetY:68.0212,dashLengthItems:[0,-6.35,0,-29.972,0,-34.29]}),H.set("BOX",Ir);const Vn=new W("BRASS");Vn.add({lineAngle:90,x:0,y:0,offsetX:0,offsetY:25.4,dashLengthItems:[]}),Vn.add({lineAngle:90,x:6.35,y:0,offsetX:0,offsetY:25.4,dashLengthItems:[]}),Vn.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:25.4,dashLengthItems:[-6.35,6.35]}),Vn.add({lineAngle:0,x:0,y:6.35,offsetX:0,offsetY:25.4,dashLengthItems:[-6.35,6.35]}),Vn.add({lineAngle:0,x:0,y:12.7,offsetX:0,offsetY:25.4,dashLengthItems:[6.35,-6.35]}),Vn.add({lineAngle:0,x:0,y:19.05,offsetX:0,offsetY:25.4,dashLengthItems:[6.35,-6.35]}),Vn.add({lineAngle:90,x:12.7,y:0,offsetX:0,offsetY:25.4,dashLengthItems:[6.35,-6.35]}),Vn.add({lineAngle:90,x:19.05,y:0,offsetX:0,offsetY:25.4,dashLengthItems:[6.35,-6.35]}),H.set("BRASS",Vn);const Kc=new W("BRICK");Kc.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),Kc.add({lineAngle:0,x:0,y:3.175,offsetX:0,offsetY:6.35,dashLengthItems:[3.175,-1.5875]}),H.set("BRICK",Kc);const ha=new W("BRSTONE");ha.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),ha.add({lineAngle:90,x:0,y:0,offsetX:0,offsetY:12.7,dashLengthItems:[6.35,-6.35]}),ha.add({lineAngle:90,x:6.35,y:0,offsetX:0,offsetY:12.7,dashLengthItems:[-6.35,6.35]}),H.set("BRSTONE",ha);const Bn=new W("CLAY");Bn.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:8.382,dashLengthItems:[]}),Bn.add({lineAngle:90,x:22.86,y:0,offsetX:8.382,offsetY:12.7,dashLengthItems:[8.382,-8.382]}),Bn.add({lineAngle:90,x:20.32,y:0,offsetX:8.382,offsetY:12.7,dashLengthItems:[8.382,-8.382]}),Bn.add({lineAngle:0,x:22.86,y:1.397,offsetX:12.7,offsetY:8.382,dashLengthItems:[-22.86,2.54]}),Bn.add({lineAngle:0,x:22.86,y:2.794,offsetX:12.7,offsetY:8.382,dashLengthItems:[-22.86,2.54]}),Bn.add({lineAngle:0,x:22.86,y:4.191,offsetX:12.7,offsetY:8.382,dashLengthItems:[-22.86,2.54]}),Bn.add({lineAngle:0,x:22.86,y:5.588,offsetX:12.7,offsetY:8.382,dashLengthItems:[-22.86,2.54]}),Bn.add({lineAngle:0,x:22.86,y:6.985,offsetX:12.7,offsetY:8.382,dashLengthItems:[-22.86,2.54]}),H.set("CLAY",Bn);const xr=new W("CORK");xr.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:4.7625,dashLengthItems:[]}),xr.add({lineAngle:0,x:0,y:.79375,offsetX:0,offsetY:4.7625,dashLengthItems:[]}),xr.add({lineAngle:0,x:0,y:1.5875,offsetX:0,offsetY:4.7625,dashLengthItems:[]}),xr.add({lineAngle:0,x:0,y:3.175,offsetX:0,offsetY:4.7625,dashLengthItems:[4.7625,-3.175]}),H.set("CORK",xr);const Sr=new W("CROSS");Sr.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),Sr.add({lineAngle:135,x:1.5875,y:-1.5875,offsetX:0,offsetY:8.98026,dashLengthItems:[4.49013,-4.49013]}),Sr.add({lineAngle:135,x:2.38125,y:-1.5875,offsetX:0,offsetY:8.98026,dashLengthItems:[4.49013,-4.49013]}),Sr.add({lineAngle:135,x:3.175,y:-1.5875,offsetX:0,offsetY:8.98026,dashLengthItems:[4.49013,-4.49013]}),H.set("CROSS",Sr);const Qc=new W("DASH");Qc.add({lineAngle:0,x:0,y:0,offsetX:6.35,offsetY:6.35,dashLengthItems:[3.175,-9.525]}),Qc.add({lineAngle:90,x:1.5875,y:-1.5875,offsetX:6.35,offsetY:6.35,dashLengthItems:[3.175,-9.525]}),H.set("DASH",Qc);const Qg=new W("DOLMIT");Qg.add({lineAngle:0,x:0,y:0,offsetX:3.175,offsetY:3.175,dashLengthItems:[3.175,-3.175]}),H.set("DOLMIT",Qg);const Jc=new W("DOTS");Jc.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),Jc.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:17.9605,dashLengthItems:[8.980256121069154,-17.960512242138307]}),H.set("DOTS",Jc);const Jg=new W("EARTH");Jg.add({lineAngle:0,x:0,y:0,offsetX:.79375,offsetY:1.5875,dashLengthItems:[0,-1.5875]}),H.set("EARTH",Jg);const Gs=new W("ESCHER");Gs.add({lineAngle:0,x:0,y:0,offsetX:6.35,offsetY:6.35,dashLengthItems:[6.35,-6.35]}),Gs.add({lineAngle:0,x:0,y:2.38125,offsetX:6.35,offsetY:6.35,dashLengthItems:[6.35,-6.35]}),Gs.add({lineAngle:0,x:0,y:4.7625,offsetX:6.35,offsetY:6.35,dashLengthItems:[6.35,-6.35]}),Gs.add({lineAngle:90,x:.79375,y:5.55625,offsetX:6.35,offsetY:6.35,dashLengthItems:[6.35,-6.35]}),Gs.add({lineAngle:90,x:3.175,y:5.55625,offsetX:6.35,offsetY:6.35,dashLengthItems:[6.35,-6.35]}),Gs.add({lineAngle:90,x:5.55625,y:5.55625,offsetX:6.35,offsetY:6.35,dashLengthItems:[6.35,-6.35]}),H.set("ESCHER",Gs);const Ke=new W("FLEX");Ke.add({lineAngle:60,x:0,y:0,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[27.94,-2.54]}),Ke.add({lineAngle:180,x:0,y:0,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[27.94,-2.54]}),Ke.add({lineAngle:300,x:0,y:0,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[27.94,-2.54]}),Ke.add({lineAngle:60,x:2.54,y:0,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Ke.add({lineAngle:300,x:2.54,y:0,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Ke.add({lineAngle:60,x:-1.27,y:2.199704516,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Ke.add({lineAngle:180,x:-1.27,y:2.199704516,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Ke.add({lineAngle:300,x:-1.27,y:-2.199704516,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Ke.add({lineAngle:180,x:-1.27,y:-2.199704516,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Ke.add({lineAngle:60,x:-10.16,y:0,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Ke.add({lineAngle:300,x:-10.16,y:0,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Ke.add({lineAngle:60,x:5.08,y:-8.7988180894,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Ke.add({lineAngle:180,x:5.08,y:-8.7988180894,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Ke.add({lineAngle:300,x:5.08,y:8.7988180894,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Ke.add({lineAngle:180,x:5.08,y:8.7988180894,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Ke.add({lineAngle:0,x:5.08,y:4.3994090574,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[17.78,-12.7]}),Ke.add({lineAngle:0,x:5.08,y:-4.3994090574,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[17.78,-12.7]}),Ke.add({lineAngle:120,x:1.27,y:6.5991135734,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[17.78,-12.7]}),Ke.add({lineAngle:120,x:-6.35,y:2.199704516,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[17.78,-12.7]}),Ke.add({lineAngle:240,x:-6.35,y:-2.199704516,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[17.78,-12.7]}),Ke.add({lineAngle:240,x:1.27,y:-6.5991135734,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[17.78,-12.7]}),H.set("FLEX",Ke);const Zc=new W("GOST_GLASS");Zc.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[6.35,-6.35]}),Zc.add({lineAngle:45,x:6.35,y:0,offsetX:4.490128053,offsetY:4.490128053,dashLengthItems:[1.5875,-5.8052561314,1.5875,-8.9802561314]}),H.set("GOST_GLASS",Zc);const da=new W("GOST_WOOD");da.add({lineAngle:45,x:0,y:0,offsetX:6,offsetY:-6,dashLengthItems:[5,-7]}),da.add({lineAngle:45,x:2.12132,y:0,offsetX:6,offsetY:-6,dashLengthItems:[2,-10]}),da.add({lineAngle:45,x:0,y:2.12132,offsetX:6,offsetY:-6,dashLengthItems:[2,-10]}),H.set("GOST_WOOD",da);const fa=new W("GOST_GROUND");fa.add({lineAngle:90,x:0,y:0,offsetX:0,offsetY:-6,dashLengthItems:[10,-2]}),fa.add({lineAngle:90,x:2,y:-2,offsetX:0,offsetY:-6,dashLengthItems:[6,-1.5,3,-1.5]}),fa.add({lineAngle:90,x:4,y:-5,offsetX:0,offsetY:-6,dashLengthItems:[10,-2]}),H.set("GOST_GROUND",fa);const pa=new W("GRASS");pa.add({lineAngle:45,x:0,y:0,offsetX:10,offsetY:-10,dashLengthItems:[20]}),pa.add({lineAngle:45,x:3,y:0,offsetX:10,offsetY:-10,dashLengthItems:[20]}),pa.add({lineAngle:45,x:6,y:0,offsetX:10,offsetY:-10,dashLengthItems:[20]}),H.set("GRASS",pa);const ga=new W("GRATE");ga.add({lineAngle:90,x:0,y:0,offsetX:17.96051224,offsetY:17.96051224,dashLengthItems:[4.7625,-31.15852448]}),ga.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:25.4,dashLengthItems:[4.7625,-20.6375]}),ga.add({lineAngle:135,x:0,y:0,offsetX:0,offsetY:25.4,dashLengthItems:[4.7625,-20.6375]}),H.set("GRATE",ga);const eu=new W("GRAVEL");eu.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:.79375,dashLengthItems:[]}),eu.add({lineAngle:90,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),H.set("GRAVEL",eu);const ge=new W("HEX");ge.add({lineAngle:228.0127875,x:18.288,y:25.4,offsetX:305.85067529778,offsetY:1.88796713245,dashLengthItems:[3.4172144,-338.30483639565]}),ge.add({lineAngle:184.969741,x:16.002,y:22.86,offsetX:-305.8545235377,offsetY:1.10019612724,dashLengthItems:[5.8640472,-580.54048893524]}),ge.add({lineAngle:132.5104471,x:10.16,y:22.352,offsetX:-377.59492241548,offsetY:1.56030959675,dashLengthItems:[4.1348152,-409.347227941]}),ge.add({lineAngle:267.273689,x:.254,y:16.002,offsetX:-508.63316875916,offsetY:1.20815479432,dashLengthItems:[5.3400452,-528.66437425738]}),ge.add({lineAngle:292.83365418,x:0,y:10.668,offsetX:-330.19770134945,offsetY:1.23208097566,dashLengthItems:[5.236337,-518.39807745344]}),ge.add({lineAngle:357.273689,x:2.032,y:5.842,offsetX:-508.63316875916,offsetY:1.20815479432,dashLengthItems:[5.3400452,-528.66437425738]}),ge.add({lineAngle:37.69424047,x:7.366,y:5.588,offsetX:-416.58997273292,offsetY:.91357450169,dashLengthItems:[7.0619366,-699.13115314247]}),ge.add({lineAngle:72.25532837,x:12.954,y:9.906,offsetX:586.40373773403,offsetY:.96766293399,dashLengthItems:[6.6671952,-660.05256601905]}),ge.add({lineAngle:121.42956562,x:14.986,y:16.256,offsetX:387.71230339293,offsetY:1.2040754753,dashLengthItems:[5.35813,-530.45545698712]}),ge.add({lineAngle:175.2363583,x:12.192,y:20.828,offsetX:-280.5442400419,offsetY:2.10935518695,dashLengthItems:[6.1171328,-299.7393695]}),ge.add({lineAngle:222.3974378,x:6.096,y:21.336,offsetX:413.48123885686,offsetY:.81554484621,dashLengthItems:[7.9107792,-783.16772512177]}),ge.add({lineAngle:138.81407483,x:25.4,y:15.748,offsetX:234.164238558,offsetY:2.38943100688,dashLengthItems:[2.7000454,-267.30565824344]}),ge.add({lineAngle:171.4692344,x:23.368,y:17.526,offsetX:-334.082478726,offsetY:1.25594916784,dashLengthItems:[5.1368198,-508.5463899704]}),ge.add({lineAngle:225,x:18.288,y:18.288,offsetX:17.96051224214,offsetY:17.96051224214,dashLengthItems:[3.5920934,-32.32893108428]}),ge.add({lineAngle:203.19859051,x:16.51,y:21.336,offsetX:-136.74251918,offsetY:3.33518339548,dashLengthItems:[1.9344132,-191.50622368894]}),ge.add({lineAngle:291.80140949,x:14.732,y:20.574,offsetX:-80.18324702488,offsetY:4.71666158921,dashLengthItems:[2.7356562,-134.0475299]}),ge.add({lineAngle:30.96375653,x:15.748,y:18.034,offsetX:91.47734531502,offsetY:4.35606406258,dashLengthItems:[4.4431966,-143.6629815291]}),ge.add({lineAngle:161.56505118,x:19.558,y:20.32,offsetX:-56.2252967978,offsetY:8.03218525675,dashLengthItems:[3.2128714,-77.10898116828]}),ge.add({lineAngle:16.389540334,x:0,y:20.574,offsetX:265.17991128726,offsetY:1.43340492604,dashLengthItems:[4.50088,-445.58826672539]}),ge.add({lineAngle:70.34617594,x:4.318,y:21.844,offsetX:-297.29446803469,offsetY:1.70858889651,dashLengthItems:[3.7759894,-373.822156782]}),ge.add({lineAngle:293.19859051,x:19.558,y:25.4,offsetX:-136.7425191801,offsetY:3.33518339548,dashLengthItems:[3.868801,-189.57183588894]}),ge.add({lineAngle:343.61045967,x:21.082,y:21.844,offsetX:-265.17991128725,offsetY:1.433404926,dashLengthItems:[4.50088,-445.5882667254]}),ge.add({lineAngle:339.44395478,x:0,y:4.826,offsetX:-136.75087638398,offsetY:2.97284513779,dashLengthItems:[4.340352,-212.67734313106]}),ge.add({lineAngle:294.7751406,x:4.064,y:3.302,offsetX:-306.90424056705,offsetY:1.77401295215,dashLengthItems:[3.6367212,-360.0359338072]}),ge.add({lineAngle:66.80140949,x:19.812,y:0,offsetX:136.74251918012,offsetY:3.33518339452,dashLengthItems:[3.868801,-189.57183588894]}),ge.add({lineAngle:17.35402464,x:21.336,y:3.556,offsetX:-345.47402804977,offsetY:1.51523696536,dashLengthItems:[4.2578274,-421.523759802]}),ge.add({lineAngle:69.44395478,x:7.366,y:0,offsetX:-136.75087638396,offsetY:2.97284513874,dashLengthItems:[2.170176,-214.84751913106]}),ge.add({lineAngle:101.309932474,x:18.288,y:0,offsetX:104.60834648271,offsetY:4.98134983255,dashLengthItems:[1.295146,-128.21994964526]}),ge.add({lineAngle:165.963756532,x:18.034,y:1.27,offsetX:-80.085263387,offsetY:6.16040487582,dashLengthItems:[5.236337,-99.49054589069]}),ge.add({lineAngle:186.00900596,x:12.954,y:2.54,offsetX:-255.26337856879,offsetY:1.32949676118,dashLengthItems:[4.85267,-480.41364863337]}),ge.add({lineAngle:303.69006753,x:15.748,y:15.748,offsetX:-56.35753993648,offsetY:7.0446924921,dashLengthItems:[3.6632388,-87.9177635968]}),ge.add({lineAngle:353.15722659,x:17.78,y:12.7,offsetX:434.77679606606,offsetY:1.0087628707,dashLengthItems:[6.3955676,-633.16009065031]}),ge.add({lineAngle:60.9453959,x:24.13,y:11.938,offsetX:-204.76648550216,offsetY:2.46706609031,dashLengthItems:[2.6150824,-258.8939231811]}),ge.add({lineAngle:90,x:25.4,y:14.224,offsetX:25.4,offsetY:25.4,dashLengthItems:[1.524,-23.876]}),ge.add({lineAngle:120.25643716,x:12.446,y:3.302,offsetX:-204.77318477297,offsetY:1.8283320086,dashLengthItems:[3.5286696,-349.339407732]}),ge.add({lineAngle:48.0127875,x:10.668,y:6.35,offsetX:305.85067529778,offsetY:1.88796713138,dashLengthItems:[6.8344288,-334.88762199565]}),ge.add({lineAngle:0,x:15.24,y:11.43,offsetX:25.4,offsetY:25.4,dashLengthItems:[6.604,-18.796]}),ge.add({lineAngle:325.3048465,x:21.844,y:11.43,offsetX:310.04235091354,offsetY:-1.6064370526,dashLengthItems:[4.0160956,-397.5931672414]}),ge.add({lineAngle:254.0546041,x:25.146,y:9.144,offsetX:104.6687497289,offsetY:3.48895832444,dashLengthItems:[3.6982908,-181.21650038772]}),ge.add({lineAngle:207.64597536,x:24.13,y:5.588,offsetX:545.36007557253,offsetY:1.07143433066,dashLengthItems:[6.021451,-596.12464422938]}),ge.add({lineAngle:175.42607874,x:18.796,y:2.794,offsetX:331.1739336186,offsetY:1.01276432357,dashLengthItems:[6.3702946,-630.6584645624]}),H.set("HEX",ge);const ma=new W("HONEY");ma.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5.4992613154,dashLengthItems:[3.175,-6.35]}),ma.add({lineAngle:120,x:0,y:0,offsetX:0,offsetY:5.4992613154,dashLengthItems:[3.175,-6.35]}),ma.add({lineAngle:60,x:3.175,y:0,offsetX:0,offsetY:5.4992613154,dashLengthItems:[3.175,-6.35]}),H.set("HONEY",ma);const _a=new W("HOUND");_a.add({lineAngle:0,x:0,y:0,offsetX:4.7625,offsetY:2.749630645,dashLengthItems:[3.175,-6.35]}),_a.add({lineAngle:120,x:0,y:0,offsetX:4.7625,offsetY:2.749630645,dashLengthItems:[3.175,-6.35]}),_a.add({lineAngle:60,x:0,y:0,offsetX:4.7625,offsetY:2.749630645,dashLengthItems:[-6.35,3.175]}),H.set("HOUND",_a);const tu=new W("INSUL");tu.add({lineAngle:0,x:0,y:0,offsetX:6.35,offsetY:1.5875,dashLengthItems:[25.4,-12.7]}),tu.add({lineAngle:90,x:0,y:0,offsetX:-6.35,offsetY:1.5875,dashLengthItems:[25.4,-12.7]}),H.set("INSUL",tu);const ya=new W("ACAD_ISO02W100");ya.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:9.525,dashLengthItems:[]}),ya.add({lineAngle:0,x:0,y:3.175,offsetX:0,offsetY:9.525,dashLengthItems:[3.175,-3.175]}),ya.add({lineAngle:0,x:0,y:6.35,offsetX:0,offsetY:9.525,dashLengthItems:[3.175,-3.175]}),H.set("ACAD_ISO02W100",ya);const Zg=new W("ACAD_ISO03W100");Zg.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-3]}),H.set("ACAD_ISO03W100",Zg);const em=new W("ACAD_ISO04W100");em.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-18]}),H.set("ACAD_ISO04W100",em);const tm=new W("ACAD_ISO05W100");tm.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[24,-3,.5,-3]}),H.set("ACAD_ISO05W100",tm);const nm=new W("ACAD_ISO06W100");nm.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[24,-3,.5,-3,.5,-3]}),H.set("ACAD_ISO06W100",nm);const nu=new W("ACAD_ISO07W100");nu.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[24,-3,.5,-3,.5,-6.5]}),nu.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[-34,.5,-3]}),H.set("ACAD_ISO07W100",nu);const sm=new W("ACAD_ISO08W100");sm.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[.5,-3]}),H.set("ACAD_ISO08W100",sm);const im=new W("ACAD_ISO09W100");im.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[24,-3,6,-3]}),H.set("ACAD_ISO09W100",im);const rm=new W("ACAD_ISO10W100");rm.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[24,-3,6,-3,6,-3]}),H.set("ACAD_ISO10W100",rm);const om=new W("ACAD_ISO11W100");om.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-3,.5,-3]}),H.set("ACAD_ISO11W100",om);const am=new W("ACAD_ISO12W100");am.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-3,12,-3,.5,-3]}),H.set("ACAD_ISO12W100",am);const lm=new W("ACAD_ISO13W100");lm.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-3,.5,-3,.5,-3]}),H.set("ACAD_ISO13W100",lm);const su=new W("ACAD_ISO14W100");su.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-3,12,-3,.5,-6.5]}),su.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[-33.5,.5,-3]}),H.set("ACAD_ISO14W100",su);const iu=new W("ACAD_ISO15W100");iu.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-3,.5,-3,.5,-6.5]}),iu.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[-22,.5,-3]}),H.set("ACAD_ISO15W100",iu);const ru=new W("JIS_LC_20");ru.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-3,12,-3,.5,-10]}),ru.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[-33.5,.5,-3,.5,-3]}),H.set("JIS_LC_20",ru);const ou=new W("JIS_LC_20A");ou.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:20,dashLengthItems:[]}),ou.add({lineAngle:45,x:.4,y:0,offsetX:0,offsetY:20,dashLengthItems:[]}),H.set("JIS_LC_20A",ou);const au=new W("JIS_LC_8");au.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:20,dashLengthItems:[]}),au.add({lineAngle:45,x:1,y:0,offsetX:0,offsetY:20,dashLengthItems:[]}),H.set("JIS_LC_8",au);const lu=new W("JIS_LC_8A");lu.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:7.8,dashLengthItems:[]}),lu.add({lineAngle:45,x:.4,y:0,offsetX:0,offsetY:7.8,dashLengthItems:[]}),H.set("JIS_LC_8A",lu);const cu=new W("JIS_RC_10");cu.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:7.8,dashLengthItems:[]}),cu.add({lineAngle:45,x:1,y:0,offsetX:0,offsetY:7.8,dashLengthItems:[]}),H.set("JIS_RC_10",cu);const va=new W("JIS_RC_15");va.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:10,dashLengthItems:[]}),va.add({lineAngle:45,x:.725,y:0,offsetX:0,offsetY:10,dashLengthItems:[]}),va.add({lineAngle:45,x:1.45,y:0,offsetX:0,offsetY:10,dashLengthItems:[]}),H.set("JIS_RC_15",va);const wa=new W("JIS_RC_18");wa.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:15,dashLengthItems:[]}),wa.add({lineAngle:45,x:.725,y:0,offsetX:0,offsetY:15,dashLengthItems:[]}),wa.add({lineAngle:45,x:1.45,y:0,offsetX:0,offsetY:15,dashLengthItems:[]}),H.set("JIS_RC_18",wa);const Ta=new W("JIS_RC_30");Ta.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:18,dashLengthItems:[]}),Ta.add({lineAngle:45,x:1,y:0,offsetX:0,offsetY:18,dashLengthItems:[]}),Ta.add({lineAngle:45,x:2,y:0,offsetX:0,offsetY:18,dashLengthItems:[]}),H.set("JIS_RC_30",Ta);const Ea=new W("JIS_STN_1E");Ea.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:30,dashLengthItems:[]}),Ea.add({lineAngle:45,x:1,y:0,offsetX:0,offsetY:30,dashLengthItems:[]}),Ea.add({lineAngle:45,x:2,y:0,offsetX:0,offsetY:30,dashLengthItems:[]}),H.set("JIS_STN_1E",Ea);const uu=new W("JIS_STN_2_5");uu.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:1,dashLengthItems:[]}),uu.add({lineAngle:45,x:.705,y:0,offsetX:0,offsetY:1,dashLengthItems:[1,-.5]}),H.set("JIS_STN_2_5",uu);const hu=new W("JIS_WOOD");hu.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:2.5,dashLengthItems:[]}),hu.add({lineAngle:45,x:1.765,y:0,offsetX:0,offsetY:2.5,dashLengthItems:[1.2,-.5]}),H.set("JIS_WOOD",hu);const cm=new W("LINE");cm.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:.70710678,dashLengthItems:[]}),H.set("LINE",cm);const um=new W("MUDST");um.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),H.set("MUDST",um);const hm=new W("NET");hm.add({lineAngle:0,x:0,y:0,offsetX:12.7,offsetY:6.35,dashLengthItems:[6.35,-6.35,0,-6.35,0,-6.35]}),H.set("NET",hm);const du=new W("NET3");du.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),du.add({lineAngle:90,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),H.set("NET3",du);const Aa=new W("PLAST");Aa.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),Aa.add({lineAngle:60,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),Aa.add({lineAngle:120,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),H.set("PLAST",Aa);const Ia=new W("PLASTI");Ia.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),Ia.add({lineAngle:0,x:0,y:.79375,offsetX:0,offsetY:6.35,dashLengthItems:[]}),Ia.add({lineAngle:0,x:0,y:1.5875,offsetX:0,offsetY:6.35,dashLengthItems:[]}),H.set("PLASTI",Ia);const br=new W("SACNCR");br.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),br.add({lineAngle:0,x:0,y:.79375,offsetX:0,offsetY:6.35,dashLengthItems:[]}),br.add({lineAngle:0,x:0,y:1.5875,offsetX:0,offsetY:6.35,dashLengthItems:[]}),br.add({lineAngle:0,x:0,y:3.96875,offsetX:0,offsetY:6.35,dashLengthItems:[]}),H.set("SACNCR",br);const fu=new W("SQUARE");fu.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:2.38125,dashLengthItems:[]}),fu.add({lineAngle:45,x:1.6838,y:0,offsetX:0,offsetY:2.38125,dashLengthItems:[0,-2.38125]}),H.set("SQUARE",fu);const pu=new W("STARS");pu.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[3.175,-3.175]}),pu.add({lineAngle:90,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[3.175,-3.175]}),H.set("STARS",pu);const xa=new W("STEEL");xa.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5.4992613154,dashLengthItems:[3.175,-3.175]}),xa.add({lineAngle:60,x:0,y:0,offsetX:0,offsetY:5.4992613154,dashLengthItems:[3.175,-3.175]}),xa.add({lineAngle:120,x:1.5875,y:2.7496306704,offsetX:0,offsetY:5.4992613154,dashLengthItems:[3.175,-3.175]}),H.set("STEEL",xa);const gu=new W("SWAMP");gu.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),gu.add({lineAngle:45,x:0,y:1.5875,offsetX:0,offsetY:3.175,dashLengthItems:[]}),H.set("SWAMP",gu);const Ys=new W("TRANS");Ys.add({lineAngle:0,x:0,y:0,offsetX:12.7,offsetY:21.9970452362,dashLengthItems:[3.175,-22.225]}),Ys.add({lineAngle:90,x:1.5875,y:0,offsetX:21.9970452362,offsetY:12.7,dashLengthItems:[1.5875,-42.4065904724]}),Ys.add({lineAngle:90,x:1.984375,y:0,offsetX:21.9970452362,offsetY:12.7,dashLengthItems:[1.27,-42.7240904724]}),Ys.add({lineAngle:90,x:1.190625,y:0,offsetX:21.9970452362,offsetY:12.7,dashLengthItems:[1.27,-42.7240904724]}),Ys.add({lineAngle:60,x:2.38125,y:0,offsetX:12.7,offsetY:21.9970452362,dashLengthItems:[1.016,-24.384]}),Ys.add({lineAngle:120,x:.79375,y:0,offsetX:12.7,offsetY:21.9970452362,dashLengthItems:[1.016,-24.384]}),H.set("TRANS",Ys);const mu=new W("TRIANG");mu.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),mu.add({lineAngle:0,x:0,y:3.175,offsetX:0,offsetY:6.35,dashLengthItems:[3.175,-3.175]}),H.set("TRIANG",mu);const Sa=new W("ZIGZAG");Sa.add({lineAngle:60,x:0,y:0,offsetX:4.7625,offsetY:8.2488919604,dashLengthItems:[4.7625,-4.7625]}),Sa.add({lineAngle:120,x:0,y:0,offsetX:4.7625,offsetY:8.2488919604,dashLengthItems:[4.7625,-4.7625]}),Sa.add({lineAngle:0,x:-2.38125,y:4.1244459802,offsetX:4.7625,offsetY:8.2488919604,dashLengthItems:[4.7625,-4.7625]}),H.set("ZIGZAG",Sa);class ml{static fromHex(e){return e.startsWith("#")&&(e=e.replace("#","")),parseInt(e,16)}static fromRGB(e,n,s){const i=[e,n,s].reduce((r,o)=>{const a=o.toString(16);return`${r}${a.length===1?"0"+a:a}`},"0x00");return ml.fromHex(i)}}class Ze{constructor(e,n,s){this.type=e,this.subclassMarker=n,this.layerName=s==null?void 0:s.layerName,this.handle=Vt.next(),this.trueColor=s==null?void 0:s.trueColor,this.inPaperSpace=!1,this.colorNumber=s==null?void 0:s.colorNumber,this.visible=s==null?void 0:s.visible,this.lineType=s==null?void 0:s.lineType,this.lineTypeScale=s==null?void 0:s.lineTypeScale,this.extrusion=s==null?void 0:s.extrusion,this.xdatas=[]}boundingBox(){return Ue.pointBBox(V())}addXData(e){const n=new J3(e);return this.xdatas.push(n),n}dxfy(e){var n,s,i;e.type(this.type),e.handle(this.handle),e.push(330,this.ownerBlockRecord),e.subclassMarker("AcDbEntity"),this.inPaperSpace&&e.push(67,Number(this.inPaperSpace)),e.push(420,this.trueColor),e.layerName(this.layerName||Ni.layerZeroName),e.lineType(this.lineType),e.colorNumber(this.colorNumber),e.push(48,this.lineTypeScale),e.visibilty(this.visible),e.subclassMarker(this.subclassMarker),this.type!=="HATCH"&&(e.push(210,(n=this.extrusion)===null||n===void 0?void 0:n.x),e.push(220,(s=this.extrusion)===null||s===void 0?void 0:s.y),e.push(230,(i=this.extrusion)===null||i===void 0?void 0:i.z)),this.dxfyChild(e),this.xdatas.forEach(r=>r.dxfy(e))}}var ts,uh,dm;(function(t){t[t.Default=0]="Default",t[t.Aligned=1]="Aligned",t[t.Angular=2]="Angular",t[t.Diameter=3]="Diameter",t[t.Radius=4]="Radius",t[t.Angular3Point=5]="Angular3Point",t[t.Ordinate=6]="Ordinate",t[t.ReferencedByThis=32]="ReferencedByThis",t[t.OrdinateType=64]="OrdinateType"})(ts||(ts={})),function(t){t[t.TopLeft=1]="TopLeft",t[t.TopCenter=2]="TopCenter",t[t.TopRight=3]="TopRight",t[t.MiddleLeft=4]="MiddleLeft",t[t.MiddleCenter=5]="MiddleCenter",t[t.MiddleRight=6]="MiddleRight",t[t.BottomLeft=7]="BottomLeft",t[t.BottomCenter=8]="BottomCenter",t[t.BottomRight=9]="BottomRight"}(uh||(uh={})),function(t){t[t.AtLeast=1]="AtLeast",t[t.Exact=2]="Exact"}(dm||(dm={}));class nr extends Ze{constructor(e){super("DIMENSION","AcDbDimension",e),this.blockName=e==null?void 0:e.blockName,this.definitionPoint=e==null?void 0:e.definitionPoint,this.middlePoint=e==null?void 0:e.middlePoint,this.dimensionType=ts.Default,this.attachmentPoint=(e==null?void 0:e.attachmentPoint)||uh.MiddleCenter,this.textLineSpacingStyle=e==null?void 0:e.textLineSpacingStyle,this.textLineSpacingFactor=e==null?void 0:e.textLineSpacingFactor,this.ActualMeasurement=e==null?void 0:e.ActualMeasurement,this.text=e==null?void 0:e.text,this.rotation=e==null?void 0:e.rotation,this.horizontalDirection=e==null?void 0:e.horizontalDirection,this.styleName=e==null?void 0:e.styleName}dxfyChild(e){e.push(2,this.blockName),e.point3d(this.definitionPoint),e.point3d(this.middlePoint,1),e.push(70,this.dimensionType),e.push(71,this.attachmentPoint),e.push(72,this.textLineSpacingStyle),e.push(41,this.textLineSpacingFactor),e.push(42,this.ActualMeasurement),e.push(1,this.text),e.push(53,this.rotation==="auto"?this.rotate():this.rotation),e.push(51,this.horizontalDirection),e.push(3,this.styleName)}}const _l=/[<>/\\":;?*|=`]/g;function kr(t){return t*Math.PI/180}function Z3(t,e){const n=function(s,i){return Math.sqrt(Math.pow(s.x-i.x,2)+Math.pow(s.y-i.y,2))}(t,e);return n===0?n:180*Math.asin(Math.abs(t.y-e.y)/n)/Math.PI}class eD extends nr{constructor(e,n,s){super(s),this.dimensionType=ts.Aligned,this.insertionPoint=s==null?void 0:s.insertionPoint,this.fisrtPoint=e,this.secondPoint=n,this.offset(s==null?void 0:s.offset)}offset(e){if(e==null)return;const[n,s]=function(r,o){const a=r.x-o.x;let u=0;return a!==0&&(u=(r.y-o.y)/a),[u,r.y-u*r.x]}(this.fisrtPoint,this.secondPoint),i=function(r,o){const[a,u]=o;return u-r*Math.sqrt(a*a+1)}(e,[n,s]);this.definitionPoint=function(r,o){const[a,u]=r,h=a??-1/a,d=o.y-h*o.x,p=h-a;let m=u-d;return p!==0&&(m=(u-d)/p),V(m,a*m+u,o.z)}([n,i],this.fisrtPoint)}rotate(){return Z3(this.fisrtPoint,this.secondPoint)}dxfyChild(e){super.dxfyChild(e),e.subclassMarker("AcDbAlignedDimension"),e.point3d(this.insertionPoint,2),e.point3d(this.fisrtPoint,3),e.point3d(this.secondPoint,4)}}class tD extends nr{constructor(e,n,s,i){super(i),this.first=e,this.second=n,this.location=s,this.dimensionType=ts.Angular}rotate(){return 0}_update(){this.definitionPoint=this.second.end}dxfyChild(e){this._update(),super.dxfyChild(e),e.subclassMarker("AcDb2LineAngularDimension"),e.point3d(this.first.start,3),e.point3d(this.first.end,4),e.point3d(this.second.start,5),e.point3d(this.location,6)}}class nD extends nr{constructor(e,n,s,i){super(i),this.center=e,this.first=n,this.second=s,this.dimensionType=ts.Angular3Point}rotate(){return 0}dxfyChild(e){super.dxfyChild(e),e.subclassMarker("AcDb3PointAngularDimension"),e.point3d(this.first,3),e.point3d(this.second,4),e.point3d(this.center,5)}}class sD extends nr{constructor(e,n,s){super(s),this.dimensionType=ts.Diameter,this.first=e,this.definitionPoint=n,this.leaderLength=s==null?void 0:s.leaderLength}rotate(){return 0}dxfyChild(e){super.dxfyChild(e),e.subclassMarker("AcDbDiametricDimension"),e.point3d(this.first,5),e.push(40,this.leaderLength)}}class iD extends nr{constructor(e,n,s){var i;super(s),this.dimensionType=ts.Default,this.insertionPoint=s==null?void 0:s.insertionPoint,this.fisrtPoint=e,this.secondPoint=n,this.angle=(i=s==null?void 0:s.angle)!==null&&i!==void 0?i:0,this.linearType=s==null?void 0:s.linearType,this.offset(s==null?void 0:s.offset)}offset(e){if(e==null)return;const n=kr(this.angle),s=this.fisrtPoint.x+e*Math.floor(Math.sin(n)),i=this.fisrtPoint.y+e*Math.floor(Math.cos(n));this.definitionPoint=V(s,i,0)}rotate(){return this.angle}dxfyChild(e){super.dxfyChild(e),e.subclassMarker("AcDbAlignedDimension"),e.point3d(this.insertionPoint,2),e.point3d(this.fisrtPoint,3),e.point3d(this.secondPoint,4),e.push(50,this.angle),e.push(52,this.linearType),e.subclassMarker("AcDbRotatedDimension")}}class rD extends nr{constructor(e,n,s){super(s),this.dimensionType=ts.Radius,this.first=e,this.definitionPoint=n,this.leaderLength=s==null?void 0:s.leaderLength}rotate(){return 0}dxfyChild(e){super.dxfyChild(e),e.subclassMarker("AcDbRadialDimension"),e.point3d(this.first,5),e.push(40,this.leaderLength)}}class oD extends Ze{get start(){return V(this.center.x+this.radius*Math.cos(kr(this.startAngle)),this.center.y+this.radius*Math.sin(kr(this.startAngle)))}get end(){return V(this.center.x+this.radius*Math.cos(kr(this.endAngle)),this.center.y+this.radius*Math.sin(kr(this.endAngle)))}constructor(e,n,s,i,r){super("ARC","AcDbCircle",r),this.center=e,this.radius=n,this.startAngle=s,this.endAngle=i}boundingBox(){return Ue.centerRadiusBBox(this.center,this.radius)}dxfyChild(e){e.point3d(this.center),e.push(40,this.radius),e.subclassMarker("AcDbArc"),e.push(50,this.startAngle),e.push(51,this.endAngle)}}class aD extends Ze{constructor(e,n,s,i,r){super("ATTDEF","AcDbText",r),this.position=e,this.height=n,this.value=i,this.tag=s,this.textStyle="STANDARD",this.rotation=r==null?void 0:r.rotation,this.obliqueAngle=r==null?void 0:r.obliqueAngle,this.generationFlags=r==null?void 0:r.generationFlags,this.horizontalAlignment=r==null?void 0:r.horizontalAlignment,this.verticalAlignment=r==null?void 0:r.verticalAlignment,this.secondAlignmentPoint=r==null?void 0:r.secondAlignmentPoint,this.relativeXScaleFactor=r==null?void 0:r.relativeXScaleFactor}boundingBox(){return Ue.pointBBox(this.position)}dxfyChild(e){e.point3d(this.position),e.push(40,this.height),e.primaryText(this.value),e.push(50,this.rotation),e.push(41,this.relativeXScaleFactor),e.push(51,this.obliqueAngle),e.textStyle(this.textStyle),e.push(71,this.generationFlags),e.push(72,this.horizontalAlignment),this.secondAlignmentPoint&&(e.push(11,this.secondAlignmentPoint.x),e.push(21,this.secondAlignmentPoint.y),e.push(31,this.secondAlignmentPoint.z)),e.push(73,this.verticalAlignment),e.subclassMarker("AcDbAttributeDefinition"),e.push(280,0),e.push(3,""),e.push(2,this.tag),e.push(70,0)}}class lD extends Ze{constructor(e,n,s,i,r){super("ATTRIB","AcDbText",r),this.position=e,this.height=n,this.value=i,this.tag=s,this.textStyle="STANDARD",this.rotation=r==null?void 0:r.rotation,this.obliqueAngle=r==null?void 0:r.obliqueAngle,this.generationFlags=r==null?void 0:r.generationFlags,this.horizontalAlignment=r==null?void 0:r.horizontalAlignment,this.verticalAlignment=r==null?void 0:r.verticalAlignment,this.secondAlignmentPoint=r==null?void 0:r.secondAlignmentPoint,this.relativeXScaleFactor=r==null?void 0:r.relativeXScaleFactor}boundingBox(){return Ue.pointBBox(this.position)}dxfyChild(e){e.point3d(this.position),e.push(40,this.height),e.primaryText(this.value),e.push(50,this.rotation),e.push(41,this.relativeXScaleFactor),e.push(51,this.obliqueAngle),e.textStyle(this.textStyle),e.push(71,this.generationFlags),e.push(72,this.horizontalAlignment),e.point3d(this.secondAlignmentPoint,1),e.push(73,this.verticalAlignment),e.subclassMarker("AcDbAttribute"),e.push(280,0),e.push(2,this.tag),e.push(70,0)}}class cD extends Ze{constructor(e,n,s){super("CIRCLE","AcDbCircle",s),this.center=e,this.radius=n}boundingBox(){return Ue.centerRadiusBBox(this.center,this.radius)}dxfyChild(e){e.point3d(this.center),e.push(40,this.radius)}}class uD extends Ze{constructor(e,n,s,i,r,o){super("ELLIPSE","AcDbEllipse",o),this.center=e,this.endPointOfMajorAxis=n,this.ratioOfMinorAxisToMajorAxis=s,this.startParameter=i,this.endParameter=r}boundingBox(){const e=this.center.x,n=this.center.y,s=this.endPointOfMajorAxis.x,i=this.endPointOfMajorAxis.y,r=Math.sqrt(Math.pow(e-(e+s),2)+Math.pow(n-(n+i),2));return Ue.centerRadiusBBox(this.center,r)}dxfyChild(e){e.point3d(this.center),e.point3d(this.endPointOfMajorAxis,1),e.push(40,this.ratioOfMinorAxisToMajorAxis),e.push(41,this.startParameter),e.push(42,this.endParameter)}}var zt,yl,hh,fm,qr,dh,fh,ph,Un,vl,Kr,gh,mh,_h,yh,wl,pm,gm,mm,Tl,vh,wh,Th,_m,ym,vm,wm,Tm,Em,Am,Eh,Ah,El,Ih;(function(t){t[t.None=0]="None",t[t.First=1]="First",t[t.Second=2]="Second",t[t.Third=4]="Third",t[t.Fourth=8]="Fourth"})(zt||(zt={}));class hD extends Ze{constructor(e,n,s,i,r){super("3DFACE","AcDbFace",r),this.firstCorner=e,this.secondCorner=n,this.thirdCorner=s,this.fourthCorner=i,this.invisibleEdges=(r==null?void 0:r.invisibleEdges)||zt.None}setFirstEdgeVisible(e){this.setEdgeVisible(zt.First,e)}setSecondEdgeVisible(e){this.setEdgeVisible(zt.Second,e)}setThirdEdgeVisible(e){this.setEdgeVisible(zt.Third,e)}setFourthEdgeVisible(e){this.setEdgeVisible(zt.Fourth,e)}setEdgesVisible(e){this.invisibleEdges=e?zt.None:zt.First|zt.Second|zt.Third|zt.Fourth}setEdgeVisible(e,n){n?this.invisibleEdges|=e:this.invisibleEdges===(this.invisibleEdges|e)&&(this.invisibleEdges^=e)}boundingBox(){return Ue.verticesBBox([this.firstCorner,this.secondCorner,this.thirdCorner,this.fourthCorner])}dxfyChild(e){e.point3d(this.firstCorner),e.point3d(this.secondCorner,1),e.point3d(this.thirdCorner,2),e.point3d(this.fourthCorner,3),e.push(70,this.invisibleEdges)}}(function(t){t.SOLID="SOLID",t.ANGLE="ANGLE",t.ANSI31="ANSI31",t.ANSI32="ANSI32",t.ANSI33="ANSI33",t.ANSI34="ANSI34",t.ANSI35="ANSI35",t.ANSI36="ANSI36",t.ANSI37="ANSI37",t.ANSI38="ANSI38",t.AR_B816="AR_B816",t.AR_B816C="AR_B816C",t.AR_B88="AR_B88",t.AR_BRELM="AR_BRELM",t.AR_BRSTD="AR_BRSTD",t.AR_CONC="AR_CONC",t.AR_HBONE="AR_HBONE",t.AR_PARQ1="AR_PARQ1",t.AR_RROOF="AR_RROOF",t.AR_RSHKE="AR_RSHKE",t.AR_SAND="AR_SAND",t.BOX="BOX",t.BRASS="BRASS",t.BRICK="BRICK",t.BRSTONE="BRSTONE",t.CLAY="CLAY",t.CORK="CORK",t.CROSS="CROSS",t.DASH="DASH",t.DOLMIT="DOLMIT",t.DOTS="DOTS",t.EARTH="EARTH",t.ESCHER="ESCHER",t.FLEX="FLEX",t.GOST_GLASS="GOST_GLASS",t.GOST_WOOD="GOST_WOOD",t.GOST_GROUND="GOST_GROUND",t.GRASS="GRASS",t.GRATE="GRATE",t.GRAVEL="GRAVEL",t.HEX="HEX",t.HONEY="HONEY",t.HOUND="HOUND",t.INSUL="INSUL",t.ACAD_ISO02W100="ACAD_ISO02W100",t.ACAD_ISO03W100="ACAD_ISO03W100",t.ACAD_ISO04W100="ACAD_ISO04W100",t.ACAD_ISO05W100="ACAD_ISO05W100",t.ACAD_ISO06W100="ACAD_ISO06W100",t.ACAD_ISO07W100="ACAD_ISO07W100",t.ACAD_ISO08W100="ACAD_ISO08W100",t.ACAD_ISO09W100="ACAD_ISO09W100",t.ACAD_ISO10W100="ACAD_ISO10W100",t.ACAD_ISO11W100="ACAD_ISO11W100",t.ACAD_ISO12W100="ACAD_ISO12W100",t.ACAD_ISO13W100="ACAD_ISO13W100",t.ACAD_ISO14W100="ACAD_ISO14W100",t.ACAD_ISO15W100="ACAD_ISO15W100",t.JIS_LC_20="JIS_LC_20",t.JIS_LC_20A="JIS_LC_20A",t.JIS_LC_8="JIS_LC_8",t.JIS_LC_8A="JIS_LC_8A",t.JIS_RC_10="JIS_RC_10",t.JIS_RC_15="JIS_RC_15",t.JIS_RC_18="JIS_RC_18",t.JIS_RC_30="JIS_RC_30",t.JIS_STN_1E="JIS_STN_1E",t.JIS_STN_2_5="JIS_STN_2_5",t.JIS_WOOD="JIS_WOOD",t.LINE="LINE",t.MUDST="MUDST",t.NET="NET",t.NET3="NET3",t.PLAST="PLAST",t.PLASTI="PLASTI",t.SACNCR="SACNCR",t.SQUARE="SQUARE",t.STARS="STARS",t.STEEL="STEEL",t.SWAMP="SWAMP",t.TRANS="TRANS",t.TRIANG="TRIANG",t.ZIGZAG="ZIGZAG"})(yl||(yl={})),function(t){t[t.UserDefined=0]="UserDefined",t[t.Predifined=1]="Predifined",t[t.Custom=2]="Custom"}(hh||(hh={}));(function(t){t[t.Default=0]="Default",t[t.External=1]="External",t[t.Polyline=2]="Polyline",t[t.Derived=4]="Derived",t[t.Textbox=8]="Textbox",t[t.Outermost=16]="Outermost"})(fm||(fm={}));(function(t){t[t.SolidFill=1]="SolidFill",t[t.PatternFill=0]="PatternFill"})(qr||(qr={})),function(t){t[t.NonAssociative=0]="NonAssociative",t[t.Associative=1]="Associative"}(dh||(dh={})),function(t){t[t.Normal=0]="Normal",t[t.Outer=1]="Outer",t[t.Ignore=2]="Ignore"}(fh||(fh={})),function(t){t.LINEAR="LINEAR",t.CYLINDER="CYLINDER",t.INVCYLINDER="INVCYLINDER",t.SPHERICAL="SPHERICAL",t.HEMISPHERICAL="HEMISPHERICAL",t.CURVED="CURVED",t.INVSPHERICAL="SPHERICAL",t.INVHEMISPHERICAL="INVHEMISPHERICAL",t.INVCURVED="INVCURVED"}(ph||(ph={}));class dD extends Ze{get patternName(){let e=yl.SOLID;return this.isPattern(this.fill)&&(e=this.fill.name),e}get solidFillFlag(){return this.patternName===yl.SOLID?qr.SolidFill:qr.PatternFill}constructor(e,n,s){super("HATCH","AcDbHatch",s),this.fill=n,this.elevation=(s==null?void 0:s.elevation)||0,this.extrusion=(s==null?void 0:s.extrusion)||V(0,0,1),this.boundaryPath=e}pattern(e,n){var s;const i=n.name,r=(s=n.angle)!==null&&s!==void 0?s:0,o=n.scale||1,a=n.double||!1;e.push(52,r),e.push(41,o),e.push(77,Number(a));const u=H.get(i);u&&(u.scale=o,r!==0&&(u.angle=r),u.dxfy(e))}gradient(e,n){var s,i,r;const o=n.firstColor,a=(s=n.secondColor)!==null&&s!==void 0?s:7,u=(i=n.angle)!==null&&i!==void 0?i:0,h=n.definition||0,d=(r=n.tint)!==null&&r!==void 0?r:1,p=n.type||ph.LINEAR;e.push(450,1),e.push(451,0),e.push(460,u),e.push(461,h),e.push(452,n.secondColor?0:1),e.push(462,d),e.push(453,2),e.push(463,0),e.push(63,o),e.push(421,ml.fromHex(Gg(o))),e.push(463,1),e.push(63,a),e.push(421,ml.fromHex(Gg(a))),e.push(470,p)}isPattern(e){return"name"in e}boundingBox(){return Ue.pointBBox(V(0,0))}dxfyChild(e){var n,s,i;e.point3d(V(0,0,this.elevation)),e.push(210,(n=this.extrusion)===null||n===void 0?void 0:n.x),e.push(220,(s=this.extrusion)===null||s===void 0?void 0:s.y),e.push(230,(i=this.extrusion)===null||i===void 0?void 0:i.z),e.name(this.patternName),e.push(70,this.solidFillFlag),e.push(71,dh.NonAssociative),e.push(91,this.boundaryPath.length),this.boundaryPath.dxfy(e),e.push(75,fh.Outer),e.push(76,hh.Predifined),this.isPattern(this.fill)?(this.solidFillFlag===qr.PatternFill&&this.pattern(e,this.fill),e.push(47,1),e.push(98,0)):(e.push(47,1),e.push(98,0),this.gradient(e,this.fill))}}(function(t){t[t.ShowImage=1]="ShowImage",t[t.ShowImageWhenNotAlignedWithScreen=2]="ShowImageWhenNotAlignedWithScreen",t[t.UseClippingBoundary=4]="UseClippingBoundary",t[t.TransparencyIsOn=8]="TransparencyIsOn"})(vl||(vl={})),function(t){t[t.Rectangular=1]="Rectangular",t[t.Polygonal=2]="Polygonal"}(Kr||(Kr={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On"}(gh||(gh={})),function(t){t[t.Outside=0]="Outside",t[t.Inside=1]="Inside"}(mh||(mh={}));class fD extends Ze{constructor(e,n){super("IMAGE","AcDbRasterImage",n),Un.set(this,void 0),this.width=e.width,this.height=e.height,this.scale=e.scale,this.rotation=e.rotation,this.insertionPoint=e.insertionPoint,this.ratio=this.scale/this.width,this.imageDefHandle=e.imageDefHandle,this.imageDisplayFlags=(n==null?void 0:n.imageDisplayFlags)||vl.ShowImage|vl.ShowImageWhenNotAlignedWithScreen,this.clippingStateFlag=(n==null?void 0:n.clippingStateFlag)||gh.On,this.clipModeFlag=(n==null?void 0:n.clipModeFlag)||mh.Inside,this.clippingType=(n==null?void 0:n.clippingType)||Kr.Rectangular,this.brightness=(n==null?void 0:n.brightness)||50,this.contrast=(n==null?void 0:n.brightness)||50,this.fade=(n==null?void 0:n.fade)||0,Lr(this,Un,[]),this.classVersion=(n==null?void 0:n.classVersion)||0,this.resetClipping()}setClipBoundaryVerticies(e,n){if(n===Kr.Rectangular){if(e.length!=2)throw new Error("The number of vertices should be 2 in rectangular clipping !");Lr(this,Un,e)}else{if(!(e.length>=3))throw new Error("The number of vertices should be >= 3 in polygonal clipping !");Lr(this,Un,e)}Lr(this,Un,[]),ke(this,Un,"f").push(...e)}resetClipping(){const e=[Xe(-.5,-.5),Xe(this.width-.5,this.height-.5)];this.setClipBoundaryVerticies(e,Kr.Rectangular)}_vector(){return Xe(this.ratio*Math.cos(this.rotation*Math.PI/180),this.ratio*Math.sin(this.rotation*Math.PI/180))}_uVector(){const e=this._vector();return V(e.x,-e.y,0)}_vVector(){const e=this._vector();return V(e.y,e.x,0)}boundingBox(){const e=this.scale,n=this.width/this.height*this.scale,s=Math.sqrt(Math.pow(e,2)+Math.pow(n,2));return Ue.centerRadiusBBox(this.insertionPoint,s)}dxfyChild(e){e.push(90,this.classVersion),e.point3d(this.insertionPoint),e.point3d(this._uVector(),1),e.point3d(this._vVector(),2),e.push(13,this.width),e.push(23,this.height),e.push(340,this.imageDefHandle),e.push(70,this.imageDisplayFlags),e.push(280,this.clippingStateFlag),e.push(281,this.brightness),e.push(282,this.contrast),e.push(283,this.fade),e.push(360,this.imageDefReactorHandle),e.push(71,this.clippingType),e.push(91,ke(this,Un,"f").length),ke(this,Un,"f").forEach(n=>e.point2d(n,4)),e.push(290,this.clipModeFlag)}}Un=new WeakMap;class pD extends Ze{constructor(e,n,s){var i,r,o,a,u,h;super("INSERT","AcDbBlockReference",s),this.blockName=e,this.insertionPoint=n,this.scaleFactor=(s==null?void 0:s.scaleFactor)||V(1,1,1),this.rotationAngle=(i=s==null?void 0:s.rotationAngle)!==null&&i!==void 0?i:0,this.columnCount=(r=s==null?void 0:s.columnCount)!==null&&r!==void 0?r:1,this.rowCount=(o=s==null?void 0:s.rowCount)!==null&&o!==void 0?o:1,this.columnSpacing=(a=s==null?void 0:s.columnSpacing)!==null&&a!==void 0?a:0,this.rowSpacing=(u=s==null?void 0:s.rowSpacing)!==null&&u!==void 0?u:0,this.attributesFollowFlag=(h=s==null?void 0:s.rowSpacing)!==null&&h!==void 0?h:0}boundingBox(){return Ue.pointBBox(this.insertionPoint)}dxfyChild(e){e.name(this.blockName),e.point3d(this.insertionPoint),e.push(41,this.scaleFactor.x),e.push(42,this.scaleFactor.y),e.push(43,this.scaleFactor.z),e.push(50,this.rotationAngle),e.push(66,this.attributesFollowFlag),e.push(70,this.columnCount),e.push(71,this.rowCount),e.push(44,this.columnSpacing),e.push(45,this.rowSpacing)}}(function(t){t[t.Disabed=0]="Disabed",t[t.Enabled=1]="Enabled"})(_h||(_h={})),function(t){t[t.StraightLine=0]="StraightLine",t[t.Spline=1]="Spline"}(yh||(yh={}));class gD extends Ze{constructor(e,n){var s,i;super("LEADER","AcDbLeader",n),this.vertices=e,this.flag=(s=n==null?void 0:n.flag)!==null&&s!==void 0?s:_h.Enabled,this.leaderPathType=(i=n==null?void 0:n.leaderPathType)!==null&&i!==void 0?i:yh.StraightLine,this.dimensionStyleName=(n==null?void 0:n.dimensionStyleName)||"Standard"}boundingBox(){return Ue.verticesBBox(this.vertices)}dxfyChild(e){e.push(3,this.dimensionStyleName),e.push(71,this.flag),e.push(72,this.leaderPathType),e.push(76,this.vertices.length),this.vertices.forEach(n=>e.point3d(n))}}class mD extends Ze{constructor(e,n,s){super("LINE","AcDbLine",s),this.startPoint=e,this.endPoint=n}boundingBox(){return Ue.lineBBox(this.startPoint,this.endPoint)}dxfyChild(e){e.point3d(this.startPoint),e.point3d(this.endPoint,1)}}(function(t){t[t.None=0]="None",t[t.Closed=1]="Closed",t[t.Plinegen=128]="Plinegen"})(wl||(wl={}));class _D extends Ze{constructor(e,n){super("LWPOLYLINE","AcDbPolyline",n),this.vertices=e,this.flags=(n==null?void 0:n.flags)||wl.None,this.constantWidth=(n==null?void 0:n.constantWidth)||0,this.elevation=(n==null?void 0:n.elevation)||0,this.thickness=(n==null?void 0:n.thickness)||0}boundingBox(){return Ue.verticesBBox(this.vertices.map(e=>V(e.point.x,e.point.y,0)))}dxfyChild(e){var n,s,i;e.push(90,this.vertices.length),e.push(70,this.flags||0),this.vertices.find(r=>{var o,a;return((o=r.startingWidth)!==null&&o!==void 0?o:0)>0&&((a=r.endWidth)!==null&&a!==void 0?a:0)>0})||e.push(43,this.constantWidth),e.elevation(this.elevation),e.thickness(this.thickness);for(const r of this.vertices)e.point2d(r.point),e.push(40,r.startingWidth),e.push(41,r.endWidth),e.push(42,r.bulge);e.push(210,(n=this.extrusion)===null||n===void 0?void 0:n.x),e.push(220,(s=this.extrusion)===null||s===void 0?void 0:s.y),e.push(230,(i=this.extrusion)===null||i===void 0?void 0:i.z)}}(function(t){t[t.TopLeft=1]="TopLeft",t[t.TopCenter=2]="TopCenter",t[t.TopRight=3]="TopRight",t[t.MiddleLeft=4]="MiddleLeft",t[t.MiddleCenter=5]="MiddleCenter",t[t.MiddleRight=6]="MiddleRight",t[t.BottomLeft=7]="BottomLeft",t[t.BottomCenter=8]="BottomCenter",t[t.BottomRight=9]="BottomRight"})(pm||(pm={})),function(t){t[t.LeftToRight=1]="LeftToRight",t[t.TopToBottom=3]="TopToBottom",t[t.ByStyle=5]="ByStyle"}(gm||(gm={})),function(t){t[t.AtLeast=1]="AtLeast",t[t.Exact=2]="Exact"}(mm||(mm={}));class yD extends Ze{constructor(e,n,s,i){super("MTEXT","AcDbMText",i),this.position=e,this.height=n,this.value=s,this.textStyle="STANDARD",this.rotation=i==null?void 0:i.rotation,this.attachmentPoint=i==null?void 0:i.attachmentPoint,this.drawingDirection=i==null?void 0:i.drawingDirection,this.lineSpacingStyle=i==null?void 0:i.lineSpacingStyle,this.width=i==null?void 0:i.width}boundingBox(){return Ue.pointBBox(this.position)}dxfyChild(e){e.point3d(this.position),e.push(40,this.height),e.push(41,this.width),e.push(71,this.attachmentPoint),e.push(72,this.drawingDirection),e.push(73,this.lineSpacingStyle),e.primaryText(this.value),e.push(50,this.rotation),e.textStyle(this.textStyle)}}class vD extends Ze{constructor(e,n,s,i){super("POINT","AcDbPoint",i),this.x=e,this.y=n,this.z=s}boundingBox(){return Ue.pointBBox(V(this.x,this.y,this.z))}dxfyChild(e){e.point3d(V(this.x,this.y,this.z))}}(function(t){t[t.None=0]="None",t[t.ExtraVertex=1]="ExtraVertex",t[t.CurveFit=2]="CurveFit",t[t.NotUsed=4]="NotUsed",t[t.SplineVertex=8]="SplineVertex",t[t.SplineFrame=16]="SplineFrame",t[t.Polyline3dVertex=32]="Polyline3dVertex",t[t.Polygon3dMesh=64]="Polygon3dMesh",t[t.PolyfaceMeshVertex=128]="PolyfaceMeshVertex"})(Tl||(Tl={}));class wD extends Ze{constructor(e,n){var s;super("VERTEX","AcDbVertex",n),this.point=e,this.flags=(s=n==null?void 0:n.flags)!==null&&s!==void 0?s:Tl.None,n&&("startingWidth"in n&&(this.startingWidth=n.startingWidth),"endWidth"in n&&(this.endWidth=n.endWidth),"bulge"in n&&(this.bulge=n.bulge))}boundingBox(){return Ue.pointBBox(this.point)}dxfyChild(e){e.subclassMarker("AcDb3dPolylineVertex"),e.point3d(this.point),e.push(40,this.startingWidth),e.push(41,this.endWidth),e.push(42,this.bulge),e.push(70,this.flags)}}class c1 extends Ze{dxfyChild(e){}constructor(){super("SEQEND")}}(function(t){t[t.None=0]="None",t[t.Closed=1]="Closed",t[t.CurveFit=2]="CurveFit",t[t.SplineFit=4]="SplineFit",t[t.Polyline3D=8]="Polyline3D",t[t.PolygonMesh3D=16]="PolygonMesh3D",t[t.PolygonMeshClosed=32]="PolygonMeshClosed",t[t.PolyfaceMesh=64]="PolyfaceMesh",t[t.LinetypeGenerated=128]="LinetypeGenerated"})(vh||(vh={})),function(t){t[t.NoSmooth=0]="NoSmooth",t[t.QuadraticBSpline=5]="QuadraticBSpline",t[t.CubicBSpline=6]="CubicBSpline",t[t.Bezier=8]="Bezier"}(wh||(wh={}));class TD extends Ze{constructor(e,n){var s,i,r,o,a,u,h,d,p,m;super("POLYLINE","AcDb3dPolyline",n),this._seqend=new c1,this.vertices=[],this.thickness=(s=n==null?void 0:n.thickness)!==null&&s!==void 0?s:0,this.elevation=(i=n==null?void 0:n.elevation)!==null&&i!==void 0?i:0,this.flags=(r=n==null?void 0:n.flags)!==null&&r!==void 0?r:vh.None,this.defaultStartWidth=(o=n==null?void 0:n.defaultStartWidth)!==null&&o!==void 0?o:0,this.defaultEndWidth=(a=n==null?void 0:n.defaultEndWidth)!==null&&a!==void 0?a:0,this.polygonMeshM=(u=n==null?void 0:n.polygonMeshM)!==null&&u!==void 0?u:0,this.polygonMeshN=(h=n==null?void 0:n.polygonMeshN)!==null&&h!==void 0?h:0,this.smoothSurfaceM=(d=n==null?void 0:n.smoothSurfaceM)!==null&&d!==void 0?d:0,this.smoothSurfaceN=(p=n==null?void 0:n.smoothSurfaceN)!==null&&p!==void 0?p:0,this.surfaceType=(m=n==null?void 0:n.surfaceType)!==null&&m!==void 0?m:wh.NoSmooth,e.forEach(_=>this.vertices.push(new wD(_.point,{startingWidth:_.startingWidth,endWidth:_.endWidth,bulge:_.bulge,flags:Tl.Polyline3dVertex})))}boundingBox(){return Ue.verticesBBox(this.vertices.map(e=>e.point))}dxfyChild(e){e.push(66,1),e.point3d(V(0,0,this.elevation)),e.push(39,this.thickness),e.push(70,this.flags),e.push(40,this.defaultStartWidth),e.push(41,this.defaultEndWidth),e.push(71,this.polygonMeshM),e.push(72,this.polygonMeshN),e.push(73,this.smoothSurfaceM),e.push(74,this.smoothSurfaceN),e.push(75,this.surfaceType),this.vertices.forEach(n=>n.dxfy(e)),this._seqend.dxfy(e)}}(function(t){t[t.Closed=1]="Closed",t[t.Periodic=2]="Periodic",t[t.Rational=4]="Rational",t[t.Planar=8]="Planar",t[t.Linear=16]="Linear"})(Th||(Th={}));class ED extends Ze{constructor(e,n){var s,i;super("SPLINE","AcDbSpline",n),this.controlPoints=e.controlPoints,this.degreeCurve=(s=e.degreeCurve)!==null&&s!==void 0?s:3,this.flags=(i=e.flags)!==null&&i!==void 0?i:Th.Planar,this.knots=e.knots||[],this.weights=e.weights||[],this.fitPoints=e.fitPoints||[];const r=this.controlPoints.length,o=this.degreeCurve,a=o+1,u=this.fitPoints.length;if(r<a)throw new Error(`Number of control points should be >= ${a}.`);if(u!==0&&u<2)throw new Error("Number of fit points should be >= 2.");const h=o+r+1;if(this.knots.length===0){let d=0;for(let p=0;p<h;p++)p<=o||p>=r+1?this.knots.push(d):this.knots.push(++d)}if(this.knots.length!==h)throw new Error(`Number of knots should be ${h}.`)}boundingBox(){return Ue.verticesBBox([...this.controlPoints,...this.fitPoints])}dxfyChild(e){e.push(70,this.flags),e.push(71,this.degreeCurve),e.push(72,this.knots.length),e.push(73,this.controlPoints.length),e.push(74,this.fitPoints.length),e.push(42,"0.0000001"),e.push(43,"0.0000001"),e.push(42,"0.0000000001"),this.knots.forEach(n=>e.push(40,n)),this.weights.forEach(n=>e.push(41,n)),this.controlPoints.forEach(n=>e.point3d(n)),this.fitPoints.forEach(n=>e.point3d(n,1))}}(function(t){t[t.Text=1]="Text",t[t.Block=2]="Block"})(_m||(_m={})),function(t){t[t.False=0]="False",t[t.True=1]="True"}(ym||(ym={})),function(t){t[t.False=0]="False",t[t.True=1]="True"}(vm||(vm={})),function(t){t[t.TopLeft=1]="TopLeft",t[t.TopCenter=2]="TopCenter",t[t.TopRight=3]="TopRight",t[t.MiddleLeft=4]="MiddleLeft",t[t.MiddleCenter=5]="MiddleCenter",t[t.MiddleRight=6]="MiddleRight",t[t.BottomLeft=7]="BottomLeft",t[t.BottomCenter=8]="BottomCenter",t[t.BottomRight=9]="BottomRight"}(wm||(wm={}));class AD extends Ze{constructor(e,n,s,i,r,o,a){super("ACAD_TABLE","AcDbBlockReference",a),this.blockName=e,this.position=n,this.numberOfRows=s,this.numberOfColumn=i,this.rowsHeight=r,this.columnsHeight=o,this.horizontalDirectionVector=(a==null?void 0:a.horizontalDirectionVector)||V(1),this.cells=a==null?void 0:a.cell}boundingBox(){return Ue.pointBBox(this.position)}dxfyChild(e){var n,s,i,r;e.name(this.blockName),e.point3d(this.position),e.subclassMarker("AcDbTable"),e.point3d(this.horizontalDirectionVector,1),e.push(91,this.numberOfRows),e.push(92,this.numberOfColumn);for(let o=0;o<this.numberOfRows;o++)e.push(141,(s=(n=this.rowsHeight[o])!==null&&n!==void 0?n:this.rowsHeight[0])!==null&&s!==void 0?s:1);for(let o=0;o<this.numberOfColumn;o++)e.push(142,(r=(i=this.columnsHeight[o])!==null&&i!==void 0?i:this.columnsHeight[0])!==null&&r!==void 0?r:1);this.cells.forEach(o=>o.dxfy(e))}}(function(t){t[t.None=0]="None",t[t.Backward=2]="Backward",t[t.UpsideDown=4]="UpsideDown"})(Tm||(Tm={})),function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right",t[t.Aligned=3]="Aligned",t[t.Middle=4]="Middle",t[t.Fit=5]="Fit"}(Em||(Em={})),function(t){t[t.BaseLine=0]="BaseLine",t[t.Bottom=1]="Bottom",t[t.Middle=2]="Middle",t[t.Top=3]="Top"}(Am||(Am={}));class ID extends Ze{constructor(e,n,s,i){super("TEXT","AcDbText",i),this.position=e,this.height=n,this.value=s,this.textStyle="STANDARD",this.rotation=i==null?void 0:i.rotation,this.obliqueAngle=i==null?void 0:i.obliqueAngle,this.generationFlags=i==null?void 0:i.generationFlags,this.horizontalAlignment=i==null?void 0:i.horizontalAlignment,this.verticalAlignment=i==null?void 0:i.verticalAlignment,this.secondAlignmentPoint=i==null?void 0:i.secondAlignmentPoint,this.relativeXScaleFactor=i==null?void 0:i.relativeXScaleFactor}boundingBox(){return Ue.pointBBox(this.position)}dxfyChild(e){e.point3d(this.position),e.push(40,this.height),e.primaryText(this.value),e.push(50,this.rotation),e.push(41,this.relativeXScaleFactor),e.push(51,this.obliqueAngle),e.textStyle(this.textStyle),e.push(71,this.generationFlags),e.push(72,this.horizontalAlignment),e.point3d(this.secondAlignmentPoint,1),e.subclassMarker("AcDbText"),e.push(73,this.verticalAlignment)}}class xD{constructor(e,n,s){this.entities=[],this.handle=Vt.next(),this.objects=e,this.blockRecord=n,this.layerName=s}dxfy(e){for(const n of this.entities)n.dxfy(e)}addHatch(e,n,s){const i=new dD(e,n,s);return this.addEntity(i)}addEntity(e){return e.ownerBlockRecord=this.blockRecord.handle,this.blockRecord.isPaperSpace&&(e.inPaperSpace=!0),e.layerName==null&&(e.layerName=this.layerName),this.entities.push(e),e}addAttrib(e,n,s,i,r,o){r.attributesFollowFlag=1;const a=this.addEntity(new lD(e,n,s,i,o));return this.addEntity(new c1).ownerBlockRecord=r.handle,a}addAttdef(e,n,s,i,r){return this.addEntity(new aD(e,n,s,i,r))}addAlignedDim(e,n,s){return this.addEntity(new eD(e,n,s))}addDiameterDim(e,n,s){return this.addEntity(new sD(e,n,s))}addRadialDim(e,n,s){return this.addEntity(new rD(e,n,s))}addLinearDim(e,n,s){return this.addEntity(new iD(e,n,s))}addAngularLinesDim(e,n,s,i){return this.addEntity(new tD(e,n,s,i))}addAngularPointsDim(e,n,s,i){return this.addEntity(new nD(e,n,s,i))}addLine(e,n,s){return this.addEntity(new mD(e,n,s))}addLeader(e,n){return this.addEntity(new gD(e,n))}addLWPolyline(e,n){return this.addEntity(new _D(e,n))}addRectangle(e,n,s){const i=[],r=e.x,o=e.y,a=n.x,u=n.y;if((s==null?void 0:s.fillet)!==void 0&&(s==null?void 0:s.chamfer)!==void 0)throw new Error("You cannot define both fillet and chamfer!");if((s==null?void 0:s.fillet)!==void 0){const h=s==null?void 0:s.fillet,d=Y3(h);i.push({point:Xe(r,o-h),bulge:d}),i.push({point:Xe(r+h,o)}),i.push({point:Xe(a-h,o),bulge:d}),i.push({point:Xe(a,o-h)}),i.push({point:Xe(a,u+h),bulge:d}),i.push({point:Xe(a-h,u)}),i.push({point:Xe(r+h,u),bulge:d}),i.push({point:Xe(r,u+h)})}else if((s==null?void 0:s.chamfer)!==void 0){const h=s==null?void 0:s.chamfer.first,d=(s==null?void 0:s.chamfer.second)||h;i.push({point:Xe(r,o-h)}),i.push({point:Xe(r+d,o)}),i.push({point:Xe(a-h,o)}),i.push({point:Xe(a,o-d)}),i.push({point:Xe(a,u+h)}),i.push({point:Xe(a-d,u)}),i.push({point:Xe(r+h,u)}),i.push({point:Xe(r,u+d)})}else i.push({point:Xe(r,o)}),i.push({point:Xe(a,o)}),i.push({point:Xe(a,u)}),i.push({point:Xe(r,u)});return this.addLWPolyline(i,Object.assign(Object.assign({},s),{flags:wl.Closed}))}addImage(e,n,s,i,r,o,a,u){const h=this.objects.addImageDef(e);h.width=i,h.height=r;const d=new fD({height:r,width:i,scale:o,rotation:a,insertionPoint:s,imageDefHandle:h.handle},u),p=this.objects.addImageDefReactor(d.handle);d.imageDefReactorHandle=p.handle,this.addEntity(d);const m=this.objects.addDictionary();return m.addEntryObject(n,h.handle),h.ownerObjecthandle=m.handle,this.objects.root.addEntryObject("ACAD_IMAGE_DICT",m.handle),h.acadImageDictHandle=m.handle,h.addImageDefReactorHandle(p.handle),d}addPolyline3D(e,n){return this.addEntity(new TD(e,n))}addPoint(e,n,s,i){return this.addEntity(new vD(e,n,s,i))}addCircle(e,n,s){return this.addEntity(new cD(e,n,s))}addArc(e,n,s,i,r){return this.addEntity(new oD(e,n,s,i,r))}addSpline(e,n){return this.addEntity(new ED(e,n))}addEllipse(e,n,s,i,r,o){const a=new uD(e,n,s,i,r,o);return this.addEntity(a),a}add3dFace(e,n,s,i,r){return this.addEntity(new hD(e,n,s,i,r))}addText(e,n,s,i){return this.addEntity(new ID(e,n,s,i))}addMText(e,n,s,i){return this.addEntity(new yD(e,n,s,i))}addInsert(e,n,s){return this.addEntity(new pD(e,n,s||{}))}addTable(e,n,s,i,r,o,a){return this.addEntity(new AD(e,n,s,i,r,o,a))}boundingBox(){const e=[];for(let n=0;n<this.entities.length;n++)e.push(this.entities[n].boundingBox());return Ue.boundingBox(e)}centerView(){return Ue.boundingBoxCenter(this.boundingBox())}viewHeight(){return Ue.boundingBoxHeight(this.boundingBox())}}(function(t){t[t.None=0]="None",t[t.AnonymousBlock=1]="AnonymousBlock",t[t.HasNonConstantAttribute=2]="HasNonConstantAttribute",t[t.XRef=4]="XRef",t[t.XRefOverlay=8]="XRefOverlay",t[t.ExternallyDependent=16]="ExternallyDependent",t[t.ResolvedXRef=32]="ResolvedXRef",t[t.ReferencedXRef=64]="ReferencedXRef"})(Eh||(Eh={}));class SD extends xD{get isPaperSpace(){return this.name.startsWith("*Paper_Space")}get isModelSpace(){return this.name.startsWith("*Model_Space")}get isModelOrPaperSpace(){return this.isModelSpace||this.isPaperSpace}constructor(e,n,s){super(s,n,"0"),this.name=e,this.flags=Eh.None,this.endBlk=new z3,this.ownerObjectHandle=n.handle,this.basePoint=V(0,0,0),this.xrefPathName=""}setLayerName(e){this.layerName=e}dxfy(e){e.type("BLOCK"),e.handle(this.handle),e.push(330,this.ownerObjectHandle),e.subclassMarker("AcDbEntity"),e.layerName(this.layerName),e.subclassMarker("AcDbBlockBegin"),e.name(this.name),e.push(70,this.flags),e.point3d(this.basePoint),e.name(this.name,3),e.push(1,this.xrefPathName),this.isModelSpace||this.name==="*Paper_Space"||super.dxfy(e),this.endBlk.dxfy(e)}}class bD{constructor(e,n){this.blocks=[],this.paperSpaceSeed=0,this.tables=e,this.objects=n,this.modelSpace=this.addBlock("*Model_Space",n,!1),this.paperSpace=this.addBlock("*Paper_Space",n,!1)}addBlock(e,n,s=!0){s&&(e=e.replace(_l,""));const i=this.tables.addBlockRecord(e),r=new SD(e,i,n);return this.blocks.push(r),r}addPaperSpace(){const e="*Paper_Space"+this.paperSpaceSeed++;return this.addBlock(e,this.objects,!1)}dxfy(e){e.start("BLOCKS"),this.blocks.forEach(n=>n.dxfy(e)),e.end()}}class CD{dxfy(e){e.start("CLASSES"),e.end()}}class DD{constructor(e){this.blocks=e,this.modelSpace=e.modelSpace,this.paperSpace=e.paperSpace}setLayerName(e){this.modelSpace.setLayerName(e)}dxfy(e){e.start("ENTITIES"),this.paperSpace.entities.forEach(n=>n.dxfy(e)),this.modelSpace.entities.forEach(n=>n.dxfy(e)),e.end()}}class PD{constructor(e,n){this.values=n,this.name=e}dxfy(e){e.variableName(this.name),Object.entries(this.values).forEach(n=>{const[s,i]=n;e.push(parseInt(s),i)})}}class RD{constructor(){this.variables=[]}setVariable(e,n){const s=this.variables.find(i=>i.name===e);s?s.values=n:this.variables.push(new PD(e,n))}dxfy(e){e.start("HEADER"),this.variables.forEach(n=>n.dxfy(e)),e.end()}}class Bd{constructor(e){this.type=e,this.ownerObjecthandle="0",this.handle=Vt.next()}dxfy(e){e.type(this.type),e.handle(this.handle),e.push(330,this.ownerObjecthandle)}}class Im extends Bd{constructor(){super("DICTIONARY"),this.entries=[],this.duplicateRecordCloningFlag=0}addEntryObject(e,n){this.entries.push({name:e,entryObjectHandle:n})}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbDictionary"),e.push(280,this.hardOwnerFlag),e.push(281,this.duplicateRecordCloningFlag);for(const n of this.entries)e.push(3,n.name),e.push(350,n.entryObjectHandle)}}(function(t){t[t.NoUnits=0]="NoUnits",t[t.Centimeters=2]="Centimeters",t[t.Inch=5]="Inch"})(Ah||(Ah={}));class ND extends Bd{constructor(e){super("IMAGEDEF"),this.path=e,this.acadImageDictHandle="",this.imageReactorHandles=[],this.width=1,this.height=1,this.widthPixelSize=1,this.heightPixelSize=1,this.loaded=!0,this.resolutionUnits=Ah.NoUnits}addImageDefReactorHandle(e){this.imageReactorHandles.push(e)}dxfy(e){super.dxfy(e);const n=new K3("ACAD_REACTORS");n.add(330,this.acadImageDictHandle);for(const s of this.imageReactorHandles)n.add(330,s);n.dxfy(e),e.subclassMarker("AcDbRasterImageDef"),e.push(1,this.path),e.point2d(Xe(this.width,this.height)),e.push(11,this.widthPixelSize),e.push(21,this.heightPixelSize),e.push(280,Number(this.loaded)),e.push(281,this.resolutionUnits)}}class MD extends Bd{constructor(e){super("IMAGEDEF_REACTOR"),this.imageHandle=e,this.classVersion=2}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbRasterImageDefReactor"),e.push(90,this.classVersion),e.push(330,this.imageHandle)}}class jD{constructor(){this.root=new Im,this.objects=[],this.root.duplicateRecordCloningFlag=1;const e=this.addDictionary();this.root.addEntryObject("ACAD_GROUP",e.handle)}addObject(e){return this.objects.push(e),e}addImageDef(e){return this.addObject(new ND(e))}addImageDefReactor(e){return this.addObject(new MD(e))}addDictionary(){const e=new Im;return e.ownerObjecthandle=this.root.handle,this.addObject(e),e}addEntryToRoot(e,n){this.root.addEntryObject(e,n)}dxfy(e){e.start("OBJECTS"),this.root.dxfy(e);for(const n of this.objects)n.dxfy(e);e.end(),e.type("EOF")}}class os{constructor(e){this.name=e,this.maxNumberEntries=0,this.ownerObjectHandle="0",this.handle=Vt.next(),this.records=[]}dxfy(e){e.type("TABLE"),e.name(this.name),e.handle(this.handle),e.push(330,this.ownerObjectHandle),e.subclassMarker("AcDbSymbolTable"),e.push(70,this.records.length);for(const n of this.records)n.dxfy(e);e.type("ENDTAB")}}(function(t){t[t.None=0]="None",t[t.XRefDependent=16]="XRefDependent",t[t.XRefResolved=32]="XRefResolved"})(El||(El={}));class LD extends Vs{constructor(e,n){super("APPID"),this.name=e,this.flags=n??El.None}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbRegAppTableRecord"),e.name(this.name),e.push(70,this.flags)}}class kD extends Vs{get isPaperSpace(){return this.name.startsWith("*Paper_Space")}constructor(e){super("BLOCK_RECORD"),this.name=e,this.insertionUnits=0,this.explodability=1,this.scalability=0}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbBlockTableRecord"),e.name(this.name),e.push(340,this.layoutObject),e.push(70,this.insertionUnits),e.push(280,this.explodability),e.push(281,this.scalability)}}(function(t){t[t.None=0]="None",t[t.XRefDependent=16]="XRefDependent",t[t.XRefRefesolved=32]="XRefRefesolved"})(Ih||(Ih={}));class FD{constructor(e,n){this.name=e,this.flags=n??Ih.None,this.handle=Vt.next(),this.type="DIMSTYLE"}dxfy(e){e.type(this.type),e.push(105,this.handle),e.push(330,this.ownerObjectHandle),e.subclassMarker("AcDbSymbolTableRecord"),e.subclassMarker("AcDbDimStyleTableRecord"),e.name(this.name),e.push(70,this.flags),e.push(3,this.DIMPOST),e.push(4,this.DIMAPOST),e.push(5,this.DIMBLK),e.push(6,this.DIMBLK1),e.push(7,this.DIMBLK2),e.push(40,this.DIMSCALE),e.push(41,this.DIMASZ),e.push(42,this.DIMEXO),e.push(43,this.DIMDLI),e.push(44,this.DIMEXE),e.push(45,this.DIMRND),e.push(46,this.DIMDLE),e.push(47,this.DIMTP),e.push(48,this.DIMTM),e.push(140,this.DIMTXT),e.push(141,this.DIMCEN),e.push(142,this.DIMTSZ),e.push(143,this.DIMALTF),e.push(144,this.DIMLFAC),e.push(145,this.DIMTVP),e.push(146,this.DIMTFAC),e.push(147,this.DIMGAP),e.push(148,this.DIMALTRND),e.push(71,this.DIMTOL),e.push(72,this.DIMLIM),e.push(73,this.DIMTIH),e.push(74,this.DIMTOH),e.push(75,this.DIMSE1),e.push(76,this.DIMSE2),e.push(77,this.DIMTAD),e.push(78,this.DIMZIN),e.push(79,this.DIMAZIN),e.push(170,this.DIMALT),e.push(171,this.DIMALTD),e.push(172,this.DIMTOFL),e.push(173,this.DIMSAH),e.push(174,this.DIMTIX),e.push(175,this.DIMSOXD),e.push(176,this.DIMCLRD),e.push(177,this.DIMCLRE),e.push(178,this.DIMCLRT),e.push(179,this.DIMADEC),e.push(271,this.DIMDEC),e.push(272,this.DIMTDEC),e.push(273,this.DIMALTU),e.push(274,this.DIMALTTD),e.push(275,this.DIMAUNIT),e.push(276,this.DIMFRAC),e.push(277,this.DIMLUNIT),e.push(278,this.DIMDSEP),e.push(279,this.DIMTMOVE),e.push(280,this.DIMJUST),e.push(281,this.DIMSD1),e.push(282,this.DIMSD2),e.push(283,this.DIMTOLJ),e.push(284,this.DIMTZIN),e.push(285,this.DIMALTZ),e.push(286,this.DIMALTTZ),e.push(287,this.DIMFIT),e.push(288,this.DIMUPT),e.push(289,this.DIMATFIT),e.push(340,this.DIMTXSTY),e.push(341,this.DIMLDRBLK),e.push(342,this.DIMBLK),e.push(343,this.DIMBLK1),e.push(344,this.DIMBLK2),e.push(371,this.DIMLWD),e.push(372,this.DIMLWE)}}class OD extends Vs{constructor(e,n,s,i){super("LTYPE"),this.name=e,this.descriptive=n,this.elements=s,this.flags=i??0}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbLinetypeTableRecord"),e.name(this.name),e.push(70,this.flags),e.push(3,this.descriptive),e.push(72,65),e.push(73,this.elements.length);let n=0;for(const s of this.elements)n+=Math.abs(s);e.push(40,n);for(const s of this.elements)e.push(49,s),e.push(74,0)}}class VD extends Vs{constructor(e,n){super("STYLE"),this.fixedTextHeight=0,this.widthFactor=1,this.obliqueAngle=0,this.textGenerationFlag=0,this.lastHeightUsed=1,this.fontFileName="txt",this.bigFontFileName="",this.name=e,this.flags=n??ah.None}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbTextStyleTableRecord"),e.name(this.name),e.push(70,this.flags),e.push(40,this.fixedTextHeight),e.push(41,this.widthFactor),e.push(50,this.obliqueAngle),e.push(71,this.textGenerationFlag),e.push(42,this.lastHeightUsed),e.push(3,this.fontFileName),e.push(4,this.bigFontFileName)}}class BD extends Vs{constructor(e){super("UCS"),this.name=e}dxfy(e){super.dxfy(e)}}class UD extends Vs{constructor(e){super("VPORT"),this.name=e,this.viewHeight=200,this.viewCenter=[0,0]}dxfy(e){super.dxfy(e);const[n,s]=this.viewCenter;e.subclassMarker("AcDbViewportTableRecord"),e.name(this.name),e.push(70,0),e.point2d({x:0,y:0}),e.push(11,1),e.push(21,1),e.push(12,n),e.push(22,s),e.push(13,0),e.push(23,0),e.push(14,10),e.push(24,10),e.push(15,10),e.push(25,10),e.push(16,0),e.push(26,0),e.push(36,1),e.push(17,0),e.push(27,0),e.push(37,0),e.push(40,this.viewHeight||200),e.push(41,2),e.push(42,50),e.push(43,0),e.push(44,0),e.push(50,0),e.push(51,0),e.push(71,0),e.push(72,100),e.push(73,1),e.push(74,3),e.push(75,0),e.push(76,1),e.push(77,0),e.push(78,0),e.push(281,0),e.push(65,1),e.push(110,0),e.push(120,0),e.push(130,0),e.push(111,1),e.push(121,0),e.push(131,0),e.push(112,0),e.push(122,1),e.push(132,0),e.push(79,0),e.push(146,0),e.push(348,10020),e.push(60,7),e.push(61,5),e.push(292,1),e.push(282,1),e.push(141,0),e.push(142,0),e.push(63,250),e.push(421,3358443)}}class $D extends Vs{constructor(e){var n;super("VIEW"),this.name=e.name,this.flags=(n=e.flags)!==null&&n!==void 0?n:lh.None,this.viewHeight=e.viewHeight,this.viewCenter=e.viewCenter,this.viewWidth=e.viewWidth,this.viewDirection=e.viewDirection,this.targetPoint=e.targetPoint,this.lensLength=e.lensLength,this.frontClipping=e.frontClipping,this.backClipping=e.backClipping,this.twistAngle=e.twistAngle,this.viewMode=e.viewMode,this.renderMode=e.renderMode,this.isUCSAssociated=e.isUCSAssociated,this.isCameraPlottable=e.isCameraPlottable||!1,e.backgroundObjectHandle&&(this.backgroundObjectHandle=e.backgroundObjectHandle),e.liveSectionObjectHandle&&(this.liveSectionObjectHandle=e.liveSectionObjectHandle),e.visualStyleObjectHandle&&(this.visualStyleObjectHandle=e.visualStyleObjectHandle)}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbViewTableRecord"),e.name(this.name),e.push(70,this.flags),e.push(40,this.viewHeight),e.point2d(this.viewCenter),e.push(41,this.viewWidth),e.push(11,this.viewDirection.x),e.push(21,this.viewDirection.y),e.push(31,this.viewDirection.z),e.push(12,this.targetPoint.x),e.push(22,this.targetPoint.y),e.push(32,this.targetPoint.z),e.push(42,this.lensLength),e.push(43,this.frontClipping),e.push(44,this.backClipping),e.push(50,this.twistAngle),e.push(71,this.viewMode),e.push(281,this.renderMode),e.push(72,this.isUCSAssociated?1:0),e.push(73,this.isCameraPlottable?1:void 0),e.push(332,this.backgroundObjectHandle),e.push(334,this.liveSectionObjectHandle),e.push(348,this.visualStyleObjectHandle)}}class HD extends os{constructor(){super("APPID")}addAppId(e,n){const s=new LD(e,n);return s.ownerObjectHandle=this.handle,this.records.push(s),s}}class WD extends os{constructor(){super("BLOCK_RECORD")}addBlockRecord(e){const n=new kD(e);return n.ownerObjectHandle=this.handle,this.records.push(n),n}}class XD extends os{constructor(){super("DIMSTYLE"),this.ownerObjectHandle="0"}addDimStyle(e,n){const s=new FD(e,n);return s.ownerObjectHandle=this.handle,this.records.push(s),s}dxfy(e){e.type("TABLE"),e.name(this.name),e.handle(this.handle),e.push(330,this.ownerObjectHandle),e.subclassMarker("AcDbSymbolTable"),e.push(70,this.records.length),e.subclassMarker("AcDbDimStyleTable");for(const n of this.records)n.dxfy(e);e.type("ENDTAB")}}class GD extends os{constructor(){super("LTYPE")}exist(e){return this.records.find(n=>n.name===e)!==void 0}ltype(e){return this.records.find(n=>n.name===e)}addLType(e,n,s,i){const r=this.ltype(e);if(r)return r;const o=new OD(e,n,s,i);return o.ownerObjectHandle=this.handle,this.records.push(o),o}}class YD extends os{constructor(e){super("LAYER"),this.lTypeTable=e}addLayer(e,n,s,i){e=e.replace(_l,"");const r=this.layer(e);if(r)return r;this.lTypeTable.exist(s)||(s=gl.Continuous);const o=new Ni(e,n,s,i);return o.ownerObjectHandle=this.handle,this.records.push(o),o}layer(e){return e=e.replace(_l,""),this.records.find(n=>n.name===e)}exist(e){return this.records.find(n=>n.name===e)!==void 0}}class zD extends os{constructor(){super("STYLE")}addStyle(e,n){const s=new VD(e,n);return s.ownerObjectHandle=this.handle,this.records.push(s),s}}class qD extends os{constructor(){super("UCS")}addUcs(e){const n=new BD(e);return n.ownerObjectHandle=this.handle,this.records.push(n),n}}class KD extends os{constructor(){super("VPORT")}addViewPort(e){const n=new UD(e);return n.ownerObjectHandle=this.handle,this.records.push(n),n}}class QD extends os{constructor(){super("VIEW")}addView(e){const n=new $D(e);return n.ownerObjectHandle=this.handle,this.records.push(n),n}}class JD{constructor(){this.vPortTable=new KD,this.ltypeTable=new GD,this.layerTable=new YD(this.ltypeTable),this.styleTable=new zD,this.viewTable=new QD,this.ucsTable=new qD,this.appIdTable=new HD,this.dimStyleTable=new XD,this.blockRecordTable=new WD}layer(e){return this.layerTable.layer(e)}addLType(e,n,s,i){return this.ltypeTable.addLType(e,n,s,i)}addBlockRecord(e){return this.blockRecordTable.addBlockRecord(e)}addLayer(e,n,s,i){return this.layerTable.addLayer(e,n,s,i)}addStyle(e){return this.styleTable.addStyle(e)}addView(e){return this.viewTable.addView(e)}addUcs(e){return this.ucsTable.addUcs(e)}addAppId(e,n){return this.appIdTable.addAppId(e,n)}addDimStyle(e,n){return this.dimStyleTable.addDimStyle(e,n)}addVPort(e){return this.vPortTable.addViewPort(e)}dxfy(e){e.start("TABLES"),this.vPortTable.dxfy(e),this.ltypeTable.dxfy(e),this.layerTable.dxfy(e),this.styleTable.dxfy(e),this.viewTable.dxfy(e),this.ucsTable.dxfy(e),this.appIdTable.dxfy(e),this.dimStyleTable.dxfy(e),this.blockRecordTable.dxfy(e),e.end()}}class ZD{constructor(){Vt.clear(),this.header=new RD,this.classes=new CD,this.tables=new JD,this.objects=new jD,this.blocks=new bD(this.tables,this.objects),this.entities=new DD(this.blocks),this.currentLayerName=Ni.layerZeroName,this.currentUnits=pl.Unitless,this.header.setVariable("$ACADVER",{1:"AC1021"}),this.header.setVariable("$LASTSAVEDBY",{1:"@tarikjabiri/dxf"}),this._handseed(),this.setUnits(pl.Unitless),this.tables.addLType("ByBlock","",[]),this.tables.addLType("ByLayer","",[]);const e=this.tables.addLType("Continuous","Solid line",[]);this.tables.addLayer(Ni.layerZeroName,ch.White,e.name),this.styleStandard=this.tables.addStyle("Standard"),this.tables.addAppId("ACAD",El.None),this.dimStyleStandard=this.tables.addDimStyle("Standard"),this.dimStyleStandard.DIMTXSTY=this.styleStandard.handle,this.activeVPort=this.tables.addVPort("*Active"),this.modelSpace=this.blocks.modelSpace,this.paperSpace=this.blocks.paperSpace,this.setZeroLayerAsCurrent()}dxfy(e){this.header.dxfy(e),this.classes.dxfy(e),this.tables.dxfy(e),this.blocks.dxfy(e),this.entities.dxfy(e),this.objects.dxfy(e)}addBlock(e){return this.blocks.addBlock(e,this.objects)}setZeroLayerAsCurrent(){this.setCurrentLayerName(Ni.layerZeroName)}setCurrentLayerName(e){this.currentLayerName=e.replace(_l,""),this.entities.setLayerName(this.currentLayerName),this.setCLayerVariable()}_handseed(){this.header.setVariable("$HANDSEED",{5:Vt.peek()})}setUnits(e){this.currentUnits=e,this.header.setVariable("$INSUNITS",{70:this.currentUnits})}setCLayerVariable(){this.header.setVariable("$CLAYER",{8:this.currentLayerName})}setViewCenter(e){this.header.setVariable("$VIEWCTR",{10:e.x,20:e.y}),this.activeVPort.viewCenter=[e.x,e.y]}stringify(){const e=new Q3;return this._handseed(),this.setViewCenter(this.modelSpace.centerView()),this.activeVPort.viewHeight=this.modelSpace.viewHeight(),this.dxfy(e),e.stringify()}}class eP{get header(){return this.document.header}get tables(){return this.document.tables}get blocks(){return this.document.blocks}get entities(){return this.document.entities}get currentLayer(){return this.document.currentLayerName}get units(){return this.document.currentUnits}get modelSpace(){return this.document.modelSpace}constructor(){this.document=new ZD}layer(e){return this.tables.layer(e)}setZeroLayerAsCurrent(){this.document.setZeroLayerAsCurrent()}addBlock(e){return this.blocks.addBlock(e,this.document.objects)}addPaperSpace(){return this.blocks.addPaperSpace()}setVariable(e,n){this.header.setVariable(e,n)}addLType(e,n,s){return this.tables.addLType(e,n,s)}addDimStyle(e){return this.tables.addDimStyle(e)}addAlignedDim(e,n,s){return this.modelSpace.addAlignedDim(e,n,s)}addDiameterDim(e,n,s){return this.modelSpace.addDiameterDim(e,n,s)}addRadialDim(e,n,s){return this.modelSpace.addRadialDim(e,n,s)}addLinearDim(e,n,s){return this.modelSpace.addLinearDim(e,n,s)}addAngularLinesDim(e,n,s,i){return this.modelSpace.addAngularLinesDim(e,n,s,i)}addHatch(e,n,s){return this.modelSpace.addHatch(e,n,s)}addLayer(e,n,s,i=fl.None){return s||(s=gl.Continuous),this.tables.addLayer(e,n,s,i)}setCurrentLayerName(e){this.document.setCurrentLayerName(e)}setUnits(e){this.document.setUnits(e)}addLine(e,n,s){return this.modelSpace.addLine(e,n,s)}addLeader(e,n){return this.modelSpace.addLeader(e,n)}addLWPolyline(e,n){return this.modelSpace.addLWPolyline(e,n)}addRectangle(e,n,s){return this.modelSpace.addRectangle(e,n,s)}addPolyline3D(e,n){return this.modelSpace.addPolyline3D(e,n)}addPoint(e,n,s,i){return this.modelSpace.addPoint(e,n,s,i)}addCircle(e,n,s){return this.modelSpace.addCircle(e,n,s)}addArc(e,n,s,i,r){return this.modelSpace.addArc(e,n,s,i,r)}addSpline(e,n){return this.modelSpace.addSpline(e,n)}addEllipse(e,n,s,i,r,o){return this.modelSpace.addEllipse(e,n,s,i,r,o)}addImage(e,n,s,i,r,o,a,u){return this.modelSpace.addImage(e,n,s,i,r,o,a,u)}add3dFace(e,n,s,i,r){return this.modelSpace.add3dFace(e,n,s,i,r)}addText(e,n,s,i){return this.modelSpace.addText(e,n,s,i)}addAttdef(e,n,s,i,r){return this.modelSpace.addAttdef(e,n,s,i,r)}addAttrib(e,n,s,i,r,o){return this.modelSpace.addAttrib(e,n,s,i,r,o)}addMText(e,n,s,i){return this.modelSpace.addMText(e,n,s,i)}addInsert(e,n,s){return this.modelSpace.addInsert(e,n,s)}addTable(e,n,s,i,r,o,a){return this.modelSpace.addTable(e,n,s,i,r,o,a)}stringify(){return this.document.stringify()}}const tP=t=>{const{spaceInfo:e,placedModules:n,drawingType:s="front"}=t,i=Zi.getState();(!i.isCalculated||!i.lastCalculatedSpaceInfo||JSON.stringify(i.lastCalculatedSpaceInfo)!==JSON.stringify(e))&&i.recalculateFromSpaceInfo(e);const r=new eP;switch(s){case"front":xm(r,e,n);break;case"plan":nP(r,e,n);break;case"side":sP(r,e,n);break;default:xm(r,e,n);break}return uP(r,e,s),r.stringify()},xm=(t,e,n)=>{iP(t,e),aP(t,n,e)},nP=(t,e,n)=>{rP(t,e),lP(t,n,e)},sP=(t,e,n)=>{oP(t,e),cP(t,n,e)},iP=(t,e)=>{t.addLine(V(0,0),V(e.width,0)),t.addLine(V(e.width,0),V(e.width,e.height)),t.addLine(V(e.width,e.height),V(0,e.height)),t.addLine(V(0,e.height),V(0,0)),t.addText(V(e.width/2,e.height+200),100,`정면도: ${e.width}mm(폭) × ${e.height}mm(높이)`),t.addText(V(e.width/2,e.height+300),60,`공간 깊이: ${e.depth}mm`)},rP=(t,e)=>{t.addLine(V(0,0),V(e.width,0)),t.addLine(V(e.width,0),V(e.width,e.depth)),t.addLine(V(e.width,e.depth),V(0,e.depth)),t.addLine(V(0,e.depth),V(0,0)),t.addText(V(e.width/2,e.depth+200),100,`평면도: ${e.width}mm(폭) × ${e.depth}mm(깊이)`),t.addText(V(e.width/2,e.depth+300),60,`공간 높이: ${e.height}mm`)},oP=(t,e)=>{t.addLine(V(0,0),V(e.depth,0)),t.addLine(V(e.depth,0),V(e.depth,e.height)),t.addLine(V(e.depth,e.height),V(0,e.height)),t.addLine(V(0,e.height),V(0,0)),t.addText(V(e.depth/2,e.height+200),100,`측면도: ${e.depth}mm(깊이) × ${e.height}mm(높이)`),t.addText(V(e.depth/2,e.height+300),60,`공간 폭: ${e.width}mm`)},aP=(t,e,n)=>{const s=Zi.getState(),i=dt(n),r={columnCount:s.columnCount,columnWidth:s.columnWidth,columnPositions:s.columnPositions,threeUnitPositions:s.threeUnitPositions,dualColumnPositions:s.dualColumnPositions,internalStartX:(n.width-s.internalWidth)/2,internalWidth:s.internalWidth,threeUnitDualPositions:s.dualColumnPositions.map(o=>o/10)};console.log("🔍 DXF 생성 - 슬롯 인덱싱 정보:",{columnCount:r.columnCount,columnPositions:r.columnPositions,threeUnitPositions:r.threeUnitPositions,dualPositions:r.dualColumnPositions,threeUnitDualPositions:r.threeUnitDualPositions,internalStartX:r.internalStartX,internalWidth:r.internalWidth}),e.forEach((o,a)=>{const{position:u,moduleData:h,moduleId:d}=o,p=Dt(d,i,n),m=h.dimensions,_=Math.abs(m.width-r.columnWidth*2)<50;let y=-1,v=0;_&&r.threeUnitDualPositions?(y=r.threeUnitDualPositions.findIndex(P=>Math.abs(P-u.x)<.1),y>=0&&(v=r.dualColumnPositions[y])):(y=r.threeUnitPositions.findIndex(P=>Math.abs(P-u.x)<.1),y>=0&&(v=r.columnPositions[y])),y<0&&(console.warn(`⚠️ 가구 ${a+1}의 슬롯을 찾을 수 없음. 기존 방식 사용.`),v=u.x*10);const w=n.width/2+v;console.log(`🔍 가구 ${a+1} (${h.name}) 좌표 변환:`,{originalThreeJsX:u.x,slotIndex:y,isDualFurniture:_,slotPositionMm:v,dxfXPosition:w,spaceWidth:n.width,dimensions:m});const b=w-m.width/2,A=u.y*10,R=b+m.width,N=A+m.height;console.log("📐 DXF 좌표 최종 계산:",{slotIndex:y,slotPositionMm:v,dxfXPosition:w,x1:b,y1:A,x2:R,y2:N,width:m.width,height:m.height}),t.addLine(V(b,A),V(R,A)),t.addLine(V(R,A),V(R,N)),t.addLine(V(R,N),V(b,N)),t.addLine(V(b,N),V(b,A));const M=m.height,k=m.width,x=p==null?void 0:p.modelConfig,T=(x==null?void 0:x.shelfCount)||0;if(console.log(`🏗️ 가구 ${a+1} 내부 구조:`,{moduleId:d,shelfCount:T,modelConfig:x,furnitureWidth:k,furnitureHeight:M}),M>200&&k>200)if(T>0)if(_){const P=b+k/2;t.addLine(V(P,A),V(P,N));const I=Math.floor(T/2);if(I>0){for(let $=1;$<=I;$++){const K=A+M/(I+1)*$;t.addLine(V(b,K),V(P,K))}for(let $=1;$<=I;$++){const K=A+M/(I+1)*$;t.addLine(V(P,K),V(R,K))}}}else for(let P=1;P<=T;P++){const I=A+M/(T+1)*P;t.addLine(V(b,I),V(R,I))}else console.log("📦 오픈 박스 가구 - 내부 구조 없음");const E=b+m.width/2,C=A+m.height/2;t.addText(V(E,C),Math.min(m.height/4,50),h.name||`가구${a+1}`);const D=T===0?"오픈박스":T===1?"2단":T===6?"7단":T===2?"듀얼2단":T===12?"듀얼7단":`${T}선반`;if(t.addText(V(E,A-120),20,`슬롯${y+1} | ${D}`),t.addText(V(E,A-160),15,`DXF-X: ${Math.round(w)}mm`),console.log(`🔍 정면도 가구 ${a+1} (${h.name}) 치수:`,{moduleId:d,moduleDataDepth:h.dimensions.depth,actualModuleDataDepth:p==null?void 0:p.dimensions.depth,finalDepth:m.depth,width:m.width,height:m.height}),t.addText(V(E,A-80),25,`${m.width}W×${m.height}H×${m.depth}D`),m.height>100){const P=R+50;t.addLine(V(P,A),V(P,N)),t.addLine(V(P-20,A),V(P+20,A)),t.addLine(V(P-20,N),V(P+20,N)),t.addText(V(P+30,C),20,`${m.height}mm`)}})},lP=(t,e,n)=>{const s=Zi.getState(),i=dt(n),r={columnCount:s.columnCount,columnWidth:s.columnWidth,columnPositions:s.columnPositions,threeUnitPositions:s.threeUnitPositions,dualColumnPositions:s.dualColumnPositions,internalStartX:(n.width-s.internalWidth)/2,internalWidth:s.internalWidth,threeUnitDualPositions:s.dualColumnPositions.map(o=>o/10)};console.log("🔍 DXF 평면도 생성 - 슬롯 인덱싱 정보:",{columnCount:r.columnCount,columnPositions:r.columnPositions,threeUnitPositions:r.threeUnitPositions,dualPositions:r.dualColumnPositions,threeUnitDualPositions:r.threeUnitDualPositions,internalStartX:r.internalStartX,internalWidth:r.internalWidth}),e.forEach((o,a)=>{const{position:u,moduleData:h,moduleId:d}=o,p=Dt(d,i,n),m=h.dimensions,_=Math.abs(m.width-r.columnWidth*2)<50;let y=-1,v=0;_&&r.threeUnitDualPositions?(y=r.threeUnitDualPositions.findIndex($=>Math.abs($-u.x)<.1),y>=0&&(v=r.dualColumnPositions[y])):(y=r.threeUnitPositions.findIndex($=>Math.abs($-u.x)<.1),y>=0&&(v=r.columnPositions[y])),y<0&&(console.warn(`⚠️ 가구 ${a+1}의 슬롯을 찾을 수 없음. 기존 방식 사용.`),v=u.x*10);const w=n.width/2+v,b=20,A=b;console.log(`🔍 평면도 가구 ${a+1} (${h.name}) 좌표 변환:`,{originalThreeJsX:u.x,originalThreeJsZ:u.z,slotIndex:y,isDualFurniture:_,slotPositionMm:v,dxfXPosition:w,frontPositionMm:b,dxfYPosition:A,spaceWidth:n.width,spaceDepth:n.depth,dimensions:m});const R=w-m.width/2,N=A,M=R+m.width,k=N+m.depth;console.log("📐 평면도 DXF 좌표 최종 계산:",{slotIndex:y,slotPositionMm:v,dxfXPosition:w,dxfYPosition:A,x1:R,y1:N,x2:M,y2:k,width:m.width,depth:m.depth}),t.addLine(V(R,N),V(M,N)),t.addLine(V(M,N),V(M,k)),t.addLine(V(M,k),V(R,k)),t.addLine(V(R,k),V(R,N));const x=m.width,T=m.depth,E=p==null?void 0:p.modelConfig,C=(E==null?void 0:E.shelfCount)||0;if(console.log(`🏗️ 평면도 가구 ${a+1} 내부 구조:`,{moduleId:d,shelfCount:C,modelConfig:E,furnitureWidth:x,furnitureDepth:T}),x>200&&T>200&&_){const $=R+x/2;t.addLine(V($,N),V($,k))}const D=R+m.width/2,P=N+m.depth/2;t.addText(V(D,P),Math.min(m.width/4,m.depth/4,50),h.name||`가구${a+1}`);const I=C===0?"오픈박스":C===1?"2단":C===6?"7단":C===2?"듀얼2단":C===12?"듀얼7단":`${C}선반`;t.addText(V(D,N-80),15,`슬롯${y+1} | ${I}`),console.log(`🔍 평면도 가구 ${a+1} (${h.name}) 치수:`,{moduleId:d,moduleDataDepth:h.dimensions.depth,actualModuleDataDepth:p==null?void 0:p.dimensions.depth,finalDepth:m.depth,width:m.width,height:m.height}),t.addText(V(D,N-50),20,`${m.width}W×${m.depth}D×${m.height}H`)})},cP=(t,e,n)=>{const s=dt(n);console.log("🔍 DXF 측면도 생성 - 가구 배치 정보:",{totalModules:e.length,spaceDepth:n.depth,spaceHeight:n.height}),e.forEach((i,r)=>{const{moduleData:o,moduleId:a}=i,u=Dt(a,s,n),h=o.dimensions,d=h.depth;console.log(`🔍 측면도 가구 ${r+1} (${o.name}) 치수:`,{moduleId:a,moduleDataDepth:o.dimensions.depth,actualModuleDataDepth:u==null?void 0:u.dimensions.depth,finalDepth:d,height:h.height});const p=20,m=p+d,_=p+d/2,y=0,v=h.height,w=v/2;console.log("📐 측면도 DXF 좌표 계산:",{frontPositionMm:p,backPositionMm:m,furnitureCenterX:_,furnitureBottomY:y,furnitureTopY:v,furnitureCenterY:w,actualDepthMm:d,height:h.height});const b=p,A=y,R=m,N=v;t.addLine(V(b,A),V(R,A)),t.addLine(V(R,A),V(R,N)),t.addLine(V(R,N),V(b,N)),t.addLine(V(b,N),V(b,A));const M=u==null?void 0:u.modelConfig,k=(M==null?void 0:M.shelfCount)||0;if(console.log(`🏗️ 측면도 가구 ${r+1} 내부 구조:`,{moduleId:a,shelfCount:k,modelConfig:M,actualDepthMm:d,height:h.height}),h.height>200&&d>200&&k>0)for(let C=1;C<=k;C++){const D=A+h.height/(k+1)*C;t.addLine(V(b,D),V(R,D))}const x=_,T=w;t.addText(V(x,T),Math.min(d/4,h.height/4,50),o.name||`가구${r+1}`);const E=k===0?"오픈박스":k===1?"2단":k===6?"7단":k===2?"듀얼2단":k===12?"듀얼7단":`${k}선반`;if(t.addText(V(x,A-80),15,`${E} | ${r+1}번째`),t.addText(V(x,A-50),20,`${h.width}W×${d}D×${h.height}H`),d>100){const C=A-120;t.addLine(V(b,C),V(R,C)),t.addLine(V(b,C-10),V(b,C+10)),t.addLine(V(R,C-10),V(R,C+10)),t.addText(V(x,C-30),15,`${d}mm`)}})},uP=(t,e,n="front")=>{const s=e.width+500,i=n==="plan"?e.depth:e.height,r={front:{ko:"정면도",en:"Front Elevation"},plan:{ko:"평면도",en:"Plan View"},side:{ko:"측면도",en:"Side Section"}},o=r[n]||r.front;t.addText(V(s,i-100),80,`가구 배치 ${o.ko}`);const a=new Date().toLocaleDateString("ko-KR");t.addText(V(s,i-200),40,`작성일: ${a}`),t.addText(V(s,i-280),40,`도면: ${o.ko} (${o.en})`),t.addText(V(s,i-360),40,"축척: 1:100"),t.addText(V(s,i-440),40,"단위: mm"),n==="plan"?(t.addText(V(e.width/2,-200),60,`폭: ${e.width}mm × 깊이: ${e.depth}mm`),t.addText(V(e.width/2,-280),50,`공간 높이: ${e.height}mm`)):(t.addText(V(e.width/2,-200),60,`폭: ${e.width}mm × 높이: ${e.height}mm`),t.addText(V(e.width/2,-280),50,`공간 깊이: ${e.depth}mm`))},hP=(t,e)=>{try{const n=new Blob([t],{type:"application/dxf"}),s=URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s),console.log(`✅ DXF 파일 다운로드 완료: ${e}`)}catch(n){throw console.error("❌ DXF 파일 다운로드 실패:",n),new Error("DXF 파일 다운로드에 실패했습니다.")}},dP=(t,e="front")=>{const n=new Date().toISOString().slice(0,19).replace(/[:-]/g,""),s=`${t.width}W-${t.height}H-${t.depth}D`;return`furniture-${{front:"elevation",plan:"plan",side:"section"}[e]||"elevation"}-${s}-${n}.dxf`},fP=()=>{const t=j.useCallback(async(s,i,r="front")=>{try{console.log(`🔧 DXF ${r} 도면 내보내기 시작...`),console.log("📊 입력 데이터:",{spaceInfo:{width:s.width,height:s.height,depth:s.depth,surroundType:s.surroundType,customColumnCount:s.customColumnCount},placedModulesCount:i.length,drawingType:r,placedModules:i.map(p=>({id:p.id,moduleId:p.moduleId,position:p.position,slotIndex:p.slotIndex,isDualSlot:p.isDualSlot,customDepth:p.customDepth}))});const o=dt(s),a={spaceInfo:s,drawingType:r,placedModules:i.map(p=>{const m=Dt(p.moduleId,o,s);return console.log(`🔍 가구 ${p.id} customDepth 확인:`,{moduleId:p.moduleId,customDepth:p.customDepth,originalDepth:m==null?void 0:m.dimensions.depth}),{id:p.id,moduleId:p.moduleId,position:{x:p.position.x,y:p.position.y,z:p.position.z},moduleData:{name:(m==null?void 0:m.name)||`모듈-${p.moduleId}`,dimensions:{width:(m==null?void 0:m.dimensions.width)||400,height:(m==null?void 0:m.dimensions.height)||400,depth:p.customDepth||(m==null?void 0:m.dimensions.depth)||300}},rotation:p.rotation,slotIndex:p.slotIndex,isDualSlot:p.isDualSlot}})};console.log("🔄 변환된 DXF 데이터:",a);const u=tP(a),h=dP(s,r);return hP(u,h),console.log(`✅ DXF ${r} 도면 내보내기 완료!`),{success:!0,filename:h,message:`DXF ${{front:"정면도",plan:"평면도",side:"측면도"}[r]} 파일이 성공적으로 생성되었습니다.`}}catch(o){return console.error(`❌ DXF ${r} 도면 내보내기 실패:`,o),{success:!1,error:o instanceof Error?o.message:"알 수 없는 오류가 발생했습니다.",message:`DXF ${r} 도면 파일 생성에 실패했습니다.`}}},[]),e=j.useCallback((s,i)=>!(!s||s.width<=0||s.depth<=0),[]),n=j.useCallback((s,i)=>{if(!s)return"공간 정보가 없습니다.";if(s.width<=0||s.depth<=0)return"공간 크기를 설정해주세요.";const r=i.length;return r===0?"공간 도면만 생성됩니다.":`${r}개 가구가 포함된 도면이 생성됩니다.`},[]);return{exportToDXF:t,canExportDXF:e,getExportStatusMessage:n}},pP="_exportPanel_p0xee_1",gP="_header_p0xee_10",mP="_title_p0xee_14",_P="_description_p0xee_24",yP="_drawingTypeSelection_p0xee_32",vP="_selectionTitle_p0xee_36",wP="_drawingTypes_p0xee_43",TP="_drawingTypeItem_p0xee_49",EP="_checkbox_p0xee_71",AP="_drawingTypeInfo_p0xee_78",IP="_drawingTypeIcon_p0xee_85",xP="_drawingTypeText_p0xee_91",SP="_drawingTypeName_p0xee_97",bP="_drawingTypeDescription_p0xee_103",CP="_status_p0xee_108",DP="_statusMessage_p0xee_116",PP="_spaceInfo_p0xee_122",RP="_spaceSize_p0xee_128",NP="_moduleCount_p0xee_133",MP="_actions_p0xee_138",jP="_exportButton_p0xee_142",LP="_disabled_p0xee_160",kP="_icon_p0xee_178",FP="_spinner_p0xee_182",OP="_result_p0xee_196",VP="_success_p0xee_204",BP="_error_p0xee_210",UP="_resultMessage_p0xee_216",$P="_filename_p0xee_221",HP="_info_p0xee_238",WP="_infoItem_p0xee_243",XP="_infoLabel_p0xee_255",GP="_infoValue_p0xee_260",ye={exportPanel:pP,header:gP,title:mP,description:_P,drawingTypeSelection:yP,selectionTitle:vP,drawingTypes:wP,drawingTypeItem:TP,checkbox:EP,drawingTypeInfo:AP,drawingTypeIcon:IP,drawingTypeText:xP,drawingTypeName:SP,drawingTypeDescription:bP,status:CP,statusMessage:DP,spaceInfo:PP,spaceSize:RP,moduleCount:NP,actions:MP,exportButton:jP,disabled:LP,icon:kP,spinner:FP,result:OP,success:VP,error:BP,resultMessage:UP,filename:$P,info:HP,infoItem:WP,infoLabel:XP,infoValue:GP},YP=[{id:"front",name:"정면도",description:"정면에서 본 도면",icon:"📐"},{id:"plan",name:"평면도",description:"위에서 본 도면",icon:"🗺️"},{id:"side",name:"측면도",description:"측면에서 본 도면",icon:"📏"}],zP=()=>{const{spaceInfo:t}=Ct(),e=be(v=>v.placedModules),{exportToDXF:n,canExportDXF:s,getExportStatusMessage:i}=fP(),[r,o]=j.useState(!1),[a,u]=j.useState(["front"]),[h,d]=j.useState(null),p=v=>{u(w=>w.includes(v)?w.filter(b=>b!==v):[...w,v])},m=async()=>{if(!(!t||!s(t,e)||a.length===0)){o(!0),d(null);try{const v=[];for(const A of a){const R=await n(t,e,A);v.push({drawingType:A,result:R})}const w=v.every(A=>A.result.success),b=v.filter(A=>A.result.success).length;d(w?{success:!0,message:`${b}개 도면이 성공적으로 생성되었습니다.`}:{success:!1,message:`${b}/${v.length}개 도면이 생성되었습니다.`}),w&&setTimeout(()=>{d(null)},3e3)}catch{d({success:!1,message:"예상치 못한 오류가 발생했습니다."})}finally{o(!1)}}},_=t&&s(t,e)&&a.length>0,y=t?i(t,e):"공간 정보가 없습니다.";return c.jsxs("div",{className:ye.exportPanel,children:[c.jsxs("div",{className:ye.header,children:[c.jsx("h3",{className:ye.title,children:"📋 도면 내보내기"}),c.jsx("p",{className:ye.description,children:"현재 가구 배치를 CAD 도면(DXF)으로 내보냅니다"})]}),c.jsxs("div",{className:ye.drawingTypeSelection,children:[c.jsx("h4",{className:ye.selectionTitle,children:"내보낼 도면 선택"}),c.jsx("div",{className:ye.drawingTypes,children:YP.map(v=>c.jsxs("label",{className:ye.drawingTypeItem,children:[c.jsx("input",{type:"checkbox",checked:a.includes(v.id),onChange:()=>p(v.id),className:ye.checkbox}),c.jsxs("div",{className:ye.drawingTypeInfo,children:[c.jsx("span",{className:ye.drawingTypeIcon,children:v.icon}),c.jsxs("div",{className:ye.drawingTypeText,children:[c.jsx("span",{className:ye.drawingTypeName,children:v.name}),c.jsx("span",{className:ye.drawingTypeDescription,children:v.description})]})]})]},v.id))})]}),c.jsxs("div",{className:ye.status,children:[c.jsx("div",{className:ye.statusMessage,children:y}),t&&c.jsxs("div",{className:ye.spaceInfo,children:[c.jsxs("span",{className:ye.spaceSize,children:[t.width,"W × ",t.height,"H × ",t.depth,"D mm"]}),c.jsxs("span",{className:ye.moduleCount,children:[e.length,"개 가구"]})]})]}),c.jsx("div",{className:ye.actions,children:c.jsx("button",{className:`${ye.exportButton} ${_?"":ye.disabled}`,onClick:m,disabled:!_||r,children:r?c.jsxs(c.Fragment,{children:[c.jsx("span",{className:ye.spinner}),"내보내는 중..."]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{className:ye.icon,children:"📄"}),"DXF 도면 다운로드 (",a.length,"개)"]})})}),h&&c.jsxs("div",{className:`${ye.result} ${h.success?ye.success:ye.error}`,children:[c.jsxs("div",{className:ye.resultMessage,children:[h.success?"✅":"❌"," ",h.message]}),h.filename&&c.jsxs("div",{className:ye.filename,children:["파일명: ",h.filename]})]}),c.jsxs("div",{className:ye.info,children:[c.jsxs("div",{className:ye.infoItem,children:[c.jsx("span",{className:ye.infoLabel,children:"파일 형식:"}),c.jsx("span",{className:ye.infoValue,children:"DXF (AutoCAD 호환)"})]}),c.jsxs("div",{className:ye.infoItem,children:[c.jsx("span",{className:ye.infoLabel,children:"축척:"}),c.jsx("span",{className:ye.infoValue,children:"1:100"})]}),c.jsxs("div",{className:ye.infoItem,children:[c.jsx("span",{className:ye.infoLabel,children:"단위:"}),c.jsx("span",{className:ye.infoValue,children:"밀리미터(mm)"})]})]})]})},qP="_configurator_3r24j_2",KP="_mainContent_3r24j_12",QP="_sidebarContent_3r24j_20",JP="_sidebarPanel_3r24j_30",ZP="_modulePanelContent_3r24j_38",eR="_modulePanelTitle_3r24j_46",tR="_moduleSection_3r24j_139",nR="_viewerArea_3r24j_145",sR="_viewer_3r24j_145",iR="_viewerDoorToggle_3r24j_161",rR="_viewerDoorButton_3r24j_171",oR="_active_3r24j_189",aR="_rightPanel_3r24j_201",lR="_rightPanelHeader_3r24j_210",cR="_rightPanelTabs_3r24j_215",uR="_rightPanelTab_3r24j_215",hR="_rightPanelContent_3r24j_243",dR="_spaceControls_3r24j_250",fR="_configSection_3r24j_257",pR="_sectionHeader_3r24j_267",gR="_sectionDot_3r24j_274",mR="_sectionTitle_3r24j_282",_R="_inputGroup_3r24j_290",yR="_inputRow_3r24j_299",vR="_inputLabel_3r24j_306",wR="_numberInputGroup_3r24j_313",TR="_decrementButton_3r24j_323",ER="_incrementButton_3r24j_324",AR="_numberInput_3r24j_313",IR="_doorSliderContainer_3r24j_357",xR="_doorSlider_3r24j_357",SR="_sliderLabels_3r24j_393",bR="_sliderLabel_3r24j_393",CR="_slotInfoBox_3r24j_412",DR="_slotInfoText_3r24j_419",PR="_moduleSettings_3r24j_457",RR="_placeholder_3r24j_463",NR="_loadingContainer_3r24j_475",z={configurator:qP,mainContent:KP,sidebarContent:QP,sidebarPanel:JP,modulePanelContent:ZP,modulePanelTitle:eR,moduleSection:tR,viewerArea:nR,viewer:sR,viewerDoorToggle:iR,viewerDoorButton:rR,active:oR,rightPanel:aR,rightPanelHeader:lR,rightPanelTabs:cR,rightPanelTab:uR,rightPanelContent:hR,spaceControls:dR,configSection:fR,sectionHeader:pR,sectionDot:gR,sectionTitle:mR,inputGroup:_R,inputRow:yR,inputLabel:vR,numberInputGroup:wR,decrementButton:TR,incrementButton:ER,numberInput:AR,doorSliderContainer:IR,doorSlider:xR,sliderLabels:SR,sliderLabel:bR,slotInfoBox:CR,slotInfoText:DR,moduleSettings:PR,placeholder:RR,loadingContainer:NR},MR=()=>{const[t]=Sm(),e=Al(),[n,s]=j.useState(!1),[i,r]=j.useState(!1),[o,a]=j.useState("idle"),[u,h]=j.useState(null),{setBasicInfo:d,basicInfo:p}=uy(),{setSpaceInfo:m,spaceInfo:_}=Ct(),{setPlacedModules:y,placedModules:v,setAllDoors:w}=be(),b=Zi(),{updateFurnitureForNewSpace:A}=nC({setPlacedModules:y}),{viewMode:R,setViewMode:N,doorsOpen:M,toggleDoors:k,view2DDirection:x,setView2DDirection:T,showDimensions:E,toggleDimensions:C}=tr(),[D,P]=j.useState("module"),[I,$]=j.useState("placement"),[K,_e]=j.useState(!0),[we,je]=j.useState("solid"),[ne,se]=j.useState(!0),[Ce,Ie]=j.useState(!1),[de,Pt]=j.useState(_),Z=()=>{if(_.customColumnCount)return _.customColumnCount;if(b.isCalculated&&b.columnCount)return b.columnCount;const le=(_.width||4800)-100;return Math.max(8,Math.min(15,Math.floor(le/600)))},pe=v.some(le=>le.moduleId.includes("dual-2drawer-styler")||le.moduleId.includes("dual-4drawer-pantshanger")),We=v.some(le=>le.hasDoor),ze=async le=>{s(!0);try{const{project:Ve,error:gn}=await wy(le);if(gn){console.error("프로젝트 로드 에러:",gn),alert("프로젝트를 불러오는데 실패했습니다: "+gn),e("/");return}Ve&&(d(Ve.projectData),m(Ve.spaceConfig),y(Ve.furniture.placedModules),h(le),console.log("✅ 프로젝트 로드 성공:",Ve.title),console.log("🎨 로드된 materialConfig:",Ve.spaceConfig.materialConfig),console.log("🔄 [프로젝트 로드 후] derivedSpaceStore 강제 재계산"),b.recalculateFromSpaceInfo(Ve.spaceConfig))}catch(Ve){console.error("프로젝트 로드 실패:",Ve),alert("프로젝트 로드 중 오류가 발생했습니다."),e("/")}finally{s(!1)}},Q=async()=>{if(!u){alert("저장할 프로젝트가 없습니다.");return}r(!0),a("idle");try{console.log("💾 저장할 spaceInfo:",_),console.log("🎨 저장할 materialConfig:",_.materialConfig);let le=await Wb();le||(console.log("📸 3D 캔버스 캡처 실패, 기본 썸네일 생성"),le=Ey(_,v.length));const{error:Ve}=await Ty(u,{title:p.title,projectData:p,spaceConfig:_,furniture:{placedModules:v}},le);if(Ve)console.error("프로젝트 저장 에러:",Ve),a("error"),alert("프로젝트 저장에 실패했습니다: "+Ve);else{a("success"),console.log("✅ 프로젝트 저장 성공 (썸네일 포함)");try{new BroadcastChannel("project-updates").postMessage({type:"PROJECT_SAVED",projectId:u,timestamp:Date.now()}),console.log("📡 다른 창에 프로젝트 업데이트 알림 전송")}catch(gn){console.warn("BroadcastChannel 전송 실패 (무시 가능):",gn)}setTimeout(()=>a("idle"),3e3)}}catch(le){console.error("프로젝트 저장 실패:",le),a("error"),alert("프로젝트 저장 중 오류가 발생했습니다.")}finally{r(!1)}};j.useEffect(()=>{const le=t.get("id");le&&le!==u&&ze(le)},[t]),j.useEffect(()=>{if(JSON.stringify(de)!==JSON.stringify(_)){const le={...de},Ve={..._};delete le.materialConfig,delete Ve.materialConfig,JSON.stringify(le)!==JSON.stringify(Ve)&&(console.log("🔄 공간이 변경되었습니다. 가구 재배치 실행 중..."),A(de,_)),Pt(_)}},[_,de,A]),j.useEffect(()=>{b.isCalculated||(console.log("🔄 derivedSpaceStore 강제 재계산 (컬럼 수 동기화)"),b.recalculateFromSpaceInfo(_))},[_,b]);const Te=le=>{P(D===le?null:le)},Pe=le=>{m(le)},ot=()=>{We?w(!1):(w(!0),M&&k())},at=()=>{e("/")},Dn=()=>{console.log("다음 단계로")},pn=()=>{window.open("/help","_blank")},pt=()=>{console.log("컨버팅")},di=()=>{e("/login")},fi=()=>{console.log("프로필")},Bs=()=>{if(!D)return null;switch(D){case"module":return c.jsx("div",{className:z.sidebarPanel,children:c.jsxs("div",{className:z.modulePanelContent,children:[c.jsx("h3",{className:z.modulePanelTitle,children:"가구 모듈"}),c.jsx("div",{className:z.moduleSection,children:c.jsx(m6,{})})]})});case"material":return c.jsx("div",{className:z.sidebarPanel,children:c.jsx(G3,{})});case"structure":return c.jsx("div",{className:z.sidebarPanel,children:c.jsx("div",{className:z.placeholder,children:"구조물 설정"})});case"etc":return c.jsx("div",{className:z.sidebarPanel,children:c.jsx(zP,{})});default:return null}},sr=()=>{switch(I){case"placement":return c.jsxs("div",{className:z.spaceControls,children:[c.jsxs("div",{className:z.configSection,children:[c.jsxs("div",{className:z.sectionHeader,children:[c.jsx("span",{className:z.sectionDot}),c.jsx("h3",{className:z.sectionTitle,children:"설치 타입"})]}),c.jsx(py,{spaceInfo:_,onUpdate:Pe})]}),c.jsxs("div",{className:z.configSection,children:[c.jsxs("div",{className:z.sectionHeader,children:[c.jsx("span",{className:z.sectionDot}),c.jsx("h3",{className:z.sectionTitle,children:"공간 설정"})]}),c.jsx("div",{className:z.inputGroup,children:c.jsx(dy,{spaceInfo:_,onUpdate:Pe,disabled:pe})}),c.jsx("div",{className:z.inputGroup,children:c.jsx(fy,{spaceInfo:_,onUpdate:Pe})})]}),c.jsxs("div",{className:z.configSection,children:[c.jsxs("div",{className:z.sectionHeader,children:[c.jsx("span",{className:z.sectionDot}),c.jsx("h3",{className:z.sectionTitle,children:"단내림"})]}),c.jsx(jb,{spaceInfo:_,onUpdate:Pe,disabled:pe})]}),c.jsxs("div",{className:z.configSection,children:[c.jsxs("div",{className:z.sectionHeader,children:[c.jsx("span",{className:z.sectionDot}),c.jsx("h3",{className:z.sectionTitle,children:"레이아웃"})]}),c.jsx("div",{className:z.inputGroup,children:c.jsxs("div",{className:z.inputRow,children:[c.jsx("label",{className:z.inputLabel,children:"도어 개수"}),c.jsxs("div",{className:z.numberInputGroup,children:[c.jsx("button",{className:z.decrementButton,onClick:()=>{const le=Z(),Ve=Math.max(8,le-1);Pe({customColumnCount:Ve})},children:"−"}),c.jsx("input",{type:"number",min:"8",max:"15",value:Z(),onChange:le=>{const Ve=Math.min(15,Math.max(8,parseInt(le.target.value)||8));Pe({customColumnCount:Ve})},className:z.numberInput}),c.jsx("button",{className:z.incrementButton,onClick:()=>{const le=Z(),Ve=Math.min(15,le+1);Pe({customColumnCount:Ve})},children:"+"})]})]})}),c.jsxs("div",{className:z.doorSliderContainer,children:[c.jsx("input",{type:"range",min:"8",max:"15",value:Z(),onChange:le=>{const Ve=parseInt(le.target.value);Pe({customColumnCount:Ve})},className:z.doorSlider}),c.jsx("div",{className:z.sliderLabels,children:[8,9,10,11,12,13,14,15].map(le=>c.jsx("span",{className:`${z.sliderLabel} ${Z()===le?z.active:""}`,children:le},le))})]}),c.jsx("div",{className:z.slotInfoBox,children:c.jsxs("p",{className:z.slotInfoText,children:["현 사이즈 기준 슬롯 생성 범위: 최소 8개 ~ 최대 15개",c.jsx("br",{}),"도어 1개 너비: ",Math.floor((_.width||4800)/Z()),"mm"]})})]}),c.jsxs("div",{className:z.configSection,children:[c.jsxs("div",{className:z.sectionHeader,children:[c.jsx("span",{className:z.sectionDot}),c.jsx("h3",{className:z.sectionTitle,children:"바닥 마감재"})]}),c.jsx(Eb,{spaceInfo:_,onUpdate:Pe})]}),c.jsxs("div",{className:z.configSection,children:[c.jsxs("div",{className:z.sectionHeader,children:[c.jsx("span",{className:z.sectionDot}),c.jsx("h3",{className:z.sectionTitle,children:"받침대"})]}),c.jsx(Fb,{spaceInfo:_,onUpdate:Pe,disabled:pe})]})]});case"module":return c.jsx("div",{className:z.moduleSettings,children:c.jsx("div",{className:z.placeholder,children:"모듈 속성 설정이 여기에 표시됩니다"})});default:return null}};return n?c.jsxs("div",{className:z.loadingContainer,children:[c.jsx(rl,{size:"large"}),c.jsx("p",{children:"프로젝트를 불러오는 중..."})]}):c.jsxs("div",{className:z.configurator,children:[c.jsx(yC,{title:p.title||"가구 설계",onSave:Q,onPrevious:at,onNext:Dn,onHelp:pn,onConvert:pt,onLogout:di,onProfile:fi,saving:i,saveStatus:o,hasDoorsInstalled:We,onDoorInstallationToggle:ot}),c.jsxs("div",{className:z.mainContent,children:[c.jsx(PC,{activeTab:D,onTabClick:Te,isOpen:!!D}),D&&c.jsx("div",{className:z.sidebarContent,children:Bs()}),c.jsxs("div",{className:z.viewerArea,children:[c.jsx(QC,{viewMode:R,onViewModeChange:le=>N(le),viewDirection:x,onViewDirectionChange:T,renderMode:we,onRenderModeChange:je,showAll:ne,onShowAllToggle:()=>se(!ne),showDimensions:E,onShowDimensionsToggle:C,showGuides:Ce,onShowGuidesToggle:()=>Ie(!Ce),doorsOpen:M,onDoorsToggle:k}),c.jsxs("div",{className:z.viewer,children:[We&&c.jsxs("div",{className:z.viewerDoorToggle,children:[c.jsx("button",{className:`${z.viewerDoorButton} ${M?"":z.active}`,onClick:()=>!M||k(),children:"Close"}),c.jsx("button",{className:`${z.viewerDoorButton} ${M?z.active:""}`,onClick:()=>M||k(),children:"Open"})]}),c.jsx(i6,{spaceInfo:_,viewMode:R,setViewMode:N,renderMode:we,svgSize:{width:600,height:400}})]})]}),K&&c.jsxs("div",{className:z.rightPanel,children:[c.jsx("div",{className:z.rightPanelHeader,children:c.jsxs("div",{className:z.rightPanelTabs,children:[c.jsx("button",{className:`${z.rightPanelTab} ${I==="placement"?z.active:""}`,onClick:()=>$("placement"),children:"배치 속성"}),c.jsx("button",{className:`${z.rightPanelTab} ${I==="module"?z.active:""}`,onClick:()=>$("module"),children:"모듈 속성"})]})}),c.jsx("div",{className:z.rightPanelContent,children:sr()})]})]}),c.jsx(N6,{}),c.jsx(c3,{})]})},jR="_card_1qjsu_1",LR="_interactive_1qjsu_14",kR="_selected_1qjsu_24",FR="_imageContainer_1qjsu_30",OR="_image_1qjsu_30",VR="_content_1qjsu_43",BR="_header_1qjsu_47",UR="_title_1qjsu_51",$R="_subtitle_1qjsu_59",HR="_body_1qjsu_65",WR="_footer_1qjsu_71",XR="_clickable_1qjsu_77",Gt={card:jR,default:"_default_1qjsu_10",interactive:LR,selected:kR,imageContainer:FR,image:OR,content:VR,header:BR,title:UR,subtitle:$R,body:HR,footer:WR,clickable:XR},_u=({variant:t="default",title:e,subtitle:n,image:s,aspectRatio:i="1/1",onClick:r,selected:o=!1,className:a="",children:u,footer:h})=>{const d=[Gt.card,Gt[t],o&&Gt.selected,r&&Gt.clickable,a].filter(Boolean).join(" ");return c.jsxs("div",{className:d,onClick:r,role:r?"button":void 0,tabIndex:r?0:void 0,children:[s&&c.jsx("div",{className:Gt.imageContainer,style:{aspectRatio:i},children:c.jsx("img",{src:s,alt:e,className:Gt.image})}),c.jsxs("div",{className:Gt.content,children:[(e||n)&&c.jsxs("div",{className:Gt.header,children:[e&&c.jsx("h3",{className:Gt.title,children:e}),n&&c.jsx("p",{className:Gt.subtitle,children:n})]}),u&&c.jsx("div",{className:Gt.body,children:u}),h&&c.jsx("div",{className:Gt.footer,children:h})]})]})},GR="_container_1yqht_1",YR="_content_1yqht_7",zR="_header_1yqht_12",qR="_title_1yqht_18",KR="_subtitle_1yqht_26",QR="_mainCard_1yqht_33",JR="_userSection_1yqht_41",ZR="_userInfo_1yqht_48",eN="_logoutButton_1yqht_58",tN="_projectsSection_1yqht_97",nN="_loadingProjects_1yqht_102",sN="_emptyState_1yqht_111",iN="_emptyIcon_1yqht_119",rN="_projectGrid_1yqht_133",oN="_projectCard_1yqht_141",aN="_newProjectCard_1yqht_157",lN="_newProjectContent_1yqht_172",cN="_newProjectIcon_1yqht_177",uN="_newProjectText_1yqht_183",hN="_projectThumbnail_1yqht_190",dN="_thumbnailPlaceholder_1yqht_203",fN="_thumbnailImage_1yqht_213",pN="_editIcon_1yqht_220",gN="_versionBadge_1yqht_225",mN="_menuButton_1yqht_238",_N="_dropdownPortal_1yqht_277",yN="_deleteMenuItem_1yqht_316",vN="_projectInfo_1yqht_322",wN="_projectTitle_1yqht_327",TN="_projectMeta_1yqht_336",EN="_projectTime_1yqht_342",AN="_projectDetailsButton_1yqht_348",IN="_loginSection_1yqht_366",xN="_loginButton_1yqht_380",SN="_featuresGrid_1yqht_396",bN="_featureCard_1yqht_402",CN="_featureIcon_1yqht_407",DN="_loadingScreen_1yqht_423",ce={container:GR,content:YR,header:zR,title:qR,subtitle:KR,mainCard:QR,userSection:JR,userInfo:ZR,logoutButton:eN,projectsSection:tN,loadingProjects:nN,emptyState:sN,emptyIcon:iN,projectGrid:rN,projectCard:oN,newProjectCard:aN,newProjectContent:lN,newProjectIcon:cN,newProjectText:uN,projectThumbnail:hN,thumbnailPlaceholder:dN,thumbnailImage:fN,editIcon:pN,versionBadge:gN,menuButton:mN,dropdownPortal:_N,deleteMenuItem:yN,projectInfo:vN,projectTitle:wN,projectMeta:TN,projectTime:EN,projectDetailsButton:AN,loginSection:IN,loginButton:xN,featuresGrid:SN,featureCard:bN,featureIcon:CN,loadingScreen:DN},PN=({isOpen:t,onClose:e,position:n,onAction:s})=>{const i=j.useRef(null);return j.useEffect(()=>{const r=o=>{i.current&&!i.current.contains(o.target)&&e()};if(t)return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[t,e]),t?c.jsxs("div",{ref:i,className:ce.dropdownPortal,style:{position:"fixed",top:n.top,left:n.left,zIndex:999999},children:[c.jsx("button",{onClick:()=>s("duplicate"),children:"Duplicate"}),c.jsx("button",{onClick:()=>s("rename"),children:"Rename"}),c.jsx("button",{onClick:()=>s("collaborate"),children:"Collaborate"}),c.jsx("button",{onClick:()=>s("delete"),className:ce.deleteMenuItem,children:"Delete"})]}):null},RN=()=>{const t=Al(),{user:e,loading:n}=cy(),[s,i]=j.useState([]),[r,o]=j.useState(!1),[a,u]=j.useState(!1),[h,d]=j.useState(null),[p,m]=j.useState({top:0,left:0}),_=j.useCallback(async()=>{if(e){o(!0);try{const{projects:M,error:k}=await Bb();k?(console.error("프로젝트 목록 로드 에러:",k),i([])):i(M)}catch(M){console.error("프로젝트 목록 로드 실패:",M),i([])}finally{o(!1)}}},[e]);j.useEffect(()=>{e&&_()},[e,_]),j.useEffect(()=>{if(!e)return;const M=new BroadcastChannel("project-updates"),k=x=>{x.data.type==="PROJECT_SAVED"&&(console.log("📡 다른 창에서 프로젝트 저장됨, 목록 새로고침:",x.data.projectId),_())};return M.addEventListener("message",k),console.log("📡 프로젝트 업데이트 리스너 등록"),()=>{M.removeEventListener("message",k),M.close(),console.log("📡 프로젝트 업데이트 리스너 해제")}},[e,_]);const y=async()=>{if(!e){t("/auth");return}u(!0);const M=window.open("about:blank","_blank");try{const k=new Date,x=String(k.getFullYear()).slice(-2),T=String(k.getMonth()+1).padStart(2,"0"),E=String(k.getDate()).padStart(2,"0"),C=`가구 ${x}${T}${E}`,{id:D,error:P}=await Ob({title:C,projectData:{title:C,location:""},spaceConfig:hy,furniture:{placedModules:[]}});if(P)console.error("프로젝트 생성 에러:",P),alert("프로젝트 생성에 실패했습니다: "+P),M&&M.close();else if(D){console.log("✅ 새 프로젝트 생성 성공:",D);const I=`/step0?projectId=${D}`;M?M.location.href=I:window.open(I,"_blank")}}catch(k){console.error("프로젝트 생성 실패:",k),alert("프로젝트 생성 중 오류가 발생했습니다."),M&&M.close()}finally{u(!1)}},v=M=>{const k=`/configurator?projectId=${M}`;window.open(k,"_blank")},w=()=>{alert("유료회원 메뉴입니다")},b=(M,k)=>{if(k.stopPropagation(),h===M)d(null);else{const x=k.currentTarget.getBoundingClientRect(),T=140,E=160;let C=x.bottom+4,D=x.right-T;D<0&&(D=x.left),D+T>window.innerWidth&&(D=window.innerWidth-T-8),C+E>window.innerHeight&&(C=x.top-E-4),m({top:C,left:D}),d(M)}},A=async M=>{if(!h)return;const k=s.find(x=>x.id===h);if(k){switch(M){case"duplicate":alert("Duplicate 기능은 아직 구현되지 않았습니다.");break;case"rename":{const x=prompt("새 프로젝트 이름을 입력하세요:",k.title);x&&x.trim()&&alert("Rename 기능은 아직 구현되지 않았습니다.");break}case"collaborate":alert("Collaborate 기능은 아직 구현되지 않았습니다.");break;case"delete":if(window.confirm(`"${k.title}" 프로젝트를 삭제하시겠습니까?`))try{await Vb(k.id),_()}catch(x){console.error("프로젝트 삭제 실패:",x),alert("프로젝트 삭제에 실패했습니다.")}break}d(null)}},R=async()=>{try{const{error:M}=await jx();M?(console.error("로그아웃 에러:",M),alert("로그아웃에 실패했습니다: "+M)):(console.log("✅ 로그아웃 성공"),i([]))}catch(M){console.error("로그아웃 실패:",M),alert("로그아웃 중 오류가 발생했습니다.")}},N=M=>{if(!M)return"날짜 미상";let k;typeof M=="object"&&M!==null&&"seconds"in M&&M.seconds?k=new Date(M.seconds*1e3):M instanceof Date?k=M:typeof M=="string"?k=new Date(M):k=new Date;const T=Math.floor((new Date().getTime()-k.getTime())/(1e3*60*60));return T<1?"방금 전":T<24?`${T}시간 전`:T<24*7?`${Math.floor(T/24)}일 전`:k.toLocaleDateString("ko-KR",{month:"short",day:"numeric"})};return n?c.jsx("div",{className:ce.loadingScreen,children:c.jsx(rl,{message:"사용자 정보를 불러오는 중...",size:"large",type:"spinner"})}):c.jsxs("div",{className:ce.container,children:[c.jsxs("div",{className:ce.content,children:[c.jsxs("div",{className:ce.header,children:[c.jsx("h1",{className:ce.title,children:"🏠 가구 설계 도구"}),c.jsx("p",{className:ce.subtitle,children:"직관적인 3D 인터페이스로 맞춤형 가구를 설계하고 관리하세요"})]}),e?c.jsxs("div",{className:ce.mainCard,children:[c.jsxs("div",{className:ce.userSection,children:[c.jsxs("div",{className:ce.userInfo,children:[c.jsxs("h2",{children:["안녕하세요, ",e.displayName||e.email,"님! 👋"]}),c.jsx("p",{children:"새로운 프로젝트를 시작하거나 기존 프로젝트를 계속 작업하세요"})]}),c.jsx("button",{className:ce.logoutButton,onClick:R,title:"로그아웃",children:"로그아웃"})]}),c.jsxs("div",{className:ce.projectsSection,children:[c.jsxs("h3",{children:["내 프로젝트 (",s.length,")"]}),r?c.jsx("div",{className:ce.loadingProjects,children:c.jsx(rl,{message:"프로젝트 목록을 불러오는 중...",size:"medium",type:"dots"})}):c.jsxs("div",{className:ce.projectGrid,children:[c.jsx("div",{className:`${ce.projectCard} ${ce.newProjectCard}`,onClick:y,children:c.jsxs("div",{className:ce.newProjectContent,children:[c.jsx("div",{className:ce.newProjectIcon,children:a?"⏳":"+"}),c.jsx("div",{className:ce.newProjectText,children:a?"생성 중...":"New project"})]})}),s.map(M=>c.jsxs("div",{className:ce.projectCard,children:[c.jsxs("div",{className:ce.projectThumbnail,onClick:()=>v(M.id),children:[M.thumbnail?c.jsx("img",{src:M.thumbnail,alt:M.title,className:ce.thumbnailImage}):c.jsx("div",{className:ce.thumbnailPlaceholder,children:c.jsx("div",{className:ce.editIcon,children:"✏️"})}),c.jsx("div",{className:ce.versionBadge,children:"V5.0"}),c.jsx("button",{className:ce.menuButton,onClick:k=>b(M.id,k),children:"⋯"})]}),c.jsxs("div",{className:ce.projectInfo,children:[c.jsx("h4",{className:ce.projectTitle,children:M.title}),c.jsx("div",{className:ce.projectMeta,children:c.jsx("span",{className:ce.projectTime,children:N(M.updatedAt)})})]}),c.jsx("button",{className:ce.projectDetailsButton,onClick:w,children:"도면 보기"})]},M.id))]}),s.length===0&&!r&&c.jsxs("div",{className:ce.emptyState,children:[c.jsx("div",{className:ce.emptyIcon,children:"📁"}),c.jsx("h4",{children:"아직 프로젝트가 없습니다"}),c.jsx("p",{children:"새 프로젝트를 만들어서 가구 설계를 시작해보세요!"})]})]})]}):c.jsx("div",{className:ce.mainCard,children:c.jsxs("div",{className:ce.loginSection,children:[c.jsx("h2",{children:"로그인이 필요합니다"}),c.jsx("p",{children:"프로젝트를 생성하고 관리하려면 먼저 로그인해주세요"}),c.jsx("button",{className:ce.loginButton,onClick:()=>t("/auth"),children:"로그인하기"})]})}),c.jsxs("div",{className:ce.featuresGrid,children:[c.jsx(_u,{children:c.jsxs("div",{className:ce.featureCard,children:[c.jsx("div",{className:ce.featureIcon,children:"🎨"}),c.jsx("h3",{children:"직관적인 설계"}),c.jsx("p",{children:"드래그 앤 드롭으로 쉽게 가구를 배치하고 수정할 수 있습니다"})]})}),c.jsx(_u,{children:c.jsxs("div",{className:ce.featureCard,children:[c.jsx("div",{className:ce.featureIcon,children:"🔄"}),c.jsx("h3",{children:"실시간 3D"}),c.jsx("p",{children:"변경사항이 즉시 3D 뷰에 반영되어 결과를 바로 확인할 수 있습니다"})]})}),c.jsx(_u,{children:c.jsxs("div",{className:ce.featureCard,children:[c.jsx("div",{className:ce.featureIcon,children:"☁️"}),c.jsx("h3",{children:"클라우드 저장"}),c.jsx("p",{children:"프로젝트가 안전하게 클라우드에 저장되어 언제든 접근할 수 있습니다"})]})})]})]}),c.jsx(PN,{isOpen:h!==null,onClose:()=>d(null),position:p,onAction:A})]})},NN="_loginForm_v1gdu_1",MN="_container_v1gdu_10",jN="_googleButton_v1gdu_28",LN="_googleIcon_v1gdu_54",kN="_divider_v1gdu_59",FN="_form_v1gdu_85",ON="_error_v1gdu_91",VN="_submitButton_v1gdu_101",BN="_switchMode_v1gdu_108",UN="_switchButton_v1gdu_115",yn={loginForm:NN,container:MN,googleButton:jN,googleIcon:LN,divider:kN,form:FN,error:ON,submitButton:VN,switchMode:BN,switchButton:UN},$N=({onSuccess:t})=>{const e=Al(),{user:n,loading:s}=cy(),[i,r]=j.useState(""),[o,a]=j.useState(""),[u,h]=j.useState(""),[d,p]=j.useState(!1),[m,_]=j.useState(!1),[y,v]=j.useState(null);j.useEffect(()=>{if(n&&!s){console.log("✅ 로그인된 상태 감지, 홈페이지로 이동합니다.");const A=setTimeout(()=>{e("/")},1e3);return()=>clearTimeout(A)}},[n,s,e]);const w=async A=>{A.preventDefault(),_(!0),v(null);try{let R;d?R=await Mx(i,o,u):R=await Rx(i,o),R.error?v(R.error):R.user&&(console.log("✅ 인증 성공:",R.user.email),t==null||t())}catch(R){v("예상치 못한 오류가 발생했습니다."),console.error("인증 에러:",R)}finally{_(!1)}},b=async()=>{_(!0),v(null);try{const A=await Nx();A.error?v(A.error):A.user&&(console.log("✅ 구글 로그인 성공:",A.user.email),t==null||t())}catch(A){v("구글 로그인 중 오류가 발생했습니다."),console.error("구글 로그인 에러:",A)}finally{_(!1)}};return c.jsx("div",{className:yn.loginForm,children:c.jsxs("div",{className:yn.container,children:[c.jsx("h2",{children:d?"회원가입":"로그인"}),c.jsxs(Gu,{onClick:b,disabled:m,className:yn.googleButton,children:[c.jsx("span",{className:yn.googleIcon,children:"🔍"}),"Google로 ",d?"회원가입":"로그인"]}),c.jsx("div",{className:yn.divider,children:c.jsx("span",{children:"또는"})}),c.jsxs("form",{onSubmit:w,className:yn.form,children:[d&&c.jsx(Fa,{type:"text",placeholder:"이름",value:u,onChange:A=>h(A.target.value),required:d}),c.jsx(Fa,{type:"email",placeholder:"이메일",value:i,onChange:A=>r(A.target.value),required:!0}),c.jsx(Fa,{type:"password",placeholder:"비밀번호",value:o,onChange:A=>a(A.target.value),required:!0}),y&&c.jsx("div",{className:yn.error,children:y}),c.jsx(Gu,{type:"submit",disabled:m,className:yn.submitButton,children:m?"처리 중...":d?"회원가입":"로그인"})]}),c.jsxs("div",{className:yn.switchMode,children:[d?"이미 계정이 있으신가요?":"계정이 없으신가요?",c.jsx("button",{type:"button",onClick:()=>p(!d),className:yn.switchButton,children:d?"로그인":"회원가입"})]})]})})};function u1(){const t=document.getElementsByTagName("canvas");for(let e=0;e<t.length;e++){const n=t[e],s=n.getContext("2d");s&&s.clearRect(0,0,n.width,n.height),n.width=1,n.height=1}}function HN(){const t=bm();return j.useEffect(()=>()=>{setTimeout(()=>{u1()},0)},[t.pathname]),null}function WN(){return c.jsxs(c.Fragment,{children:[c.jsx(HN,{}),c.jsxs(K1,{children:[c.jsx(us,{path:"/",element:c.jsx(RN,{})}),c.jsx(us,{path:"/auth",element:c.jsx($N,{})}),c.jsx(us,{path:"/step0",element:c.jsx(Xb,{})}),c.jsx(us,{path:"/configurator",element:c.jsx(MR,{})}),c.jsx(us,{path:"/step1",element:c.jsx(Qo,{to:"/configurator",replace:!0})}),c.jsx(us,{path:"/step2",element:c.jsx(Qo,{to:"/configurator",replace:!0})}),c.jsx(us,{path:"/step3",element:c.jsx(Qo,{to:"/configurator",replace:!0})}),c.jsx(us,{path:"*",element:c.jsx(Qo,{to:"/",replace:!0})})]})]})}function XN(){return j.useEffect(()=>{const t=()=>{u1()};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t),t()}},[]),c.jsx(Fx,{children:c.jsx(kx,{children:c.jsx(q1,{children:c.jsx(WN,{})})})})}z1.createRoot(document.getElementById("root")).render(c.jsx(XN,{}));
