var tr=Object.defineProperty;var nr=(s,e,t)=>e in s?tr(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var g=(s,e,t)=>nr(s,typeof e!="symbol"?e+"":e,t);import{M as rr,b as sr,r as h,u as ir,R as or,s as ar,c as A,j as d,d as mt,e as cr,f as ce,h as we,i as lr,k as ur,t as fr,l as dr,C as mn,P as hr,O as pr,G as mr}from"./three-fiber-CdjZNv-7.js";import{a8 as gr,a9 as ot,aa as gn,ab as xr,ac as ge,ad as xn,a7 as B,e as H,y as te,ae as V,af as oe,ag as yr,ah as wr,ai as Tr,w as v,d as y,aj as yn,Q as X,K as Rr,ak as Te,al as Sr,am as br,a1 as re,an as Mr,ao as wn,ap as Pr,aq as Ir,ar as _r,Y as ye,as as Tn,at,au as Er,av as Ar,aw as vr,ax as xe,ay as Cr,az as Rn,D as Lr,J,aA as Nr,a0 as gt,aB as jr,t as K,aC as Or,aD as Fr,aE as Dr,aF as Hr,aG as qe,P as kr,x as Xr,O as Gr,aH as Br,aI as Ur,aJ as zr,aK as Vr,aL as Sn,m as Kr,X as ct,aM as Ct,aN as Lt,aO as Nt,aP as jt,aQ as Wr,aR as qr,o as Qr,p as xt,j as lt,aS as $r,aT as bn,v as ut,k as yt,a as Mn,aU as Yr,_ as Zr,aV as Jr,aW as es,aX as ts,a2 as Re,a4 as ns,a3 as rs,aY as ss,aZ as is,a_ as Pn,u as In}from"./three-core-CnIHn6i7.js";import{a as _n,B as En}from"./index-CO79Pfc8.js";import{u as An}from"./router-B4jDJN-_.js";import"./store-DMBoUgOw.js";function os(s,e,t){return Math.max(e,Math.min(t,s))}function Ot(s,e){if(e===gr)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),s;if(e===ot||e===gn){let t=s.getIndex();if(t===null){const o=[],a=s.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)o.push(c);s.setIndex(o),t=s.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),s}const n=t.count-2,r=[];if(e===ot)for(let o=1;o<=n;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=s.clone();return i.setIndex(r),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),s}class vn extends xr{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new fs(t)}),this.register(function(t){return new ds(t)}),this.register(function(t){return new Rs(t)}),this.register(function(t){return new Ss(t)}),this.register(function(t){return new bs(t)}),this.register(function(t){return new ps(t)}),this.register(function(t){return new ms(t)}),this.register(function(t){return new gs(t)}),this.register(function(t){return new xs(t)}),this.register(function(t){return new us(t)}),this.register(function(t){return new ys(t)}),this.register(function(t){return new hs(t)}),this.register(function(t){return new Ts(t)}),this.register(function(t){return new ws(t)}),this.register(function(t){return new cs(t)}),this.register(function(t){return new Ms(t)}),this.register(function(t){return new Ps(t)})}load(e,t,n,r){const i=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const l=ge.extractUrlBase(e);o=ge.resolveURL(l,this.path)}else o=ge.extractUrlBase(e);this.manager.itemStart(e);const a=function(l){r?r(l):console.error(l),i.manager.itemError(e),i.manager.itemEnd(e)},c=new xn(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{i.parse(l,o,function(u){t(u),i.manager.itemEnd(e)},a)}catch(u){a(u)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let i;const o={},a={},c=new TextDecoder;if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===Cn){try{o[R.KHR_BINARY_GLTF]=new Is(e)}catch(f){r&&r(f);return}i=JSON.parse(o[R.KHR_BINARY_GLTF].content)}else i=JSON.parse(c.decode(e));else i=e;if(i.asset===void 0||i.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new ks(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const f=this.pluginCallbacks[u](l);f.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[f.name]=f,o[f.name]=!0}if(i.extensionsUsed)for(let u=0;u<i.extensionsUsed.length;++u){const f=i.extensionsUsed[u],p=i.extensionsRequired||[];switch(f){case R.KHR_MATERIALS_UNLIT:o[f]=new ls;break;case R.KHR_DRACO_MESH_COMPRESSION:o[f]=new _s(i,this.dracoLoader);break;case R.KHR_TEXTURE_TRANSFORM:o[f]=new Es;break;case R.KHR_MESH_QUANTIZATION:o[f]=new As;break;default:p.indexOf(f)>=0&&a[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,i){n.parse(e,t,r,i)})}}function as(){let s={};return{get:function(e){return s[e]},add:function(e,t){s[e]=t},remove:function(e){delete s[e]},removeAll:function(){s={}}}}const R={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class cs{constructor(e){this.parser=e,this.name=R.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const i=t.json,c=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let l;const u=new te(16777215);c.color!==void 0&&u.setRGB(c.color[0],c.color[1],c.color[2],V);const f=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new Tr(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new wr(u),l.distance=f;break;case"spot":l=new yr(u),l.distance=f,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),z(l,c),c.intensity!==void 0&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),r=Promise.resolve(l),t.cache.add(n,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],a=(i.extensions&&i.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return n._getNodeRef(t.cache,a,c)})}}class ls{constructor(){this.name=R.KHR_MATERIALS_UNLIT}getMaterialType(){return J}extendParams(e,t,n){const r=[];e.color=new te(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const o=i.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],V),e.opacity=o[3]}i.baseColorTexture!==void 0&&r.push(n.assignTexture(e,"map",i.baseColorTexture,oe))}return Promise.all(r)}}class us{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class fs{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:B}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&i.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(i.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new H(a,a)}return Promise.all(i)}}class ds{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:B}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return t.dispersion=i.dispersion!==void 0?i.dispersion:0,Promise.resolve()}}class hs{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:B}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&i.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&i.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(i)}}class ps{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:B}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new te(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],V)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&i.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,oe)),o.sheenRoughnessTexture!==void 0&&i.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}}class ms{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:B}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&i.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}class gs{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:B}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&i.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new te().setRGB(a[0],a[1],a[2],V),Promise.all(i)}}class xs{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:B}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class ys{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:B}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&i.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new te().setRGB(a[0],a[1],a[2],V),o.specularColorTexture!==void 0&&i.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,oe)),Promise.all(i)}}class ws{constructor(e){this.parser=e,this.name=R.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:B}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&i.push(n.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(i)}}class Ts{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:B}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&i.push(n.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(i)}}class Rs{constructor(e){this.parser=e,this.name=R.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,o)}}class Ss{constructor(e){this.parser=e,this.name=R.EXT_TEXTURE_WEBP}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],a=r.images[o.source];let c=n.textureLoader;if(a.uri){const l=n.options.manager.getHandler(a.uri);l!==null&&(c=l)}return n.loadTextureImage(e,o.source,c)}}class bs{constructor(e){this.parser=e,this.name=R.EXT_TEXTURE_AVIF}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],a=r.images[o.source];let c=n.textureLoader;if(a.uri){const l=n.options.manager.getHandler(a.uri);l!==null&&(c=l)}return n.loadTextureImage(e,o.source,c)}}class Ms{constructor(e){this.name=R.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(a){const c=r.byteOffset||0,l=r.byteLength||0,u=r.count,f=r.byteStride,p=new Uint8Array(a,c,l);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,f,p,r.mode,r.filter).then(function(m){return m.buffer}):o.ready.then(function(){const m=new ArrayBuffer(u*f);return o.decodeGltfBuffer(new Uint8Array(m),u,f,p,r.mode,r.filter),m})})}else return null}}class Ps{constructor(e){this.name=R.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const r=t.meshes[n.mesh];for(const l of r.primitives)if(l.mode!==D.TRIANGLES&&l.mode!==D.TRIANGLE_STRIP&&l.mode!==D.TRIANGLE_FAN&&l.mode!==void 0)return null;const o=n.extensions[this.name].attributes,a=[],c={};for(const l in o)a.push(this.parser.getDependency("accessor",o[l]).then(u=>(c[l]=u,c[l])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(l=>{const u=l.pop(),f=u.isGroup?u.children:[u],p=l[0].count,m=[];for(const w of f){const S=new v,x=new y,T=new X,M=new y(1,1,1),P=new yn(w.geometry,w.material,p);for(let b=0;b<p;b++)c.TRANSLATION&&x.fromBufferAttribute(c.TRANSLATION,b),c.ROTATION&&T.fromBufferAttribute(c.ROTATION,b),c.SCALE&&M.fromBufferAttribute(c.SCALE,b),P.setMatrixAt(b,S.compose(x,T,M));for(const b in c)if(b==="_COLOR_0"){const F=c[b];P.instanceColor=new Rr(F.array,F.itemSize,F.normalized)}else b!=="TRANSLATION"&&b!=="ROTATION"&&b!=="SCALE"&&w.geometry.setAttribute(b,c[b]);Te.prototype.copy.call(P,w),this.parser.assignFinalMaterial(P),m.push(P)}return u.isGroup?(u.clear(),u.add(...m),u):m[0]}))}}const Cn="glTF",ue=12,Ft={JSON:1313821514,BIN:5130562};class Is{constructor(e){this.name=R.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,ue),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Cn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-ue,i=new DataView(e,ue);let o=0;for(;o<r;){const a=i.getUint32(o,!0);o+=4;const c=i.getUint32(o,!0);if(o+=4,c===Ft.JSON){const l=new Uint8Array(e,ue+o,a);this.content=n.decode(l)}else if(c===Ft.BIN){const l=ue+o;this.body=e.slice(l,l+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class _s{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=R.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},c={},l={};for(const u in o){const f=ft[u]||u.toLowerCase();a[f]=o[u]}for(const u in e.attributes){const f=ft[u]||u.toLowerCase();if(o[u]!==void 0){const p=n.accessors[e.attributes[u]],m=se[p.componentType];l[f]=m.name,c[f]=p.normalized===!0}}return t.getDependency("bufferView",i).then(function(u){return new Promise(function(f,p){r.decodeDracoFile(u,function(m){for(const w in m.attributes){const S=m.attributes[w],x=c[w];x!==void 0&&(S.normalized=x)}f(m)},a,l,V,p)})})}}class Es{constructor(){this.name=R.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class As{constructor(){this.name=R.KHR_MESH_QUANTIZATION}}class Ln extends qr{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let o=0;o!==r;o++)t[o]=n[i+o];return t}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=a*2,l=a*3,u=r-t,f=(n-t)/u,p=f*f,m=p*f,w=e*l,S=w-l,x=-2*m+3*p,T=m-p,M=1-x,P=T-p+f;for(let b=0;b!==a;b++){const F=o[S+b+a],C=o[S+b+c]*u,N=o[w+b+a],O=o[w+b]*u;i[b]=M*F+P*C+x*N+T*O}return i}}const vs=new X;class Cs extends Ln{interpolate_(e,t,n,r){const i=super.interpolate_(e,t,n,r);return vs.fromArray(i).normalize().toArray(i),i}}const D={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},se={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Dt={9728:Tn,9729:ye,9984:_r,9985:Ir,9986:Pr,9987:wn},Ht={33071:Ar,33648:Er,10497:at},Qe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ft={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Q={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ls={CUBICSPLINE:void 0,LINEAR:Sn,STEP:Vr},$e={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Ns(s){return s.DefaultMaterial===void 0&&(s.DefaultMaterial=new Rn({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Wr})),s.DefaultMaterial}function Z(s,e,t){for(const n in t.extensions)s[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function z(s,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(s.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function js(s,e,t){let n=!1,r=!1,i=!1;for(let l=0,u=e.length;l<u;l++){const f=e[l];if(f.POSITION!==void 0&&(n=!0),f.NORMAL!==void 0&&(r=!0),f.COLOR_0!==void 0&&(i=!0),n&&r&&i)break}if(!n&&!r&&!i)return Promise.resolve(s);const o=[],a=[],c=[];for(let l=0,u=e.length;l<u;l++){const f=e[l];if(n){const p=f.POSITION!==void 0?t.getDependency("accessor",f.POSITION):s.attributes.position;o.push(p)}if(r){const p=f.NORMAL!==void 0?t.getDependency("accessor",f.NORMAL):s.attributes.normal;a.push(p)}if(i){const p=f.COLOR_0!==void 0?t.getDependency("accessor",f.COLOR_0):s.attributes.color;c.push(p)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c)]).then(function(l){const u=l[0],f=l[1],p=l[2];return n&&(s.morphAttributes.position=u),r&&(s.morphAttributes.normal=f),i&&(s.morphAttributes.color=p),s.morphTargetsRelative=!0,s})}function Os(s,e){if(s.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)s.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(s.morphTargetInfluences.length===t.length){s.morphTargetDictionary={};for(let n=0,r=t.length;n<r;n++)s.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Fs(s){let e;const t=s.extensions&&s.extensions[R.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Ye(t.attributes):e=s.indices+":"+Ye(s.attributes)+":"+s.mode,s.targets!==void 0)for(let n=0,r=s.targets.length;n<r;n++)e+=":"+Ye(s.targets[n]);return e}function Ye(s){let e="";const t=Object.keys(s).sort();for(let n=0,r=t.length;n<r;n++)e+=t[n]+":"+s[t[n]]+";";return e}function dt(s){switch(s){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Ds(s){return s.search(/\.jpe?g($|\?)/i)>0||s.search(/^data\:image\/jpeg/)===0?"image/jpeg":s.search(/\.webp($|\?)/i)>0||s.search(/^data\:image\/webp/)===0?"image/webp":s.search(/\.ktx2($|\?)/i)>0||s.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const Hs=new v;class ks{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new as,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=-1,i=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;n=/^((?!chrome|android).)*safari/i.test(a)===!0;const c=a.match(/Version\/(\d+)/);r=n&&c?parseInt(c[1],10):-1,i=a.indexOf("Firefox")>-1,o=i?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||n&&r<17||i&&o<98?this.textureLoader=new Sr(this.options.manager):this.textureLoader=new br(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new xn(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:n,userData:{}};return Z(i,a,r),z(a,r),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){for(const c of a.scenes)c.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){const o=t[r].joints;for(let a=0,c=o.length;a<c;a++)e[o[a]].isBone=!0}for(let r=0,i=e.length;r<i;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),i=(o,a)=>{const c=this.associations.get(o);c!=null&&this.associations.set(a,c);for(const[l,u]of o.children.entries())i(u,a.children[l])};return i(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const i=e(t[r]);i&&n.push(i)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(i){return i.loadNode&&i.loadNode(t)});break;case"mesh":r=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(i,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[R.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(i,o){n.load(ge.resolveURL(t.uri,r.path),i,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const r=t.byteLength||0,i=t.byteOffset||0;return n.slice(i,i+r)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const o=Qe[r.type],a=se[r.componentType],c=r.normalized===!0,l=new a(r.count*o);return Promise.resolve(new re(l,o,c))}const i=[];return r.bufferView!==void 0?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),r.sparse!==void 0&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then(function(o){const a=o[0],c=Qe[r.type],l=se[r.componentType],u=l.BYTES_PER_ELEMENT,f=u*c,p=r.byteOffset||0,m=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,w=r.normalized===!0;let S,x;if(m&&m!==f){const T=Math.floor(p/m),M="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+T+":"+r.count;let P=t.cache.get(M);P||(S=new l(a,T*m,r.count*m/u),P=new Mr(S,m/u),t.cache.add(M,P)),x=new Kr(P,c,p%m/u,w)}else a===null?S=new l(r.count*c):S=new l(a,p,r.count*c),x=new re(S,c,w);if(r.sparse!==void 0){const T=Qe.SCALAR,M=se[r.sparse.indices.componentType],P=r.sparse.indices.byteOffset||0,b=r.sparse.values.byteOffset||0,F=new M(o[1],P,r.sparse.count*T),C=new l(o[2],b,r.sparse.count*c);a!==null&&(x=new re(x.array.slice(),x.itemSize,x.normalized)),x.normalized=!1;for(let N=0,O=F.length;N<O;N++){const k=F[N];if(x.setX(k,C[N*c]),c>=2&&x.setY(k,C[N*c+1]),c>=3&&x.setZ(k,C[N*c+2]),c>=4&&x.setW(k,C[N*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}x.normalized=w}return x})}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,o=t.images[i];let a=this.textureLoader;if(o.uri){const c=n.manager.getHandler(o.uri);c!==null&&(a=c)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,n){const r=this,i=this.json,o=i.textures[e],a=i.images[t],c=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,n).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const p=(i.samplers||{})[o.sampler]||{};return u.magFilter=Dt[p.magFilter]||ye,u.minFilter=Dt[p.minFilter]||wn,u.wrapS=Ht[p.wrapS]||at,u.wrapT=Ht[p.wrapT]||at,u.generateMipmaps=!u.isCompressedTexture&&u.minFilter!==Tn&&u.minFilter!==ye,r.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const n=this,r=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(f=>f.clone());const o=r.images[e],a=self.URL||self.webkitURL;let c=o.uri||"",l=!1;if(o.bufferView!==void 0)c=n.getDependency("bufferView",o.bufferView).then(function(f){l=!0;const p=new Blob([f],{type:o.mimeType});return c=a.createObjectURL(p),c});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(c).then(function(f){return new Promise(function(p,m){let w=p;t.isImageBitmapLoader===!0&&(w=function(S){const x=new ct(S);x.needsUpdate=!0,p(x)}),t.load(ge.resolveURL(f,i.path),w,void 0,m)})}).then(function(f){return l===!0&&a.revokeObjectURL(c),z(f,o),f.userData.mimeType=o.mimeType||Ds(o.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),f});return this.sourceCache[e]=u,u}assignTexture(e,t,n,r){const i=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(o=o.clone(),o.channel=n.texCoord),i.extensions[R.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[R.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=i.associations.get(o);o=i.extensions[R.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),i.associations.set(o,c)}}return r!==void 0&&(o.colorSpace=r),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new vr,xe.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(a,c)),n=c}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new Cr,xe.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,this.cache.add(a,c)),n=c}if(r||i||o){let a="ClonedMaterial:"+n.uuid+":";r&&(a+="derivative-tangents:"),i&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=n.clone(),i&&(c.vertexColors=!0),o&&(c.flatShading=!0),r&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(n))),n=c}e.material=n}getMaterialType(){return Rn}loadMaterial(e){const t=this,n=this.json,r=this.extensions,i=n.materials[e];let o;const a={},c=i.extensions||{},l=[];if(c[R.KHR_MATERIALS_UNLIT]){const f=r[R.KHR_MATERIALS_UNLIT];o=f.getMaterialType(),l.push(f.extendParams(a,i,t))}else{const f=i.pbrMetallicRoughness||{};if(a.color=new te(1,1,1),a.opacity=1,Array.isArray(f.baseColorFactor)){const p=f.baseColorFactor;a.color.setRGB(p[0],p[1],p[2],V),a.opacity=p[3]}f.baseColorTexture!==void 0&&l.push(t.assignTexture(a,"map",f.baseColorTexture,oe)),a.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,a.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(a,"metalnessMap",f.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",f.metallicRoughnessTexture))),o=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(e,a)})))}i.doubleSided===!0&&(a.side=Lr);const u=i.alphaMode||$e.OPAQUE;if(u===$e.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===$e.MASK&&(a.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&o!==J&&(l.push(t.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new H(1,1),i.normalTexture.scale!==void 0)){const f=i.normalTexture.scale;a.normalScale.set(f,f)}if(i.occlusionTexture!==void 0&&o!==J&&(l.push(t.assignTexture(a,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&o!==J){const f=i.emissiveFactor;a.emissive=new te().setRGB(f[0],f[1],f[2],V)}return i.emissiveTexture!==void 0&&o!==J&&l.push(t.assignTexture(a,"emissiveMap",i.emissiveTexture,oe)),Promise.all(l).then(function(){const f=new o(a);return i.name&&(f.name=i.name),z(f,i),t.associations.set(f,{materials:e}),i.extensions&&Z(r,f,i),f})}createUniqueName(e){const t=Nr.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function i(a){return n[R.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return kt(c,a,t)})}const o=[];for(let a=0,c=e.length;a<c;a++){const l=e[a],u=Fs(l),f=r[u];if(f)o.push(f.promise);else{let p;l.extensions&&l.extensions[R.KHR_DRACO_MESH_COMPRESSION]?p=i(l):p=kt(new gt,l,t),r[u]={primitive:l,promise:p},o.push(p)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,r=this.extensions,i=n.meshes[e],o=i.primitives,a=[];for(let c=0,l=o.length;c<l;c++){const u=o[c].material===void 0?Ns(this.cache):this.getDependency("material",o[c].material);a.push(u)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),u=c[c.length-1],f=[];for(let m=0,w=u.length;m<w;m++){const S=u[m],x=o[m];let T;const M=l[m];if(x.mode===D.TRIANGLES||x.mode===D.TRIANGLE_STRIP||x.mode===D.TRIANGLE_FAN||x.mode===void 0)T=i.isSkinnedMesh===!0?new jr(S,M):new K(S,M),T.isSkinnedMesh===!0&&T.normalizeSkinWeights(),x.mode===D.TRIANGLE_STRIP?T.geometry=Ot(T.geometry,gn):x.mode===D.TRIANGLE_FAN&&(T.geometry=Ot(T.geometry,ot));else if(x.mode===D.LINES)T=new Or(S,M);else if(x.mode===D.LINE_STRIP)T=new Fr(S,M);else if(x.mode===D.LINE_LOOP)T=new Dr(S,M);else if(x.mode===D.POINTS)T=new Hr(S,M);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+x.mode);Object.keys(T.geometry.morphAttributes).length>0&&Os(T,i),T.name=t.createUniqueName(i.name||"mesh_"+e),z(T,i),x.extensions&&Z(r,T,x),t.assignFinalMaterial(T),f.push(T)}for(let m=0,w=f.length;m<w;m++)t.associations.set(f[m],{meshes:e,primitives:m});if(f.length===1)return i.extensions&&Z(r,f[0],i),f[0];const p=new qe;i.extensions&&Z(r,p,i),t.associations.set(p,{meshes:e});for(let m=0,w=f.length;m<w;m++)p.add(f[m]);return p})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new kr(Xr.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(t=new Gr(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),z(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,i=t.joints.length;r<i;r++)n.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(r){const i=r.pop(),o=r,a=[],c=[];for(let l=0,u=o.length;l<u;l++){const f=o[l];if(f){a.push(f);const p=new v;i!==null&&p.fromArray(i.array,l*16),c.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new Br(a,c)})}loadAnimation(e){const t=this.json,n=this,r=t.animations[e],i=r.name?r.name:"animation_"+e,o=[],a=[],c=[],l=[],u=[];for(let f=0,p=r.channels.length;f<p;f++){const m=r.channels[f],w=r.samplers[m.sampler],S=m.target,x=S.node,T=r.parameters!==void 0?r.parameters[w.input]:w.input,M=r.parameters!==void 0?r.parameters[w.output]:w.output;S.node!==void 0&&(o.push(this.getDependency("node",x)),a.push(this.getDependency("accessor",T)),c.push(this.getDependency("accessor",M)),l.push(w),u.push(S))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c),Promise.all(l),Promise.all(u)]).then(function(f){const p=f[0],m=f[1],w=f[2],S=f[3],x=f[4],T=[];for(let M=0,P=p.length;M<P;M++){const b=p[M],F=m[M],C=w[M],N=S[M],O=x[M];if(b===void 0)continue;b.updateMatrix&&b.updateMatrix();const k=n._createAnimationTracks(b,F,C,N,O);if(k)for(let W=0;W<k.length;W++)T.push(k[W])}return new Ur(i,void 0,T)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(i){const o=n._getNodeRef(n.meshCache,r.mesh,i);return r.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let c=0,l=r.weights.length;c<l;c++)a.morphTargetInfluences[c]=r.weights[c]}),o})}loadNode(e){const t=this.json,n=this,r=t.nodes[e],i=n._loadNodeShallow(e),o=[],a=r.children||[];for(let l=0,u=a.length;l<u;l++)o.push(n.getDependency("node",a[l]));const c=r.skin===void 0?Promise.resolve(null):n.getDependency("skin",r.skin);return Promise.all([i,Promise.all(o),c]).then(function(l){const u=l[0],f=l[1],p=l[2];p!==null&&u.traverse(function(m){m.isSkinnedMesh&&m.bind(p,Hs)});for(let m=0,w=f.length;m<w;m++)u.add(f[m]);return u})}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const i=t.nodes[e],o=i.name?r.createUniqueName(i.name):"",a=[],c=r._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&a.push(c),i.camera!==void 0&&a.push(r.getDependency("camera",i.camera).then(function(l){return r._getNodeRef(r.cameraCache,i.camera,l)})),r._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),this.nodeCache[e]=Promise.all(a).then(function(l){let u;if(i.isBone===!0?u=new zr:l.length>1?u=new qe:l.length===1?u=l[0]:u=new Te,u!==l[0])for(let f=0,p=l.length;f<p;f++)u.add(l[f]);if(i.name&&(u.userData.name=i.name,u.name=o),z(u,i),i.extensions&&Z(n,u,i),i.matrix!==void 0){const f=new v;f.fromArray(i.matrix),u.applyMatrix4(f)}else i.translation!==void 0&&u.position.fromArray(i.translation),i.rotation!==void 0&&u.quaternion.fromArray(i.rotation),i.scale!==void 0&&u.scale.fromArray(i.scale);if(!r.associations.has(u))r.associations.set(u,{});else if(i.mesh!==void 0&&r.meshCache.refs[i.mesh]>1){const f=r.associations.get(u);r.associations.set(u,{...f})}return r.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,i=new qe;n.name&&(i.name=r.createUniqueName(n.name)),z(i,n),n.extensions&&Z(t,i,n);const o=n.nodes||[],a=[];for(let c=0,l=o.length;c<l;c++)a.push(r.getDependency("node",o[c]));return Promise.all(a).then(function(c){for(let u=0,f=c.length;u<f;u++)i.add(c[u]);const l=u=>{const f=new Map;for(const[p,m]of r.associations)(p instanceof xe||p instanceof ct)&&f.set(p,m);return u.traverse(p=>{const m=r.associations.get(p);m!=null&&f.set(p,m)}),f};return r.associations=l(i),i})}_createAnimationTracks(e,t,n,r,i){const o=[],a=e.name?e.name:e.uuid,c=[];Q[i.path]===Q.weights?e.traverse(function(p){p.morphTargetInfluences&&c.push(p.name?p.name:p.uuid)}):c.push(a);let l;switch(Q[i.path]){case Q.weights:l=Lt;break;case Q.rotation:l=Nt;break;case Q.translation:case Q.scale:l=Ct;break;default:switch(n.itemSize){case 1:l=Lt;break;case 2:case 3:default:l=Ct;break}break}const u=r.interpolation!==void 0?Ls[r.interpolation]:Sn,f=this._getArrayFromAccessor(n);for(let p=0,m=c.length;p<m;p++){const w=new l(c[p]+"."+Q[i.path],t.array,f,u);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(w),o.push(w)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=dt(t.constructor),r=new Float32Array(t.length);for(let i=0,o=t.length;i<o;i++)r[i]=t[i]*n;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const r=this instanceof Nt?Cs:Ln;return new r(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Xs(s,e,t){const n=e.attributes,r=new Qr;if(n.POSITION!==void 0){const a=t.json.accessors[n.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(r.set(new y(c[0],c[1],c[2]),new y(l[0],l[1],l[2])),a.normalized){const u=dt(se[a.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const a=new y,c=new y;for(let l=0,u=i.length;l<u;l++){const f=i[l];if(f.POSITION!==void 0){const p=t.json.accessors[f.POSITION],m=p.min,w=p.max;if(m!==void 0&&w!==void 0){if(c.setX(Math.max(Math.abs(m[0]),Math.abs(w[0]))),c.setY(Math.max(Math.abs(m[1]),Math.abs(w[1]))),c.setZ(Math.max(Math.abs(m[2]),Math.abs(w[2]))),p.normalized){const S=dt(se[p.componentType]);c.multiplyScalar(S)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}s.boundingBox=r;const o=new xt;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,s.boundingSphere=o}function kt(s,e,t){const n=e.attributes,r=[];function i(o,a){return t.getDependency("accessor",o).then(function(c){s.setAttribute(a,c)})}for(const o in n){const a=ft[o]||o.toLowerCase();a in s.attributes||r.push(i(n[o],a))}if(e.indices!==void 0&&!s.index){const o=t.getDependency("accessor",e.indices).then(function(a){s.setIndex(a)});r.push(o)}return jt.workingColorSpace!==V&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${jt.workingColorSpace}" not supported.`),z(s,e),Xs(s,e,t),Promise.all(r).then(function(){return e.targets!==void 0?js(s,e.targets,t):s})}new v;new v;function Gs(s){const e=new Map,t=new Map,n=s.clone();return Nn(s,n,function(r,i){e.set(i,r),t.set(r,i)}),n.traverse(function(r){if(!r.isSkinnedMesh)return;const i=r,o=e.get(r),a=o.skeleton.bones;i.skeleton=o.skeleton.clone(),i.bindMatrix.copy(o.bindMatrix),i.skeleton.bones=a.map(function(c){return t.get(c)}),i.bind(i.skeleton,i.bindMatrix)}),n}function Nn(s,e,t){t(s,e);for(let n=0;n<s.children.length;n++)Nn(s.children[n],e.children[n],t)}function Bs({scene:s}){const e=Gs(s),t=e.getObjectByProperty("type","SkinnedMesh");if(t==null)throw new Error("missing SkinnedMesh in loaded XRHand model");return t.frustumCulled=!1,e}function Us(s,e){s.renderOrder=(e==null?void 0:e.renderOrder)??0,s.traverse(t=>{t instanceof K&&t.material instanceof xe&&(t.material.colorWrite=(e==null?void 0:e.colorWrite)??!0)})}const zs=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"];function Vs(s,e,t){const n=new Float32Array(s.size*16),r=zs.map(i=>{const o=e.getObjectByName(i);if(o==null)throw new Error(`missing joint "${i}" in hand model`);return o.matrixAutoUpdate=!1,o});return i=>{const o=typeof t=="function"?t():t;if(i==null||o==null)return;i.fillPoses(s.values(),o,n);const a=r.length;for(let c=0;c<a;c++)r[c].matrix.fromArray(n,c*16)}}function Ks(s){return s!=null&&typeof s=="object"&&"inputSource"in s}function Ws(s,e){const t=(n,r)=>{r!=null&&n.visibilityState===r.visibilityState||e(n.visibilityState==="visible")};return t(s.getState()),s.subscribe(t)}class qs extends J{constructor(){super({transparent:!0,toneMapped:!1,depthWrite:!1})}onBeforeCompile(e,t){super.onBeforeCompile(e,t),e.vertexShader=`varying vec2 vLocalPosition;
`+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <color_vertex>",`#include <color_vertex>
        vLocalPosition = position.xy * 2.0;`),e.fragmentShader=`varying vec2 vLocalPosition;
`+e.fragmentShader,e.fragmentShader=e.fragmentShader.replace("#include <color_fragment>",`#include <color_fragment>
          float value = max(0.0, 1.0 - sqrt(dot(vLocalPosition, vLocalPosition)));
          diffuseColor.a = diffuseColor.a * value * value;`)}}const Qs=new y(0,0,1),Xt=new X,Ze=new y;function $s(s,e,t,n,r){var c;const i=n.getIntersection();if(i==null||!n.getEnabled()||i.object.isVoidObject===!0||!jn(s)){e.visible=!1;return}e.visible=!0;const o=typeof r.color=="function"?r.color(n):r.color;Array.isArray(o)?t.color.set(...o):t.color.set(o??"white"),t.opacity=typeof r.opacity=="function"?r.opacity(n):r.opacity??.4,e.position.copy(i.pointOnFace),e.scale.setScalar(r.size??.1);const a=i.normal??((c=i.face)==null?void 0:c.normal);a!=null&&(Xt.setFromUnitVectors(Qs,a),i.object.getWorldQuaternion(e.quaternion),e.quaternion.multiply(Xt),Ze.set(0,0,r.cursorOffset??.01),Ze.applyQuaternion(e.quaternion),e.position.add(Ze)),e.updateMatrix()}function jn({visible:s,parent:e}){return s?e==null?!0:jn(e):!1}class Ys extends J{constructor(){super({transparent:!0,toneMapped:!1})}onBeforeCompile(e,t){super.onBeforeCompile(e,t),e.vertexShader=`varying float vFade;
`+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <color_vertex>",`#include <color_vertex>
            vFade = position.z + 0.5;`),e.fragmentShader=`varying float vFade;
`+e.fragmentShader,e.fragmentShader=e.fragmentShader.replace("#include <color_fragment>",`#include <color_fragment>
              diffuseColor.a *= vFade;`)}}function Zs(s,e,t,n){const r=t.getIntersection();if(!t.getEnabled()||r==null){s.visible=!1;return}s.visible=!0;const i=typeof n.color=="function"?n.color(t):n.color;Array.isArray(i)?e.color.set(...i):e.color.set(i??"white"),e.opacity=typeof n.opacity=="function"?n.opacity(t):n.opacity??.4;const o=Math.min(n.maxLength??1,r.distance);s.position.z=-o/2;const a=n.size??.005;s.scale.set(a,a,o),s.updateMatrix()}function Js(s,e,t,n,r,i={}){const o=f=>{f.inputSource===t&&s.down(Object.assign(f,{button:i.button??0}))},a=f=>{f.inputSource===t&&s.up(Object.assign(f,{button:i.button??0}))},c=`${n}start`,l=`${n}end`,u=r.length;for(let f=0;f<u;f++){const p=r[f];switch(p.type){case c:o(p);break;case l:a(p);break}}return e.addEventListener(c,o),e.addEventListener(l,a),()=>{e.removeEventListener(c,o),e.removeEventListener(l,a)}}function ei(s){var e;return s.getButtonsDown().size>0?.6:On(((e=s.getIntersection())==null?void 0:e.distance)??1/0,.07,0,.2,.4)}function Ne(s){return s.getButtonsDown().size>0?.6:.4}function ti(s){var e;return On(((e=s.getIntersection())==null?void 0:e.distance)??1/0,.1,.03,.2,.6)}function On(s,e,t,n,r){return n+Math.max(0,Math.min(1,(s-e)/(t-e)))*(r-n)}function ni(s,e){return(t,n)=>{if(s===e)return t.identity(),!0;const r=typeof e=="function"?e():e;if(r==null)return!1;const i=n==null?void 0:n.getPose(s,r);return i==null?!1:(t.fromArray(i.transform.matrix),!0)}}function He(s,e,t,n){n==null||n.copy(s.matrix);const r=Fn(s.parent,n);return r??(n!=null&&ri(s,e,n),t)}function ri(s,e,t){if(s.updateWorldMatrix(!0,!1),e==null){t.copy(s.matrixWorld);return}e.updateWorldMatrix(!0,!1),t.copy(e.matrixWorld).invert().multiply(s.matrixWorld)}function Fn(s,e){if(s!=null)return s.xrSpace!=null?s.xrSpace:(e==null||e.premultiply(s.matrix),Fn(s.parent,e))}class si{constructor(e){g(this,"nativeEvent");g(this,"NONE",0);g(this,"CAPTURING_PHASE",1);g(this,"AT_TARGET",2);g(this,"BUBBLING_PHASE",3);g(this,"relatedTarget",null);this.nativeEvent=e}get altKey(){return this.getFromNative("altKey",!1)}get button(){return this.getFromNative("button",0)}get buttons(){return this.getFromNative("buttons",0)}get clientX(){return this.getFromNative("clientX",0)}get clientY(){return this.getFromNative("clientY",0)}get ctrlKey(){return this.getFromNative("ctrlKey",!1)}get layerX(){return this.getFromNative("layerX",0)}get layerY(){return this.getFromNative("layerY",0)}get metaKey(){return this.getFromNative("metaKey",!1)}get movementX(){return this.getFromNative("movementX",0)}get movementY(){return this.getFromNative("movementY",0)}get offsetX(){return this.getFromNative("offsetX",0)}get offsetY(){return this.getFromNative("offsetY",0)}get pageX(){return this.getFromNative("pageX",0)}get pageY(){return this.getFromNative("pageY",0)}get screenX(){return this.getFromNative("screenX",0)}get screenY(){return this.getFromNative("screenY",0)}get shiftKey(){return this.getFromNative("shiftKey",!1)}get x(){return this.getFromNative("x",0)}get y(){return this.getFromNative("y",0)}get detail(){return this.getFromNative("detail",0)}get view(){return this.getFromNative("view",null)}get which(){return this.getFromNative("which",0)}get cancelBubble(){return this.getFromNative("cancelBubble",!1)}get composed(){return this.getFromNative("composed",!1)}get eventPhase(){return this.getFromNative("eventPhase",0)}get isTrusted(){return this.getFromNative("isTrusted",!1)}get returnValue(){return this.getFromNative("returnValue",!1)}get timeStamp(){return this.getFromNative("timeStamp",0)}get cancelable(){return this.getFromNative("cancelable",!1)}get defaultPrevented(){return this.getFromNative("defaultPrevented",!1)}getFromNative(e,t){return e in this.nativeEvent?this.nativeEvent[e]:t}}const Je=new y;class L extends si{constructor(t,n,r,i,o,a,c=o.object,l=c,u={stopped:!n,stoppedImmediate:!1}){super(r);g(this,"type");g(this,"bubbles");g(this,"internalPointer");g(this,"intersection");g(this,"camera");g(this,"currentObject");g(this,"object");g(this,"propagationState");g(this,"_pointer");g(this,"_ray");g(this,"_intersections",[]);g(this,"_unprojectedPoint");this.type=t,this.bubbles=n,this.internalPointer=i,this.intersection=o,this.camera=a,this.currentObject=c,this.object=l,this.propagationState=u}get pointerId(){return this.internalPointer.id}get pointerType(){return this.internalPointer.type}get pointerState(){return this.internalPointer.state}get distance(){return this.intersection.distance}get distanceToRay(){return this.intersection.distanceToRay}get point(){return this.intersection.point}get index(){return this.intersection.index}get face(){return this.intersection.face}get faceIndex(){return this.intersection.faceIndex}get uv(){return this.intersection.uv}get uv1(){return this.intersection.uv1}get normal(){return this.intersection.normal}get instanceId(){return this.intersection.instanceId}get pointOnLine(){return this.intersection.pointOnLine}get batchId(){return this.intersection.batchId}get pointerPosition(){return this.intersection.pointerPosition}get pointerQuaternion(){return this.intersection.pointerQuaternion}get pointOnFace(){return this.intersection.pointOnFace}get localPoint(){return this.intersection.localPoint}get details(){return this.intersection.details}get target(){return this.object}get currentTarget(){return this.currentObject}get eventObject(){return this.currentObject}get srcElement(){return this.currentObject}get pointer(){return this._pointer==null&&(Je.copy(this.intersection.point).project(this.camera),this._pointer=new H(Je.x,Je.y)),this._pointer}get ray(){if(this._ray!=null)return this._ray;switch(this.intersection.details.type){case"screen-ray":case"ray":case"sphere":return this._ray=new lt(this.intersection.pointerPosition,new y(0,0,-1).applyQuaternion(this.intersection.pointerQuaternion));case"lines":return this._ray=new lt(this.intersection.details.line.start,this.intersection.details.line.end.clone().sub(this.intersection.details.line.start).normalize())}}get intersections(){return this._intersections==null&&(this._intersections=[{...this.intersection,eventObject:this.currentObject}]),this._intersections}get unprojectedPoint(){if(this._unprojectedPoint==null){const t=this.pointer;this._unprojectedPoint=new y(t.x,t.y,0).unproject(this.camera)}return this._unprojectedPoint}get stopped(){return this.propagationState.stoppedImmediate||this.propagationState.stopped}get stoppedImmediate(){return this.propagationState.stoppedImmediate}get delta(){throw new Error("not supported")}stopPropagation(){this.propagationState.stopped=!0}stopImmediatePropagation(){this.propagationState.stoppedImmediate=!0}retarget(t){return new L(this.type,this.bubbles,this.nativeEvent,this.internalPointer,this.intersection,this.camera,t,this.target,this.propagationState)}}class je extends L{get deltaX(){return this.nativeEvent.deltaX}get deltaY(){return this.nativeEvent.deltaY}get deltaZ(){return this.nativeEvent.deltaZ}constructor(e,t,n,r,i,o){super("wheel",!0,e,t,n,r,i,o)}retarget(e){return new je(this.nativeEvent,this.internalPointer,this.intersection,this.camera,e,this.target)}}function j(s){Dn(s,s.currentObject)}function Dn(s,e){if(e==null)return;const t=oi(e,s.type);if(t!=null&&t.length>0){const n=s.retarget(e),r=t.length;for(let i=0;i<r&&!n.stoppedImmediate;i++)t[i](n)}s.stopped||Dn(s,e.parent)}const Hn={click:"onClick",contextmenu:"onContextMenu",dblclick:"onDoubleClick",pointercancel:"onPointerCancel",pointerdown:"onPointerDown",pointerenter:"onPointerEnter",pointerleave:"onPointerLeave",pointermove:"onPointerMove",pointerout:"onPointerOut",pointerover:"onPointerOver",pointerup:"onPointerUp",wheel:"onWheel"},ii=Object.keys(Hn);function oi(s,e){var n;if(s._listeners!=null&&e in s._listeners)return s._listeners[e];let t;if(s.isVoidObject&&e==="click"&&((n=s.parent)==null?void 0:n.__r3f)!=null&&(t=s.parent.__r3f.root.getState().onPointerMissed),s.__r3f!=null&&(t=s.__r3f.handlers[Hn[e]]),t!=null)return[t]}const ai=1e10,ci=new $r(ai),Gt=new Map;function kn(s){let e=Gt.get(s);return e==null&&(e=new K(ci),e.isVoidObject=!0,e.parent=s,e.pointerEventsOrder=-1/0,Gt.set(s,e)),e}function wt(s,e,t){var r;const n=e.normal??((r=e.face)==null?void 0:r.normal);return n==null?!1:(s.setFromNormalAndCoplanarPoint(n,e.localPoint),s.applyMatrix4(t),!0)}function li(s,e,t){if(e==="none"||e==="listener"&&!s)return!1;if(t==="all")return!0;if(typeof t=="function")return({id:i,type:o,state:a})=>t(i,o,a);let n,r;return"deny"in t?(r=!0,n=t.deny):(r=!1,n=t.allow),Array.isArray(n)?i=>Bt(n.includes(i.type),r):i=>Bt(n===i.type,r)}function Bt(s,e){return e?!s:s}function Tt(s,e,t,n=!1,r,i,o){const a=n||ui(s,e),c=e.pointerEvents??r,l=c??e.defaultPointerEvents??"listener",u=e.pointerEventsType??i??"all",f=e.pointerEventsOrder??o??0,p=li(a,l,u),m=t.length;if(m===1)(p===!0||typeof p=="function"&&p(t[0]))&&et(t[0],e,l,u,f);else if(p===!0)for(let x=0;x<m;x++)et(t[x],e,l,u,f);else if(typeof p=="function")for(let x=0;x<m;x++){const T=t[x];p(T)&&et(T,e,l,u,f)}if(e.children.length===0||e.intersectChildren===!1)return;const w=e.interactableDescendants??e.children,S=w.length;for(let x=0;x<S;x++)Tt(s,w[x],t,a,c,u,f)}function ui(s,e){var r;if(e.ancestorsHaveListeners||s==="pointer"&&e.ancestorsHavePointerListeners||s==="wheel"&&e.ancestorsHaveWheelListeners||e.__r3f!=null&&((r=e.__r3f)==null?void 0:r.eventCount)>0&&(s==="wheel"&&e.__r3f.handlers.onWheel!=null||s==="pointer"&&Object.keys(e.__r3f.handlers).some(i=>i!="onWheel")))return!0;if(e._listeners==null)return!1;if(s==="wheel"){const i=e._listeners.wheel;return i!=null&&i.length>0}const t=Object.entries(e._listeners),n=t.length;for(let i=0;i<n;i++){const o=t[i];if(o[0]!=="wheel"&&ii.includes(o[0])&&o[1]!=null&&o[1].length>0)return!0}return!1}function et({intersector:s,options:e},t,n,r,i){var o;((o=e.filter)==null?void 0:o.call(e,t,n,r,i))!==!1&&s.executeIntersection(t,i)}function Rt(s,e,{customSort:t=fi}={},n){let r,i,o;const a=s.length;for(let c=0;c<a;c++){const l=s[c];if((n==null?void 0:n(l))===!1)continue;const u=e==null?void 0:e[c];(r==null||t(l,u,r,i)<0)&&(o=c,r=l,i=u)}return o}function fi(s,e=0,t,n=0){return e!=n?n-e:s.distance-t.distance}const Ut=1e7;function Xn(s,e,t,n,r,i=0){const o=e.direction.clone().multiplyScalar(Ut),a=Ut;return{distance:a+i,object:kn(s),point:o,normal:e.origin.clone().sub(o).normalize(),details:t(o,a),pointerPosition:n,pointerQuaternion:r,pointOnFace:o,localPoint:o}}function ht(s,e,t){for(;t>0;)s.push(e),--t}const fe=Symbol("buttonsDownTime"),tt=Symbol("buttonsClickTime");globalThis.pointerEventspointerMap??(globalThis.pointerEventspointerMap=new Map);Te.prototype.setPointerCapture=function(s){var e;(e=St(s))==null||e.setCapture(this)};Te.prototype.releasePointerCapture=function(s){const e=St(s);e==null||!e.hasCaptured(this)||e.setCapture(void 0)};Te.prototype.hasPointerCapture=function(s){var e;return((e=St(s))==null?void 0:e.hasCaptured(this))??!1};function St(s){var e;return(e=globalThis.pointerEventspointerMap)==null?void 0:e.get(s)}class Se{constructor(e,t,n,r,i,o,a,c,l={}){g(this,"id");g(this,"type");g(this,"state");g(this,"intersector");g(this,"getCamera");g(this,"onMoveCommited");g(this,"parentSetPointerCapture");g(this,"parentReleasePointerCapture");g(this,"options");g(this,"prevIntersection");g(this,"intersection");g(this,"prevEnabled",!0);g(this,"enabled",!0);g(this,"wheelIntersection");g(this,"pointerEntered",[]);g(this,"pointerEnteredHelper",[]);g(this,"pointerCapture");g(this,"buttonsDownTime",new Map);g(this,"buttonsDown",new Set);g(this,"wasMoved",!1);g(this,"onFirstMove",[]);var u;this.id=e,this.type=t,this.state=n,this.intersector=r,this.getCamera=i,this.onMoveCommited=o,this.parentSetPointerCapture=a,this.parentReleasePointerCapture=c,this.options=l,(u=globalThis.pointerEventspointerMap)==null||u.set(e,this)}getPointerCapture(){return this.pointerCapture}hasCaptured(e){var t;return((t=this.pointerCapture)==null?void 0:t.object)===e}setCapture(e){var t,n,r;((t=this.pointerCapture)==null?void 0:t.object)!==e&&(this.pointerCapture!=null&&((n=this.parentReleasePointerCapture)==null||n.call(this),this.pointerCapture=void 0),e!=null&&this.intersection!=null&&(this.pointerCapture={object:e,intersection:this.intersection},(r=this.parentSetPointerCapture)==null||r.call(this)))}getButtonsDown(){return this.buttonsDown}getIntersection(){return this.intersection}getEnabled(){return this.enabled}setEnabled(e,t,n=!0){var r;this.enabled!==e&&(!e&&this.pointerCapture!=null&&((r=this.parentReleasePointerCapture)==null||r.call(this),this.pointerCapture=void 0),this.enabled=e,n&&this.commit(t,!1))}computeIntersection(e,t,n){return this.pointerCapture!=null?this.intersector.intersectPointerCapture(this.pointerCapture,n):(this.intersector.startIntersection(n),Tt(e,t,[this]),this.intersector.finalizeIntersection(t))}setIntersection(e){this.intersection=e}commit(e,t){var c;const n=this.getCamera(),r=this.prevEnabled?this.prevIntersection:void 0,i=this.enabled?this.intersection:void 0;r!=null&&r.object!=(i==null?void 0:i.object)&&j(new L("pointerout",!0,e,this,r,n));const o=this.pointerEntered;this.pointerEntered=[],this.pointerEnteredHelper.length=0,Gn(i==null?void 0:i.object,this.pointerEntered,o,this.pointerEnteredHelper);const a=o.length;for(let l=0;l<a;l++){const u=o[l];j(new L("pointerleave",!1,e,this,r,n,u))}i!=null&&(r==null?void 0:r.object)!=i.object&&j(new L("pointerover",!0,e,this,i,n));for(let l=this.pointerEnteredHelper.length-1;l>=0;l--){const u=this.pointerEnteredHelper[l];j(new L("pointerenter",!1,e,this,i,n,u))}if(t&&i!=null&&j(new L("pointermove",!0,e,this,i,n)),this.prevIntersection=this.intersection,this.prevEnabled=this.enabled,!this.wasMoved&&this.intersector.isReady()){this.wasMoved=!0;const l=this.onFirstMove.length;for(let u=0;u<l;u++)this.onFirstMove[u](n);this.onFirstMove.length=0}(c=this.onMoveCommited)==null||c.call(this,this)}move(e,t){this.intersection=this.computeIntersection("pointer",e,t),this.commit(t,!0)}emitMove(e){this.intersection!=null&&j(new L("pointermove",!0,e,this,this.intersection,this.getCamera()))}down(e){if(this.buttonsDown.add(e.button),!this.enabled)return;if(!this.wasMoved){this.onFirstMove.push(this.down.bind(this,e));return}if(this.intersection==null)return;j(new L("pointerdown",!0,e,this,this.intersection,this.getCamera()));const{object:t}=this.intersection;t[fe]??(t[fe]=new Map),t[fe].set(e.button,e.timeStamp),this.buttonsDownTime.set(e.button,e.timeStamp)}up(e){if(this.buttonsDown.delete(e.button),!this.enabled)return;if(!this.wasMoved){this.onFirstMove.push(this.up.bind(this,e));return}if(this.intersection==null)return;const{clickThesholdMs:t,contextMenuButton:n=2,dblClickThresholdMs:r=500,clickThresholdMs:i=t??300}=this.options;this.pointerCapture=void 0;const o=di(this.buttonsDownTime,this.intersection.object[fe],e.button,e.timeStamp,i),a=this.getCamera();if(o&&e.button===n&&j(new L("contextmenu",!0,e,this,this.intersection,a)),j(new L("pointerup",!0,e,this,this.intersection,a)),!o||e.button===n)return;j(new L("click",!0,e,this,this.intersection,a));const{object:c}=this.intersection,l=c[tt]??(c[tt]=new Map),u=l.get(e.button);if(u==null||e.timeStamp-u>r){l.set(e.button,e.timeStamp);return}j(new L("dblclick",!0,e,this,this.intersection,a)),l.delete(e.button)}cancel(e){if(this.enabled){if(!this.wasMoved){this.onFirstMove.push(this.cancel.bind(this,e));return}this.intersection!=null&&j(new L("pointercancel",!0,e,this,this.intersection,this.getCamera()))}}wheel(e,t,n=!1){if(!this.enabled)return;if(!this.wasMoved&&n){this.onFirstMove.push(this.wheel.bind(this,e,t,n));return}n||(this.wheelIntersection=this.computeIntersection("wheel",e,t));const r=n?this.intersection:this.wheelIntersection;r!=null&&j(new je(t,this,r,this.getCamera()))}emitWheel(e,t=!1){if(!this.enabled)return;if(!this.wasMoved&&t){this.onFirstMove.push(this.emitWheel.bind(this,e,t));return}const n=t?this.intersection:this.wheelIntersection;n!=null&&j(new je(e,this,n,this.getCamera()))}exit(e){var t;this.wasMoved&&(this.pointerCapture!=null&&((t=this.parentReleasePointerCapture)==null||t.call(this),this.pointerCapture=void 0),this.intersection=void 0,this.commit(e,!1)),this.onFirstMove.length=0,this.wasMoved=!1}}function Gn(s,e,t,n){if(s==null)return;const r=t.indexOf(s);r!=-1?t.splice(r,1):n.push(s),e.push(s),Gn(s.parent,e,t,n)}function di(s,e,t,n,r){if(e==null)return!1;const i=e.get(t);return!(i==null||n-i>r||i!=s.get(t))}function ke(s){return s.transformReady===!1?!1:s.parent==null?(s.matrixWorld.copy(s.matrix),!0):ke(s.parent)?(s.matrixWorld.multiplyMatrices(s.parent.matrixWorld,s.matrix),!0):!1}const de=new bn,nt=new bn,zt=new H,Vt=new H,Kt=new H,rt=new y,hi=new v,_e=new y;function Xe(s,e,t){_e.copy(e).applyMatrix4(hi.copy(t.matrixWorld).invert());const n=t.geometry.attributes.uv;if(n==null||!(n instanceof re))return!1;let r;return pi(t,(i,o,a)=>{t.getVertexPosition(i,de.a),t.getVertexPosition(o,de.b),t.getVertexPosition(a,de.c);const c=de.closestPointToPoint(_e,rt).distanceTo(_e);r!=null&&c>=r||(r=c,nt.copy(de),zt.fromBufferAttribute(n,i),Vt.fromBufferAttribute(n,o),Kt.fromBufferAttribute(n,a))}),r==null?!1:(nt.closestPointToPoint(_e,rt),nt.getInterpolation(rt,zt,Vt,Kt,s),!0)}function pi(s,e){const t=s.geometry.drawRange;if(s.geometry.index!=null){const o=s.geometry.index,a=Math.max(0,t.start),c=Math.min(o.count,t.start+t.count);for(let l=a;l<c;l+=3)e(o.getX(l),o.getX(l+1),o.getX(l+2));return}const n=s.geometry.attributes.position;if(n==null)return;const r=Math.max(0,t.start),i=Math.min(n.count,t.start+t.count);for(let o=r;o<i;o+=3)e(o,o+1,o+2)}const mi=new v,st=new ut,gi=new y,Wt=new yt,xi=new lt,qt=new H,Qt=[new y(0,0,0),new y(0,0,1)];class yi{constructor(e,t){g(this,"space");g(this,"options");g(this,"raycasters",[]);g(this,"fromMatrixWorld",new v);g(this,"ready");g(this,"intersects",[]);g(this,"pointerEventsOrders",[]);g(this,"raycasterIndices",[]);this.space=e,this.options=t}isReady(){return this.ready??this.prepareTransformation()}prepareTransformation(){const e=this.space.current;return e==null?this.ready=!1:(this.ready=ke(e),this.ready?(this.fromMatrixWorld.copy(e.matrixWorld),!0):!1)}intersectPointerCapture({intersection:e,object:t}){const n=e.details;if(n.type!="lines")throw new Error(`unable to process a pointer capture of type "${e.details.type}" with a lines intersector`);if(!this.prepareTransformation())return e;const r=this.options.linePoints??Qt;st.set(r[n.lineIndex],r[n.lineIndex+1]).applyMatrix4(this.fromMatrixWorld);const i=st.at(n.distanceOnLine/st.distance(),new y);e.object.updateWorldMatrix(!0,!1),wt(Wt,e,e.object.matrixWorld);const o=xi.intersectPlane(Wt,new y)??i,a=new y,c=new X;this.fromMatrixWorld.decompose(a,c,gi);let l=e.uv;return e.object instanceof K&&Xe(qt,i,e.object)&&(l=qt.clone()),{...e,object:t,uv:l,pointOnFace:o,point:i,pointerPosition:a,pointerQuaternion:c}}startIntersection(){if(!this.prepareTransformation())return;const e=this.options.linePoints??Qt,t=e.length-1;for(let n=0;n<t;n++){const r=e[n],i=e[n+1],o=this.raycasters[n]??(this.raycasters[n]=new Mn);o.ray.origin.copy(r).applyMatrix4(this.fromMatrixWorld),o.ray.direction.copy(i).applyMatrix4(this.fromMatrixWorld),o.ray.direction.sub(o.ray.origin);const a=o.ray.direction.length();o.ray.direction.divideScalar(a),o.far=a}this.raycasters.length=t}executeIntersection(e,t){if(!this.isReady())return;const n=this.intersects.length,r=this.raycasters.length;for(let i=0;i<r;i++){const o=this.raycasters[i],a=this.intersects.length;e.raycast(o,this.intersects),ht(this.raycasterIndices,i,this.intersects.length-a)}ht(this.pointerEventsOrders,t,this.intersects.length-n)}finalizeIntersection(e){const t=new y().setFromMatrixPosition(this.fromMatrixWorld),n=new X().setFromRotationMatrix(this.fromMatrixWorld),r=Rt(this.intersects,this.pointerEventsOrders,this.options),i=r==null?void 0:this.intersects[r],o=r==null?void 0:this.raycasterIndices[r];if(this.intersects.length=0,this.raycasterIndices.length=0,this.pointerEventsOrders.length=0,i==null||o==null){const l=this.raycasters.length-1,u=this.raycasters.reduce((p,m,w)=>w===l?p:p+m.far,0),f=this.raycasters[l];return Xn(e,f.ray,(p,m)=>({line:new ut(f.ray.origin.clone(),p),lineIndex:this.raycasters.length-1,distanceOnLine:m,type:"lines"}),t,n,u)}let a=i.distance;for(let l=0;l<o;l++)a+=this.raycasters[l].far;i.object.updateWorldMatrix(!0,!1);const c=this.raycasters[o];return Object.assign(i,{details:{lineIndex:o,distanceOnLine:i.distance,type:"lines",line:new ut(c.ray.origin.clone(),c.ray.direction.clone().multiplyScalar(c.far).add(c.ray.origin))},distance:a,pointerPosition:t,pointerQuaternion:n,pointOnFace:i.point,localPoint:i.point.clone().applyMatrix4(mi.copy(i.object.matrixWorld).invert())})}}const wi=new v,$t=new y,Ti=new y(0,0,-1),Yt=new yt,Zt=new H;class Ri{constructor(e,t){g(this,"space");g(this,"options");g(this,"raycaster",new Mn);g(this,"raycasterQuaternion",new X);g(this,"worldScale",0);g(this,"ready");g(this,"intersects",[]);g(this,"pointerEventsOrders",[]);this.space=e,this.options=t}isReady(){return this.ready??this.prepareTransformation()}prepareTransformation(){var t;const e=this.space.current;return e==null?this.ready=!1:(this.ready=ke(e),this.ready?(e.matrixWorld.decompose(this.raycaster.ray.origin,this.raycasterQuaternion,$t),this.worldScale=$t.x,this.raycaster.ray.direction.copy(((t=this.options)==null?void 0:t.direction)??Ti).applyQuaternion(this.raycasterQuaternion),!0):!1)}intersectPointerCapture({intersection:e,object:t}){if(e.details.type!="ray")throw new Error(`unable to process a pointer capture of type "${e.details.type}" with a ray intersector`);if(!this.prepareTransformation())return e;e.object.updateWorldMatrix(!0,!1),wt(Yt,e,e.object.matrixWorld);const{ray:n}=this.raycaster,r=n.intersectPlane(Yt,new y)??e.point,i=n.direction.clone().multiplyScalar(e.pointerPosition.distanceTo(e.point)).add(n.origin);let o=e.uv;return e.object instanceof K&&Xe(Zt,i,e.object)&&(o=Zt.clone()),{...e,uv:o,object:t,pointOnFace:r,point:i,pointerPosition:n.origin.clone(),pointerQuaternion:this.raycasterQuaternion.clone()}}startIntersection(){this.prepareTransformation()}executeIntersection(e,t){if(!this.isReady())return;const n=this.intersects.length;e.raycast(this.raycaster,this.intersects),ht(this.pointerEventsOrders,t,this.intersects.length-n)}finalizeIntersection(e){const t=this.raycaster.ray.origin.clone(),n=this.raycasterQuaternion.clone();let r;if(this.options.minDistance!=null){const a=this.options.minDistance/this.worldScale;r=c=>c.distance>=a}const i=Rt(this.intersects,this.pointerEventsOrders,this.options,r),o=i==null?void 0:this.intersects[i];return this.intersects.length=0,this.pointerEventsOrders.length=0,o==null?Xn(e,this.raycaster.ray,()=>({type:"ray"}),t,n):(o.object.updateWorldMatrix(!0,!1),Object.assign(o,{details:{type:"ray"},pointerPosition:t,pointerQuaternion:n,pointOnFace:o.point,localPoint:o.point.clone().applyMatrix4(wi.copy(o.object.matrixWorld).invert())}))}}new y;const Si=new y,Oe=new H;class Bn{constructor(e,t,n){g(this,"space");g(this,"getSphereRadius");g(this,"options");g(this,"fromPosition",new y);g(this,"fromQuaternion",new X);g(this,"collisionSphere",new xt);g(this,"ready");g(this,"intersects",[]);this.space=e,this.getSphereRadius=t,this.options=n}isReady(){return this.ready??this.prepareTransformation()}prepareTransformation(){const e=this.space.current;return e==null?this.ready=!1:(this.ready=ke(e),this.ready?(e.matrixWorld.decompose(this.fromPosition,this.fromQuaternion,Si),!0):!1)}intersectPointerCapture({intersection:e,object:t}){if(e.details.type!="sphere")throw new Error(`unable to process a pointer capture of type "${e.details.type}" with a sphere intersector`);if(!this.prepareTransformation())return e;Jt.copy(e.point).sub(e.pointerPosition),en.copy(e.pointerQuaternion).invert().multiply(this.fromQuaternion);const n=Jt.clone().applyQuaternion(en).add(this.fromPosition);e.object.updateWorldMatrix(!0,!1),wt(tn,e,e.object.matrixWorld);const r=tn.projectPoint(this.fromPosition,new y);let i=e.uv;return e.object instanceof K&&Xe(Oe,n,e.object)&&(i=Oe.clone()),{details:{type:"sphere"},uv:i,distance:n.distanceTo(r),pointerPosition:this.fromPosition.clone(),pointerQuaternion:this.fromQuaternion.clone(),object:t,point:n,pointOnFace:r,face:e.face,localPoint:e.localPoint}}startIntersection(){this.prepareTransformation()&&(this.collisionSphere.center.copy(this.fromPosition),this.collisionSphere.radius=this.getSphereRadius())}executeIntersection(e){this.isReady()&&bi(this.collisionSphere,e,this.intersects)}finalizeIntersection(e){const t=this.fromPosition.clone(),n=this.fromQuaternion.clone(),r=Rt(this.intersects,void 0,this.options),i=r==null?void 0:this.intersects[r];return this.intersects.length=0,i==null?{details:{type:"sphere"},distance:0,point:t,object:kn(e),pointerPosition:t,pointerQuaternion:n,pointOnFace:t,localPoint:t}:(i.object.updateWorldMatrix(!0,!1),Object.assign(i,{details:{type:"sphere"},pointOnFace:i.point,pointerPosition:this.fromPosition.clone(),pointerQuaternion:this.fromQuaternion.clone(),localPoint:i.point.clone().applyMatrix4(Fe.copy(i.object.matrixWorld).invert())}))}}const Ee=new v;function bi(s,e,t){if(e.updateWorldMatrix(!0,!1),e.spherecast!=null){e.spherecast(s,t);return}if(e instanceof yn){e.geometry.boundingSphere==null&&e.geometry.computeBoundingSphere(),e.geometry.boundingBox==null&&e.geometry.computeBoundingBox();for(let r=0;r<e.count;r++){if(e.getMatrixAt(r,Ee),Ee.premultiply(e.matrixWorld),!nn(s,e,Ee))continue;const i=sn(s,e,Ee,r);i!=null&&t.push(i)}}if(!(e instanceof K)||!nn(s,e,e.matrixWorld))return;Fe.copy(e.matrixWorld).invert();const n=sn(s,e,e.matrixWorld);n!=null&&t.push(n)}const Jt=new y,en=new X,tn=new yt,ie=new xt;function nn(s,{geometry:e},t){return e.boundingSphere==null&&e.computeBoundingSphere(),ie.copy(e.boundingSphere).applyMatrix4(t),ie.center.distanceToSquared(s.center)<(s.radius+ie.radius)**2}const Ae=new y,it=new y,rn=new y,Mi=new y(1e-4,1e-4,1e-4),Fe=new v;function sn(s,e,t,n){Fe.copy(t).invert(),ie.copy(s).applyMatrix4(Fe);const{geometry:r}=e;r.boundingBox==null&&r.computeBoundingBox(),r.boundingBox.getSize(it),r.boundingBox.getCenter(rn),r.boundingBox.clampPoint(ie.center,Ae),Ae.applyMatrix4(t);const i=Ae.distanceToSquared(s.center);if(i>s.radius*s.radius)return;it.max(Mi);const o=ie.center.clone().sub(rn);o.divide(it),Pi(o);const a=Ae.clone();let c;return Xe(Oe,a,e)&&(c=Oe.clone()),{distance:Math.sqrt(i),face:{a:0,b:0,c:0,materialIndex:0,normal:o},uv:c,normal:o,point:a,instanceId:n,object:e}}function Pi(s){const e=Math.abs(s.x),t=Math.abs(s.y),n=Math.abs(s.z);if(e>=t&&e>=n){s.set(s.x<0?-1:1,0,0);return}if(t>=e&&t>=n){s.set(0,s.y<0?-1:1,0);return}s.set(0,0,s.z<0?-1:1)}function Ii(s,e,t,n={},r="grab"){return new Se(Ge(),r,t,new Bn(e,()=>n.radius??.07,n),s,void 0,void 0,void 0,n)}function _i(s,e,t,n={},r="ray"){return new Se(Ge(),r,t,new Ri(e,n),s,void 0,void 0,void 0,n)}function Ei(s,e,t,n={},r="lines"){return new Se(Ge(),r,t,new yi(e,n),s,void 0,void 0,void 0,n)}function Ai(s,e,t,n={},r="touch"){return new Se(Ge(),r,t,new Bn(e,()=>n.hoverRadius??.1,n),s,vi(n),void 0,void 0,n)}function vi(s){let e=!1;return t=>{if(!t.getEnabled())return;const n=t.getIntersection(),r=Ci(n,s.downRadius??.03);if(r===e)return;const i={timeStamp:performance.now(),button:s.button??0};r?t.down(i):t.up(i),e=r}}function Ci(s,e){return s==null?!1:s.distance<=e}let Li=23412;function Ge(){return Li++}let Un=class pt{constructor(e){g(this,"enableMultiplePointers");g(this,"pointers",[]);g(this,"isDefaults",[]);g(this,"enabled",!0);g(this,"activePointer");g(this,"nonCapturedPointers",[]);this.enableMultiplePointers=e}register(e,t=!1){return this.pointers.push(e),this.isDefaults.push(t),this.unregister.bind(this,e)}unregister(e){const t=this.pointers.indexOf(e);t!==-1&&(this.isDefaults.splice(t,1),this.pointers.splice(t,1))}startIntersection(e,t){const n=this.pointers.length;let r=!1;for(let i=0;i<n;i++){const o=this.pointers[i];if(o instanceof pt){o.startIntersection(e,t);continue}const a=o.getPointerCapture();if(a!=null){r=!0,o.setIntersection(o.intersector.intersectPointerCapture(a,t));continue}e.push(o),o.intersector.startIntersection(t)}return r}getIntersection(){var e;return(e=this.activePointer)==null?void 0:e.getIntersection()}getPointerCapture(){var e;return(e=this.activePointer)==null?void 0:e.getPointerCapture()}computeActivePointer(){let e;this.activePointer=void 0;const t=this.pointers.length;for(let n=0;n<t;n++){const r=this.pointers[n];r instanceof pt&&r.computeActivePointer();const i=r.getIntersection(),o=r.getPointerCapture()!=null?-1/0:i!=null&&i.object.isVoidObject?1/0:(i==null?void 0:i.distance)??1/0,a=this.isDefaults[n];(e==null||a&&o===e||o<e)&&(this.activePointer=r,e=o)}}commit(e,t,n=!0){if(this.enableMultiplePointers){const i=this.pointers.length;for(let o=0;o<i;o++)this.pointers[o].commit(e,t);return}n&&this.computeActivePointer();const r=this.pointers.length;for(let i=0;i<r;i++){const o=this.pointers[i];o.setEnabled(o===this.activePointer,e,!1),o.commit(e,t,!1)}}move(e,t){if(!this.enabled)return;if(this.nonCapturedPointers.length=0,!this.startIntersection(this.nonCapturedPointers,t)||this.enableMultiplePointers){Tt("pointer",e,this.nonCapturedPointers);const r=this.nonCapturedPointers.length;for(let i=0;i<r;i++){const o=this.nonCapturedPointers[i];o.setIntersection(o.intersector.finalizeIntersection(e))}}this.commit(t,!0)}setEnabled(e,t){this.enabled=e;const n=this.pointers.length;for(let r=0;r<n;r++){const i=this.pointers[r];i.setEnabled(e&&(this.enableMultiplePointers||i==this.activePointer),t)}}};new y;new y;new y;function bt(s,e,t){return typeof s=="function"?s:(typeof s=="object"&&(e!=null&&Ni(s,e)?s=s[e]:"default"in s&&(s=s.default)),s===!1?!1:s===!0?t:s??t)}function Ni(s,e){return e in s}new y;new y;new Yr;new Zr;async function ji(s,e=io){const{scene:t}=await e.loadAsync(s.assetPath);return t.clone(!0)}function Oi(s,e){s.renderOrder=(e==null?void 0:e.renderOrder)??0,s.traverse(t=>{t instanceof K&&t.material instanceof xe&&(t.material.colorWrite=(e==null?void 0:e.colorWrite)??!0)})}function Fi(s,e,t){const n=[];for(const r in e.components){const i=e.components[r];let o=t[r];o==null&&(t[r]=o={state:"default"}),n.push(...Object.values(i.visualResponses).map(a=>Di(s,o,a)))}return()=>{const r=n.length;for(let i=0;i<r;i++)n[i]()}}function Di(s,e,t){const n=s.getObjectByName(t.valueNodeName);if(e.object=n,n==null)return()=>{};if(t.valueNodeProperty==="visibility")return()=>n.visible=t.states.includes(e.state);const r=s.getObjectByName(t.minNodeName),i=s.getObjectByName(t.maxNodeName);return r==null||i==null?()=>{}:()=>{const o=Hi(e,t);n.quaternion.slerpQuaternions(r.quaternion,i.quaternion,o),n.position.lerpVectors(r.position,i.position,o),n.updateMatrix()}}function Hi(s,{componentProperty:e,states:t}){const n=t.includes(s.state);switch(e){case"xAxis":return n?on(s).x:.5;case"yAxis":return n?on(s).y:.5;case"button":return n?s.button??0:0;case"state":return n?1:0}}const he=new H;function on({xAxis:s=0,yAxis:e=0}){if(he.lengthSq()>1){const n=Math.atan2(e,s);he.set(Math.cos(n),Math.sin(n))}else he.set(s,e);return he.multiplyScalar(.5).addScalar(.5),he}function an(s,e){if(e!=null&&e.createdAt!=null&&e.createdAt>=s.lastChangedTime)return e;const t=new gt;return t.setIndex(new re(s.indices,1)),t.setAttribute("position",new re(s.vertices,3)),Object.assign(t,{creationTime:s.lastChangedTime})}function cn(s,e){return e!=null&&e.createdAt!=null&&e.createdAt>=s.lastChangedTime?e:Object.assign(ki(s.polygon),{createdAt:s.lastChangedTime})}const pe=new Jr,ve=new H;function ki(s){if(s.length===0)return new gt;const e=new es,t=s.map(({x:r,z:i})=>new H(r,i));pe.setFromPoints(t),pe.getSize(ve);for(const r of t)r.sub(pe.min),r.divide(ve);e.setFromPoints(t);const n=new ts(e);return n.scale(ve.x,ve.y,1),n.translate(pe.min.x,pe.min.y,0),n.rotateX(Math.PI/2),n}function De(s,e=1){if(s!=null)return{x:ee(s.x),y:ee(s.y),z:ee(s.z),w:"w"in s?ee(s.w,e):e}}function ee(s,e=0){return isNaN(s)?e:s}const zn=60/180*Math.PI,Xi=60/180*Math.PI,Gi=-30/180*Math.PI,Bi=30/180*Math.PI;function Ui(s,e,t,n,r,i,o){return s instanceof HTMLVideoElement?zi(s,e,t,r,i,o):Vi(s,e.origin,t,n,r,i,o)}function zi(s,e,t,n,{invertStereo:r,layout:i,shape:o="quad"},a={}){var m;const c=He(n,e.origin,t,ae),l=Mt(ae,ne),u={invertStereo:r,layout:i,space:c,transform:l};It(o,u,a.centralAngle,ne);const f=`create${Vn(o)}Layer`,p=(m=e.mediaBinding)==null?void 0:m[f](s,u);if(p!=null)return Pt(p,a),p}function Vi(s,e,t,n,r,{shape:i="quad",...o},a={}){var m;const c=He(r,e,t,ae),l=Mt(ae,ne),u={...o,isStatic:!(s instanceof Re),textureType:"texture",viewPixelWidth:o.layout==="stereo-left-right"?s.width/2:s.width,viewPixelHeight:o.layout==="stereo-top-bottom"?s.height/2:s.height,space:c,transform:l};It(i,u,a.centralAngle,ne);const f=`create${Vn(i)}Layer`,p=(m=n.getBinding())==null?void 0:m[f](u);if(p!=null)return Pt(p,a),p}const ae=new v,ln=new y,un=new X,ne=new y;function Mt(s,e=ne){return s.decompose(ln,un,e),e.x=ee(e.x),e.y=ee(e.y),e.z=ee(e.z),new XRRigidTransform(De(ln),De(un))}function Vn(s){return`${s[0].toUpperCase()}${s.slice(1)}`}function Pt(s,e={}){if(s.chromaticAberrationCorrection=e.chromaticAberrationCorrection,s.quality=e.quality??"default",s.blendTextureSourceAlpha=e.blendTextureSourceAlpha??!1,s instanceof XRCylinderLayer){s.centralAngle=(e==null?void 0:e.centralAngle)??zn;return}s instanceof XREquirectLayer&&(s.centralHorizontalAngle=(e==null?void 0:e.centralHorizontalAngle)??Xi,s.lowerVerticalAngle=(e==null?void 0:e.lowerVerticalAngle)??Gi,s.upperVerticalAngle=(e==null?void 0:e.upperVerticalAngle)??Bi)}function Ki(s,e,t,n){let r=!1;const i=async()=>{const o=await e.requestFrame();r||qi(s,t,o,n)};return t.addEventListener("redraw",i),i(),()=>{r=!0,t.removeEventListener("redraw",i)}}function Wi(s){if(s instanceof Re)return s.texture;const e=s instanceof HTMLVideoElement?new ss(s):new ct(s);return e.colorSpace=oe,e.needsUpdate=!0,e}function qi(s,e,t,n){const r=s.getContext(),i=s.xr.getBinding().getSubImage(e,t);s.state.bindTexture(r.TEXTURE_2D,i.colorTexture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.texSubImage2D(r.TEXTURE_2D,0,0,0,n.width,n.height,r.RGBA,r.UNSIGNED_BYTE,n)}function Qi(s,e,t,n){s.originReferenceSpace!=null&&(e.space=He(n,s.origin,s.originReferenceSpace,ae),e.transform=Mt(ae,ne),It($i(e),e,t,ne))}function It(s,e,t,n){if(s==="cylinder"){const i=(n.x+n.z)/2,o=i*(t??zn);e.radius=i,e.aspectRatio=n.y===0?1:o/n.y}else s==="quad"?(e.width=n.x/2,e.height=n.y/2):e.radius=(n.x+n.y+n.z)/3}function $i(s){return s instanceof XRCylinderLayer?"cylinder":s instanceof XREquirectLayer?"equirect":"quad"}function Kn(s,e,t){return new Re(s*t,e*t,{minFilter:ye,magFilter:ye,type:rs,depthTexture:new ns(s,e)})}const me=new Pn(0,0,0,"YXZ"),Ce=new X;function Yi(s,e,t){s.updateWorldMatrix(!0,!1),s.matrixWorld.decompose(e.position,Ce,e.scale),me.setFromQuaternion(Ce),me.z=0,me.x=os(me.x-10*Math.PI/180,-Math.PI/2,1.1*Math.PI/4),Ce.setFromEuler(me),e.quaternion.slerp(Ce,t/100)}function Zi(s){return s.userData.teleportTarget===!0}function Ji(s={}){return(e,t,n,r)=>!(!Zi(e)||s.filter!=null&&!s.filter(e,t,n,r))}function eo(){return new is(new y(0,0,0),new y(0,0,-8),new y(0,-20,-15)).getPoints(20)}let to=class extends K{constructor(t){const n=new rr,r=new Float32Array(t.length*3);for(let a=0;a<t.length;a++)t[a].toArray(r,a*3);n.setPoints(r);const i=(t.length*3-3)/(t.length*3-1),o=new sr({lineWidth:.1,resolution:void 0,visibility:i});super(n,o);g(this,"multiplier");g(this,"lineLengths");g(this,"options",{});this.material.transparent=!0,this.multiplier=i,this.material=o,this.lineLengths=t.slice(0,-1).map((a,c)=>a.distanceTo(t[c+1]))}update(t){const n=t.getEnabled(),r=t.getIntersection();if(!n||t.getButtonsDown().size===0||r==null){this.visible=!1;return}if(this.visible=!0,r.details.type!="lines"){this.material.visibility=this.multiplier;return}const{distanceOnLine:i,lineIndex:o}=r.details,a=this.lineLengths[o];this.material.visibility=this.multiplier*(o+i/a)/this.lineLengths.length;const{color:c="white",opacity:l=.4,size:u=.01}=this.options;this.material.lineWidth=u,this.material.opacity=typeof l=="function"?l(t):l;const f=typeof c=="function"?c(t):c;Array.isArray(f)?this.material.color.set(...f):this.material.color.set(f)}};const fn=new v,Le=new y,no=new y,dn=new X;async function ro(s,e,t,n=["point","plane","mesh"]){var u;typeof t=="string"&&(t=await e.requestReferenceSpace(t));const r=Array.isArray(n)?n:[n];let i,o,a;const c=s.getState();if(t instanceof XRSpace)i={space:t,entityTypes:r},a=c.origin;else{const f=He(t,c.origin,c.originReferenceSpace,fn);if(f==null)return;fn.decompose(Le,dn,no);const p=De(Le);Le.set(0,0,-1).applyQuaternion(dn);const m=new XRRay(p,De(Le,0));a=t,i={space:f,offsetRay:m,entityTypes:r},o=f}const l=await((u=e==null?void 0:e.requestHitTestSource)==null?void 0:u.call(e,i));if(l!=null)return{source:l,getWorldMatrix:so.bind(null,s,o,a)}}function so(s,e,t,n,r){if(e??(e=s.getState().originReferenceSpace),e==null)return!1;const i=r.getPose(e);return i==null?!1:(n.fromArray(i.transform.matrix),t!=null&&(t.updateWorldMatrix(!0,!1),n.premultiply(t.matrixWorld)),!0)}new y(1,1,1);new y(0,0,0);new v;new v;new y;new y;new y;new Pn;new y;new y;const io=new vn,Wn=h.createContext(void 0),Y=h.createContext(void 0),be=h.createContext(void 0),_t=h.createContext(void 0),oo={},{useDebugValue:ao}=or,{useSyncExternalStoreWithSelector:co}=ir;let hn=!1;const lo=s=>s;function Et(s,e=lo,t){(oo?"production":void 0)!=="production"&&t&&!hn&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),hn=!0);const n=co(s.subscribe,s.getState,s.getServerState||s.getInitialState,e,t);return ao(n),n}function Me(s,e){if(Object.is(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;if(s instanceof Map&&e instanceof Map){if(s.size!==e.size)return!1;for(const[n,r]of s)if(!Object.is(r,e.get(n)))return!1;return!0}if(s instanceof Set&&e instanceof Set){if(s.size!==e.size)return!1;for(const n of s)if(!e.has(n))return!1;return!0}const t=Object.keys(s);if(t.length!==Object.keys(e).length)return!1;for(const n of t)if(!Object.prototype.hasOwnProperty.call(e,n)||!Object.is(s[n],e[n]))return!1;return!0}h.forwardRef(({id:s,children:e,onPress:t,onRelease:n},r)=>{const i=$("controller"),[o,a]=h.useState(void 0);if(h.useImperativeHandle(r,()=>o,[o]),uo(i,s,c=>c==="pressed"?t==null?void 0:t():n==null?void 0:n()),A(()=>{var c;return a((c=i.gamepad[s])==null?void 0:c.object)}),o!=null)return mt(e,o)});function uo(s,e,t){const n=h.useRef(void 0);A(()=>{var i;const r=(i=s==null?void 0:s.gamepad[e])==null?void 0:i.state;r!=null&&r!=n.current&&t(r),n.current=r})}const fo=Symbol("loadXRControllerModel"),ho=h.forwardRef((s,e)=>{const t=$("controller"),n=ar(ji,[t.layout,void 0,fo]);Oi(n,s),t.object=n,h.useImperativeHandle(e,()=>n,[n]);const r=h.useMemo(()=>Fi(n,t.layout,t.gamepad),[n,t.layout,t.gamepad]);return A(r),d.jsx(G,{space:"grip-space",children:d.jsx("primitive",{object:n})})}),po=h.forwardRef((s,e)=>{const t=$("hand"),n=cr(vn,t.assetPath),r=h.useMemo(()=>Bs(n),[n]);Us(r,s),t.object=r,h.useImperativeHandle(e,()=>r,[r]);const i=Zn(),o=h.useMemo(()=>Vs(t.inputSource.hand,r,i),[t.inputSource,r,i]);return A((a,c,l)=>o(l)),d.jsx("primitive",{object:r})});h.forwardRef(({joint:s,children:e},t)=>d.jsx(G,{ref:t,space:s,children:e}));function qn({children:s}){const e=h.useMemo(()=>new Un(!1),[]);return Pe(e),d.jsx(_t.Provider,{value:e,children:s})}function Be(s){for(const e of Object.keys(s))delete s[e]}function mo(s,e,t,n){const r=h.useMemo(()=>({}),[]);Be(r),Object.assign(r,t);const i=ce(),o=h.useMemo(()=>Ii(()=>i.getState().camera,s,e,r,n),[i,s,e,r,n]);return Pe(o,t==null?void 0:t.makeDefault),o}function go(s,e,t,n){const r=h.useMemo(()=>({}),[]);Be(r),Object.assign(r,t);const i=ce(),o=h.useMemo(()=>_i(()=>i.getState().camera,s,e,r,n),[i,s,e,r,n]);return Pe(o,t==null?void 0:t.makeDefault),o}function xo(s,e,t,n){const r=h.useMemo(()=>({}),[]);Be(r),Object.assign(r,t);const i=ce(),o=h.useMemo(()=>Ei(()=>i.getState().camera,s,e,r,n),[i,s,e,r,n]);return Pe(o,t==null?void 0:t.makeDefault),o}function yo(s,e,t,n){const r=h.useMemo(()=>({}),[]);Be(r),Object.assign(r,t);const i=ce(),o=h.useMemo(()=>Ai(()=>i.getState().camera,s,e,r,n),[i,s,e,r,n]);return Pe(o,t==null?void 0:t.makeDefault),o}const wo=h.forwardRef((s,e)=>{const t=h.useMemo(()=>{const r=s.materialClass??Ys;return new r},[s.materialClass]),n=h.useRef(null);return h.useImperativeHandle(e,()=>n.current,[]),A(()=>n.current!=null&&Zs(n.current,t,s.pointer,s)),d.jsx("mesh",{matrixAutoUpdate:!1,renderOrder:s.renderOrder??2,ref:n,material:t,children:d.jsx("boxGeometry",{})})}),Ue=h.forwardRef((s,e)=>{const t=h.useMemo(()=>{const o=s.materialClass??qs;return new o},[s.materialClass]),n=h.useRef(null),r=h.useRef(null);h.useImperativeHandle(e,()=>n.current,[]),A(()=>n.current!=null&&r.current!=null&&$s(r.current,n.current,t,s.pointer,s));const i=we(o=>o.scene);return d.jsxs(d.Fragment,{children:[d.jsx("group",{ref:r}),mt(d.jsx("mesh",{renderOrder:s.renderOrder??1,ref:n,matrixAutoUpdate:!1,material:t,children:d.jsx("planeGeometry",{})}),i)]})});function At(s,e,t,n){const r=I(i=>i.session);h.useEffect(()=>{if(r!=null)return Js(s,r,e,t,n)},[t,e,s,r,n])}function Pe(s,e=!1){const t=h.useContext(_t);if(t==null)throw new Error("xr pointers can only be used inside the XR component");h.useEffect(()=>{const n=t.register(s,e);return()=>{n()}},[t,s,e]),h.useEffect(()=>{if(s instanceof Se)return()=>s.exit({timeStamp:performance.now()})},[s])}const To=h.forwardRef(({pointer:s,linePoints:e,...t},n)=>{const r=h.useMemo(()=>new to(e),[e]);return h.useImperativeHandle(n,()=>r,[r]),r.options=t,A(()=>r.update(s)),d.jsx("primitive",{object:r})});function Qn(s,e,t){const n=h.useContext(Y);if(n==null)throw new Error("DefaultXRInputSourceGrabPointer can only be used inside a XRInputSource");const r=h.useRef(null),i=mo(r,n,t);At(i,n.inputSource,s,n.events);const o=t.cursorModel;return d.jsx(G,{ref:r,space:e,children:o!==!1&&d.jsx(Ue,{pointer:i,opacity:ei,...E(o)})})}const Ro=Qn.bind(null,"select","index-finger-tip"),So=Qn.bind(null,"squeeze","grip-space");function Ie(s){const e=$(),t=h.useRef(null),n=go(t,e,s);At(n,e.inputSource,"select",e.events);const r=s.rayModel,i=s.cursorModel;return d.jsxs(G,{ref:t,space:"target-ray-space",children:[r!==!1&&d.jsx(wo,{pointer:n,opacity:Ne,...E(r)}),i!==!1&&d.jsx(Ue,{pointer:n,opacity:Ne,...E(i)})]})}function bo(s){const e=$("hand"),t=h.useRef(null),n=yo(t,e,s),r=s.cursorModel;return d.jsx(G,{ref:t,space:e.inputSource.hand.get("index-finger-tip"),children:r!==!1&&d.jsx(Ue,{pointer:n,opacity:ti,...E(r)})})}function Mo(s){const e=s.model,t=s.grabPointer,n=s.rayPointer,r=s.teleportPointer??!1;return d.jsxs(d.Fragment,{children:[e!==!1&&d.jsx(h.Suspense,{children:d.jsx(ho,{...E(e)})}),d.jsxs(qn,{children:[t!==!1&&d.jsx(So,{...E(t)}),n!==!1&&d.jsx(Ie,{makeDefault:!0,minDistance:.2,...E(n)}),r!==!1&&d.jsx($n,{...E(r)})]})]})}function Po(s){var a;const e=s.model,t=s.grabPointer,n=s.rayPointer,r=s.touchPointer,i=s.teleportPointer??!1,o=n===!1?!1:(a=E(n))==null?void 0:a.rayModel;return d.jsxs(d.Fragment,{children:[e!==!1&&d.jsx(h.Suspense,{children:d.jsx(po,{...E(e)})}),d.jsxs(qn,{children:[t!==!1&&d.jsx(Ro,{...E(t)}),r!==!1&&d.jsx(bo,{...E(r)}),n!==!1&&d.jsx(Ie,{makeDefault:!0,minDistance:.2,...E(n),rayModel:o===!1?!1:{maxLength:.2,...E(o)}}),i!==!1&&d.jsx($n,{...E(i)})]})]})}function Io(s){return d.jsx(Ie,{...s,rayModel:!1})}function _o(s){return d.jsx(Ie,{...s,rayModel:!1})}function Eo(s){return d.jsx(Ie,{...s,cursorModel:!1,rayModel:!1})}function $n(s){const e=h.useContext(Y);if(e==null)throw new Error("DefaultXRInputSourceRayPointer can only be used inside a XRInputSource");const t=h.useRef(null),n=h.useRef(null),r=h.useMemo(()=>eo(),[]),i=xo(n,e,{...s,linePoints:r,filter:Ji(s)},"teleport");At(i,e.inputSource,"select",e.events);const o=s.rayModel,a=s.cursorModel,c=we(u=>u.scene),l=h.useRef(null);return A((u,f)=>{l.current!=null&&(l.current.visible=i.getEnabled()&&i.getButtonsDown().size>0);const p=n.current,m=t.current;p==null||m==null||Yi(m,p,f*1e3)}),d.jsxs(d.Fragment,{children:[d.jsx(G,{ref:t,space:"target-ray-space"}),mt(d.jsxs("group",{ref:n,children:[o!==!1&&d.jsx(To,{linePoints:r,pointer:i,opacity:Ne,...E(o)}),a!==!1&&d.jsx(Ue,{ref:l,pointer:i,opacity:Ne,...E(a)})]}),c)]})}function E(s){if(s!==!0)return s}function Ao(){return I(s=>s.visibilityState)}function vo(s,e){const t=h.useRef(e);t.current=e;const[n,r]=h.useMemo(()=>{let i;return[o=>{let a=!1;return typeof navigator>"u"||navigator.xr==null?(i=!1,()=>{}):(navigator.xr.isSessionSupported(s).then(c=>{i=c,!a&&o()}).catch(c=>{var l;a||(l=t.current)==null||l.call(t,c)}),()=>a=!0)},()=>i]},[s]);return h.useSyncExternalStore(n,r)}let Co=0;const pn=new Map;function ze(s){let e=pn.get(s);return e==null&&pn.set(s,e=Co++),e}function Lo({children:s}){const e=I(o=>o.originReferenceSpace),t=I(o=>o.origin),n=Ao()==="visible",r=ce(),i=h.useMemo(()=>Object.assign({},r,{getState(){return{...r.getState(),scene:t}}}),[t,r]);return t==null||e==null?null:d.jsx(d.Fragment,{children:lr.createPortal(d.jsx(ur.Provider,{value:r,children:d.jsxs(be.Provider,{value:e,children:[d.jsxs("group",{matrixAutoUpdate:!1,visible:n,children:[d.jsx(No,{}),d.jsx(jo,{}),d.jsx(Oo,{}),d.jsx(Fo,{}),d.jsx(Do,{})]}),s]})}),i,null)})}function No(){const s=I(t=>t.inputSourceStates.filter(n=>n.type==="controller"),Me);let e=I(t=>t.controller);return e===!1?null:d.jsx(d.Fragment,{children:s.map(t=>{const n=bt(e,t.inputSource.handedness,{});return n===!1?null:d.jsx(Y.Provider,{value:t,children:d.jsx(G,{space:"target-ray-space",children:d.jsx(h.Suspense,{children:typeof n=="function"?d.jsx(n,{}):d.jsx(Mo,{...n})})})},t.id)})})}function jo(){const s=I(t=>t.inputSourceStates.filter(n=>n.type==="hand"),Me),e=I(t=>t.hand);return e===!1?null:d.jsx(d.Fragment,{children:s.map(t=>{const n=bt(e,t.inputSource.handedness,{});return n===!1?null:d.jsx(Y.Provider,{value:t,children:d.jsx(G,{space:"target-ray-space",children:d.jsx(h.Suspense,{children:typeof n=="function"?d.jsx(n,{}):d.jsx(Po,{...n})})})},ze(t))})})}function Oo(){const s=I(t=>t.inputSourceStates.filter(n=>n.type==="transientPointer"),Me),e=I(t=>t.transientPointer);return e===!1?null:d.jsx(d.Fragment,{children:s.map(t=>{const n=bt(e,t.inputSource.handedness,{});return n===!1?null:d.jsx(Y.Provider,{value:t,children:d.jsx(G,{space:"target-ray-space",children:d.jsx(h.Suspense,{children:typeof n=="function"?d.jsx(n,{}):d.jsx(Io,{...n})})})},ze(t))})})}function Fo(){const s=I(t=>t.inputSourceStates.filter(n=>n.type==="gaze"),Me),e=I(t=>t.gaze);return e===!1?null:d.jsx(d.Fragment,{children:s.map(t=>d.jsx(Y.Provider,{value:t,children:d.jsx(G,{space:"target-ray-space",children:d.jsx(h.Suspense,{children:typeof e=="function"?d.jsx(e,{}):d.jsx(_o,{...Yn(e)})})})},ze(t)))})}function Do(){const s=I(t=>t.inputSourceStates.filter(n=>n.type==="screenInput"),Me),e=I(t=>t.screenInput);return e===!1?null:d.jsx(d.Fragment,{children:s.map(t=>d.jsx(Y.Provider,{value:t,children:d.jsx(G,{space:"target-ray-space",children:d.jsx(h.Suspense,{children:typeof e=="function"?d.jsx(e,{}):d.jsx(Eo,{...Yn(e)})})})},ze(t)))})}function Yn(s){if(s!==!0)return s}function Ho({children:s,store:e}){e.setWebXRManager(we(n=>n.gl.xr));const t=ce();return h.useEffect(()=>{let n;return e.subscribe((r,i)=>{if(r.session!==i.session){if(r.session!=null){const{camera:o,gl:a}=t.getState();n=o,t.setState({camera:a.xr.getCamera()});return}n!=null&&t.setState({camera:n})}})},[t,e]),A((n,r,i)=>e.onBeforeFrame(n.scene,n.camera,i),-1e3),A(()=>e.onBeforeRender()),d.jsx(Wn.Provider,{value:e,children:d.jsxs(ko,{children:[d.jsx(Lo,{}),s]})})}function ko({children:s}){const e=Ve(),t=h.useMemo(()=>new Un(!0),[]);return h.useEffect(()=>Ws(e,n=>t.setEnabled(n,{timeStamp:performance.now()})),[e,t]),A(n=>t.move(n.scene,{timeStamp:performance.now()}),-50),d.jsx(_t.Provider,{value:t,children:s})}function Ve(){const s=h.useContext(Wn);if(s==null)throw new Error("XR features can only be used inside the <XR> component");return s}function I(s=t=>t,e){return Et(Ve(),s,e)}function $(s){const e=h.useContext(Y);if(e==null)throw new Error("useXRInputSourceStateContext() can only be used inside the xr store config");if(s!=null&&e.type!=s)throw new Error(`useXRInputSourceStateContext(${s}) can not be used inside a component for input type "${e.type}"`);return e}const G=h.forwardRef(({space:s,children:e},t)=>{const n=h.useRef(null),r=typeof s=="string"?Zn(s):s;h.useImperativeHandle(t,()=>n.current,[]),Go(n,r);const i=h.useCallback(o=>{o!=null&&(o.transformReady=!1,o.visible=!1),n.current=o},[]);return d.jsx("group",{xrSpace:r,matrixAutoUpdate:!1,ref:i,children:r&&d.jsx(be.Provider,{value:r,children:e})})});function Zn(s){var r;switch(s){case"grip-space":return $().inputSource.gripSpace;case"target-ray-space":return $().inputSource.targetRaySpace;case"wrist":case"thumb-metacarpal":case"thumb-phalanx-proximal":case"thumb-phalanx-distal":case"thumb-tip":case"index-finger-metacarpal":case"index-finger-phalanx-proximal":case"index-finger-phalanx-intermediate":case"index-finger-phalanx-distal":case"index-finger-tip":case"middle-finger-metacarpal":case"middle-finger-phalanx-proximal":case"middle-finger-phalanx-intermediate":case"middle-finger-phalanx-distal":case"middle-finger-tip":case"ring-finger-metacarpal":case"ring-finger-phalanx-proximal":case"ring-finger-phalanx-intermediate":case"ring-finger-phalanx-distal":case"ring-finger-tip":case"pinky-finger-metacarpal":case"pinky-finger-phalanx-proximal":case"pinky-finger-phalanx-intermediate":case"pinky-finger-phalanx-distal":case"pinky-finger-tip":return $("hand").inputSource.hand.get(s);case"root":case"hips":case"spine-lower":case"spine-middle":case"spine-upper":case"chest":case"neck":case"head":case"left-shoulder":case"left-scapula":case"left-arm-upper":case"left-arm-lower":case"left-hand-wrist-twist":case"right-shoulder":case"right-scapula":case"right-arm-upper":case"right-arm-lower":case"right-hand-wrist-twist":case"left-hand-palm":case"left-hand-wrist":case"left-hand-thumb-metacarpal":case"left-hand-thumb-phalanx-proximal":case"left-hand-thumb-phalanx-distal":case"left-hand-thumb-tip":case"left-hand-index-metacarpal":case"left-hand-index-phalanx-proximal":case"left-hand-index-phalanx-intermediate":case"left-hand-index-phalanx-distal":case"left-hand-index-tip":case"left-hand-middle-metacarpal":case"left-hand-middle-phalanx-proximal":case"left-hand-middle-phalanx-intermediate":case"left-hand-middle-phalanx-distal":case"left-hand-middle-tip":case"left-hand-ring-metacarpal":case"left-hand-ring-phalanx-proximal":case"left-hand-ring-phalanx-intermediate":case"left-hand-ring-phalanx-distal":case"left-hand-ring-tip":case"left-hand-little-metacarpal":case"left-hand-little-phalanx-proximal":case"left-hand-little-phalanx-intermediate":case"left-hand-little-phalanx-distal":case"left-hand-little-tip":case"right-hand-palm":case"right-hand-wrist":case"right-hand-thumb-metacarpal":case"right-hand-thumb-phalanx-proximal":case"right-hand-thumb-phalanx-distal":case"right-hand-thumb-tip":case"right-hand-index-metacarpal":case"right-hand-index-phalanx-proximal":case"right-hand-index-phalanx-intermediate":case"right-hand-index-phalanx-distal":case"right-hand-index-tip":case"right-hand-middle-metacarpal":case"right-hand-middle-phalanx-proximal":case"right-hand-middle-phalanx-intermediate":case"right-hand-middle-phalanx-distal":case"right-hand-middle-tip":case"right-hand-ring-metacarpal":case"right-hand-ring-phalanx-proximal":case"right-hand-ring-phalanx-intermediate":case"right-hand-ring-phalanx-distal":case"right-hand-ring-tip":case"right-hand-little-metacarpal":case"right-hand-little-phalanx-proximal":case"right-hand-little-phalanx-intermediate":case"right-hand-little-phalanx-distal":case"right-hand-little-tip":case"left-upper-leg":case"left-lower-leg":case"left-foot-ankle-twist":case"left-foot-ankle":case"left-foot-subtalar":case"left-foot-transverse":case"left-foot-ball":case"right-upper-leg":case"right-lower-leg":case"right-foot-ankle-twist":case"right-foot-ankle":case"right-foot-subtalar":case"right-foot-transverse":case"right-foot-ball":return(r=I(i=>i.body))==null?void 0:r.get(s)}if(s==null){const i=h.useContext(be);if(i==null)throw new Error("XR objects must be placed inside the XROrigin");return i}const[e,t]=h.useState(void 0),n=I(i=>i.session);return h.useEffect(()=>{if(n==null)return;let i=!1;return n.requestReferenceSpace(s).then(o=>{i||t(o)}),()=>void(i=!0)},[n,s]),e}function Xo(s){const e=h.useContext(be),t=I(n=>e??n.originReferenceSpace);return h.useMemo(()=>s==null||t==null?void 0:ni(s,t),[s,t])}function Go(s,e,t){const n=Xo(e);A((r,i,o)=>{s.current!=null&&(s.current.visible=s.current.transformReady=(n==null?void 0:n(s.current.matrix,o))??!1)},-100)}h.forwardRef(({mesh:s,...e},t)=>{const n=Bo(s);return d.jsx("mesh",{ref:t,geometry:n,...e})});function Bo(s,e=!0){const[t,n]=h.useState(an(s,void 0));return A(()=>n(r=>an(s,r))),h.useEffect(()=>{if(e)return()=>t.dispose()},[t]),t}h.forwardRef(({plane:s,...e},t)=>{const n=Uo(s);return d.jsx("mesh",{ref:t,geometry:n,...e})});function Uo(s,e=!0){const[t,n]=h.useState(cn(s,void 0));return A(()=>n(r=>cn(s,r))),h.useEffect(()=>{if(e)return()=>t.dispose()},[t]),t}h.forwardRef(({children:s,disabled:e,...t},n)=>{const r=we(a=>a.gl.xr.getCamera()),i=h.useRef(null),o=I(a=>a.originReferenceSpace);return h.useImperativeHandle(n,()=>i.current,[]),h.useEffect(()=>{const a=i.current;if(!(a==null||e))return a.add(r),()=>void a.remove(r)},[e,r]),d.jsx("group",{ref:i,...t,children:d.jsx(be.Provider,{value:o,children:s})})});function zo(s,e,t){const n=h.useRef(void 0);Vo(e,t,h.useCallback(r=>n.current=r,[])),A((r,i,o)=>{s==null||o==null||n.current==null||s(o.getHitTestResults(n.current.source),n.current.getWorldMatrix)})}function Vo(s,e,t){const n=Ve(),r=Et(n,i=>i.session);h.useEffect(()=>{if(r==null)return;let i,o=!1;const a=s instanceof XRSpace||typeof s=="string"?s:s==null?void 0:s.current;if(a!=null)return ro(n,r,a,e).then(c=>{o||(i=c,t(c))}),()=>{t(void 0),o=!0,i==null||i.source.cancel()}},[r,n,s,e,t])}h.forwardRef(({trackableType:s,onResults:e,space:t,...n},r)=>{const i=h.useRef(null);return h.useImperativeHandle(r,()=>i.current),zo(e,t??i,s),d.jsx("group",{...n,ref:i})});h.forwardRef((s,e)=>{const t=I(i=>i.domOverlayRoot),{In:n,Out:r}=h.useMemo(fr,[]);return h.useEffect(()=>{if(t==null)return;const i=dr.createRoot(t);return i.render(d.jsx(r,{})),()=>i.unmount()},[t,r]),d.jsx(n,{children:d.jsx("div",{...s,ref:e})})});h.forwardRef(({src:s,shape:e,colorFormat:t,depthFormat:n,layout:r,mipLevels:i,renderOrder:o=0,blendTextureSourceAlpha:a,centralAngle:c,centralHorizontalAngle:l,chromaticAberrationCorrection:u,lowerVerticalAngle:f,quality:p,upperVerticalAngle:m,invertStereo:w,pixelWidth:S,pixelHeight:x,dpr:T,renderTargetRef:M,layerEntryRef:P,...b},F)=>{const C=h.useRef(null),N=we(q=>q.gl),O=Ve(),k={blendTextureSourceAlpha:a,centralAngle:c,centralHorizontalAngle:l,chromaticAberrationCorrection:u,lowerVerticalAngle:f,quality:p,upperVerticalAngle:m},W=h.useRef(k);W.current=k;const vt=h.useRef(o);vt.current=o;const Ke=I(q=>q.originReferenceSpace);return h.useEffect(()=>{if(C.current==null||Ke==null)return;const q=s??(M.current=Kn(S,x,T)),le=Ui(q,O.getState(),Ke,N.xr,C.current,{colorFormat:t,depthFormat:n,invertStereo:w,layout:r,mipLevels:i,shape:e},W.current);if(le==null)return;const We=P.current={layer:le,renderOrder:vt.current,object3D:C.current};if(O.addLayerEntry(We),q instanceof HTMLVideoElement||q instanceof Re)return()=>{O.removeLayerEntry(We),le.destroy()};const er=Ki(N,O,le,q);return()=>{O.removeLayerEntry(We),er(),le.destroy()}},[Ke,t,n,w,P,r,i,x,S,T,M,N,e,s,O]),P.current!=null&&(P.current.renderOrder=o),P.current!=null&&Pt(P.current.layer,W.current),A(()=>{P.current==null||C.current==null||Qi(O.getState(),P.current.layer,W.current.centralAngle,C.current)}),h.useImperativeHandle(F,()=>C.current,[]),d.jsx("mesh",{...b,renderOrder:-1/0,ref:C,children:d.jsx("meshBasicMaterial",{colorWrite:!1})})});h.forwardRef(({src:s,renderTargetRef:e,dpr:t,renderOrder:n,pixelWidth:r,pixelHeight:i,...o},a)=>{const c=h.useRef(null);return h.useEffect(()=>{if(c.current==null)return;const l=s??(e.current=Kn(r,i,t)),u=Wi(l);return c.current.map=u,c.current.needsUpdate=!0,()=>{if(l instanceof Re){l.dispose();return}u.dispose()}},[s,r,i,t,e]),d.jsx("mesh",{ref:a,...o,children:d.jsx("meshBasicMaterial",{ref:c,toneMapped:!1})})});new In;new In;const Jn=h.forwardRef(({store:s,mode:e,onError:t,children:n,...r},i)=>{const o=Et(s,c=>c.session),a=vo(e,t);return d.jsx("button",{ref:i,...r,onClick:()=>o!=null?o.end():s.enterXR(e).catch(t),children:typeof n=="function"?n(a?o!=null?"entered":"exited":"unsupported"):n})}),Ko=h.forwardRef((s,e)=>d.jsx(Jn,{ref:e,mode:"immersive-ar",...s}));h.forwardRef((s,e)=>d.jsx(Jn,{ref:e,mode:"immersive-vr",...s}));const Wo={onBlur:"pointerleave",onHover:"pointerenter",onMove:"pointermove",onSelect:{type:"click",filter:s=>s.pointerType==="ray"},onSelectEnd:{type:"pointerup",filter:s=>s.pointerType==="ray"},onSelectStart:{type:"pointerdown",filter:s=>s.pointerType==="ray"},onSqueeze:{type:"click",filter:s=>s.pointerType==="grab"},onSqueezeEnd:{type:"pointerup",filter:s=>s.pointerType==="grab"},onSqueezeStart:{type:"pointerdown",filter:s=>s.pointerType==="grab"}};function U(s,e,t){const n=h.useRef(t);n.current=t,h.useEffect(()=>{const{current:r}=s;if(r==null)return;const i=Wo[e],o=typeof i=="string"?c=>{var l;return(l=n.current)==null?void 0:l.call(n,{intersection:c,intersections:[c],target:c.pointerState})}:c=>{var l;c instanceof L&&!i.filter(c)||(l=n.current)==null||l.call(n,{intersection:c,intersections:[c],target:c.pointerState})},a=typeof i=="string"?i:i.type;return r.addEventListener(a,o),()=>r.removeEventListener(a,o)},[s,e])}const qo=h.forwardRef(({onHover:s,onBlur:e,onSelectStart:t,onSelectEnd:n,onSelect:r,onSqueezeStart:i,onSqueezeEnd:o,onSqueeze:a,onMove:c,children:l},u)=>{const f=h.useRef(null);return h.useImperativeHandle(u,()=>f.current),U(f,"onHover",s),U(f,"onBlur",e),U(f,"onSelectStart",t),U(f,"onSelectEnd",n),U(f,"onSelect",r),U(f,"onSqueezeStart",i),U(f,"onSqueezeEnd",o),U(f,"onSqueeze",a),U(f,"onMove",c),d.jsx("group",{ref:f,children:l})});h.forwardRef(function({onSelectStart:e,onSelectEnd:t,children:n,...r},i){const o=h.useRef(void 0),a=h.useRef(null),c=h.useMemo(()=>new v,[]);return h.useImperativeHandle(i,()=>a.current),A(()=>{const l=o.current,u=a.current;!u||!l||(u.applyMatrix4(c),l.updateWorldMatrix(!0,!1),u.applyMatrix4(l.matrixWorld),u.updateMatrixWorld(),c.copy(l.matrixWorld).invert())}),d.jsx(qo,{ref:a,onSelectStart:l=>{Ks(l.target)&&(l.target.type==="controller"||l.target.type==="hand")&&l.target.object!=null&&(o.current=l.target.object,l.target.object.updateWorldMatrix(!0,!1),c.copy(l.target.object.matrixWorld).invert(),e==null||e(l))},onSelectEnd:l=>{l.target.controller===o.current&&(o.current=void 0),t==null||t(l)},...r,children:n})});const Qo="_container_zg7k3_1",$o="_header_zg7k3_8",Yo="_arButton_zg7k3_30",Zo="_controls_zg7k3_51",Jo="_scaleControl_zg7k3_69",ea="_instructions_zg7k3_92",ta="_error_zg7k3_104",na="_notSupported_zg7k3_105",ra="_loading_zg7k3_106",_={container:Qo,header:$o,arButton:Yo,controls:Zo,scaleControl:Jo,instructions:ea,error:ta,notSupported:na,loading:ra},sa=()=>{const[s]=An(),[e,t]=h.useState(null),[n,r]=h.useState(null),[i,o]=h.useState(.1);if(h.useEffect(()=>{const u=s.get("id");if(u)try{const f=localStorage.getItem(`ar_data_${u}`);f?t(JSON.parse(f)):r("AR    .")}catch{r("AR     .")}else r("AR ID  .")},[s]),n)return d.jsx("div",{className:_.container,children:d.jsxs("div",{className:_.error,children:[d.jsx("h2",{children:""}),d.jsx("p",{children:n})]})});if(!e)return d.jsx("div",{className:_.container,children:d.jsx("div",{className:_.loading,children:d.jsx("p",{children:"AR   ..."})})});const{spaceInfo:a,placedModules:c}=e,l=u=>u*.01;return d.jsxs("div",{className:_.container,children:[d.jsxs("div",{className:_.header,children:[d.jsx("h1",{children:"3D  (AR )"}),d.jsx("p",{children:"HTTPS  AR  3D    "})]}),d.jsxs(mn,{style:{background:"#f0f0f0"},children:[d.jsx(hr,{makeDefault:!0,position:[20,20,20]}),d.jsx(pr,{enablePan:!0,enableZoom:!0,enableRotate:!0}),d.jsx("ambientLight",{intensity:.5}),d.jsx("directionalLight",{position:[10,10,5],intensity:.8,castShadow:!0}),d.jsx(mr,{args:[30,30],cellSize:1,cellThickness:.5,cellColor:"#6f6f6f",sectionSize:5,sectionThickness:1.5,sectionColor:"#9d9d9d",fadeDistance:50,fadeStrength:1,followCamera:!1}),d.jsxs("group",{scale:[i,i,i],children:[d.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.01,0],receiveShadow:!0,children:[d.jsx("planeGeometry",{args:[l(a.width),l(a.depth||1500)]}),d.jsx("meshStandardMaterial",{color:"#ffffff",opacity:.8,transparent:!0})]}),c.map(u=>{const f=_n(u.moduleId,{width:a.width,height:a.height,depth:a.depth||1500},a);return f?d.jsx(En,{moduleData:f,position:u.position,rotation:u.rotation,isSelected:!1,isHovered:!1,isDragging:!1,hasDoor:u.hasDoor,hingePosition:u.hingePosition},u.id):null})]})]}),d.jsxs("div",{className:_.controls,children:[d.jsx("h3",{children:" "}),d.jsx("div",{className:_.scaleControl,children:d.jsxs("label",{children:[" : ",(i*100).toFixed(0),"%",d.jsx("input",{type:"range",min:"1",max:"100",value:i*100,onChange:u=>o(Number(u.target.value)/100)})]})}),d.jsxs("div",{className:_.info,children:[d.jsx("p",{children:" ,  /"}),d.jsxs("p",{children:[": ",a.width," x ",a.height," x ",a.depth||1500," mm"]}),d.jsxs("p",{children:[": ",c.length,""]})]})]})]})},ia=({data:s,position:e,scale:t})=>{const{spaceInfo:n,placedModules:r}=s,i=o=>o*.01;return d.jsxs("group",{position:e,scale:[t,t,t],children:[d.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.01,0],children:[d.jsx("planeGeometry",{args:[i(n.width)*t,i(n.depth)*t]}),d.jsx("meshBasicMaterial",{color:"#f0f0f0",opacity:.3,transparent:!0})]}),r.map(o=>{var c;const a=_n(o.moduleId,{width:n.width,height:n.height},n);return a?d.jsx("group",{position:[o.position.x*t,o.position.y*t,o.position.z*t],rotation:[0,o.rotation*Math.PI/180,0],children:d.jsx(En,{moduleData:a,spaceInfo:n,color:(c=n.materialConfig)==null?void 0:c.interiorColor,hasDoor:o.hasDoor,customDepth:o.customDepth,hingePosition:o.hingePosition,originalSlotWidth:o.adjustedWidth,viewMode:"3D",renderMode:"solid"})},o.id):null})]})},oa=({data:s})=>{const[e,t]=h.useState(!1),[n,r]=h.useState(new y),[i,o]=h.useState(.5),a=()=>{t(!0)};return d.jsxs(d.Fragment,{children:[d.jsx(ia,{data:s,position:n,scale:i}),!e&&d.jsxs("mesh",{position:n,onPointerDown:a,children:[d.jsx("boxGeometry",{args:[.1,.1,.1]}),d.jsx("meshBasicMaterial",{color:"green",opacity:.5,transparent:!0})]})]})},pa=()=>{const[s]=An(),[e,t]=h.useState(null),[n,r]=h.useState(""),[i,o]=h.useState(!1),[a,c]=h.useState(.5);return h.useEffect(()=>{window.location.protocol==="https:"&&"xr"in navigator?navigator.xr.isSessionSupported("immersive-ar").then(f=>{o(f)}):o(!1);const u=s.get("id");if(u)try{const f=localStorage.getItem(`ar_data_${u}`);if(f){const p=JSON.parse(f);t(p)}else r("AR    .")}catch{r("AR     .")}else r("  AR .")},[s]),n?d.jsxs("div",{className:_.error,children:[d.jsx("h2",{children:""}),d.jsx("p",{children:n})]}):i?e?d.jsxs("div",{className:_.container,children:[d.jsx(Ko,{className:_.arButton,sessionInit:{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","dom-overlay-for-handheld-ar"],domOverlay:{root:document.body}}}),d.jsx(mn,{children:d.jsx(Ho,{referenceSpace:"local",children:d.jsxs(h.Suspense,{fallback:null,children:[d.jsx("ambientLight",{intensity:.5}),d.jsx("directionalLight",{position:[10,10,5],intensity:1}),d.jsx(oa,{data:e})]})})}),d.jsxs("div",{className:_.controls,children:[d.jsx("h3",{children:"  "}),d.jsxs("div",{className:_.scaleControl,children:[d.jsx("label",{children:" "}),d.jsx("input",{type:"range",min:"0.1",max:"2",step:"0.1",value:a,onChange:l=>c(parseFloat(l.target.value))}),d.jsxs("span",{children:[(a*100).toFixed(0),"%"]})]}),d.jsx("div",{className:_.instructions,children:d.jsx("p",{children:"     "})})]})]}):d.jsx("div",{className:_.loading,children:d.jsx("p",{children:"AR   ..."})}):window.location.protocol==="https:"?d.jsxs("div",{className:_.notSupported,children:[d.jsx("h2",{children:"AR  "}),d.jsx("p",{children:"    WebXR AR  ."}),d.jsxs("ul",{children:[d.jsx("li",{children:"iOS: Safari "}),d.jsx("li",{children:"Android: Chrome "}),d.jsx("li",{children:"HTTPS  "})]})]}):d.jsx(sa,{})};export{pa as default};
