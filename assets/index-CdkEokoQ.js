var O1=Object.defineProperty;var V1=(t,e,n)=>e in t?O1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var yc=(t,e,n)=>V1(t,typeof e!="symbol"?e+"":e,n);import{r as M,j as c,p as B1,u as Sh,C as U1,O as $1,P as H1,a as W1,e as et,b as X1,d as G1,B as z1,E as Y1,L as H,T as Ke,R as q1}from"./three-fiber-gElx9mfP.js";import{c as _o}from"./store-IPzLMAa1.js";import{u as Il,a as bm,b as Cm,B as K1,R as Q1,c as hs,N as Zo}from"./router-DyTV7ai8.js";import{k as J1,M as vc,w as Dm,Y as Z1,V as ev,A as tv,c as nv,e as it,a6 as Ut,a7 as Vf,Z as sv,a8 as iv,a9 as Pm,aa as rv,ab as Qt,$ as vn,K as vu,ac as ov,t as Bf,h as av,R as lv,ad as Rm,ae as ai,a1 as bh,T as cv,a0 as uv,g as zt,af as hv}from"./three-core-CV1u6Hpc.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const dv=()=>{};var Uf={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nm=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++s)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},fv=function(t){const e=[];let n=0,s=0;for(;n<t.length;){const i=t[n++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=t[n++];e[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=t[n++],o=t[n++],a=t[n++],u=((i&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(u>>10)),e[s++]=String.fromCharCode(56320+(u&1023))}else{const r=t[n++],o=t[n++];e[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|o&63)}}return e.join("")},Mm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<t.length;i+=3){const r=t[i],o=i+1<t.length,a=o?t[i+1]:0,u=i+2<t.length,h=u?t[i+2]:0,d=r>>2,p=(r&3)<<4|a>>4;let m=(a&15)<<2|h>>6,y=h&63;u||(y=64,o||(m=64)),s.push(n[d],n[p],n[m],n[y])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Nm(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):fv(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<t.length;){const r=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;const h=i<t.length?n[t.charAt(i)]:64;++i;const p=i<t.length?n[t.charAt(i)]:64;if(++i,r==null||a==null||h==null||p==null)throw new pv;const m=r<<2|a>>4;if(s.push(m),h!==64){const y=a<<4&240|h>>2;if(s.push(y),p!==64){const v=h<<6&192|p;s.push(v)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class pv extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const gv=function(t){const e=Nm(t);return Mm.encodeByteArray(e,!0)},$a=function(t){return gv(t).replace(/\./g,"")},jm=function(t){try{return Mm.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mv(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _v=()=>mv().__FIREBASE_DEFAULTS__,yv=()=>{if(typeof process>"u"||typeof Uf>"u")return;const t=Uf.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},vv=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&jm(t[1]);return e&&JSON.parse(e)},Sl=()=>{try{return dv()||_v()||yv()||vv()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Lm=t=>{var e,n;return(n=(e=Sl())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},wv=t=>{const e=Lm(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),s]:[e.substring(0,n),s]},km=()=>{var t;return(t=Sl())===null||t===void 0?void 0:t.config},Fm=t=>{var e;return(e=Sl())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tv{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,s)=>{n?this.reject(n):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hi(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Om(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ev(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},s=e||"demo-project",i=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[$a(JSON.stringify(n)),$a(JSON.stringify(o)),""].join(".")}const Or={};function Av(){const t={prod:[],emulator:[]};for(const e of Object.keys(Or))Or[e]?t.emulator.push(e):t.prod.push(e);return t}function xv(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let $f=!1;function Vm(t,e){if(typeof window>"u"||typeof document>"u"||!Hi(window.location.host)||Or[t]===e||Or[t]||$f)return;Or[t]=e;function n(m){return`__firebase__banner__${m}`}const s="__firebase__banner",r=Av().prod.length>0;function o(){const m=document.getElementById(s);m&&m.remove()}function a(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function u(m,y){m.setAttribute("width","24"),m.setAttribute("id",y),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function h(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{$f=!0,o()},m}function d(m,y){m.setAttribute("id",y),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function p(){const m=xv(s),y=n("text"),v=document.getElementById(y)||document.createElement("span"),w=n("learnmore"),E=document.getElementById(w)||document.createElement("a"),C=n("preprendIcon"),A=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const R=m.element;a(R),d(E,w);const N=h();u(A,C),R.append(A,v,E,N),document.body.appendChild(R)}r?(v.innerText="Preview backend disconnected.",A.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(A.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,v.innerText="Preview backend running in this workspace."),v.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Iv(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Dt())}function Sv(){var t;const e=(t=Sl())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function bv(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Cv(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Dv(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Pv(){const t=Dt();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Rv(){return!Sv()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Nv(){try{return typeof indexedDB=="object"}catch{return!1}}function Mv(){return new Promise((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var r;e(((r=i.error)===null||r===void 0?void 0:r.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jv="FirebaseError";class ss extends Error{constructor(e,n,s){super(n),this.code=e,this.customData=s,this.name=jv,Object.setPrototypeOf(this,ss.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,yo.prototype.create)}}class yo{constructor(e,n,s){this.service=e,this.serviceName=n,this.errors=s}create(e,...n){const s=n[0]||{},i=`${this.service}/${e}`,r=this.errors[e],o=r?Lv(r,s):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new ss(i,a,s)}}function Lv(t,e){return t.replace(kv,(n,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const kv=/\{\$([^}]+)}/g;function Fv(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function ei(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const i of n){if(!s.includes(i))return!1;const r=t[i],o=e[i];if(Hf(r)&&Hf(o)){if(!ei(r,o))return!1}else if(r!==o)return!1}for(const i of s)if(!n.includes(i))return!1;return!0}function Hf(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vo(t){const e=[];for(const[n,s]of Object.entries(t))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Dr(t){const e={};return t.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[i,r]=s.split("=");e[decodeURIComponent(i)]=decodeURIComponent(r)}}),e}function Pr(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function Ov(t,e){const n=new Vv(t,e);return n.subscribe.bind(n)}class Vv{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,s){let i;if(e===void 0&&n===void 0&&s===void 0)throw new Error("Missing Observer.");Bv(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:s},i.next===void 0&&(i.next=wc),i.error===void 0&&(i.error=wc),i.complete===void 0&&(i.complete=wc);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Bv(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function wc(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dt(t){return t&&t._delegate?t._delegate:t}class ti{constructor(e,n,s){this.name=e,this.instanceFactory=n,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qs="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uv{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const s=new Tv;if(this.instancesDeferred.set(n,s),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Hv(e))try{this.getOrInitializeService({instanceIdentifier:qs})}catch{}for(const[n,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(e=qs){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=qs){return this.instances.has(e)}getOptions(e=qs){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:n});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);s===a&&o.resolve(i)}return i}onInit(e,n){var s;const i=this.normalizeInstanceIdentifier(n),r=(s=this.onInitCallbacks.get(i))!==null&&s!==void 0?s:new Set;r.add(e),this.onInitCallbacks.set(i,r);const o=this.instances.get(i);return o&&e(o,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,n){const s=this.onInitCallbacks.get(n);if(s)for(const i of s)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:$v(e),options:n}),this.instances.set(e,s),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=qs){return this.component?this.component.multipleInstances?e:qs:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function $v(t){return t===qs?void 0:t}function Hv(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wv{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new Uv(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ie;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Ie||(Ie={}));const Xv={debug:Ie.DEBUG,verbose:Ie.VERBOSE,info:Ie.INFO,warn:Ie.WARN,error:Ie.ERROR,silent:Ie.SILENT},Gv=Ie.INFO,zv={[Ie.DEBUG]:"log",[Ie.VERBOSE]:"log",[Ie.INFO]:"info",[Ie.WARN]:"warn",[Ie.ERROR]:"error"},Yv=(t,e,...n)=>{if(e<t.logLevel)return;const s=new Date().toISOString(),i=zv[e];if(i)console[i](`[${s}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ch{constructor(e){this.name=e,this._logLevel=Gv,this._logHandler=Yv,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ie))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Xv[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ie.DEBUG,...e),this._logHandler(this,Ie.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ie.VERBOSE,...e),this._logHandler(this,Ie.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ie.INFO,...e),this._logHandler(this,Ie.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ie.WARN,...e),this._logHandler(this,Ie.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ie.ERROR,...e),this._logHandler(this,Ie.ERROR,...e)}}const qv=(t,e)=>e.some(n=>t instanceof n);let Wf,Xf;function Kv(){return Wf||(Wf=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Qv(){return Xf||(Xf=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Bm=new WeakMap,wu=new WeakMap,Um=new WeakMap,Tc=new WeakMap,Dh=new WeakMap;function Jv(t){const e=new Promise((n,s)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",o)},r=()=>{n(Ts(t.result)),i()},o=()=>{s(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&Bm.set(n,t)}).catch(()=>{}),Dh.set(e,t),e}function Zv(t){if(wu.has(t))return;const e=new Promise((n,s)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",o),t.removeEventListener("abort",o)},r=()=>{n(),i()},o=()=>{s(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",o),t.addEventListener("abort",o)});wu.set(t,e)}let Tu={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return wu.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Um.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ts(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function e2(t){Tu=t(Tu)}function t2(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const s=t.call(Ec(this),e,...n);return Um.set(s,e.sort?e.sort():[e]),Ts(s)}:Qv().includes(t)?function(...e){return t.apply(Ec(this),e),Ts(Bm.get(this))}:function(...e){return Ts(t.apply(Ec(this),e))}}function n2(t){return typeof t=="function"?t2(t):(t instanceof IDBTransaction&&Zv(t),qv(t,Kv())?new Proxy(t,Tu):t)}function Ts(t){if(t instanceof IDBRequest)return Jv(t);if(Tc.has(t))return Tc.get(t);const e=n2(t);return e!==t&&(Tc.set(t,e),Dh.set(e,t)),e}const Ec=t=>Dh.get(t);function s2(t,e,{blocked:n,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(t,e),a=Ts(o);return s&&o.addEventListener("upgradeneeded",u=>{s(Ts(o.result),u.oldVersion,u.newVersion,Ts(o.transaction),u)}),n&&o.addEventListener("blocked",u=>n(u.oldVersion,u.newVersion,u)),a.then(u=>{r&&u.addEventListener("close",()=>r()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),a}const i2=["get","getKey","getAll","getAllKeys","count"],r2=["put","add","delete","clear"],Ac=new Map;function Gf(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Ac.get(e))return Ac.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,i=r2.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(i||i2.includes(n)))return;const r=async function(o,...a){const u=this.transaction(o,i?"readwrite":"readonly");let h=u.store;return s&&(h=h.index(a.shift())),(await Promise.all([h[n](...a),i&&u.done]))[0]};return Ac.set(e,r),r}e2(t=>({...t,get:(e,n,s)=>Gf(e,n)||t.get(e,n,s),has:(e,n)=>!!Gf(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o2{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(a2(n)){const s=n.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(n=>n).join(" ")}}function a2(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Eu="@firebase/app",zf="0.13.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kn=new Ch("@firebase/app"),l2="@firebase/app-compat",c2="@firebase/analytics-compat",u2="@firebase/analytics",h2="@firebase/app-check-compat",d2="@firebase/app-check",f2="@firebase/auth",p2="@firebase/auth-compat",g2="@firebase/database",m2="@firebase/data-connect",_2="@firebase/database-compat",y2="@firebase/functions",v2="@firebase/functions-compat",w2="@firebase/installations",T2="@firebase/installations-compat",E2="@firebase/messaging",A2="@firebase/messaging-compat",x2="@firebase/performance",I2="@firebase/performance-compat",S2="@firebase/remote-config",b2="@firebase/remote-config-compat",C2="@firebase/storage",D2="@firebase/storage-compat",P2="@firebase/firestore",R2="@firebase/ai",N2="@firebase/firestore-compat",M2="firebase",j2="11.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Au="[DEFAULT]",L2={[Eu]:"fire-core",[l2]:"fire-core-compat",[u2]:"fire-analytics",[c2]:"fire-analytics-compat",[d2]:"fire-app-check",[h2]:"fire-app-check-compat",[f2]:"fire-auth",[p2]:"fire-auth-compat",[g2]:"fire-rtdb",[m2]:"fire-data-connect",[_2]:"fire-rtdb-compat",[y2]:"fire-fn",[v2]:"fire-fn-compat",[w2]:"fire-iid",[T2]:"fire-iid-compat",[E2]:"fire-fcm",[A2]:"fire-fcm-compat",[x2]:"fire-perf",[I2]:"fire-perf-compat",[S2]:"fire-rc",[b2]:"fire-rc-compat",[C2]:"fire-gcs",[D2]:"fire-gcs-compat",[P2]:"fire-fst",[N2]:"fire-fst-compat",[R2]:"fire-vertex","fire-js":"fire-js",[M2]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ha=new Map,k2=new Map,xu=new Map;function Yf(t,e){try{t.container.addComponent(e)}catch(n){Kn.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function ji(t){const e=t.name;if(xu.has(e))return Kn.debug(`There were multiple attempts to register component ${e}.`),!1;xu.set(e,t);for(const n of Ha.values())Yf(n,t);for(const n of k2.values())Yf(n,t);return!0}function Ph(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function $t(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F2={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Es=new yo("app","Firebase",F2);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O2{constructor(e,n,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new ti("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Es.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wi=j2;function $m(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const s=Object.assign({name:Au,automaticDataCollectionEnabled:!0},e),i=s.name;if(typeof i!="string"||!i)throw Es.create("bad-app-name",{appName:String(i)});if(n||(n=km()),!n)throw Es.create("no-options");const r=Ha.get(i);if(r){if(ei(n,r.options)&&ei(s,r.config))return r;throw Es.create("duplicate-app",{appName:i})}const o=new Wv(i);for(const u of xu.values())o.addComponent(u);const a=new O2(n,s,o);return Ha.set(i,a),a}function Hm(t=Au){const e=Ha.get(t);if(!e&&t===Au&&km())return $m();if(!e)throw Es.create("no-app",{appName:t});return e}function As(t,e,n){var s;let i=(s=L2[t])!==null&&s!==void 0?s:t;n&&(i+=`-${n}`);const r=i.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const a=[`Unable to register library "${i}" with version "${e}":`];r&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Kn.warn(a.join(" "));return}ji(new ti(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V2="firebase-heartbeat-database",B2=1,Jr="firebase-heartbeat-store";let xc=null;function Wm(){return xc||(xc=s2(V2,B2,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Jr)}catch(n){console.warn(n)}}}}).catch(t=>{throw Es.create("idb-open",{originalErrorMessage:t.message})})),xc}async function U2(t){try{const n=(await Wm()).transaction(Jr),s=await n.objectStore(Jr).get(Xm(t));return await n.done,s}catch(e){if(e instanceof ss)Kn.warn(e.message);else{const n=Es.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Kn.warn(n.message)}}}async function qf(t,e){try{const s=(await Wm()).transaction(Jr,"readwrite");await s.objectStore(Jr).put(e,Xm(t)),await s.done}catch(n){if(n instanceof ss)Kn.warn(n.message);else{const s=Es.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Kn.warn(s.message)}}}function Xm(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $2=1024,H2=30;class W2{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new G2(n),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Kf();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:i}),this._heartbeatsCache.heartbeats.length>H2){const o=z2(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){Kn.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Kf(),{heartbeatsToSend:s,unsentEntries:i}=X2(this._heartbeatsCache.heartbeats),r=$a(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(n){return Kn.warn(n),""}}}function Kf(){return new Date().toISOString().substring(0,10)}function X2(t,e=$2){const n=[];let s=t.slice();for(const i of t){const r=n.find(o=>o.agent===i.agent);if(r){if(r.dates.push(i.date),Qf(n)>e){r.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Qf(n)>e){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}class G2{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Nv()?Mv().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await U2(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return qf(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return qf(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Qf(t){return $a(JSON.stringify({version:2,heartbeats:t})).length}function z2(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let s=1;s<t.length;s++)t[s].date<n&&(n=t[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y2(t){ji(new ti("platform-logger",e=>new o2(e),"PRIVATE")),ji(new ti("heartbeat",e=>new W2(e),"PRIVATE")),As(Eu,zf,t),As(Eu,zf,"esm2017"),As("fire-js","")}Y2("");function Rh(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(t);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(t,s[i])&&(n[s[i]]=t[s[i]]);return n}function Gm(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const q2=Gm,zm=new yo("auth","Firebase",Gm());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wa=new Ch("@firebase/auth");function K2(t,...e){Wa.logLevel<=Ie.WARN&&Wa.warn(`Auth (${Wi}): ${t}`,...e)}function Da(t,...e){Wa.logLevel<=Ie.ERROR&&Wa.error(`Auth (${Wi}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nn(t,...e){throw Mh(t,...e)}function un(t,...e){return Mh(t,...e)}function Nh(t,e,n){const s=Object.assign(Object.assign({},q2()),{[e]:n});return new yo("auth","Firebase",s).create(e,{appName:t.name})}function Yn(t){return Nh(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Q2(t,e,n){const s=n;if(!(e instanceof s))throw s.name!==e.constructor.name&&nn(t,"argument-error"),Nh(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Mh(t,...e){if(typeof t!="string"){const n=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=t.name),t._errorFactory.create(n,...s)}return zm.create(t,...e)}function oe(t,e,...n){if(!t)throw Mh(e,...n)}function Gn(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Da(e),new Error(e)}function Qn(t,e){t||Gn(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iu(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function J2(){return Jf()==="http:"||Jf()==="https:"}function Jf(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z2(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(J2()||Cv()||"connection"in navigator)?navigator.onLine:!0}function ew(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wo{constructor(e,n){this.shortDelay=e,this.longDelay=n,Qn(n>e,"Short delay should be less than long delay!"),this.isMobile=Iv()||Dv()}get(){return Z2()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jh(t,e){Qn(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym{static initialize(e,n,s){this.fetchImpl=e,n&&(this.headersImpl=n),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Gn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Gn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Gn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tw={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nw=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],sw=new wo(3e4,6e4);function Ls(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function is(t,e,n,s,i={}){return qm(t,i,async()=>{let r={},o={};s&&(e==="GET"?o=s:r={body:JSON.stringify(s)});const a=vo(Object.assign({key:t.config.apiKey},o)).slice(1),u=await t._getAdditionalHeaders();u["Content-Type"]="application/json",t.languageCode&&(u["X-Firebase-Locale"]=t.languageCode);const h=Object.assign({method:e,headers:u},r);return bv()||(h.referrerPolicy="no-referrer"),t.emulatorConfig&&Hi(t.emulatorConfig.host)&&(h.credentials="include"),Ym.fetch()(await Km(t,t.config.apiHost,n,a),h)})}async function qm(t,e,n){t._canInitEmulator=!1;const s=Object.assign(Object.assign({},tw),e);try{const i=new rw(t),r=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw ea(t,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const a=r.ok?o.errorMessage:o.error.message,[u,h]=a.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw ea(t,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw ea(t,"email-already-in-use",o);if(u==="USER_DISABLED")throw ea(t,"user-disabled",o);const d=s[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Nh(t,d,h);nn(t,d)}}catch(i){if(i instanceof ss)throw i;nn(t,"network-request-failed",{message:String(i)})}}async function To(t,e,n,s,i={}){const r=await is(t,e,n,s,i);return"mfaPendingCredential"in r&&nn(t,"multi-factor-auth-required",{_serverResponse:r}),r}async function Km(t,e,n,s){const i=`${e}${n}?${s}`,r=t,o=r.config.emulator?jh(t.config,i):`${t.config.apiScheme}://${i}`;return nw.includes(n)&&(await r._persistenceManagerAvailable,r._getPersistenceType()==="COOKIE")?r._getPersistence()._getFinalTarget(o).toString():o}function iw(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class rw{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,s)=>{this.timer=setTimeout(()=>s(un(this.auth,"network-request-failed")),sw.get())})}}function ea(t,e,n){const s={appName:t.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const i=un(t,e,s);return i.customData._tokenResponse=n,i}function Zf(t){return t!==void 0&&t.enterprise!==void 0}class ow{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return iw(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function aw(t,e){return is(t,"GET","/v2/recaptchaConfig",Ls(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lw(t,e){return is(t,"POST","/v1/accounts:delete",e)}async function Xa(t,e){return is(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vr(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function cw(t,e=!1){const n=dt(t),s=await n.getIdToken(e),i=Lh(s);oe(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const r=typeof i.firebase=="object"?i.firebase:void 0,o=r==null?void 0:r.sign_in_provider;return{claims:i,token:s,authTime:Vr(Ic(i.auth_time)),issuedAtTime:Vr(Ic(i.iat)),expirationTime:Vr(Ic(i.exp)),signInProvider:o||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function Ic(t){return Number(t)*1e3}function Lh(t){const[e,n,s]=t.split(".");if(e===void 0||n===void 0||s===void 0)return Da("JWT malformed, contained fewer than 3 sections"),null;try{const i=jm(n);return i?JSON.parse(i):(Da("Failed to decode base64 JWT payload"),null)}catch(i){return Da("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function ep(t){const e=Lh(t);return oe(e,"internal-error"),oe(typeof e.exp<"u","internal-error"),oe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Li(t,e,n=!1){if(n)return e;try{return await e}catch(s){throw s instanceof ss&&uw(s)&&t.auth.currentUser===t&&await t.auth.signOut(),s}}function uw({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hw{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const i=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Su{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Vr(this.lastLoginAt),this.creationTime=Vr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ga(t){var e;const n=t.auth,s=await t.getIdToken(),i=await Li(t,Xa(n,{idToken:s}));oe(i==null?void 0:i.users.length,n,"internal-error");const r=i.users[0];t._notifyReloadListener(r);const o=!((e=r.providerUserInfo)===null||e===void 0)&&e.length?Qm(r.providerUserInfo):[],a=fw(t.providerData,o),u=t.isAnonymous,h=!(t.email&&r.passwordHash)&&!(a!=null&&a.length),d=u?h:!1,p={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Su(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(t,p)}async function dw(t){const e=dt(t);await Ga(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function fw(t,e){return[...t.filter(s=>!e.some(i=>i.providerId===s.providerId)),...e]}function Qm(t){return t.map(e=>{var{providerId:n}=e,s=Rh(e,["providerId"]);return{providerId:n,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pw(t,e){const n=await qm(t,{},async()=>{const s=vo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=t.config,o=await Km(t,i,"/v1/token",`key=${r}`),a=await t._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:a,body:s};return t.emulatorConfig&&Hi(t.emulatorConfig.host)&&(u.credentials="include"),Ym.fetch()(o,u)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function gw(t,e){return is(t,"POST","/v2/accounts:revokeToken",Ls(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){oe(e.idToken,"internal-error"),oe(typeof e.idToken<"u","internal-error"),oe(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ep(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){oe(e.length!==0,"internal-error");const n=ep(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(oe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:s,refreshToken:i,expiresIn:r}=await pw(e,n);this.updateTokensAndExpiration(s,i,Number(r))}updateTokensAndExpiration(e,n,s){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,n){const{refreshToken:s,accessToken:i,expirationTime:r}=n,o=new Si;return s&&(oe(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),i&&(oe(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),r&&(oe(typeof r=="number","internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Si,this.toJSON())}_performRefresh(){return Gn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ds(t,e){oe(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class an{constructor(e){var{uid:n,auth:s,stsTokenManager:i}=e,r=Rh(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new hw(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=s,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Su(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const n=await Li(this,this.stsTokenManager.getToken(this.auth,e));return oe(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return cw(this,e)}reload(){return dw(this)}_assign(e){this!==e&&(oe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new an(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){oe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),n&&await Ga(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if($t(this.auth.app))return Promise.reject(Yn(this.auth));const e=await this.getIdToken();return await Li(this,lw(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var s,i,r,o,a,u,h,d;const p=(s=n.displayName)!==null&&s!==void 0?s:void 0,m=(i=n.email)!==null&&i!==void 0?i:void 0,y=(r=n.phoneNumber)!==null&&r!==void 0?r:void 0,v=(o=n.photoURL)!==null&&o!==void 0?o:void 0,w=(a=n.tenantId)!==null&&a!==void 0?a:void 0,E=(u=n._redirectEventId)!==null&&u!==void 0?u:void 0,C=(h=n.createdAt)!==null&&h!==void 0?h:void 0,A=(d=n.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:R,emailVerified:N,isAnonymous:k,providerData:j,stsTokenManager:I}=n;oe(R&&I,e,"internal-error");const T=Si.fromJSON(this.name,I);oe(typeof R=="string",e,"internal-error"),ds(p,e.name),ds(m,e.name),oe(typeof N=="boolean",e,"internal-error"),oe(typeof k=="boolean",e,"internal-error"),ds(y,e.name),ds(v,e.name),ds(w,e.name),ds(E,e.name),ds(C,e.name),ds(A,e.name);const _=new an({uid:R,auth:e,email:m,emailVerified:N,displayName:p,isAnonymous:k,photoURL:v,phoneNumber:y,tenantId:w,stsTokenManager:T,createdAt:C,lastLoginAt:A});return j&&Array.isArray(j)&&(_.providerData=j.map(S=>Object.assign({},S))),E&&(_._redirectEventId=E),_}static async _fromIdTokenResponse(e,n,s=!1){const i=new Si;i.updateFromServerResponse(n);const r=new an({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:s});return await Ga(r),r}static async _fromGetAccountInfoResponse(e,n,s){const i=n.users[0];oe(i.localId!==void 0,"internal-error");const r=i.providerUserInfo!==void 0?Qm(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(r!=null&&r.length),a=new Si;a.updateFromIdToken(s);const u=new an({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new Su(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(r!=null&&r.length)};return Object.assign(u,h),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tp=new Map;function zn(t){Qn(t instanceof Function,"Expected a class definition");let e=tp.get(t);return e?(Qn(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,tp.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}Jm.type="NONE";const np=Jm;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pa(t,e,n){return`firebase:${t}:${e}:${n}`}class bi{constructor(e,n,s){this.persistence=e,this.auth=n,this.userKey=s;const{config:i,name:r}=this.auth;this.fullUserKey=Pa(this.userKey,i.apiKey,r),this.fullPersistenceKey=Pa("persistence",i.apiKey,r),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Xa(this.auth,{idToken:e}).catch(()=>{});return n?an._fromGetAccountInfoResponse(this.auth,n,e):null}return an._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,s="authUser"){if(!n.length)return new bi(zn(np),e,s);const i=(await Promise.all(n.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let r=i[0]||zn(np);const o=Pa(s,e.config.apiKey,e.name);let a=null;for(const h of n)try{const d=await h._get(o);if(d){let p;if(typeof d=="string"){const m=await Xa(e,{idToken:d}).catch(()=>{});if(!m)break;p=await an._fromGetAccountInfoResponse(e,m,d)}else p=an._fromJSON(e,d);h!==r&&(a=p),r=h;break}}catch{}const u=i.filter(h=>h._shouldAllowMigration);return!r._shouldAllowMigration||!u.length?new bi(r,e,s):(r=u[0],a&&await r._set(o,a.toJSON()),await Promise.all(n.map(async h=>{if(h!==r)try{await h._remove(o)}catch{}})),new bi(r,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sp(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(n0(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Zm(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(i0(e))return"Blackberry";if(r0(e))return"Webos";if(e0(e))return"Safari";if((e.includes("chrome/")||t0(e))&&!e.includes("edge/"))return"Chrome";if(s0(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=t.match(n);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function Zm(t=Dt()){return/firefox\//i.test(t)}function e0(t=Dt()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function t0(t=Dt()){return/crios\//i.test(t)}function n0(t=Dt()){return/iemobile/i.test(t)}function s0(t=Dt()){return/android/i.test(t)}function i0(t=Dt()){return/blackberry/i.test(t)}function r0(t=Dt()){return/webos/i.test(t)}function kh(t=Dt()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function mw(t=Dt()){var e;return kh(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function _w(){return Pv()&&document.documentMode===10}function o0(t=Dt()){return kh(t)||s0(t)||r0(t)||i0(t)||/windows phone/i.test(t)||n0(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a0(t,e=[]){let n;switch(t){case"Browser":n=sp(Dt());break;case"Worker":n=`${sp(Dt())}-${t}`;break;default:n=t}const s=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Wi}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yw{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const s=r=>new Promise((o,a)=>{try{const u=e(r);o(u)}catch(u){a(u)}});s.onAbort=n,this.queue.push(s);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const s of this.queue)await s(e),s.onAbort&&n.push(s.onAbort)}catch(s){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vw(t,e={}){return is(t,"GET","/v2/passwordPolicy",Ls(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ww=6;class Tw{constructor(e){var n,s,i,r;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:ww,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(r=e.forceUpgradeOnSignin)!==null&&r!==void 0?r:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,s,i,r,o,a;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(n=u.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),u.isValid&&(u.isValid=(s=u.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(r=u.containsUppercaseLetter)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(a=u.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),u}validatePasswordLengthOptions(e,n){const s=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;s&&(n.meetsMinPasswordLength=e.length>=s),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let s;for(let i=0;i<e.length;i++)s=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,n,s,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ew{constructor(e,n,s,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=s,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ip(this),this.idTokenSubscription=new ip(this),this.beforeStateQueue=new yw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=zm,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(r=>this._resolvePersistenceManagerAvailable=r)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=zn(n)),this._initializationPromise=this.queue(async()=>{var s,i,r;if(!this._deleted&&(this.persistenceManager=await bi.create(this,e),(s=this._resolvePersistenceManagerAvailable)===null||s===void 0||s.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Xa(this,{idToken:e}),s=await an._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(s)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if($t(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let i=s,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=i==null?void 0:i._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===a)&&(u!=null&&u.user)&&(i=u.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return oe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Ga(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=ew()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if($t(this.app))return Promise.reject(Yn(this));const n=e?dt(e):null;return n&&oe(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&oe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return $t(this.app)?Promise.reject(Yn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return $t(this.app)?Promise.reject(Yn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(zn(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await vw(this),n=new Tw(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new yo("auth","Firebase",e())}onAuthStateChanged(e,n,s){return this.registerStateListener(this.authStateSubscription,e,n,s)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,s){return this.registerStateListener(this.idTokenSubscription,e,n,s)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(s.tenantId=this.tenantId),await gw(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const s=await this.getOrInitRedirectPersistenceManager(n);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&zn(e)||this._popupRedirectResolver;oe(n,this,"argument-error"),this.redirectPersistenceManager=await bi.create(this,[zn(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,s;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,s,i){if(this._deleted)return()=>{};const r=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(oe(a,this,"internal-error"),a.then(()=>{o||r(this.currentUser)}),typeof n=="function"){const u=e.addObserver(n,s,i);return()=>{o=!0,u()}}else{const u=e.addObserver(n);return()=>{o=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return oe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=a0(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(n["X-Firebase-Client"]=s);const i=await this._getAppCheckToken();return i&&(n["X-Firebase-AppCheck"]=i),n}async _getAppCheckToken(){var e;if($t(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&K2(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function ks(t){return dt(t)}class ip{constructor(e){this.auth=e,this.observer=null,this.addObserver=Ov(n=>this.observer=n)}get next(){return oe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bl={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Aw(t){bl=t}function l0(t){return bl.loadJS(t)}function xw(){return bl.recaptchaEnterpriseScript}function Iw(){return bl.gapiScript}function Sw(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class bw{constructor(){this.enterprise=new Cw}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class Cw{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const Dw="recaptcha-enterprise",c0="NO_RECAPTCHA";class Pw{constructor(e){this.type=Dw,this.auth=ks(e)}async verify(e="verify",n=!1){async function s(r){if(!n){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(o,a)=>{aw(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const h=new ow(u);return r.tenantId==null?r._agentRecaptchaConfig=h:r._tenantRecaptchaConfigs[r.tenantId]=h,o(h.siteKey)}}).catch(u=>{a(u)})})}function i(r,o,a){const u=window.grecaptcha;Zf(u)?u.enterprise.ready(()=>{u.enterprise.execute(r,{action:e}).then(h=>{o(h)}).catch(()=>{o(c0)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new bw().execute("siteKey",{action:"verify"}):new Promise((r,o)=>{s(this.auth).then(a=>{if(!n&&Zf(window.grecaptcha))i(a,r,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=xw();u.length!==0&&(u+=a),l0(u).then(()=>{i(a,r,o)}).catch(h=>{o(h)})}}).catch(a=>{o(a)})})}}async function rp(t,e,n,s=!1,i=!1){const r=new Pw(t);let o;if(i)o=c0;else try{o=await r.verify(n)}catch{o=await r.verify(n,!0)}const a=Object.assign({},e);if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const u=a.phoneEnrollmentInfo.phoneNumber,h=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:h,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const u=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return s?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function bu(t,e,n,s,i){var r;if(!((r=t._getRecaptchaConfig())===null||r===void 0)&&r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await rp(t,e,n,n==="getOobCode");return s(t,o)}else return s(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await rp(t,e,n,n==="getOobCode");return s(t,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rw(t,e){const n=Ph(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),r=n.getOptions();if(ei(r,e??{}))return i;nn(i,"already-initialized")}return n.initialize({options:e})}function Nw(t,e){const n=(e==null?void 0:e.persistence)||[],s=(Array.isArray(n)?n:[n]).map(zn);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function Mw(t,e,n){const s=ks(t);oe(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const i=!1,r=u0(e),{host:o,port:a}=jw(e),u=a===null?"":`:${a}`,h={url:`${r}//${o}${u}/`},d=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!s._canInitEmulator){oe(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),oe(ei(h,s.config.emulator)&&ei(d,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=h,s.emulatorConfig=d,s.settings.appVerificationDisabledForTesting=!0,Hi(o)?(Om(`${r}//${o}${u}`),Vm("Auth",!0)):Lw()}function u0(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function jw(t){const e=u0(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(s);if(i){const r=i[1];return{host:r,port:op(s.substr(r.length+1))}}else{const[r,o]=s.split(":");return{host:r,port:op(o)}}}function op(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Lw(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fh{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Gn("not implemented")}_getIdTokenResponse(e){return Gn("not implemented")}_linkToIdToken(e,n){return Gn("not implemented")}_getReauthenticationResolver(e){return Gn("not implemented")}}async function kw(t,e){return is(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fw(t,e){return To(t,"POST","/v1/accounts:signInWithPassword",Ls(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ow(t,e){return To(t,"POST","/v1/accounts:signInWithEmailLink",Ls(t,e))}async function Vw(t,e){return To(t,"POST","/v1/accounts:signInWithEmailLink",Ls(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zr extends Fh{constructor(e,n,s,i=null){super("password",s),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Zr(e,n,"password")}static _fromEmailAndCode(e,n,s=null){return new Zr(e,n,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return bu(e,n,"signInWithPassword",Fw);case"emailLink":return Ow(e,{email:this._email,oobCode:this._password});default:nn(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const s={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return bu(e,s,"signUpPassword",kw);case"emailLink":return Vw(e,{idToken:n,email:this._email,oobCode:this._password});default:nn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ci(t,e){return To(t,"POST","/v1/accounts:signInWithIdp",Ls(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bw="http://localhost";class ni extends Fh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new ni(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):nn("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:i}=n,r=Rh(n,["providerId","signInMethod"]);if(!s||!i)return null;const o=new ni(s,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Ci(e,n)}_linkToIdToken(e,n){const s=this.buildRequest();return s.idToken=n,Ci(e,s)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Ci(e,n)}buildRequest(){const e={requestUri:Bw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=vo(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uw(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function $w(t){const e=Dr(Pr(t)).link,n=e?Dr(Pr(e)).deep_link_id:null,s=Dr(Pr(t)).deep_link_id;return(s?Dr(Pr(s)).link:null)||s||n||e||t}class Oh{constructor(e){var n,s,i,r,o,a;const u=Dr(Pr(e)),h=(n=u.apiKey)!==null&&n!==void 0?n:null,d=(s=u.oobCode)!==null&&s!==void 0?s:null,p=Uw((i=u.mode)!==null&&i!==void 0?i:null);oe(h&&d&&p,"argument-error"),this.apiKey=h,this.operation=p,this.code=d,this.continueUrl=(r=u.continueUrl)!==null&&r!==void 0?r:null,this.languageCode=(o=u.lang)!==null&&o!==void 0?o:null,this.tenantId=(a=u.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const n=$w(e);try{return new Oh(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi{constructor(){this.providerId=Xi.PROVIDER_ID}static credential(e,n){return Zr._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const s=Oh.parseLink(n);return oe(s,"argument-error"),Zr._fromEmailAndCode(e,s.code,s.tenantId)}}Xi.PROVIDER_ID="password";Xi.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Xi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vh{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo extends Vh{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs extends Eo{constructor(){super("facebook.com")}static credential(e){return ni._fromParams({providerId:gs.PROVIDER_ID,signInMethod:gs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gs.credentialFromTaggedObject(e)}static credentialFromError(e){return gs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return gs.credential(e.oauthAccessToken)}catch{return null}}}gs.FACEBOOK_SIGN_IN_METHOD="facebook.com";gs.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xn extends Eo{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return ni._fromParams({providerId:Xn.PROVIDER_ID,signInMethod:Xn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Xn.credentialFromTaggedObject(e)}static credentialFromError(e){return Xn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:s}=e;if(!n&&!s)return null;try{return Xn.credential(n,s)}catch{return null}}}Xn.GOOGLE_SIGN_IN_METHOD="google.com";Xn.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms extends Eo{constructor(){super("github.com")}static credential(e){return ni._fromParams({providerId:ms.PROVIDER_ID,signInMethod:ms.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ms.credentialFromTaggedObject(e)}static credentialFromError(e){return ms.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ms.credential(e.oauthAccessToken)}catch{return null}}}ms.GITHUB_SIGN_IN_METHOD="github.com";ms.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s extends Eo{constructor(){super("twitter.com")}static credential(e,n){return ni._fromParams({providerId:_s.PROVIDER_ID,signInMethod:_s.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return _s.credentialFromTaggedObject(e)}static credentialFromError(e){return _s.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:s}=e;if(!n||!s)return null;try{return _s.credential(n,s)}catch{return null}}}_s.TWITTER_SIGN_IN_METHOD="twitter.com";_s.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hw(t,e){return To(t,"POST","/v1/accounts:signUp",Ls(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class si{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,s,i=!1){const r=await an._fromIdTokenResponse(e,s,i),o=ap(s);return new si({user:r,providerId:o,_tokenResponse:s,operationType:n})}static async _forOperation(e,n,s){await e._updateTokensIfNecessary(s,!0);const i=ap(s);return new si({user:e,providerId:i,_tokenResponse:s,operationType:n})}}function ap(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class za extends ss{constructor(e,n,s,i){var r;super(n.code,n.message),this.operationType=s,this.user=i,Object.setPrototypeOf(this,za.prototype),this.customData={appName:e.name,tenantId:(r=e.tenantId)!==null&&r!==void 0?r:void 0,_serverResponse:n.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,n,s,i){return new za(e,n,s,i)}}function h0(t,e,n,s){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?za._fromErrorAndOperation(t,r,e,s):r})}async function Ww(t,e,n=!1){const s=await Li(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return si._forOperation(t,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xw(t,e,n=!1){const{auth:s}=t;if($t(s.app))return Promise.reject(Yn(s));const i="reauthenticate";try{const r=await Li(t,h0(s,i,e,t),n);oe(r.idToken,s,"internal-error");const o=Lh(r.idToken);oe(o,s,"internal-error");const{sub:a}=o;return oe(t.uid===a,s,"user-mismatch"),si._forOperation(t,i,r)}catch(r){throw(r==null?void 0:r.code)==="auth/user-not-found"&&nn(s,"user-mismatch"),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d0(t,e,n=!1){if($t(t.app))return Promise.reject(Yn(t));const s="signIn",i=await h0(t,s,e),r=await si._fromIdTokenResponse(t,s,i);return n||await t._updateCurrentUser(r.user),r}async function Gw(t,e){return d0(ks(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f0(t){const e=ks(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function zw(t,e,n){if($t(t.app))return Promise.reject(Yn(t));const s=ks(t),o=await bu(s,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Hw).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&f0(t),u}),a=await si._fromIdTokenResponse(s,"signIn",o);return await s._updateCurrentUser(a.user),a}function Yw(t,e,n){return $t(t.app)?Promise.reject(Yn(t)):Gw(dt(t),Xi.credential(e,n)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&f0(t),s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qw(t,e){return is(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kw(t,{displayName:e,photoURL:n}){if(e===void 0&&n===void 0)return;const s=dt(t),r={idToken:await s.getIdToken(),displayName:e,photoUrl:n,returnSecureToken:!0},o=await Li(s,qw(s.auth,r));s.displayName=o.displayName||null,s.photoURL=o.photoUrl||null;const a=s.providerData.find(({providerId:u})=>u==="password");a&&(a.displayName=s.displayName,a.photoURL=s.photoURL),await s._updateTokensIfNecessary(o)}function Qw(t,e,n,s){return dt(t).onIdTokenChanged(e,n,s)}function Jw(t,e,n){return dt(t).beforeAuthStateChanged(e,n)}function p0(t,e,n,s){return dt(t).onAuthStateChanged(e,n,s)}function Zw(t){return dt(t).signOut()}const Ya="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g0{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Ya,"1"),this.storage.removeItem(Ya),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eT=1e3,tT=10;class m0 extends g0{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=o0(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const s=this.storage.getItem(n),i=this.localCache[n];s!==i&&e(n,i,s)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,u)=>{this.notifyListeners(o,u)});return}const s=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(s);!n&&this.localCache[s]===o||this.notifyListeners(s,o)},r=this.storage.getItem(s);_w()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,tT):i()}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:s}),!0)})},eT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}m0.type="LOCAL";const nT=m0;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0 extends g0{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}_0.type="SESSION";const y0=_0;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sT(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cl{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const s=new Cl(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:s,eventType:i,data:r}=n.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:s,eventType:i});const a=Array.from(o).map(async h=>h(n.origin,r)),u=await sT(a);n.ports[0].postMessage({status:"done",eventId:s,eventType:i,response:u})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Cl.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bh(t="",e=10){let n="";for(let s=0;s<e;s++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iT{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,s=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,o;return new Promise((a,u)=>{const h=Bh("",20);i.port1.start();const d=setTimeout(()=>{u(new Error("unsupported_event"))},s);o={messageChannel:i,onMessage(p){const m=p;if(m.data.eventId===h)switch(m.data.status){case"ack":clearTimeout(d),r=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(m.data.response);break;default:clearTimeout(d),clearTimeout(r),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:n},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function An(){return window}function rT(t){An().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v0(){return typeof An().WorkerGlobalScope<"u"&&typeof An().importScripts=="function"}async function oT(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function aT(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function lT(){return v0()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w0="firebaseLocalStorageDb",cT=1,qa="firebaseLocalStorage",T0="fbase_key";class Ao{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Dl(t,e){return t.transaction([qa],e?"readwrite":"readonly").objectStore(qa)}function uT(){const t=indexedDB.deleteDatabase(w0);return new Ao(t).toPromise()}function Cu(){const t=indexedDB.open(w0,cT);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const s=t.result;try{s.createObjectStore(qa,{keyPath:T0})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const s=t.result;s.objectStoreNames.contains(qa)?e(s):(s.close(),await uT(),e(await Cu()))})})}async function lp(t,e,n){const s=Dl(t,!0).put({[T0]:e,value:n});return new Ao(s).toPromise()}async function hT(t,e){const n=Dl(t,!1).get(e),s=await new Ao(n).toPromise();return s===void 0?null:s.value}function cp(t,e){const n=Dl(t,!0).delete(e);return new Ao(n).toPromise()}const dT=800,fT=3;class E0{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Cu(),this.db)}async _withRetries(e){let n=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(n++>fT)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return v0()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Cl._getInstance(lT()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await oT(),!this.activeServiceWorker)return;this.sender=new iT(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((n=s[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||aT()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Cu();return await lp(e,Ya,"1"),await cp(e,Ya),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(s=>lp(s,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(s=>hT(s,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>cp(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const r=Dl(i,!1).getAll();return new Ao(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],s=new Set;if(e.length!==0)for(const{fbase_key:i,value:r}of e)s.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!s.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),dT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}E0.type="LOCAL";const pT=E0;new wo(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A0(t,e){return e?zn(e):(oe(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uh extends Fh{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ci(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Ci(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Ci(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function gT(t){return d0(t.auth,new Uh(t),t.bypassAuthState)}function mT(t){const{auth:e,user:n}=t;return oe(n,e,"internal-error"),Xw(n,new Uh(t),t.bypassAuthState)}async function _T(t){const{auth:e,user:n}=t;return oe(n,e,"internal-error"),Ww(n,new Uh(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{constructor(e,n,s,i,r=!1){this.auth=e,this.resolver=s,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:s,postBody:i,tenantId:r,error:o,type:a}=e;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:n,sessionId:s,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(u))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return gT;case"linkViaPopup":case"linkViaRedirect":return _T;case"reauthViaPopup":case"reauthViaRedirect":return mT;default:nn(this.auth,"internal-error")}}resolve(e){Qn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Qn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yT=new wo(2e3,1e4);async function vT(t,e,n){if($t(t.app))return Promise.reject(un(t,"operation-not-supported-in-this-environment"));const s=ks(t);Q2(t,e,Vh);const i=A0(s,n);return new Qs(s,"signInViaPopup",e,i).executeNotNull()}class Qs extends x0{constructor(e,n,s,i,r){super(e,n,i,r),this.provider=s,this.authWindow=null,this.pollId=null,Qs.currentPopupAction&&Qs.currentPopupAction.cancel(),Qs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return oe(e,this.auth,"internal-error"),e}async onExecution(){Qn(this.filter.length===1,"Popup operations only handle one event");const e=Bh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(un(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(un(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Qs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,s;if(!((s=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(un(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,yT.get())};e()}}Qs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wT="pendingRedirect",Ra=new Map;class TT extends x0{constructor(e,n,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,s),this.eventId=null}async execute(){let e=Ra.get(this.auth._key());if(!e){try{const s=await ET(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(n){e=()=>Promise.reject(n)}Ra.set(this.auth._key(),e)}return this.bypassAuthState||Ra.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ET(t,e){const n=IT(e),s=xT(t);if(!await s._isAvailable())return!1;const i=await s._get(n)==="true";return await s._remove(n),i}function AT(t,e){Ra.set(t._key(),e)}function xT(t){return zn(t._redirectPersistence)}function IT(t){return Pa(wT,t.config.apiKey,t.name)}async function ST(t,e,n=!1){if($t(t.app))return Promise.reject(Yn(t));const s=ks(t),i=A0(s,e),o=await new TT(s,i,n).execute();return o&&!n&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bT=10*60*1e3;class CT{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(n=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!DT(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var s;if(e.error&&!I0(e)){const i=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";n.onError(un(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const s=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=bT&&this.cachedEventUids.clear(),this.cachedEventUids.has(up(e))}saveEventToCache(e){this.cachedEventUids.add(up(e)),this.lastProcessedEventTime=Date.now()}}function up(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function I0({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function DT(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return I0(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PT(t,e={}){return is(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RT=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,NT=/^https?/;async function MT(t){if(t.config.emulator)return;const{authorizedDomains:e}=await PT(t);for(const n of e)try{if(jT(n))return}catch{}nn(t,"unauthorized-domain")}function jT(t){const e=Iu(),{protocol:n,hostname:s}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&s===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===s}if(!NT.test(n))return!1;if(RT.test(t))return s===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LT=new wo(3e4,6e4);function hp(){const t=An().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function kT(t){return new Promise((e,n)=>{var s,i,r;function o(){hp(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{hp(),n(un(t,"network-request-failed"))},timeout:LT.get()})}if(!((i=(s=An().gapi)===null||s===void 0?void 0:s.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((r=An().gapi)===null||r===void 0)&&r.load)o();else{const a=Sw("iframefcb");return An()[a]=()=>{gapi.load?o():n(un(t,"network-request-failed"))},l0(`${Iw()}?onload=${a}`).catch(u=>n(u))}}).catch(e=>{throw Na=null,e})}let Na=null;function FT(t){return Na=Na||kT(t),Na}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OT=new wo(5e3,15e3),VT="__/auth/iframe",BT="emulator/auth/iframe",UT={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},$T=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function HT(t){const e=t.config;oe(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?jh(e,BT):`https://${t.config.authDomain}/${VT}`,s={apiKey:e.apiKey,appName:t.name,v:Wi},i=$T.get(t.config.apiHost);i&&(s.eid=i);const r=t._getFrameworks();return r.length&&(s.fw=r.join(",")),`${n}?${vo(s).slice(1)}`}async function WT(t){const e=await FT(t),n=An().gapi;return oe(n,t,"internal-error"),e.open({where:document.body,url:HT(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:UT,dontclear:!0},s=>new Promise(async(i,r)=>{await s.restyle({setHideOnLeave:!1});const o=un(t,"network-request-failed"),a=An().setTimeout(()=>{r(o)},OT.get());function u(){An().clearTimeout(a),i(s)}s.ping(u).then(u,()=>{r(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XT={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},GT=500,zT=600,YT="_blank",qT="http://localhost";class dp{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function KT(t,e,n,s=GT,i=zT){const r=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const u=Object.assign(Object.assign({},XT),{width:s.toString(),height:i.toString(),top:r,left:o}),h=Dt().toLowerCase();n&&(a=t0(h)?YT:n),Zm(h)&&(e=e||qT,u.scrollbars="yes");const d=Object.entries(u).reduce((m,[y,v])=>`${m}${y}=${v},`,"");if(mw(h)&&a!=="_self")return QT(e||"",a),new dp(null);const p=window.open(e||"",a,d);oe(p,t,"popup-blocked");try{p.focus()}catch{}return new dp(p)}function QT(t,e){const n=document.createElement("a");n.href=t,n.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JT="__/auth/handler",ZT="emulator/auth/handler",eE=encodeURIComponent("fac");async function fp(t,e,n,s,i,r){oe(t.config.authDomain,t,"auth-domain-config-required"),oe(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:s,v:Wi,eventId:i};if(e instanceof Vh){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",Fv(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,p]of Object.entries({}))o[d]=p}if(e instanceof Eo){const d=e.getScopes().filter(p=>p!=="");d.length>0&&(o.scopes=d.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const u=await t._getAppCheckToken(),h=u?`#${eE}=${encodeURIComponent(u)}`:"";return`${tE(t)}?${vo(a).slice(1)}${h}`}function tE({config:t}){return t.emulator?jh(t,ZT):`https://${t.authDomain}/${JT}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sc="webStorageSupport";class nE{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=y0,this._completeRedirectFn=ST,this._overrideRedirectResult=AT}async _openPopup(e,n,s,i){var r;Qn((r=this.eventManagers[e._key()])===null||r===void 0?void 0:r.manager,"_initialize() not called before _openPopup()");const o=await fp(e,n,s,Iu(),i);return KT(e,o,Bh())}async _openRedirect(e,n,s,i){await this._originValidation(e);const r=await fp(e,n,s,Iu(),i);return rT(r),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:r}=this.eventManagers[n];return i?Promise.resolve(i):(Qn(r,"If manager is not set, promise should be"),r)}const s=this.initAndGetManager(e);return this.eventManagers[n]={promise:s},s.catch(()=>{delete this.eventManagers[n]}),s}async initAndGetManager(e){const n=await WT(e),s=new CT(e);return n.register("authEvent",i=>(oe(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:s.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=n,s}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Sc,{type:Sc},i=>{var r;const o=(r=i==null?void 0:i[0])===null||r===void 0?void 0:r[Sc];o!==void 0&&n(!!o),nn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=MT(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return o0()||e0()||kh()}}const sE=nE;var pp="@firebase/auth",gp="1.10.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iE{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){oe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rE(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function oE(t){ji(new ti("auth",(e,{options:n})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;oe(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const u={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:a0(t)},h=new Ew(s,i,r,u);return Nw(h,n),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,s)=>{e.getProvider("auth-internal").initialize()})),ji(new ti("auth-internal",e=>{const n=ks(e.getProvider("auth").getImmediate());return(s=>new iE(s))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),As(pp,gp,rE(t)),As(pp,gp,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aE=5*60,lE=Fm("authIdTokenMaxAge")||aE;let mp=null;const cE=t=>async e=>{const n=e&&await e.getIdTokenResult(),s=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(s&&s>lE)return;const i=n==null?void 0:n.token;mp!==i&&(mp=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function uE(t=Hm()){const e=Ph(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Rw(t,{popupRedirectResolver:sE,persistence:[pT,nT,y0]}),s=Fm("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(s,location.origin);if(location.origin===r.origin){const o=cE(r.toString());Jw(n,o,()=>o(n.currentUser)),Qw(n,a=>o(a))}}const i=Lm("auth");return i&&Mw(n,`http://${i}`),n}function hE(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}Aw({loadJS(t){return new Promise((e,n)=>{const s=document.createElement("script");s.setAttribute("src",t),s.onload=e,s.onerror=i=>{const r=un("internal-error");r.customData=i,n(r)},s.type="text/javascript",s.charset="UTF-8",hE().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});oE("Browser");var dE="firebase",fE="11.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */As(dE,fE,"app");var _p=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xs,S0;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,T){function _(){}_.prototype=T.prototype,I.D=T.prototype,I.prototype=new _,I.prototype.constructor=I,I.C=function(S,D,P){for(var x=Array(arguments.length-2),V=2;V<arguments.length;V++)x[V-2]=arguments[V];return T.prototype[D].apply(S,x)}}function n(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(s,n),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(I,T,_){_||(_=0);var S=Array(16);if(typeof T=="string")for(var D=0;16>D;++D)S[D]=T.charCodeAt(_++)|T.charCodeAt(_++)<<8|T.charCodeAt(_++)<<16|T.charCodeAt(_++)<<24;else for(D=0;16>D;++D)S[D]=T[_++]|T[_++]<<8|T[_++]<<16|T[_++]<<24;T=I.g[0],_=I.g[1],D=I.g[2];var P=I.g[3],x=T+(P^_&(D^P))+S[0]+3614090360&4294967295;T=_+(x<<7&4294967295|x>>>25),x=P+(D^T&(_^D))+S[1]+3905402710&4294967295,P=T+(x<<12&4294967295|x>>>20),x=D+(_^P&(T^_))+S[2]+606105819&4294967295,D=P+(x<<17&4294967295|x>>>15),x=_+(T^D&(P^T))+S[3]+3250441966&4294967295,_=D+(x<<22&4294967295|x>>>10),x=T+(P^_&(D^P))+S[4]+4118548399&4294967295,T=_+(x<<7&4294967295|x>>>25),x=P+(D^T&(_^D))+S[5]+1200080426&4294967295,P=T+(x<<12&4294967295|x>>>20),x=D+(_^P&(T^_))+S[6]+2821735955&4294967295,D=P+(x<<17&4294967295|x>>>15),x=_+(T^D&(P^T))+S[7]+4249261313&4294967295,_=D+(x<<22&4294967295|x>>>10),x=T+(P^_&(D^P))+S[8]+1770035416&4294967295,T=_+(x<<7&4294967295|x>>>25),x=P+(D^T&(_^D))+S[9]+2336552879&4294967295,P=T+(x<<12&4294967295|x>>>20),x=D+(_^P&(T^_))+S[10]+4294925233&4294967295,D=P+(x<<17&4294967295|x>>>15),x=_+(T^D&(P^T))+S[11]+2304563134&4294967295,_=D+(x<<22&4294967295|x>>>10),x=T+(P^_&(D^P))+S[12]+1804603682&4294967295,T=_+(x<<7&4294967295|x>>>25),x=P+(D^T&(_^D))+S[13]+4254626195&4294967295,P=T+(x<<12&4294967295|x>>>20),x=D+(_^P&(T^_))+S[14]+2792965006&4294967295,D=P+(x<<17&4294967295|x>>>15),x=_+(T^D&(P^T))+S[15]+1236535329&4294967295,_=D+(x<<22&4294967295|x>>>10),x=T+(D^P&(_^D))+S[1]+4129170786&4294967295,T=_+(x<<5&4294967295|x>>>27),x=P+(_^D&(T^_))+S[6]+3225465664&4294967295,P=T+(x<<9&4294967295|x>>>23),x=D+(T^_&(P^T))+S[11]+643717713&4294967295,D=P+(x<<14&4294967295|x>>>18),x=_+(P^T&(D^P))+S[0]+3921069994&4294967295,_=D+(x<<20&4294967295|x>>>12),x=T+(D^P&(_^D))+S[5]+3593408605&4294967295,T=_+(x<<5&4294967295|x>>>27),x=P+(_^D&(T^_))+S[10]+38016083&4294967295,P=T+(x<<9&4294967295|x>>>23),x=D+(T^_&(P^T))+S[15]+3634488961&4294967295,D=P+(x<<14&4294967295|x>>>18),x=_+(P^T&(D^P))+S[4]+3889429448&4294967295,_=D+(x<<20&4294967295|x>>>12),x=T+(D^P&(_^D))+S[9]+568446438&4294967295,T=_+(x<<5&4294967295|x>>>27),x=P+(_^D&(T^_))+S[14]+3275163606&4294967295,P=T+(x<<9&4294967295|x>>>23),x=D+(T^_&(P^T))+S[3]+4107603335&4294967295,D=P+(x<<14&4294967295|x>>>18),x=_+(P^T&(D^P))+S[8]+1163531501&4294967295,_=D+(x<<20&4294967295|x>>>12),x=T+(D^P&(_^D))+S[13]+2850285829&4294967295,T=_+(x<<5&4294967295|x>>>27),x=P+(_^D&(T^_))+S[2]+4243563512&4294967295,P=T+(x<<9&4294967295|x>>>23),x=D+(T^_&(P^T))+S[7]+1735328473&4294967295,D=P+(x<<14&4294967295|x>>>18),x=_+(P^T&(D^P))+S[12]+2368359562&4294967295,_=D+(x<<20&4294967295|x>>>12),x=T+(_^D^P)+S[5]+4294588738&4294967295,T=_+(x<<4&4294967295|x>>>28),x=P+(T^_^D)+S[8]+2272392833&4294967295,P=T+(x<<11&4294967295|x>>>21),x=D+(P^T^_)+S[11]+1839030562&4294967295,D=P+(x<<16&4294967295|x>>>16),x=_+(D^P^T)+S[14]+4259657740&4294967295,_=D+(x<<23&4294967295|x>>>9),x=T+(_^D^P)+S[1]+2763975236&4294967295,T=_+(x<<4&4294967295|x>>>28),x=P+(T^_^D)+S[4]+1272893353&4294967295,P=T+(x<<11&4294967295|x>>>21),x=D+(P^T^_)+S[7]+4139469664&4294967295,D=P+(x<<16&4294967295|x>>>16),x=_+(D^P^T)+S[10]+3200236656&4294967295,_=D+(x<<23&4294967295|x>>>9),x=T+(_^D^P)+S[13]+681279174&4294967295,T=_+(x<<4&4294967295|x>>>28),x=P+(T^_^D)+S[0]+3936430074&4294967295,P=T+(x<<11&4294967295|x>>>21),x=D+(P^T^_)+S[3]+3572445317&4294967295,D=P+(x<<16&4294967295|x>>>16),x=_+(D^P^T)+S[6]+76029189&4294967295,_=D+(x<<23&4294967295|x>>>9),x=T+(_^D^P)+S[9]+3654602809&4294967295,T=_+(x<<4&4294967295|x>>>28),x=P+(T^_^D)+S[12]+3873151461&4294967295,P=T+(x<<11&4294967295|x>>>21),x=D+(P^T^_)+S[15]+530742520&4294967295,D=P+(x<<16&4294967295|x>>>16),x=_+(D^P^T)+S[2]+3299628645&4294967295,_=D+(x<<23&4294967295|x>>>9),x=T+(D^(_|~P))+S[0]+4096336452&4294967295,T=_+(x<<6&4294967295|x>>>26),x=P+(_^(T|~D))+S[7]+1126891415&4294967295,P=T+(x<<10&4294967295|x>>>22),x=D+(T^(P|~_))+S[14]+2878612391&4294967295,D=P+(x<<15&4294967295|x>>>17),x=_+(P^(D|~T))+S[5]+4237533241&4294967295,_=D+(x<<21&4294967295|x>>>11),x=T+(D^(_|~P))+S[12]+1700485571&4294967295,T=_+(x<<6&4294967295|x>>>26),x=P+(_^(T|~D))+S[3]+2399980690&4294967295,P=T+(x<<10&4294967295|x>>>22),x=D+(T^(P|~_))+S[10]+4293915773&4294967295,D=P+(x<<15&4294967295|x>>>17),x=_+(P^(D|~T))+S[1]+2240044497&4294967295,_=D+(x<<21&4294967295|x>>>11),x=T+(D^(_|~P))+S[8]+1873313359&4294967295,T=_+(x<<6&4294967295|x>>>26),x=P+(_^(T|~D))+S[15]+4264355552&4294967295,P=T+(x<<10&4294967295|x>>>22),x=D+(T^(P|~_))+S[6]+2734768916&4294967295,D=P+(x<<15&4294967295|x>>>17),x=_+(P^(D|~T))+S[13]+1309151649&4294967295,_=D+(x<<21&4294967295|x>>>11),x=T+(D^(_|~P))+S[4]+4149444226&4294967295,T=_+(x<<6&4294967295|x>>>26),x=P+(_^(T|~D))+S[11]+3174756917&4294967295,P=T+(x<<10&4294967295|x>>>22),x=D+(T^(P|~_))+S[2]+718787259&4294967295,D=P+(x<<15&4294967295|x>>>17),x=_+(P^(D|~T))+S[9]+3951481745&4294967295,I.g[0]=I.g[0]+T&4294967295,I.g[1]=I.g[1]+(D+(x<<21&4294967295|x>>>11))&4294967295,I.g[2]=I.g[2]+D&4294967295,I.g[3]=I.g[3]+P&4294967295}s.prototype.u=function(I,T){T===void 0&&(T=I.length);for(var _=T-this.blockSize,S=this.B,D=this.h,P=0;P<T;){if(D==0)for(;P<=_;)i(this,I,P),P+=this.blockSize;if(typeof I=="string"){for(;P<T;)if(S[D++]=I.charCodeAt(P++),D==this.blockSize){i(this,S),D=0;break}}else for(;P<T;)if(S[D++]=I[P++],D==this.blockSize){i(this,S),D=0;break}}this.h=D,this.o+=T},s.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var T=1;T<I.length-8;++T)I[T]=0;var _=8*this.o;for(T=I.length-8;T<I.length;++T)I[T]=_&255,_/=256;for(this.u(I),I=Array(16),T=_=0;4>T;++T)for(var S=0;32>S;S+=8)I[_++]=this.g[T]>>>S&255;return I};function r(I,T){var _=a;return Object.prototype.hasOwnProperty.call(_,I)?_[I]:_[I]=T(I)}function o(I,T){this.h=T;for(var _=[],S=!0,D=I.length-1;0<=D;D--){var P=I[D]|0;S&&P==T||(_[D]=P,S=!1)}this.g=_}var a={};function u(I){return-128<=I&&128>I?r(I,function(T){return new o([T|0],0>T?-1:0)}):new o([I|0],0>I?-1:0)}function h(I){if(isNaN(I)||!isFinite(I))return p;if(0>I)return E(h(-I));for(var T=[],_=1,S=0;I>=_;S++)T[S]=I/_|0,_*=4294967296;return new o(T,0)}function d(I,T){if(I.length==0)throw Error("number format error: empty string");if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(I.charAt(0)=="-")return E(d(I.substring(1),T));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=h(Math.pow(T,8)),S=p,D=0;D<I.length;D+=8){var P=Math.min(8,I.length-D),x=parseInt(I.substring(D,D+P),T);8>P?(P=h(Math.pow(T,P)),S=S.j(P).add(h(x))):(S=S.j(_),S=S.add(h(x)))}return S}var p=u(0),m=u(1),y=u(16777216);t=o.prototype,t.m=function(){if(w(this))return-E(this).m();for(var I=0,T=1,_=0;_<this.g.length;_++){var S=this.i(_);I+=(0<=S?S:4294967296+S)*T,T*=4294967296}return I},t.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(v(this))return"0";if(w(this))return"-"+E(this).toString(I);for(var T=h(Math.pow(I,6)),_=this,S="";;){var D=N(_,T).g;_=C(_,D.j(T));var P=((0<_.g.length?_.g[0]:_.h)>>>0).toString(I);if(_=D,v(_))return P+S;for(;6>P.length;)P="0"+P;S=P+S}},t.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function v(I){if(I.h!=0)return!1;for(var T=0;T<I.g.length;T++)if(I.g[T]!=0)return!1;return!0}function w(I){return I.h==-1}t.l=function(I){return I=C(this,I),w(I)?-1:v(I)?0:1};function E(I){for(var T=I.g.length,_=[],S=0;S<T;S++)_[S]=~I.g[S];return new o(_,~I.h).add(m)}t.abs=function(){return w(this)?E(this):this},t.add=function(I){for(var T=Math.max(this.g.length,I.g.length),_=[],S=0,D=0;D<=T;D++){var P=S+(this.i(D)&65535)+(I.i(D)&65535),x=(P>>>16)+(this.i(D)>>>16)+(I.i(D)>>>16);S=x>>>16,P&=65535,x&=65535,_[D]=x<<16|P}return new o(_,_[_.length-1]&-2147483648?-1:0)};function C(I,T){return I.add(E(T))}t.j=function(I){if(v(this)||v(I))return p;if(w(this))return w(I)?E(this).j(E(I)):E(E(this).j(I));if(w(I))return E(this.j(E(I)));if(0>this.l(y)&&0>I.l(y))return h(this.m()*I.m());for(var T=this.g.length+I.g.length,_=[],S=0;S<2*T;S++)_[S]=0;for(S=0;S<this.g.length;S++)for(var D=0;D<I.g.length;D++){var P=this.i(S)>>>16,x=this.i(S)&65535,V=I.i(D)>>>16,Y=I.i(D)&65535;_[2*S+2*D]+=x*Y,A(_,2*S+2*D),_[2*S+2*D+1]+=P*Y,A(_,2*S+2*D+1),_[2*S+2*D+1]+=x*V,A(_,2*S+2*D+1),_[2*S+2*D+2]+=P*V,A(_,2*S+2*D+2)}for(S=0;S<T;S++)_[S]=_[2*S+1]<<16|_[2*S];for(S=T;S<2*T;S++)_[S]=0;return new o(_,0)};function A(I,T){for(;(I[T]&65535)!=I[T];)I[T+1]+=I[T]>>>16,I[T]&=65535,T++}function R(I,T){this.g=I,this.h=T}function N(I,T){if(v(T))throw Error("division by zero");if(v(I))return new R(p,p);if(w(I))return T=N(E(I),T),new R(E(T.g),E(T.h));if(w(T))return T=N(I,E(T)),new R(E(T.g),T.h);if(30<I.g.length){if(w(I)||w(T))throw Error("slowDivide_ only works with positive integers.");for(var _=m,S=T;0>=S.l(I);)_=k(_),S=k(S);var D=j(_,1),P=j(S,1);for(S=j(S,2),_=j(_,2);!v(S);){var x=P.add(S);0>=x.l(I)&&(D=D.add(_),P=x),S=j(S,1),_=j(_,1)}return T=C(I,D.j(T)),new R(D,T)}for(D=p;0<=I.l(T);){for(_=Math.max(1,Math.floor(I.m()/T.m())),S=Math.ceil(Math.log(_)/Math.LN2),S=48>=S?1:Math.pow(2,S-48),P=h(_),x=P.j(T);w(x)||0<x.l(I);)_-=S,P=h(_),x=P.j(T);v(P)&&(P=m),D=D.add(P),I=C(I,x)}return new R(D,I)}t.A=function(I){return N(this,I).h},t.and=function(I){for(var T=Math.max(this.g.length,I.g.length),_=[],S=0;S<T;S++)_[S]=this.i(S)&I.i(S);return new o(_,this.h&I.h)},t.or=function(I){for(var T=Math.max(this.g.length,I.g.length),_=[],S=0;S<T;S++)_[S]=this.i(S)|I.i(S);return new o(_,this.h|I.h)},t.xor=function(I){for(var T=Math.max(this.g.length,I.g.length),_=[],S=0;S<T;S++)_[S]=this.i(S)^I.i(S);return new o(_,this.h^I.h)};function k(I){for(var T=I.g.length+1,_=[],S=0;S<T;S++)_[S]=I.i(S)<<1|I.i(S-1)>>>31;return new o(_,I.h)}function j(I,T){var _=T>>5;T%=32;for(var S=I.g.length-_,D=[],P=0;P<S;P++)D[P]=0<T?I.i(P+_)>>>T|I.i(P+_+1)<<32-T:I.i(P+_);return new o(D,I.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,S0=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=d,xs=o}).apply(typeof _p<"u"?_p:typeof self<"u"?self:typeof window<"u"?window:{});var ta=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var b0,Rr,C0,Ma,Du,D0,P0,R0;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,f,g){return l==Array.prototype||l==Object.prototype||(l[f]=g.value),l};function n(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof ta=="object"&&ta];for(var f=0;f<l.length;++f){var g=l[f];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var s=n(this);function i(l,f){if(f)e:{var g=s;l=l.split(".");for(var b=0;b<l.length-1;b++){var L=l[b];if(!(L in g))break e;g=g[L]}l=l[l.length-1],b=g[l],f=f(b),f!=b&&f!=null&&e(g,l,{configurable:!0,writable:!0,value:f})}}function r(l,f){l instanceof String&&(l+="");var g=0,b=!1,L={next:function(){if(!b&&g<l.length){var F=g++;return{value:f(F,l[F]),done:!1}}return b=!0,{done:!0,value:void 0}}};return L[Symbol.iterator]=function(){return L},L}i("Array.prototype.values",function(l){return l||function(){return r(this,function(f,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function u(l){var f=typeof l;return f=f!="object"?f:l?Array.isArray(l)?"array":f:"null",f=="array"||f=="object"&&typeof l.length=="number"}function h(l){var f=typeof l;return f=="object"&&l!=null||f=="function"}function d(l,f,g){return l.call.apply(l.bind,arguments)}function p(l,f,g){if(!l)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var L=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(L,b),l.apply(f,L)}}return function(){return l.apply(f,arguments)}}function m(l,f,g){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:p,m.apply(null,arguments)}function y(l,f){var g=Array.prototype.slice.call(arguments,1);return function(){var b=g.slice();return b.push.apply(b,arguments),l.apply(this,b)}}function v(l,f){function g(){}g.prototype=f.prototype,l.aa=f.prototype,l.prototype=new g,l.prototype.constructor=l,l.Qb=function(b,L,F){for(var G=Array(arguments.length-2),Oe=2;Oe<arguments.length;Oe++)G[Oe-2]=arguments[Oe];return f.prototype[L].apply(b,G)}}function w(l){const f=l.length;if(0<f){const g=Array(f);for(let b=0;b<f;b++)g[b]=l[b];return g}return[]}function E(l,f){for(let g=1;g<arguments.length;g++){const b=arguments[g];if(u(b)){const L=l.length||0,F=b.length||0;l.length=L+F;for(let G=0;G<F;G++)l[L+G]=b[G]}else l.push(b)}}class C{constructor(f,g){this.i=f,this.j=g,this.h=0,this.g=null}get(){let f;return 0<this.h?(this.h--,f=this.g,this.g=f.next,f.next=null):f=this.i(),f}}function A(l){return/^[\s\xa0]*$/.test(l)}function R(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function N(l){return N[" "](l),l}N[" "]=function(){};var k=R().indexOf("Gecko")!=-1&&!(R().toLowerCase().indexOf("webkit")!=-1&&R().indexOf("Edge")==-1)&&!(R().indexOf("Trident")!=-1||R().indexOf("MSIE")!=-1)&&R().indexOf("Edge")==-1;function j(l,f,g){for(const b in l)f.call(g,l[b],b,l)}function I(l,f){for(const g in l)f.call(void 0,l[g],g,l)}function T(l){const f={};for(const g in l)f[g]=l[g];return f}const _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function S(l,f){let g,b;for(let L=1;L<arguments.length;L++){b=arguments[L];for(g in b)l[g]=b[g];for(let F=0;F<_.length;F++)g=_[F],Object.prototype.hasOwnProperty.call(b,g)&&(l[g]=b[g])}}function D(l){var f=1;l=l.split(":");const g=[];for(;0<f&&l.length;)g.push(l.shift()),f--;return l.length&&g.push(l.join(":")),g}function P(l){a.setTimeout(()=>{throw l},0)}function x(){var l=Z;let f=null;return l.g&&(f=l.g,l.g=l.g.next,l.g||(l.h=null),f.next=null),f}class V{constructor(){this.h=this.g=null}add(f,g){const b=Y.get();b.set(f,g),this.h?this.h.next=b:this.g=b,this.h=b}}var Y=new C(()=>new le,l=>l.reset());class le{constructor(){this.next=this.g=this.h=null}set(f,g){this.h=f,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let re,fe=!1,Z=new V,te=()=>{const l=a.Promise.resolve(void 0);re=()=>{l.then(Ae)}};var Ae=()=>{for(var l;l=x();){try{l.h.call(l.g)}catch(g){P(g)}var f=Y;f.j(l),100>f.h&&(f.h++,l.next=f.g,f.g=l)}fe=!1};function ce(){this.s=this.s,this.C=this.C}ce.prototype.s=!1,ce.prototype.ma=function(){this.s||(this.s=!0,this.N())},ce.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ie(l,f){this.type=l,this.g=this.target=f,this.defaultPrevented=!1}ie.prototype.h=function(){this.defaultPrevented=!0};var Rt=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,f=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const g=()=>{};a.addEventListener("test",g,f),a.removeEventListener("test",g,f)}catch{}return l}();function ne(l,f){if(ie.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var g=this.type=l.type,b=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=f,f=l.relatedTarget){if(k){e:{try{N(f.nodeName);var L=!0;break e}catch{}L=!1}L||(f=null)}}else g=="mouseover"?f=l.fromElement:g=="mouseout"&&(f=l.toElement);this.relatedTarget=f,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:ye[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&ne.aa.h.call(this)}}v(ne,ie);var ye={2:"touch",3:"pen",4:"mouse"};ne.prototype.h=function(){ne.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var We="closure_listenable_"+(1e6*Math.random()|0),Ye=0;function J(l,f,g,b,L){this.listener=l,this.proxy=null,this.src=f,this.type=g,this.capture=!!b,this.ha=L,this.key=++Ye,this.da=this.fa=!1}function xe(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Je(l){this.src=l,this.g={},this.h=0}Je.prototype.add=function(l,f,g,b,L){var F=l.toString();l=this.g[F],l||(l=this.g[F]=[],this.h++);var G=lt(l,f,b,L);return-1<G?(f=l[G],g||(f.fa=!1)):(f=new J(f,this.src,F,!!b,L),f.fa=g,l.push(f)),f};function Le(l,f){var g=f.type;if(g in l.g){var b=l.g[g],L=Array.prototype.indexOf.call(b,f,void 0),F;(F=0<=L)&&Array.prototype.splice.call(b,L,1),F&&(xe(f),l.g[g].length==0&&(delete l.g[g],l.h--))}}function lt(l,f,g,b){for(var L=0;L<l.length;++L){var F=l[L];if(!F.da&&F.listener==f&&F.capture==!!g&&F.ha==b)return L}return-1}var Dn="closure_lm_"+(1e6*Math.random()|0),pn={};function mt(l,f,g,b,L){if(Array.isArray(f)){for(var F=0;F<f.length;F++)mt(l,f[F],g,b,L);return null}return g=$d(g),l&&l[We]?l.K(f,g,h(b)?!!b.capture:!1,L):fi(l,f,g,!1,b,L)}function fi(l,f,g,b,L,F){if(!f)throw Error("Invalid event type");var G=h(L)?!!L.capture:!!L,Oe=Re(l);if(Oe||(l[Dn]=Oe=new Je(l)),g=Oe.add(f,g,b,G,F),g.proxy)return g;if(b=pi(),g.proxy=b,b.src=l,b.listener=g,l.addEventListener)Rt||(L=G),L===void 0&&(L=!1),l.addEventListener(f.toString(),b,L);else if(l.attachEvent)l.attachEvent(ko(f.toString()),b);else if(l.addListener&&l.removeListener)l.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return g}function pi(){function l(g){return f.call(l.src,l.listener,g)}const f=pe;return l}function Us(l,f,g,b,L){if(Array.isArray(f))for(var F=0;F<f.length;F++)Us(l,f[F],g,b,L);else b=h(b)?!!b.capture:!!b,g=$d(g),l&&l[We]?(l=l.i,f=String(f).toString(),f in l.g&&(F=l.g[f],g=lt(F,g,b,L),-1<g&&(xe(F[g]),Array.prototype.splice.call(F,g,1),F.length==0&&(delete l.g[f],l.h--)))):l&&(l=Re(l))&&(f=l.g[f.toString()],l=-1,f&&(l=lt(f,g,b,L)),(g=-1<l?f[l]:null)&&ir(g))}function ir(l){if(typeof l!="number"&&l&&!l.da){var f=l.src;if(f&&f[We])Le(f.i,l);else{var g=l.type,b=l.proxy;f.removeEventListener?f.removeEventListener(g,b,l.capture):f.detachEvent?f.detachEvent(ko(g),b):f.addListener&&f.removeListener&&f.removeListener(b),(g=Re(f))?(Le(g,l),g.h==0&&(g.src=null,f[Dn]=null)):xe(l)}}}function ko(l){return l in pn?pn[l]:pn[l]="on"+l}function pe(l,f){if(l.da)l=!0;else{f=new ne(f,this);var g=l.listener,b=l.ha||l.src;l.fa&&ir(l),l=g.call(b,f)}return l}function Re(l){return l=l[Dn],l instanceof Je?l:null}var gn="__closure_events_fn_"+(1e9*Math.random()>>>0);function $d(l){return typeof l=="function"?l:(l[gn]||(l[gn]=function(f){return l.handleEvent(f)}),l[gn])}function Et(){ce.call(this),this.i=new Je(this),this.M=this,this.F=null}v(Et,ce),Et.prototype[We]=!0,Et.prototype.removeEventListener=function(l,f,g,b){Us(this,l,f,g,b)};function Nt(l,f){var g,b=l.F;if(b)for(g=[];b;b=b.F)g.push(b);if(l=l.M,b=f.type||f,typeof f=="string")f=new ie(f,l);else if(f instanceof ie)f.target=f.target||l;else{var L=f;f=new ie(b,l),S(f,L)}if(L=!0,g)for(var F=g.length-1;0<=F;F--){var G=f.g=g[F];L=Fo(G,b,!0,f)&&L}if(G=f.g=l,L=Fo(G,b,!0,f)&&L,L=Fo(G,b,!1,f)&&L,g)for(F=0;F<g.length;F++)G=f.g=g[F],L=Fo(G,b,!1,f)&&L}Et.prototype.N=function(){if(Et.aa.N.call(this),this.i){var l=this.i,f;for(f in l.g){for(var g=l.g[f],b=0;b<g.length;b++)xe(g[b]);delete l.g[f],l.h--}}this.F=null},Et.prototype.K=function(l,f,g,b){return this.i.add(String(l),f,!1,g,b)},Et.prototype.L=function(l,f,g,b){return this.i.add(String(l),f,!0,g,b)};function Fo(l,f,g,b){if(f=l.i.g[String(f)],!f)return!0;f=f.concat();for(var L=!0,F=0;F<f.length;++F){var G=f[F];if(G&&!G.da&&G.capture==g){var Oe=G.listener,_t=G.ha||G.src;G.fa&&Le(l.i,G),L=Oe.call(_t,b)!==!1&&L}}return L&&!b.defaultPrevented}function Hd(l,f,g){if(typeof l=="function")g&&(l=m(l,g));else if(l&&typeof l.handleEvent=="function")l=m(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(f)?-1:a.setTimeout(l,f||0)}function Wd(l){l.g=Hd(()=>{l.g=null,l.i&&(l.i=!1,Wd(l))},l.l);const f=l.h;l.h=null,l.m.apply(null,f)}class d1 extends ce{constructor(f,g){super(),this.m=f,this.l=g,this.h=null,this.i=!1,this.g=null}j(f){this.h=arguments,this.g?this.i=!0:Wd(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function rr(l){ce.call(this),this.h=l,this.g={}}v(rr,ce);var Xd=[];function Gd(l){j(l.g,function(f,g){this.g.hasOwnProperty(g)&&ir(f)},l),l.g={}}rr.prototype.N=function(){rr.aa.N.call(this),Gd(this)},rr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var nc=a.JSON.stringify,f1=a.JSON.parse,p1=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function sc(){}sc.prototype.h=null;function zd(l){return l.h||(l.h=l.i())}function Yd(){}var or={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ic(){ie.call(this,"d")}v(ic,ie);function rc(){ie.call(this,"c")}v(rc,ie);var $s={},qd=null;function Oo(){return qd=qd||new Et}$s.La="serverreachability";function Kd(l){ie.call(this,$s.La,l)}v(Kd,ie);function ar(l){const f=Oo();Nt(f,new Kd(f))}$s.STAT_EVENT="statevent";function Qd(l,f){ie.call(this,$s.STAT_EVENT,l),this.stat=f}v(Qd,ie);function Mt(l){const f=Oo();Nt(f,new Qd(f,l))}$s.Ma="timingevent";function Jd(l,f){ie.call(this,$s.Ma,l),this.size=f}v(Jd,ie);function lr(l,f){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},f)}function cr(){this.g=!0}cr.prototype.xa=function(){this.g=!1};function g1(l,f,g,b,L,F){l.info(function(){if(l.g)if(F)for(var G="",Oe=F.split("&"),_t=0;_t<Oe.length;_t++){var Pe=Oe[_t].split("=");if(1<Pe.length){var At=Pe[0];Pe=Pe[1];var xt=At.split("_");G=2<=xt.length&&xt[1]=="type"?G+(At+"="+Pe+"&"):G+(At+"=redacted&")}}else G=null;else G=F;return"XMLHTTP REQ ("+b+") [attempt "+L+"]: "+f+`
`+g+`
`+G})}function m1(l,f,g,b,L,F,G){l.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+L+"]: "+f+`
`+g+`
`+F+" "+G})}function gi(l,f,g,b){l.info(function(){return"XMLHTTP TEXT ("+f+"): "+y1(l,g)+(b?" "+b:"")})}function _1(l,f){l.info(function(){return"TIMEOUT: "+f})}cr.prototype.info=function(){};function y1(l,f){if(!l.g)return f;if(!f)return null;try{var g=JSON.parse(f);if(g){for(l=0;l<g.length;l++)if(Array.isArray(g[l])){var b=g[l];if(!(2>b.length)){var L=b[1];if(Array.isArray(L)&&!(1>L.length)){var F=L[0];if(F!="noop"&&F!="stop"&&F!="close")for(var G=1;G<L.length;G++)L[G]=""}}}}return nc(g)}catch{return f}}var Vo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Zd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},oc;function Bo(){}v(Bo,sc),Bo.prototype.g=function(){return new XMLHttpRequest},Bo.prototype.i=function(){return{}},oc=new Bo;function ls(l,f,g,b){this.j=l,this.i=f,this.l=g,this.R=b||1,this.U=new rr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ef}function ef(){this.i=null,this.g="",this.h=!1}var tf={},ac={};function lc(l,f,g){l.L=1,l.v=Wo(Pn(f)),l.m=g,l.P=!0,nf(l,null)}function nf(l,f){l.F=Date.now(),Uo(l),l.A=Pn(l.v);var g=l.A,b=l.R;Array.isArray(b)||(b=[String(b)]),_f(g.i,"t",b),l.C=0,g=l.j.J,l.h=new ef,l.g=Lf(l.j,g?f:null,!l.m),0<l.O&&(l.M=new d1(m(l.Y,l,l.g),l.O)),f=l.U,g=l.g,b=l.ca;var L="readystatechange";Array.isArray(L)||(L&&(Xd[0]=L.toString()),L=Xd);for(var F=0;F<L.length;F++){var G=mt(g,L[F],b||f.handleEvent,!1,f.h||f);if(!G)break;f.g[G.key]=G}f=l.H?T(l.H):{},l.m?(l.u||(l.u="POST"),f["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,f)):(l.u="GET",l.g.ea(l.A,l.u,null,f)),ar(),g1(l.i,l.u,l.A,l.l,l.R,l.m)}ls.prototype.ca=function(l){l=l.target;const f=this.M;f&&Rn(l)==3?f.j():this.Y(l)},ls.prototype.Y=function(l){try{if(l==this.g)e:{const xt=Rn(this.g);var f=this.g.Ba();const yi=this.g.Z();if(!(3>xt)&&(xt!=3||this.g&&(this.h.h||this.g.oa()||xf(this.g)))){this.J||xt!=4||f==7||(f==8||0>=yi?ar(3):ar(2)),cc(this);var g=this.g.Z();this.X=g;t:if(sf(this)){var b=xf(this.g);l="";var L=b.length,F=Rn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Hs(this),ur(this);var G="";break t}this.h.i=new a.TextDecoder}for(f=0;f<L;f++)this.h.h=!0,l+=this.h.i.decode(b[f],{stream:!(F&&f==L-1)});b.length=0,this.h.g+=l,this.C=0,G=this.h.g}else G=this.g.oa();if(this.o=g==200,m1(this.i,this.u,this.A,this.l,this.R,xt,g),this.o){if(this.T&&!this.K){t:{if(this.g){var Oe,_t=this.g;if((Oe=_t.g?_t.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!A(Oe)){var Pe=Oe;break t}}Pe=null}if(g=Pe)gi(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,uc(this,g);else{this.o=!1,this.s=3,Mt(12),Hs(this),ur(this);break e}}if(this.P){g=!0;let sn;for(;!this.J&&this.C<G.length;)if(sn=v1(this,G),sn==ac){xt==4&&(this.s=4,Mt(14),g=!1),gi(this.i,this.l,null,"[Incomplete Response]");break}else if(sn==tf){this.s=4,Mt(15),gi(this.i,this.l,G,"[Invalid Chunk]"),g=!1;break}else gi(this.i,this.l,sn,null),uc(this,sn);if(sf(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),xt!=4||G.length!=0||this.h.h||(this.s=1,Mt(16),g=!1),this.o=this.o&&g,!g)gi(this.i,this.l,G,"[Invalid Chunked Response]"),Hs(this),ur(this);else if(0<G.length&&!this.W){this.W=!0;var At=this.j;At.g==this&&At.ba&&!At.M&&(At.j.info("Great, no buffering proxy detected. Bytes received: "+G.length),mc(At),At.M=!0,Mt(11))}}else gi(this.i,this.l,G,null),uc(this,G);xt==4&&Hs(this),this.o&&!this.J&&(xt==4?Rf(this.j,this):(this.o=!1,Uo(this)))}else k1(this.g),g==400&&0<G.indexOf("Unknown SID")?(this.s=3,Mt(12)):(this.s=0,Mt(13)),Hs(this),ur(this)}}}catch{}finally{}};function sf(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function v1(l,f){var g=l.C,b=f.indexOf(`
`,g);return b==-1?ac:(g=Number(f.substring(g,b)),isNaN(g)?tf:(b+=1,b+g>f.length?ac:(f=f.slice(b,b+g),l.C=b+g,f)))}ls.prototype.cancel=function(){this.J=!0,Hs(this)};function Uo(l){l.S=Date.now()+l.I,rf(l,l.I)}function rf(l,f){if(l.B!=null)throw Error("WatchDog timer not null");l.B=lr(m(l.ba,l),f)}function cc(l){l.B&&(a.clearTimeout(l.B),l.B=null)}ls.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?(_1(this.i,this.A),this.L!=2&&(ar(),Mt(17)),Hs(this),this.s=2,ur(this)):rf(this,this.S-l)};function ur(l){l.j.G==0||l.J||Rf(l.j,l)}function Hs(l){cc(l);var f=l.M;f&&typeof f.ma=="function"&&f.ma(),l.M=null,Gd(l.U),l.g&&(f=l.g,l.g=null,f.abort(),f.ma())}function uc(l,f){try{var g=l.j;if(g.G!=0&&(g.g==l||hc(g.h,l))){if(!l.K&&hc(g.h,l)&&g.G==3){try{var b=g.Da.g.parse(f)}catch{b=null}if(Array.isArray(b)&&b.length==3){var L=b;if(L[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<l.F)Ko(g),Yo(g);else break e;gc(g),Mt(18)}}else g.za=L[1],0<g.za-g.T&&37500>L[2]&&g.F&&g.v==0&&!g.C&&(g.C=lr(m(g.Za,g),6e3));if(1>=lf(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else Xs(g,11)}else if((l.K||g.g==l)&&Ko(g),!A(f))for(L=g.Da.g.parse(f),f=0;f<L.length;f++){let Pe=L[f];if(g.T=Pe[0],Pe=Pe[1],g.G==2)if(Pe[0]=="c"){g.K=Pe[1],g.ia=Pe[2];const At=Pe[3];At!=null&&(g.la=At,g.j.info("VER="+g.la));const xt=Pe[4];xt!=null&&(g.Aa=xt,g.j.info("SVER="+g.Aa));const yi=Pe[5];yi!=null&&typeof yi=="number"&&0<yi&&(b=1.5*yi,g.L=b,g.j.info("backChannelRequestTimeoutMs_="+b)),b=g;const sn=l.g;if(sn){const Jo=sn.g?sn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Jo){var F=b.h;F.g||Jo.indexOf("spdy")==-1&&Jo.indexOf("quic")==-1&&Jo.indexOf("h2")==-1||(F.j=F.l,F.g=new Set,F.h&&(dc(F,F.h),F.h=null))}if(b.D){const _c=sn.g?sn.g.getResponseHeader("X-HTTP-Session-Id"):null;_c&&(b.ya=_c,$e(b.I,b.D,_c))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-l.F,g.j.info("Handshake RTT: "+g.R+"ms")),b=g;var G=l;if(b.qa=jf(b,b.J?b.ia:null,b.W),G.K){cf(b.h,G);var Oe=G,_t=b.L;_t&&(Oe.I=_t),Oe.B&&(cc(Oe),Uo(Oe)),b.g=G}else Df(b);0<g.i.length&&qo(g)}else Pe[0]!="stop"&&Pe[0]!="close"||Xs(g,7);else g.G==3&&(Pe[0]=="stop"||Pe[0]=="close"?Pe[0]=="stop"?Xs(g,7):pc(g):Pe[0]!="noop"&&g.l&&g.l.ta(Pe),g.v=0)}}ar(4)}catch{}}var w1=class{constructor(l,f){this.g=l,this.map=f}};function of(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function af(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function lf(l){return l.h?1:l.g?l.g.size:0}function hc(l,f){return l.h?l.h==f:l.g?l.g.has(f):!1}function dc(l,f){l.g?l.g.add(f):l.h=f}function cf(l,f){l.h&&l.h==f?l.h=null:l.g&&l.g.has(f)&&l.g.delete(f)}of.prototype.cancel=function(){if(this.i=uf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function uf(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let f=l.i;for(const g of l.g.values())f=f.concat(g.D);return f}return w(l.i)}function T1(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(u(l)){for(var f=[],g=l.length,b=0;b<g;b++)f.push(l[b]);return f}f=[],g=0;for(b in l)f[g++]=l[b];return f}function E1(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||typeof l=="string"){var f=[];l=l.length;for(var g=0;g<l;g++)f.push(g);return f}f=[],g=0;for(const b in l)f[g++]=b;return f}}}function hf(l,f){if(l.forEach&&typeof l.forEach=="function")l.forEach(f,void 0);else if(u(l)||typeof l=="string")Array.prototype.forEach.call(l,f,void 0);else for(var g=E1(l),b=T1(l),L=b.length,F=0;F<L;F++)f.call(void 0,b[F],g&&g[F],l)}var df=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function A1(l,f){if(l){l=l.split("&");for(var g=0;g<l.length;g++){var b=l[g].indexOf("="),L=null;if(0<=b){var F=l[g].substring(0,b);L=l[g].substring(b+1)}else F=l[g];f(F,L?decodeURIComponent(L.replace(/\+/g," ")):"")}}}function Ws(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof Ws){this.h=l.h,$o(this,l.j),this.o=l.o,this.g=l.g,Ho(this,l.s),this.l=l.l;var f=l.i,g=new fr;g.i=f.i,f.g&&(g.g=new Map(f.g),g.h=f.h),ff(this,g),this.m=l.m}else l&&(f=String(l).match(df))?(this.h=!1,$o(this,f[1]||"",!0),this.o=hr(f[2]||""),this.g=hr(f[3]||"",!0),Ho(this,f[4]),this.l=hr(f[5]||"",!0),ff(this,f[6]||"",!0),this.m=hr(f[7]||"")):(this.h=!1,this.i=new fr(null,this.h))}Ws.prototype.toString=function(){var l=[],f=this.j;f&&l.push(dr(f,pf,!0),":");var g=this.g;return(g||f=="file")&&(l.push("//"),(f=this.o)&&l.push(dr(f,pf,!0),"@"),l.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&l.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&l.push("/"),l.push(dr(g,g.charAt(0)=="/"?S1:I1,!0))),(g=this.i.toString())&&l.push("?",g),(g=this.m)&&l.push("#",dr(g,C1)),l.join("")};function Pn(l){return new Ws(l)}function $o(l,f,g){l.j=g?hr(f,!0):f,l.j&&(l.j=l.j.replace(/:$/,""))}function Ho(l,f){if(f){if(f=Number(f),isNaN(f)||0>f)throw Error("Bad port number "+f);l.s=f}else l.s=null}function ff(l,f,g){f instanceof fr?(l.i=f,D1(l.i,l.h)):(g||(f=dr(f,b1)),l.i=new fr(f,l.h))}function $e(l,f,g){l.i.set(f,g)}function Wo(l){return $e(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function hr(l,f){return l?f?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function dr(l,f,g){return typeof l=="string"?(l=encodeURI(l).replace(f,x1),g&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function x1(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var pf=/[#\/\?@]/g,I1=/[#\?:]/g,S1=/[#\?]/g,b1=/[#\?@]/g,C1=/#/g;function fr(l,f){this.h=this.g=null,this.i=l||null,this.j=!!f}function cs(l){l.g||(l.g=new Map,l.h=0,l.i&&A1(l.i,function(f,g){l.add(decodeURIComponent(f.replace(/\+/g," ")),g)}))}t=fr.prototype,t.add=function(l,f){cs(this),this.i=null,l=mi(this,l);var g=this.g.get(l);return g||this.g.set(l,g=[]),g.push(f),this.h+=1,this};function gf(l,f){cs(l),f=mi(l,f),l.g.has(f)&&(l.i=null,l.h-=l.g.get(f).length,l.g.delete(f))}function mf(l,f){return cs(l),f=mi(l,f),l.g.has(f)}t.forEach=function(l,f){cs(this),this.g.forEach(function(g,b){g.forEach(function(L){l.call(f,L,b,this)},this)},this)},t.na=function(){cs(this);const l=Array.from(this.g.values()),f=Array.from(this.g.keys()),g=[];for(let b=0;b<f.length;b++){const L=l[b];for(let F=0;F<L.length;F++)g.push(f[b])}return g},t.V=function(l){cs(this);let f=[];if(typeof l=="string")mf(this,l)&&(f=f.concat(this.g.get(mi(this,l))));else{l=Array.from(this.g.values());for(let g=0;g<l.length;g++)f=f.concat(l[g])}return f},t.set=function(l,f){return cs(this),this.i=null,l=mi(this,l),mf(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[f]),this.h+=1,this},t.get=function(l,f){return l?(l=this.V(l),0<l.length?String(l[0]):f):f};function _f(l,f,g){gf(l,f),0<g.length&&(l.i=null,l.g.set(mi(l,f),w(g)),l.h+=g.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],f=Array.from(this.g.keys());for(var g=0;g<f.length;g++){var b=f[g];const F=encodeURIComponent(String(b)),G=this.V(b);for(b=0;b<G.length;b++){var L=F;G[b]!==""&&(L+="="+encodeURIComponent(String(G[b]))),l.push(L)}}return this.i=l.join("&")};function mi(l,f){return f=String(f),l.j&&(f=f.toLowerCase()),f}function D1(l,f){f&&!l.j&&(cs(l),l.i=null,l.g.forEach(function(g,b){var L=b.toLowerCase();b!=L&&(gf(this,b),_f(this,L,g))},l)),l.j=f}function P1(l,f){const g=new cr;if(a.Image){const b=new Image;b.onload=y(us,g,"TestLoadImage: loaded",!0,f,b),b.onerror=y(us,g,"TestLoadImage: error",!1,f,b),b.onabort=y(us,g,"TestLoadImage: abort",!1,f,b),b.ontimeout=y(us,g,"TestLoadImage: timeout",!1,f,b),a.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=l}else f(!1)}function R1(l,f){const g=new cr,b=new AbortController,L=setTimeout(()=>{b.abort(),us(g,"TestPingServer: timeout",!1,f)},1e4);fetch(l,{signal:b.signal}).then(F=>{clearTimeout(L),F.ok?us(g,"TestPingServer: ok",!0,f):us(g,"TestPingServer: server error",!1,f)}).catch(()=>{clearTimeout(L),us(g,"TestPingServer: error",!1,f)})}function us(l,f,g,b,L){try{L&&(L.onload=null,L.onerror=null,L.onabort=null,L.ontimeout=null),b(g)}catch{}}function N1(){this.g=new p1}function M1(l,f,g){const b=g||"";try{hf(l,function(L,F){let G=L;h(L)&&(G=nc(L)),f.push(b+F+"="+encodeURIComponent(G))})}catch(L){throw f.push(b+"type="+encodeURIComponent("_badmap")),L}}function Xo(l){this.l=l.Ub||null,this.j=l.eb||!1}v(Xo,sc),Xo.prototype.g=function(){return new Go(this.l,this.j)},Xo.prototype.i=function(l){return function(){return l}}({});function Go(l,f){Et.call(this),this.D=l,this.o=f,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}v(Go,Et),t=Go.prototype,t.open=function(l,f){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=f,this.readyState=1,gr(this)},t.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const f={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(f.body=l),(this.D||a).fetch(new Request(this.A,f)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,pr(this)),this.readyState=0},t.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,gr(this)),this.g&&(this.readyState=3,gr(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;yf(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function yf(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}t.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var f=l.value?l.value:new Uint8Array(0);(f=this.v.decode(f,{stream:!l.done}))&&(this.response=this.responseText+=f)}l.done?pr(this):gr(this),this.readyState==3&&yf(this)}},t.Ra=function(l){this.g&&(this.response=this.responseText=l,pr(this))},t.Qa=function(l){this.g&&(this.response=l,pr(this))},t.ga=function(){this.g&&pr(this)};function pr(l){l.readyState=4,l.l=null,l.j=null,l.v=null,gr(l)}t.setRequestHeader=function(l,f){this.u.append(l,f)},t.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],f=this.h.entries();for(var g=f.next();!g.done;)g=g.value,l.push(g[0]+": "+g[1]),g=f.next();return l.join(`\r
`)};function gr(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Go.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function vf(l){let f="";return j(l,function(g,b){f+=b,f+=":",f+=g,f+=`\r
`}),f}function fc(l,f,g){e:{for(b in g){var b=!1;break e}b=!0}b||(g=vf(g),typeof l=="string"?g!=null&&encodeURIComponent(String(g)):$e(l,f,g))}function qe(l){Et.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}v(qe,Et);var j1=/^https?$/i,L1=["POST","PUT"];t=qe.prototype,t.Ha=function(l){this.J=l},t.ea=function(l,f,g,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);f=f?f.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():oc.g(),this.v=this.o?zd(this.o):zd(oc),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(f,String(l),!0),this.B=!1}catch(F){wf(this,F);return}if(l=g||"",g=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var L in b)g.set(L,b[L]);else if(typeof b.keys=="function"&&typeof b.get=="function")for(const F of b.keys())g.set(F,b.get(F));else throw Error("Unknown input type for opt_headers: "+String(b));b=Array.from(g.keys()).find(F=>F.toLowerCase()=="content-type"),L=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(L1,f,void 0))||b||L||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[F,G]of g)this.g.setRequestHeader(F,G);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Af(this),this.u=!0,this.g.send(l),this.u=!1}catch(F){wf(this,F)}};function wf(l,f){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=f,l.m=5,Tf(l),zo(l)}function Tf(l){l.A||(l.A=!0,Nt(l,"complete"),Nt(l,"error"))}t.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,Nt(this,"complete"),Nt(this,"abort"),zo(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),zo(this,!0)),qe.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Ef(this):this.bb())},t.bb=function(){Ef(this)};function Ef(l){if(l.h&&typeof o<"u"&&(!l.v[1]||Rn(l)!=4||l.Z()!=2)){if(l.u&&Rn(l)==4)Hd(l.Ea,0,l);else if(Nt(l,"readystatechange"),Rn(l)==4){l.h=!1;try{const G=l.Z();e:switch(G){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var f=!0;break e;default:f=!1}var g;if(!(g=f)){var b;if(b=G===0){var L=String(l.D).match(df)[1]||null;!L&&a.self&&a.self.location&&(L=a.self.location.protocol.slice(0,-1)),b=!j1.test(L?L.toLowerCase():"")}g=b}if(g)Nt(l,"complete"),Nt(l,"success");else{l.m=6;try{var F=2<Rn(l)?l.g.statusText:""}catch{F=""}l.l=F+" ["+l.Z()+"]",Tf(l)}}finally{zo(l)}}}}function zo(l,f){if(l.g){Af(l);const g=l.g,b=l.v[0]?()=>{}:null;l.g=null,l.v=null,f||Nt(l,"ready");try{g.onreadystatechange=b}catch{}}}function Af(l){l.I&&(a.clearTimeout(l.I),l.I=null)}t.isActive=function(){return!!this.g};function Rn(l){return l.g?l.g.readyState:0}t.Z=function(){try{return 2<Rn(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(l){if(this.g){var f=this.g.responseText;return l&&f.indexOf(l)==0&&(f=f.substring(l.length)),f1(f)}};function xf(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function k1(l){const f={};l=(l.g&&2<=Rn(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let b=0;b<l.length;b++){if(A(l[b]))continue;var g=D(l[b]);const L=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const F=f[L]||[];f[L]=F,F.push(g)}I(f,function(b){return b.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function mr(l,f,g){return g&&g.internalChannelParams&&g.internalChannelParams[l]||f}function If(l){this.Aa=0,this.i=[],this.j=new cr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=mr("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=mr("baseRetryDelayMs",5e3,l),this.cb=mr("retryDelaySeedMs",1e4,l),this.Wa=mr("forwardChannelMaxRetries",2,l),this.wa=mr("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new of(l&&l.concurrentRequestLimit),this.Da=new N1,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=If.prototype,t.la=8,t.G=1,t.connect=function(l,f,g,b){Mt(0),this.W=l,this.H=f||{},g&&b!==void 0&&(this.H.OSID=g,this.H.OAID=b),this.F=this.X,this.I=jf(this,null,this.W),qo(this)};function pc(l){if(Sf(l),l.G==3){var f=l.U++,g=Pn(l.I);if($e(g,"SID",l.K),$e(g,"RID",f),$e(g,"TYPE","terminate"),_r(l,g),f=new ls(l,l.j,f),f.L=2,f.v=Wo(Pn(g)),g=!1,a.navigator&&a.navigator.sendBeacon)try{g=a.navigator.sendBeacon(f.v.toString(),"")}catch{}!g&&a.Image&&(new Image().src=f.v,g=!0),g||(f.g=Lf(f.j,null),f.g.ea(f.v)),f.F=Date.now(),Uo(f)}Mf(l)}function Yo(l){l.g&&(mc(l),l.g.cancel(),l.g=null)}function Sf(l){Yo(l),l.u&&(a.clearTimeout(l.u),l.u=null),Ko(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function qo(l){if(!af(l.h)&&!l.s){l.s=!0;var f=l.Ga;re||te(),fe||(re(),fe=!0),Z.add(f,l),l.B=0}}function F1(l,f){return lf(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=f.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=lr(m(l.Ga,l,f),Nf(l,l.B)),l.B++,!0)}t.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const L=new ls(this,this.j,l);let F=this.o;if(this.S&&(F?(F=T(F),S(F,this.S)):F=this.S),this.m!==null||this.O||(L.H=F,F=null),this.P)e:{for(var f=0,g=0;g<this.i.length;g++){t:{var b=this.i[g];if("__data__"in b.map&&(b=b.map.__data__,typeof b=="string")){b=b.length;break t}b=void 0}if(b===void 0)break;if(f+=b,4096<f){f=g;break e}if(f===4096||g===this.i.length-1){f=g+1;break e}}f=1e3}else f=1e3;f=Cf(this,L,f),g=Pn(this.I),$e(g,"RID",l),$e(g,"CVER",22),this.D&&$e(g,"X-HTTP-Session-Id",this.D),_r(this,g),F&&(this.O?f="headers="+encodeURIComponent(String(vf(F)))+"&"+f:this.m&&fc(g,this.m,F)),dc(this.h,L),this.Ua&&$e(g,"TYPE","init"),this.P?($e(g,"$req",f),$e(g,"SID","null"),L.T=!0,lc(L,g,null)):lc(L,g,f),this.G=2}}else this.G==3&&(l?bf(this,l):this.i.length==0||af(this.h)||bf(this))};function bf(l,f){var g;f?g=f.l:g=l.U++;const b=Pn(l.I);$e(b,"SID",l.K),$e(b,"RID",g),$e(b,"AID",l.T),_r(l,b),l.m&&l.o&&fc(b,l.m,l.o),g=new ls(l,l.j,g,l.B+1),l.m===null&&(g.H=l.o),f&&(l.i=f.D.concat(l.i)),f=Cf(l,g,1e3),g.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),dc(l.h,g),lc(g,b,f)}function _r(l,f){l.H&&j(l.H,function(g,b){$e(f,b,g)}),l.l&&hf({},function(g,b){$e(f,b,g)})}function Cf(l,f,g){g=Math.min(l.i.length,g);var b=l.l?m(l.l.Na,l.l,l):null;e:{var L=l.i;let F=-1;for(;;){const G=["count="+g];F==-1?0<g?(F=L[0].g,G.push("ofs="+F)):F=0:G.push("ofs="+F);let Oe=!0;for(let _t=0;_t<g;_t++){let Pe=L[_t].g;const At=L[_t].map;if(Pe-=F,0>Pe)F=Math.max(0,L[_t].g-100),Oe=!1;else try{M1(At,G,"req"+Pe+"_")}catch{b&&b(At)}}if(Oe){b=G.join("&");break e}}}return l=l.i.splice(0,g),f.D=l,b}function Df(l){if(!l.g&&!l.u){l.Y=1;var f=l.Fa;re||te(),fe||(re(),fe=!0),Z.add(f,l),l.v=0}}function gc(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=lr(m(l.Fa,l),Nf(l,l.v)),l.v++,!0)}t.Fa=function(){if(this.u=null,Pf(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=lr(m(this.ab,this),l)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Mt(10),Yo(this),Pf(this))};function mc(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function Pf(l){l.g=new ls(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var f=Pn(l.qa);$e(f,"RID","rpc"),$e(f,"SID",l.K),$e(f,"AID",l.T),$e(f,"CI",l.F?"0":"1"),!l.F&&l.ja&&$e(f,"TO",l.ja),$e(f,"TYPE","xmlhttp"),_r(l,f),l.m&&l.o&&fc(f,l.m,l.o),l.L&&(l.g.I=l.L);var g=l.g;l=l.ia,g.L=1,g.v=Wo(Pn(f)),g.m=null,g.P=!0,nf(g,l)}t.Za=function(){this.C!=null&&(this.C=null,Yo(this),gc(this),Mt(19))};function Ko(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function Rf(l,f){var g=null;if(l.g==f){Ko(l),mc(l),l.g=null;var b=2}else if(hc(l.h,f))g=f.D,cf(l.h,f),b=1;else return;if(l.G!=0){if(f.o)if(b==1){g=f.m?f.m.length:0,f=Date.now()-f.F;var L=l.B;b=Oo(),Nt(b,new Jd(b,g)),qo(l)}else Df(l);else if(L=f.s,L==3||L==0&&0<f.X||!(b==1&&F1(l,f)||b==2&&gc(l)))switch(g&&0<g.length&&(f=l.h,f.i=f.i.concat(g)),L){case 1:Xs(l,5);break;case 4:Xs(l,10);break;case 3:Xs(l,6);break;default:Xs(l,2)}}}function Nf(l,f){let g=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(g*=2),g*f}function Xs(l,f){if(l.j.info("Error code "+f),f==2){var g=m(l.fb,l),b=l.Xa;const L=!b;b=new Ws(b||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||$o(b,"https"),Wo(b),L?P1(b.toString(),g):R1(b.toString(),g)}else Mt(2);l.G=0,l.l&&l.l.sa(f),Mf(l),Sf(l)}t.fb=function(l){l?(this.j.info("Successfully pinged google.com"),Mt(2)):(this.j.info("Failed to ping google.com"),Mt(1))};function Mf(l){if(l.G=0,l.ka=[],l.l){const f=uf(l.h);(f.length!=0||l.i.length!=0)&&(E(l.ka,f),E(l.ka,l.i),l.h.i.length=0,w(l.i),l.i.length=0),l.l.ra()}}function jf(l,f,g){var b=g instanceof Ws?Pn(g):new Ws(g);if(b.g!="")f&&(b.g=f+"."+b.g),Ho(b,b.s);else{var L=a.location;b=L.protocol,f=f?f+"."+L.hostname:L.hostname,L=+L.port;var F=new Ws(null);b&&$o(F,b),f&&(F.g=f),L&&Ho(F,L),g&&(F.l=g),b=F}return g=l.D,f=l.ya,g&&f&&$e(b,g,f),$e(b,"VER",l.la),_r(l,b),b}function Lf(l,f,g){if(f&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return f=l.Ca&&!l.pa?new qe(new Xo({eb:g})):new qe(l.pa),f.Ha(l.J),f}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function kf(){}t=kf.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function Qo(){}Qo.prototype.g=function(l,f){return new Bt(l,f)};function Bt(l,f){Et.call(this),this.g=new If(f),this.l=l,this.h=f&&f.messageUrlParams||null,l=f&&f.messageHeaders||null,f&&f.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=f&&f.initMessageHeaders||null,f&&f.messageContentType&&(l?l["X-WebChannel-Content-Type"]=f.messageContentType:l={"X-WebChannel-Content-Type":f.messageContentType}),f&&f.va&&(l?l["X-WebChannel-Client-Profile"]=f.va:l={"X-WebChannel-Client-Profile":f.va}),this.g.S=l,(l=f&&f.Sb)&&!A(l)&&(this.g.m=l),this.v=f&&f.supportsCrossDomainXhr||!1,this.u=f&&f.sendRawJson||!1,(f=f&&f.httpSessionIdParam)&&!A(f)&&(this.g.D=f,l=this.h,l!==null&&f in l&&(l=this.h,f in l&&delete l[f])),this.j=new _i(this)}v(Bt,Et),Bt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Bt.prototype.close=function(){pc(this.g)},Bt.prototype.o=function(l){var f=this.g;if(typeof l=="string"){var g={};g.__data__=l,l=g}else this.u&&(g={},g.__data__=nc(l),l=g);f.i.push(new w1(f.Ya++,l)),f.G==3&&qo(f)},Bt.prototype.N=function(){this.g.l=null,delete this.j,pc(this.g),delete this.g,Bt.aa.N.call(this)};function Ff(l){ic.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var f=l.__sm__;if(f){e:{for(const g in f){l=g;break e}l=void 0}(this.i=l)&&(l=this.i,f=f!==null&&l in f?f[l]:void 0),this.data=f}else this.data=l}v(Ff,ic);function Of(){rc.call(this),this.status=1}v(Of,rc);function _i(l){this.g=l}v(_i,kf),_i.prototype.ua=function(){Nt(this.g,"a")},_i.prototype.ta=function(l){Nt(this.g,new Ff(l))},_i.prototype.sa=function(l){Nt(this.g,new Of)},_i.prototype.ra=function(){Nt(this.g,"b")},Qo.prototype.createWebChannel=Qo.prototype.g,Bt.prototype.send=Bt.prototype.o,Bt.prototype.open=Bt.prototype.m,Bt.prototype.close=Bt.prototype.close,R0=function(){return new Qo},P0=function(){return Oo()},D0=$s,Du={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Vo.NO_ERROR=0,Vo.TIMEOUT=8,Vo.HTTP_ERROR=6,Ma=Vo,Zd.COMPLETE="complete",C0=Zd,Yd.EventType=or,or.OPEN="a",or.CLOSE="b",or.ERROR="c",or.MESSAGE="d",Et.prototype.listen=Et.prototype.K,Rr=Yd,qe.prototype.listenOnce=qe.prototype.L,qe.prototype.getLastError=qe.prototype.Ka,qe.prototype.getLastErrorCode=qe.prototype.Ba,qe.prototype.getStatus=qe.prototype.Z,qe.prototype.getResponseJson=qe.prototype.Oa,qe.prototype.getResponseText=qe.prototype.oa,qe.prototype.send=qe.prototype.ea,qe.prototype.setWithCredentials=qe.prototype.Ha,b0=qe}).apply(typeof ta<"u"?ta:typeof self<"u"?self:typeof window<"u"?window:{});const yp="@firebase/firestore",vp="4.8.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}bt.UNAUTHENTICATED=new bt(null),bt.GOOGLE_CREDENTIALS=new bt("google-credentials-uid"),bt.FIRST_PARTY=new bt("first-party-uid"),bt.MOCK_USER=new bt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gi="11.10.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ii=new Ch("@firebase/firestore");function Ti(){return ii.logLevel}function Q(t,...e){if(ii.logLevel<=Ie.DEBUG){const n=e.map($h);ii.debug(`Firestore (${Gi}): ${t}`,...n)}}function Jn(t,...e){if(ii.logLevel<=Ie.ERROR){const n=e.map($h);ii.error(`Firestore (${Gi}): ${t}`,...n)}}function bs(t,...e){if(ii.logLevel<=Ie.WARN){const n=e.map($h);ii.warn(`Firestore (${Gi}): ${t}`,...n)}}function $h(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ae(t,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,N0(t,s,n)}function N0(t,e,n){let s=`FIRESTORE (${Gi}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{s+=" CONTEXT: "+JSON.stringify(n)}catch{s+=" CONTEXT: "+n}throw Jn(s),new Error(s)}function Me(t,e,n,s){let i="Unexpected state";typeof n=="string"?i=n:s=n,t||N0(e,i,s)}function me(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class q extends ss{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M0{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class pE{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(bt.UNAUTHENTICATED))}shutdown(){}}class gE{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class mE{constructor(e){this.t=e,this.currentUser=bt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Me(this.o===void 0,42304);let s=this.i;const i=u=>this.i!==s?(s=this.i,n(u)):Promise.resolve();let r=new qn;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new qn,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const u=r;e.enqueueRetryable(async()=>{await u.promise,await i(this.currentUser)})},a=u=>{Q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?a(u):(Q("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new qn)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(s=>this.i!==e?(Q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(Me(typeof s.accessToken=="string",31837,{l:s}),new M0(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Me(e===null||typeof e=="string",2055,{h:e}),new bt(e)}}class _E{constructor(e,n,s){this.P=e,this.T=n,this.I=s,this.type="FirstParty",this.user=bt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class yE{constructor(e,n,s){this.P=e,this.T=n,this.I=s}getToken(){return Promise.resolve(new _E(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(bt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class wp{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class vE{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,$t(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Me(this.o===void 0,3512);const s=r=>{r.error!=null&&Q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const o=r.token!==this.m;return this.m=r.token,Q("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable(()=>s(r))};const i=r=>{Q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(r=>i(r)),setTimeout(()=>{if(!this.appCheck){const r=this.V.getImmediate({optional:!0});r?i(r):Q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new wp(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Me(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new wp(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wE(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let s=0;s<t;s++)n[s]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j0(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hh{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const i=wE(40);for(let r=0;r<i.length;++r)s.length<20&&i[r]<n&&(s+=e.charAt(i[r]%62))}return s}}function Ee(t,e){return t<e?-1:t>e?1:0}function Pu(t,e){let n=0;for(;n<t.length&&n<e.length;){const s=t.codePointAt(n),i=e.codePointAt(n);if(s!==i){if(s<128&&i<128)return Ee(s,i);{const r=j0(),o=TE(r.encode(Tp(t,n)),r.encode(Tp(e,n)));return o!==0?o:Ee(s,i)}}n+=s>65535?2:1}return Ee(t.length,e.length)}function Tp(t,e){return t.codePointAt(e)>65535?t.substring(e,e+2):t.substring(e,e+1)}function TE(t,e){for(let n=0;n<t.length&&n<e.length;++n)if(t[n]!==e[n])return Ee(t[n],e[n]);return Ee(t.length,e.length)}function ki(t,e,n){return t.length===e.length&&t.every((s,i)=>n(s,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ep="__name__";class wn{constructor(e,n,s){n===void 0?n=0:n>e.length&&ae(637,{offset:n,range:e.length}),s===void 0?s=e.length-n:s>e.length-n&&ae(1746,{length:s,range:e.length-n}),this.segments=e,this.offset=n,this.len=s}get length(){return this.len}isEqual(e){return wn.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof wn?e.forEach(s=>{n.push(s)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,s=this.limit();n<s;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const s=Math.min(e.length,n.length);for(let i=0;i<s;i++){const r=wn.compareSegments(e.get(i),n.get(i));if(r!==0)return r}return Ee(e.length,n.length)}static compareSegments(e,n){const s=wn.isNumericId(e),i=wn.isNumericId(n);return s&&!i?-1:!s&&i?1:s&&i?wn.extractNumericId(e).compare(wn.extractNumericId(n)):Pu(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return xs.fromString(e.substring(4,e.length-2))}}class Be extends wn{construct(e,n,s){return new Be(e,n,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const s of e){if(s.indexOf("//")>=0)throw new q(U.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);n.push(...s.split("/").filter(i=>i.length>0))}return new Be(n)}static emptyPath(){return new Be([])}}const EE=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class wt extends wn{construct(e,n,s){return new wt(e,n,s)}static isValidIdentifier(e){return EE.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),wt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Ep}static keyField(){return new wt([Ep])}static fromServerFormat(e){const n=[];let s="",i=0;const r=()=>{if(s.length===0)throw new q(U.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(s),s=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new q(U.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new q(U.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(s+=a,i++):(r(),i++)}if(r(),o)throw new q(U.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new wt(n)}static emptyPath(){return new wt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ee{constructor(e){this.path=e}static fromPath(e){return new ee(Be.fromString(e))}static fromName(e){return new ee(Be.fromString(e).popFirst(5))}static empty(){return new ee(Be.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Be.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Be.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ee(new Be(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L0(t,e,n){if(!n)throw new q(U.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function AE(t,e,n,s){if(e===!0&&s===!0)throw new q(U.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Ap(t){if(!ee.isDocumentKey(t))throw new q(U.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function xp(t){if(ee.isDocumentKey(t))throw new q(U.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function k0(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Pl(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ae(12329,{type:typeof t})}function Zn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new q(U.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Pl(t);throw new q(U.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ot(t,e){const n={typeString:t};return e&&(n.value=e),n}function xo(t,e){if(!k0(t))throw new q(U.INVALID_ARGUMENT,"JSON must be an object");let n;for(const s in e)if(e[s]){const i=e[s].typeString,r="value"in e[s]?{value:e[s].value}:void 0;if(!(s in t)){n=`JSON missing required field: '${s}'`;break}const o=t[s];if(i&&typeof o!==i){n=`JSON field '${s}' must be a ${i}.`;break}if(r!==void 0&&o!==r.value){n=`Expected '${s}' field to equal '${r.value}'`;break}}if(n)throw new q(U.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ip=-62135596800,Sp=1e6;class He{static now(){return He.fromMillis(Date.now())}static fromDate(e){return He.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),s=Math.floor((e-1e3*n)*Sp);return new He(n,s)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new q(U.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new q(U.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Ip)throw new q(U.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new q(U.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Sp}_compareTo(e){return this.seconds===e.seconds?Ee(this.nanoseconds,e.nanoseconds):Ee(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:He._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(xo(e,He._jsonSchema))return new He(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Ip;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}He._jsonSchemaVersion="firestore/timestamp/1.0",He._jsonSchema={type:ot("string",He._jsonSchemaVersion),seconds:ot("number"),nanoseconds:ot("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class de{static fromTimestamp(e){return new de(e)}static min(){return new de(new He(0,0))}static max(){return new de(new He(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eo=-1;function xE(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,i=de.fromTimestamp(s===1e9?new He(n+1,0):new He(n,s));return new Cs(i,ee.empty(),e)}function IE(t){return new Cs(t.readTime,t.key,eo)}class Cs{constructor(e,n,s){this.readTime=e,this.documentKey=n,this.largestBatchId=s}static min(){return new Cs(de.min(),ee.empty(),eo)}static max(){return new Cs(de.max(),ee.empty(),eo)}}function SE(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=ee.comparator(t.documentKey,e.documentKey),n!==0?n:Ee(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class CE{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zi(t){if(t.code!==U.FAILED_PRECONDITION||t.message!==bE)throw t;Q("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ${constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&ae(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new $((s,i)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(s,i)},this.catchCallback=r=>{this.wrapFailure(n,r).next(s,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof $?n:$.resolve(n)}catch(n){return $.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):$.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):$.reject(n)}static resolve(e){return new $((n,s)=>{n(e)})}static reject(e){return new $((n,s)=>{s(e)})}static waitFor(e){return new $((n,s)=>{let i=0,r=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++r,o&&r===i&&n()},u=>s(u))}),o=!0,r===i&&n()})}static or(e){let n=$.resolve(!1);for(const s of e)n=n.next(i=>i?$.resolve(i):s());return n}static forEach(e,n){const s=[];return e.forEach((i,r)=>{s.push(n.call(this,i,r))}),this.waitFor(s)}static mapArray(e,n){return new $((s,i)=>{const r=e.length,o=new Array(r);let a=0;for(let u=0;u<r;u++){const h=u;n(e[h]).next(d=>{o[h]=d,++a,a===r&&s(o)},d=>i(d))}})}static doWhile(e,n){return new $((s,i)=>{const r=()=>{e()===!0?n().next(()=>{r()},i):s()};r()})}}function DE(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Yi(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rl{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=s=>this._e(s),this.ae=s=>n.writeSequenceNumber(s))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}Rl.ue=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wh=-1;function Nl(t){return t==null}function Ka(t){return t===0&&1/t==-1/0}function PE(t){return typeof t=="number"&&Number.isInteger(t)&&!Ka(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F0="";function RE(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=bp(e)),e=NE(t.get(n),e);return bp(e)}function NE(t,e){let n=e;const s=t.length;for(let i=0;i<s;i++){const r=t.charAt(i);switch(r){case"\0":n+="";break;case F0:n+="";break;default:n+=r}}return n}function bp(t){return t+F0+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cp(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Fs(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function O0(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ze{constructor(e,n){this.comparator=e,this.root=n||vt.EMPTY}insert(e,n){return new ze(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,vt.BLACK,null,null))}remove(e){return new ze(this.comparator,this.root.remove(e,this.comparator).copy(null,null,vt.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(s===0)return n.value;s<0?n=n.left:s>0&&(n=n.right)}return null}indexOf(e){let n=0,s=this.root;for(;!s.isEmpty();){const i=this.comparator(e,s.key);if(i===0)return n+s.left.size;i<0?s=s.left:(n+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,s)=>(e(n,s),!1))}toString(){const e=[];return this.inorderTraversal((n,s)=>(e.push(`${n}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new na(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new na(this.root,e,this.comparator,!1)}getReverseIterator(){return new na(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new na(this.root,e,this.comparator,!0)}}class na{constructor(e,n,s,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=n?s(e.key,n):1,n&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class vt{constructor(e,n,s,i,r){this.key=e,this.value=n,this.color=s??vt.RED,this.left=i??vt.EMPTY,this.right=r??vt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,s,i,r){return new vt(e??this.key,n??this.value,s??this.color,i??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,s){let i=this;const r=s(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,n,s),null):r===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,s)),i.fixUp()}removeMin(){if(this.left.isEmpty())return vt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let s,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return vt.EMPTY;s=i.right.min(),i=i.copy(s.key,s.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,vt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,vt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ae(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ae(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ae(27949);return e+(this.isRed()?0:1)}}vt.EMPTY=null,vt.RED=!0,vt.BLACK=!1;vt.EMPTY=new class{constructor(){this.size=0}get key(){throw ae(57766)}get value(){throw ae(16141)}get color(){throw ae(16727)}get left(){throw ae(29726)}get right(){throw ae(36894)}copy(e,n,s,i,r){return this}insert(e,n,s){return new vt(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(e){this.comparator=e,this.data=new ze(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,s)=>(e(n),!1))}forEachInRange(e,n){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const i=s.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let s;for(s=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Dp(this.data.getIterator())}getIteratorFrom(e){return new Dp(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(s=>{n=n.add(s)}),n}isEqual(e){if(!(e instanceof ht)||this.size!==e.size)return!1;const n=this.data.getIterator(),s=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,r=s.getNext().key;if(this.comparator(i,r)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new ht(this.comparator);return n.data=e,n}}class Dp{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(e){this.fields=e,e.sort(wt.comparator)}static empty(){return new Ht([])}unionWith(e){let n=new ht(wt.comparator);for(const s of this.fields)n=n.add(s);for(const s of e)n=n.add(s);return new Ht(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return ki(this.fields,e.fields,(n,s)=>n.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V0 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(i){try{return atob(i)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new V0("Invalid base64 string: "+r):r}}(e);return new Tt(n)}static fromUint8Array(e){const n=function(i){let r="";for(let o=0;o<i.length;++o)r+=String.fromCharCode(i[o]);return r}(e);return new Tt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const s=new Uint8Array(n.length);for(let i=0;i<n.length;i++)s[i]=n.charCodeAt(i);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ee(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Tt.EMPTY_BYTE_STRING=new Tt("");const ME=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ds(t){if(Me(!!t,39018),typeof t=="string"){let e=0;const n=ME.exec(t);if(Me(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Ze(t.seconds),nanos:Ze(t.nanos)}}function Ze(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ps(t){return typeof t=="string"?Tt.fromBase64String(t):Tt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B0="server_timestamp",U0="__type__",$0="__previous_value__",H0="__local_write_time__";function Xh(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{})[U0])===null||n===void 0?void 0:n.stringValue)===B0}function Ml(t){const e=t.mapValue.fields[$0];return Xh(e)?Ml(e):e}function to(t){const e=Ds(t.mapValue.fields[H0].timestampValue);return new He(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jE{constructor(e,n,s,i,r,o,a,u,h,d){this.databaseId=e,this.appId=n,this.persistenceKey=s,this.host=i,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=d}}const Qa="(default)";class no{constructor(e,n){this.projectId=e,this.database=n||Qa}static empty(){return new no("","")}get isDefaultDatabase(){return this.database===Qa}isEqual(e){return e instanceof no&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W0="__type__",LE="__max__",sa={mapValue:{}},X0="__vector__",Ja="value";function Rs(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Xh(t)?4:FE(t)?9007199254740991:kE(t)?10:11:ae(28295,{value:t})}function Cn(t,e){if(t===e)return!0;const n=Rs(t);if(n!==Rs(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return to(t).isEqual(to(e));case 3:return function(i,r){if(typeof i.timestampValue=="string"&&typeof r.timestampValue=="string"&&i.timestampValue.length===r.timestampValue.length)return i.timestampValue===r.timestampValue;const o=Ds(i.timestampValue),a=Ds(r.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,r){return Ps(i.bytesValue).isEqual(Ps(r.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,r){return Ze(i.geoPointValue.latitude)===Ze(r.geoPointValue.latitude)&&Ze(i.geoPointValue.longitude)===Ze(r.geoPointValue.longitude)}(t,e);case 2:return function(i,r){if("integerValue"in i&&"integerValue"in r)return Ze(i.integerValue)===Ze(r.integerValue);if("doubleValue"in i&&"doubleValue"in r){const o=Ze(i.doubleValue),a=Ze(r.doubleValue);return o===a?Ka(o)===Ka(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return ki(t.arrayValue.values||[],e.arrayValue.values||[],Cn);case 10:case 11:return function(i,r){const o=i.mapValue.fields||{},a=r.mapValue.fields||{};if(Cp(o)!==Cp(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!Cn(o[u],a[u])))return!1;return!0}(t,e);default:return ae(52216,{left:t})}}function so(t,e){return(t.values||[]).find(n=>Cn(n,e))!==void 0}function Fi(t,e){if(t===e)return 0;const n=Rs(t),s=Rs(e);if(n!==s)return Ee(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ee(t.booleanValue,e.booleanValue);case 2:return function(r,o){const a=Ze(r.integerValue||r.doubleValue),u=Ze(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(t,e);case 3:return Pp(t.timestampValue,e.timestampValue);case 4:return Pp(to(t),to(e));case 5:return Pu(t.stringValue,e.stringValue);case 6:return function(r,o){const a=Ps(r),u=Ps(o);return a.compareTo(u)}(t.bytesValue,e.bytesValue);case 7:return function(r,o){const a=r.split("/"),u=o.split("/");for(let h=0;h<a.length&&h<u.length;h++){const d=Ee(a[h],u[h]);if(d!==0)return d}return Ee(a.length,u.length)}(t.referenceValue,e.referenceValue);case 8:return function(r,o){const a=Ee(Ze(r.latitude),Ze(o.latitude));return a!==0?a:Ee(Ze(r.longitude),Ze(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Rp(t.arrayValue,e.arrayValue);case 10:return function(r,o){var a,u,h,d;const p=r.fields||{},m=o.fields||{},y=(a=p[Ja])===null||a===void 0?void 0:a.arrayValue,v=(u=m[Ja])===null||u===void 0?void 0:u.arrayValue,w=Ee(((h=y==null?void 0:y.values)===null||h===void 0?void 0:h.length)||0,((d=v==null?void 0:v.values)===null||d===void 0?void 0:d.length)||0);return w!==0?w:Rp(y,v)}(t.mapValue,e.mapValue);case 11:return function(r,o){if(r===sa.mapValue&&o===sa.mapValue)return 0;if(r===sa.mapValue)return 1;if(o===sa.mapValue)return-1;const a=r.fields||{},u=Object.keys(a),h=o.fields||{},d=Object.keys(h);u.sort(),d.sort();for(let p=0;p<u.length&&p<d.length;++p){const m=Pu(u[p],d[p]);if(m!==0)return m;const y=Fi(a[u[p]],h[d[p]]);if(y!==0)return y}return Ee(u.length,d.length)}(t.mapValue,e.mapValue);default:throw ae(23264,{le:n})}}function Pp(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Ee(t,e);const n=Ds(t),s=Ds(e),i=Ee(n.seconds,s.seconds);return i!==0?i:Ee(n.nanos,s.nanos)}function Rp(t,e){const n=t.values||[],s=e.values||[];for(let i=0;i<n.length&&i<s.length;++i){const r=Fi(n[i],s[i]);if(r)return r}return Ee(n.length,s.length)}function Oi(t){return Ru(t)}function Ru(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const s=Ds(n);return`time(${s.seconds},${s.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Ps(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return ee.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let s="[",i=!0;for(const r of n.values||[])i?i=!1:s+=",",s+=Ru(r);return s+"]"}(t.arrayValue):"mapValue"in t?function(n){const s=Object.keys(n.fields||{}).sort();let i="{",r=!0;for(const o of s)r?r=!1:i+=",",i+=`${o}:${Ru(n.fields[o])}`;return i+"}"}(t.mapValue):ae(61005,{value:t})}function ja(t){switch(Rs(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ml(t);return e?16+ja(e):16;case 5:return 2*t.stringValue.length;case 6:return Ps(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(s){return(s.values||[]).reduce((i,r)=>i+ja(r),0)}(t.arrayValue);case 10:case 11:return function(s){let i=0;return Fs(s.fields,(r,o)=>{i+=r.length+ja(o)}),i}(t.mapValue);default:throw ae(13486,{value:t})}}function Np(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Nu(t){return!!t&&"integerValue"in t}function Gh(t){return!!t&&"arrayValue"in t}function Mp(t){return!!t&&"nullValue"in t}function jp(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function La(t){return!!t&&"mapValue"in t}function kE(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{})[W0])===null||n===void 0?void 0:n.stringValue)===X0}function Br(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Fs(t.mapValue.fields,(n,s)=>e.mapValue.fields[n]=Br(s)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Br(t.arrayValue.values[n]);return e}return Object.assign({},t)}function FE(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===LE}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e){this.value=e}static empty(){return new Ot({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let s=0;s<e.length-1;++s)if(n=(n.mapValue.fields||{})[e.get(s)],!La(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Br(n)}setAll(e){let n=wt.emptyPath(),s={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const u=this.getFieldsMap(n);this.applyChanges(u,s,i),s={},i=[],n=a.popLast()}o?s[a.lastSegment()]=Br(o):i.push(a.lastSegment())});const r=this.getFieldsMap(n);this.applyChanges(r,s,i)}delete(e){const n=this.field(e.popLast());La(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Cn(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let s=0;s<e.length;++s){let i=n.mapValue.fields[e.get(s)];La(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(s)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,s){Fs(n,(i,r)=>e[i]=r);for(const i of s)delete e[i]}clone(){return new Ot(Br(this.value))}}function G0(t){const e=[];return Fs(t.fields,(n,s)=>{const i=new wt([n]);if(La(s)){const r=G0(s.mapValue).fields;if(r.length===0)e.push(i);else for(const o of r)e.push(i.child(o))}else e.push(i)}),new Ht(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(e,n,s,i,r,o,a){this.key=e,this.documentType=n,this.version=s,this.readTime=i,this.createTime=r,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Ct(e,0,de.min(),de.min(),de.min(),Ot.empty(),0)}static newFoundDocument(e,n,s,i){return new Ct(e,1,n,de.min(),s,i,0)}static newNoDocument(e,n){return new Ct(e,2,n,de.min(),de.min(),Ot.empty(),0)}static newUnknownDocument(e,n){return new Ct(e,3,n,de.min(),de.min(),Ot.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(de.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ot.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ot.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=de.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ct&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ct(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Za{constructor(e,n){this.position=e,this.inclusive=n}}function Lp(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(r.field.isKeyField()?s=ee.comparator(ee.fromName(o.referenceValue),n.key):s=Fi(o,n.data.field(r.field)),r.dir==="desc"&&(s*=-1),s!==0)break}return s}function kp(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Cn(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class io{constructor(e,n="asc"){this.field=e,this.dir=n}}function OE(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z0{}class rt extends z0{constructor(e,n,s){super(),this.field=e,this.op=n,this.value=s}static create(e,n,s){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,s):new BE(e,n,s):n==="array-contains"?new HE(e,s):n==="in"?new WE(e,s):n==="not-in"?new XE(e,s):n==="array-contains-any"?new GE(e,s):new rt(e,n,s)}static createKeyFieldInFilter(e,n,s){return n==="in"?new UE(e,s):new $E(e,s)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Fi(n,this.value)):n!==null&&Rs(this.value)===Rs(n)&&this.matchesComparison(Fi(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ae(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class dn extends z0{constructor(e,n){super(),this.filters=e,this.op=n,this.he=null}static create(e,n){return new dn(e,n)}matches(e){return Y0(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function Y0(t){return t.op==="and"}function q0(t){return VE(t)&&Y0(t)}function VE(t){for(const e of t.filters)if(e instanceof dn)return!1;return!0}function Mu(t){if(t instanceof rt)return t.field.canonicalString()+t.op.toString()+Oi(t.value);if(q0(t))return t.filters.map(e=>Mu(e)).join(",");{const e=t.filters.map(n=>Mu(n)).join(",");return`${t.op}(${e})`}}function K0(t,e){return t instanceof rt?function(s,i){return i instanceof rt&&s.op===i.op&&s.field.isEqual(i.field)&&Cn(s.value,i.value)}(t,e):t instanceof dn?function(s,i){return i instanceof dn&&s.op===i.op&&s.filters.length===i.filters.length?s.filters.reduce((r,o,a)=>r&&K0(o,i.filters[a]),!0):!1}(t,e):void ae(19439)}function Q0(t){return t instanceof rt?function(n){return`${n.field.canonicalString()} ${n.op} ${Oi(n.value)}`}(t):t instanceof dn?function(n){return n.op.toString()+" {"+n.getFilters().map(Q0).join(" ,")+"}"}(t):"Filter"}class BE extends rt{constructor(e,n,s){super(e,n,s),this.key=ee.fromName(s.referenceValue)}matches(e){const n=ee.comparator(e.key,this.key);return this.matchesComparison(n)}}class UE extends rt{constructor(e,n){super(e,"in",n),this.keys=J0("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class $E extends rt{constructor(e,n){super(e,"not-in",n),this.keys=J0("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function J0(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(s=>ee.fromName(s.referenceValue))}class HE extends rt{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Gh(n)&&so(n.arrayValue,this.value)}}class WE extends rt{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&so(this.value.arrayValue,n)}}class XE extends rt{constructor(e,n){super(e,"not-in",n)}matches(e){if(so(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!so(this.value.arrayValue,n)}}class GE extends rt{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Gh(n)||!n.arrayValue.values)&&n.arrayValue.values.some(s=>so(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zE{constructor(e,n=null,s=[],i=[],r=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=s,this.filters=i,this.limit=r,this.startAt=o,this.endAt=a,this.Pe=null}}function Fp(t,e=null,n=[],s=[],i=null,r=null,o=null){return new zE(t,e,n,s,i,r,o)}function zh(t){const e=me(t);if(e.Pe===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(s=>Mu(s)).join(","),n+="|ob:",n+=e.orderBy.map(s=>function(r){return r.field.canonicalString()+r.dir}(s)).join(","),Nl(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(s=>Oi(s)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(s=>Oi(s)).join(",")),e.Pe=n}return e.Pe}function Yh(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!OE(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!K0(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!kp(t.startAt,e.startAt)&&kp(t.endAt,e.endAt)}function ju(t){return ee.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e,n=null,s=[],i=[],r=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=s,this.filters=i,this.limit=r,this.limitType=o,this.startAt=a,this.endAt=u,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function YE(t,e,n,s,i,r,o,a){return new qi(t,e,n,s,i,r,o,a)}function qh(t){return new qi(t)}function Op(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Z0(t){return t.collectionGroup!==null}function Ur(t){const e=me(t);if(e.Te===null){e.Te=[];const n=new Set;for(const r of e.explicitOrderBy)e.Te.push(r),n.add(r.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ht(wt.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(a=a.add(h.field))})}),a})(e).forEach(r=>{n.has(r.canonicalString())||r.isKeyField()||e.Te.push(new io(r,s))}),n.has(wt.keyField().canonicalString())||e.Te.push(new io(wt.keyField(),s))}return e.Te}function xn(t){const e=me(t);return e.Ie||(e.Ie=qE(e,Ur(t))),e.Ie}function qE(t,e){if(t.limitType==="F")return Fp(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const r=i.dir==="desc"?"asc":"desc";return new io(i.field,r)});const n=t.endAt?new Za(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new Za(t.startAt.position,t.startAt.inclusive):null;return Fp(t.path,t.collectionGroup,e,t.filters,t.limit,n,s)}}function Lu(t,e){const n=t.filters.concat([e]);return new qi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function ku(t,e,n){return new qi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function jl(t,e){return Yh(xn(t),xn(e))&&t.limitType===e.limitType}function e_(t){return`${zh(xn(t))}|lt:${t.limitType}`}function Ei(t){return`Query(target=${function(n){let s=n.path.canonicalString();return n.collectionGroup!==null&&(s+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(s+=`, filters: [${n.filters.map(i=>Q0(i)).join(", ")}]`),Nl(n.limit)||(s+=", limit: "+n.limit),n.orderBy.length>0&&(s+=`, orderBy: [${n.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),n.startAt&&(s+=", startAt: ",s+=n.startAt.inclusive?"b:":"a:",s+=n.startAt.position.map(i=>Oi(i)).join(",")),n.endAt&&(s+=", endAt: ",s+=n.endAt.inclusive?"a:":"b:",s+=n.endAt.position.map(i=>Oi(i)).join(",")),`Target(${s})`}(xn(t))}; limitType=${t.limitType})`}function Ll(t,e){return e.isFoundDocument()&&function(s,i){const r=i.key.path;return s.collectionGroup!==null?i.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(r):ee.isDocumentKey(s.path)?s.path.isEqual(r):s.path.isImmediateParentOf(r)}(t,e)&&function(s,i){for(const r of Ur(s))if(!r.field.isKeyField()&&i.data.field(r.field)===null)return!1;return!0}(t,e)&&function(s,i){for(const r of s.filters)if(!r.matches(i))return!1;return!0}(t,e)&&function(s,i){return!(s.startAt&&!function(o,a,u){const h=Lp(o,a,u);return o.inclusive?h<=0:h<0}(s.startAt,Ur(s),i)||s.endAt&&!function(o,a,u){const h=Lp(o,a,u);return o.inclusive?h>=0:h>0}(s.endAt,Ur(s),i))}(t,e)}function KE(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function t_(t){return(e,n)=>{let s=!1;for(const i of Ur(t)){const r=QE(i,e,n);if(r!==0)return r;s=s||i.field.isKeyField()}return 0}}function QE(t,e,n){const s=t.field.isKeyField()?ee.comparator(e.key,n.key):function(r,o,a){const u=o.data.field(r),h=a.data.field(r);return u!==null&&h!==null?Fi(u,h):ae(42886)}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return ae(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class li{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),s=this.inner[n];if(s!==void 0){for(const[i,r]of s)if(this.equalsFn(i,e))return r}}has(e){return this.get(e)!==void 0}set(e,n){const s=this.mapKeyFn(e),i=this.inner[s];if(i===void 0)return this.inner[s]=[[e,n]],void this.innerSize++;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return void(i[r]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),s=this.inner[n];if(s===void 0)return!1;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return s.length===1?delete this.inner[n]:s.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Fs(this.inner,(n,s)=>{for(const[i,r]of s)e(i,r)})}isEmpty(){return O0(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JE=new ze(ee.comparator);function es(){return JE}const n_=new ze(ee.comparator);function Nr(...t){let e=n_;for(const n of t)e=e.insert(n.key,n);return e}function s_(t){let e=n_;return t.forEach((n,s)=>e=e.insert(n,s.overlayedDocument)),e}function Js(){return $r()}function i_(){return $r()}function $r(){return new li(t=>t.toString(),(t,e)=>t.isEqual(e))}const ZE=new ze(ee.comparator),eA=new ht(ee.comparator);function Se(...t){let e=eA;for(const n of t)e=e.add(n);return e}const tA=new ht(Ee);function nA(){return tA}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kh(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ka(e)?"-0":e}}function r_(t){return{integerValue:""+t}}function sA(t,e){return PE(e)?r_(e):Kh(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl{constructor(){this._=void 0}}function iA(t,e,n){return t instanceof ro?function(i,r){const o={fields:{[U0]:{stringValue:B0},[H0]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return r&&Xh(r)&&(r=Ml(r)),r&&(o.fields[$0]=r),{mapValue:o}}(n,e):t instanceof oo?a_(t,e):t instanceof ao?l_(t,e):function(i,r){const o=o_(i,r),a=Vp(o)+Vp(i.Ee);return Nu(o)&&Nu(i.Ee)?r_(a):Kh(i.serializer,a)}(t,e)}function rA(t,e,n){return t instanceof oo?a_(t,e):t instanceof ao?l_(t,e):n}function o_(t,e){return t instanceof el?function(s){return Nu(s)||function(r){return!!r&&"doubleValue"in r}(s)}(e)?e:{integerValue:0}:null}class ro extends kl{}class oo extends kl{constructor(e){super(),this.elements=e}}function a_(t,e){const n=c_(e);for(const s of t.elements)n.some(i=>Cn(i,s))||n.push(s);return{arrayValue:{values:n}}}class ao extends kl{constructor(e){super(),this.elements=e}}function l_(t,e){let n=c_(e);for(const s of t.elements)n=n.filter(i=>!Cn(i,s));return{arrayValue:{values:n}}}class el extends kl{constructor(e,n){super(),this.serializer=e,this.Ee=n}}function Vp(t){return Ze(t.integerValue||t.doubleValue)}function c_(t){return Gh(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oA{constructor(e,n){this.field=e,this.transform=n}}function aA(t,e){return t.field.isEqual(e.field)&&function(s,i){return s instanceof oo&&i instanceof oo||s instanceof ao&&i instanceof ao?ki(s.elements,i.elements,Cn):s instanceof el&&i instanceof el?Cn(s.Ee,i.Ee):s instanceof ro&&i instanceof ro}(t.transform,e.transform)}class lA{constructor(e,n){this.version=e,this.transformResults=n}}class hn{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new hn}static exists(e){return new hn(void 0,e)}static updateTime(e){return new hn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ka(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Fl{}function u_(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Qh(t.key,hn.none()):new Io(t.key,t.data,hn.none());{const n=t.data,s=Ot.empty();let i=new ht(wt.comparator);for(let r of e.fields)if(!i.has(r)){let o=n.field(r);o===null&&r.length>1&&(r=r.popLast(),o=n.field(r)),o===null?s.delete(r):s.set(r,o),i=i.add(r)}return new Os(t.key,s,new Ht(i.toArray()),hn.none())}}function cA(t,e,n){t instanceof Io?function(i,r,o){const a=i.value.clone(),u=Up(i.fieldTransforms,r,o.transformResults);a.setAll(u),r.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof Os?function(i,r,o){if(!ka(i.precondition,r))return void r.convertToUnknownDocument(o.version);const a=Up(i.fieldTransforms,r,o.transformResults),u=r.data;u.setAll(h_(i)),u.setAll(a),r.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(t,e,n):function(i,r,o){r.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function Hr(t,e,n,s){return t instanceof Io?function(r,o,a,u){if(!ka(r.precondition,o))return a;const h=r.value.clone(),d=$p(r.fieldTransforms,u,o);return h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(t,e,n,s):t instanceof Os?function(r,o,a,u){if(!ka(r.precondition,o))return a;const h=$p(r.fieldTransforms,u,o),d=o.data;return d.setAll(h_(r)),d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(p=>p.field))}(t,e,n,s):function(r,o,a){return ka(r.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function uA(t,e){let n=null;for(const s of t.fieldTransforms){const i=e.data.field(s.field),r=o_(s.transform,i||null);r!=null&&(n===null&&(n=Ot.empty()),n.set(s.field,r))}return n||null}function Bp(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(s,i){return s===void 0&&i===void 0||!(!s||!i)&&ki(s,i,(r,o)=>aA(r,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Io extends Fl{constructor(e,n,s,i=[]){super(),this.key=e,this.value=n,this.precondition=s,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Os extends Fl{constructor(e,n,s,i,r=[]){super(),this.key=e,this.data=n,this.fieldMask=s,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function h_(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}}),e}function Up(t,e,n){const s=new Map;Me(t.length===n.length,32656,{Ae:n.length,Re:t.length});for(let i=0;i<n.length;i++){const r=t[i],o=r.transform,a=e.data.field(r.field);s.set(r.field,rA(o,a,n[i]))}return s}function $p(t,e,n){const s=new Map;for(const i of t){const r=i.transform,o=n.data.field(i.field);s.set(i.field,iA(r,o,e))}return s}class Qh extends Fl{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class hA extends Fl{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dA{constructor(e,n,s,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=s,this.mutations=i}applyToRemoteDocument(e,n){const s=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const r=this.mutations[i];r.key.isEqual(e.key)&&cA(r,e,s[i])}}applyToLocalView(e,n){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(n=Hr(s,e,n,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(n=Hr(s,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const s=i_();return this.mutations.forEach(i=>{const r=e.get(i.key),o=r.overlayedDocument;let a=this.applyToLocalView(o,r.mutatedFields);a=n.has(i.key)?null:a;const u=u_(o,a);u!==null&&s.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(de.min())}),s}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Se())}isEqual(e){return this.batchId===e.batchId&&ki(this.mutations,e.mutations,(n,s)=>Bp(n,s))&&ki(this.baseMutations,e.baseMutations,(n,s)=>Bp(n,s))}}class Jh{constructor(e,n,s,i){this.batch=e,this.commitVersion=n,this.mutationResults=s,this.docVersions=i}static from(e,n,s){Me(e.mutations.length===s.length,58842,{Ve:e.mutations.length,me:s.length});let i=function(){return ZE}();const r=e.mutations;for(let o=0;o<r.length;o++)i=i.insert(r[o].key,s[o].version);return new Jh(e,n,s,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fA{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pA{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var st,Ce;function gA(t){switch(t){case U.OK:return ae(64938);case U.CANCELLED:case U.UNKNOWN:case U.DEADLINE_EXCEEDED:case U.RESOURCE_EXHAUSTED:case U.INTERNAL:case U.UNAVAILABLE:case U.UNAUTHENTICATED:return!1;case U.INVALID_ARGUMENT:case U.NOT_FOUND:case U.ALREADY_EXISTS:case U.PERMISSION_DENIED:case U.FAILED_PRECONDITION:case U.ABORTED:case U.OUT_OF_RANGE:case U.UNIMPLEMENTED:case U.DATA_LOSS:return!0;default:return ae(15467,{code:t})}}function d_(t){if(t===void 0)return Jn("GRPC error has no .code"),U.UNKNOWN;switch(t){case st.OK:return U.OK;case st.CANCELLED:return U.CANCELLED;case st.UNKNOWN:return U.UNKNOWN;case st.DEADLINE_EXCEEDED:return U.DEADLINE_EXCEEDED;case st.RESOURCE_EXHAUSTED:return U.RESOURCE_EXHAUSTED;case st.INTERNAL:return U.INTERNAL;case st.UNAVAILABLE:return U.UNAVAILABLE;case st.UNAUTHENTICATED:return U.UNAUTHENTICATED;case st.INVALID_ARGUMENT:return U.INVALID_ARGUMENT;case st.NOT_FOUND:return U.NOT_FOUND;case st.ALREADY_EXISTS:return U.ALREADY_EXISTS;case st.PERMISSION_DENIED:return U.PERMISSION_DENIED;case st.FAILED_PRECONDITION:return U.FAILED_PRECONDITION;case st.ABORTED:return U.ABORTED;case st.OUT_OF_RANGE:return U.OUT_OF_RANGE;case st.UNIMPLEMENTED:return U.UNIMPLEMENTED;case st.DATA_LOSS:return U.DATA_LOSS;default:return ae(39323,{code:t})}}(Ce=st||(st={}))[Ce.OK=0]="OK",Ce[Ce.CANCELLED=1]="CANCELLED",Ce[Ce.UNKNOWN=2]="UNKNOWN",Ce[Ce.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ce[Ce.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ce[Ce.NOT_FOUND=5]="NOT_FOUND",Ce[Ce.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ce[Ce.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ce[Ce.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ce[Ce.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ce[Ce.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ce[Ce.ABORTED=10]="ABORTED",Ce[Ce.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ce[Ce.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ce[Ce.INTERNAL=13]="INTERNAL",Ce[Ce.UNAVAILABLE=14]="UNAVAILABLE",Ce[Ce.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mA=new xs([4294967295,4294967295],0);function Hp(t){const e=j0().encode(t),n=new S0;return n.update(e),new Uint8Array(n.digest())}function Wp(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),s=e.getUint32(4,!0),i=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new xs([n,s],0),new xs([i,r],0)]}class Zh{constructor(e,n,s){if(this.bitmap=e,this.padding=n,this.hashCount=s,n<0||n>=8)throw new Mr(`Invalid padding: ${n}`);if(s<0)throw new Mr(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Mr(`Invalid hash count: ${s}`);if(e.length===0&&n!==0)throw new Mr(`Invalid padding when bitmap length is 0: ${n}`);this.fe=8*e.length-n,this.ge=xs.fromNumber(this.fe)}pe(e,n,s){let i=e.add(n.multiply(xs.fromNumber(s)));return i.compare(mA)===1&&(i=new xs([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;const n=Hp(e),[s,i]=Wp(n);for(let r=0;r<this.hashCount;r++){const o=this.pe(s,i,r);if(!this.ye(o))return!1}return!0}static create(e,n,s){const i=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),o=new Zh(r,i,n);return s.forEach(a=>o.insert(a)),o}insert(e){if(this.fe===0)return;const n=Hp(e),[s,i]=Wp(n);for(let r=0;r<this.hashCount;r++){const o=this.pe(s,i,r);this.we(o)}}we(e){const n=Math.floor(e/8),s=e%8;this.bitmap[n]|=1<<s}}class Mr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol{constructor(e,n,s,i,r){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=s,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,n,s){const i=new Map;return i.set(e,So.createSynthesizedTargetChangeForCurrentChange(e,n,s)),new Ol(de.min(),i,new ze(Ee),es(),Se())}}class So{constructor(e,n,s,i,r){this.resumeToken=e,this.current=n,this.addedDocuments=s,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,n,s){return new So(s,n,Se(),Se(),Se())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fa{constructor(e,n,s,i){this.Se=e,this.removedTargetIds=n,this.key=s,this.be=i}}class f_{constructor(e,n){this.targetId=e,this.De=n}}class p_{constructor(e,n,s=Tt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=s,this.cause=i}}class Xp{constructor(){this.ve=0,this.Ce=Gp(),this.Fe=Tt.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=Se(),n=Se(),s=Se();return this.Ce.forEach((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:s=s.add(i);break;default:ae(38017,{changeType:r})}}),new So(this.Fe,this.Me,e,n,s)}ke(){this.xe=!1,this.Ce=Gp()}qe(e,n){this.xe=!0,this.Ce=this.Ce.insert(e,n)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,Me(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class _A{constructor(e){this.We=e,this.Ge=new Map,this.ze=es(),this.je=ia(),this.Je=ia(),this.He=new ze(Ee)}Ye(e){for(const n of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(n,e.be):this.Xe(n,e.key,e.be);for(const n of e.removedTargetIds)this.Xe(n,e.key,e.be)}et(e){this.forEachTarget(e,n=>{const s=this.tt(n);switch(e.state){case 0:this.nt(n)&&s.Be(e.resumeToken);break;case 1:s.Ue(),s.Oe||s.ke(),s.Be(e.resumeToken);break;case 2:s.Ue(),s.Oe||this.removeTarget(n);break;case 3:this.nt(n)&&(s.Ke(),s.Be(e.resumeToken));break;case 4:this.nt(n)&&(this.rt(n),s.Be(e.resumeToken));break;default:ae(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Ge.forEach((s,i)=>{this.nt(i)&&n(i)})}it(e){const n=e.targetId,s=e.De.count,i=this.st(n);if(i){const r=i.target;if(ju(r))if(s===0){const o=new ee(r.path);this.Xe(n,o,Ct.newNoDocument(o,de.min()))}else Me(s===1,20013,{expectedCount:s});else{const o=this.ot(n);if(o!==s){const a=this._t(e),u=a?this.ut(a,e,o):1;if(u!==0){this.rt(n);const h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(n,h)}}}}}_t(e){const n=e.De.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:s="",padding:i=0},hashCount:r=0}=n;let o,a;try{o=Ps(s).toUint8Array()}catch(u){if(u instanceof V0)return bs("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Zh(o,i,r)}catch(u){return bs(u instanceof Mr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.fe===0?null:a}ut(e,n,s){return n.De.count===s-this.ht(e,n.targetId)?0:2}ht(e,n){const s=this.We.getRemoteKeysForTarget(n);let i=0;return s.forEach(r=>{const o=this.We.lt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${r.path.canonicalString()}`;e.mightContain(a)||(this.Xe(n,r,null),i++)}),i}Pt(e){const n=new Map;this.Ge.forEach((r,o)=>{const a=this.st(o);if(a){if(r.current&&ju(a.target)){const u=new ee(a.target.path);this.Tt(u).has(o)||this.It(o,u)||this.Xe(o,u,Ct.newNoDocument(u,e))}r.Ne&&(n.set(o,r.Le()),r.ke())}});let s=Se();this.Je.forEach((r,o)=>{let a=!0;o.forEachWhile(u=>{const h=this.st(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(s=s.add(r))}),this.ze.forEach((r,o)=>o.setReadTime(e));const i=new Ol(e,n,this.He,this.ze,s);return this.ze=es(),this.je=ia(),this.Je=ia(),this.He=new ze(Ee),i}Ze(e,n){if(!this.nt(e))return;const s=this.It(e,n.key)?2:0;this.tt(e).qe(n.key,s),this.ze=this.ze.insert(n.key,n),this.je=this.je.insert(n.key,this.Tt(n.key).add(e)),this.Je=this.Je.insert(n.key,this.dt(n.key).add(e))}Xe(e,n,s){if(!this.nt(e))return;const i=this.tt(e);this.It(e,n)?i.qe(n,1):i.Qe(n),this.Je=this.Je.insert(n,this.dt(n).delete(e)),this.Je=this.Je.insert(n,this.dt(n).add(e)),s&&(this.ze=this.ze.insert(n,s))}removeTarget(e){this.Ge.delete(e)}ot(e){const n=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let n=this.Ge.get(e);return n||(n=new Xp,this.Ge.set(e,n)),n}dt(e){let n=this.Je.get(e);return n||(n=new ht(Ee),this.Je=this.Je.insert(e,n)),n}Tt(e){let n=this.je.get(e);return n||(n=new ht(Ee),this.je=this.je.insert(e,n)),n}nt(e){const n=this.st(e)!==null;return n||Q("WatchChangeAggregator","Detected inactive target",e),n}st(e){const n=this.Ge.get(e);return n&&n.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new Xp),this.We.getRemoteKeysForTarget(e).forEach(n=>{this.Xe(e,n,null)})}It(e,n){return this.We.getRemoteKeysForTarget(e).has(n)}}function ia(){return new ze(ee.comparator)}function Gp(){return new ze(ee.comparator)}const yA={asc:"ASCENDING",desc:"DESCENDING"},vA={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},wA={and:"AND",or:"OR"};class TA{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Fu(t,e){return t.useProto3Json||Nl(e)?e:{value:e}}function tl(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function g_(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function EA(t,e){return tl(t,e.toTimestamp())}function In(t){return Me(!!t,49232),de.fromTimestamp(function(n){const s=Ds(n);return new He(s.seconds,s.nanos)}(t))}function ed(t,e){return Ou(t,e).canonicalString()}function Ou(t,e){const n=function(i){return new Be(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function m_(t){const e=Be.fromString(t);return Me(T_(e),10190,{key:e.toString()}),e}function Vu(t,e){return ed(t.databaseId,e.path)}function bc(t,e){const n=m_(e);if(n.get(1)!==t.databaseId.projectId)throw new q(U.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new q(U.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ee(y_(n))}function __(t,e){return ed(t.databaseId,e)}function AA(t){const e=m_(t);return e.length===4?Be.emptyPath():y_(e)}function Bu(t){return new Be(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function y_(t){return Me(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function zp(t,e,n){return{name:Vu(t,e),fields:n.value.mapValue.fields}}function xA(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:ae(39313,{state:h})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(h,d){return h.useProto3Json?(Me(d===void 0||typeof d=="string",58123),Tt.fromBase64String(d||"")):(Me(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),Tt.fromUint8Array(d||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(h){const d=h.code===void 0?U.UNKNOWN:d_(h.code);return new q(d,h.message||"")}(o);n=new p_(s,i,r,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=bc(t,s.document.name),r=In(s.document.updateTime),o=s.document.createTime?In(s.document.createTime):de.min(),a=new Ot({mapValue:{fields:s.document.fields}}),u=Ct.newFoundDocument(i,r,o,a),h=s.targetIds||[],d=s.removedTargetIds||[];n=new Fa(h,d,u.key,u)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=bc(t,s.document),r=s.readTime?In(s.readTime):de.min(),o=Ct.newNoDocument(i,r),a=s.removedTargetIds||[];n=new Fa([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=bc(t,s.document),r=s.removedTargetIds||[];n=new Fa([],r,i,null)}else{if(!("filter"in e))return ae(11601,{At:e});{e.filter;const s=e.filter;s.targetId;const{count:i=0,unchangedNames:r}=s,o=new pA(i,r),a=s.targetId;n=new f_(a,o)}}return n}function IA(t,e){let n;if(e instanceof Io)n={update:zp(t,e.key,e.value)};else if(e instanceof Qh)n={delete:Vu(t,e.key)};else if(e instanceof Os)n={update:zp(t,e.key,e.data),updateMask:jA(e.fieldMask)};else{if(!(e instanceof hA))return ae(16599,{Rt:e.type});n={verify:Vu(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(s=>function(r,o){const a=o.transform;if(a instanceof ro)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof oo)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ao)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof el)return{fieldPath:o.field.canonicalString(),increment:a.Ee};throw ae(20930,{transform:o.transform})}(0,s))),e.precondition.isNone||(n.currentDocument=function(i,r){return r.updateTime!==void 0?{updateTime:EA(i,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:ae(27497)}(t,e.precondition)),n}function SA(t,e){return t&&t.length>0?(Me(e!==void 0,14353),t.map(n=>function(i,r){let o=i.updateTime?In(i.updateTime):In(r);return o.isEqual(de.min())&&(o=In(r)),new lA(o,i.transformResults||[])}(n,e))):[]}function bA(t,e){return{documents:[__(t,e.path)]}}function CA(t,e){const n={structuredQuery:{}},s=e.path;let i;e.collectionGroup!==null?(i=s,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=s.popLast(),n.structuredQuery.from=[{collectionId:s.lastSegment()}]),n.parent=__(t,i);const r=function(h){if(h.length!==0)return w_(dn.create(h,"and"))}(e.filters);r&&(n.structuredQuery.where=r);const o=function(h){if(h.length!==0)return h.map(d=>function(m){return{field:Ai(m.field),direction:RA(m.dir)}}(d))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Fu(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{Vt:n,parent:i}}function DA(t){let e=AA(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){Me(s===1,65062);const d=n.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let r=[];n.where&&(r=function(p){const m=v_(p);return m instanceof dn&&q0(m)?m.getFilters():[m]}(n.where));let o=[];n.orderBy&&(o=function(p){return p.map(m=>function(v){return new io(xi(v.field),function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction))}(m))}(n.orderBy));let a=null;n.limit&&(a=function(p){let m;return m=typeof p=="object"?p.value:p,Nl(m)?null:m}(n.limit));let u=null;n.startAt&&(u=function(p){const m=!!p.before,y=p.values||[];return new Za(y,m)}(n.startAt));let h=null;return n.endAt&&(h=function(p){const m=!p.before,y=p.values||[];return new Za(y,m)}(n.endAt)),YE(e,i,o,r,a,"F",u,h)}function PA(t,e){const n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ae(28987,{purpose:i})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function v_(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const s=xi(n.unaryFilter.field);return rt.create(s,"==",{doubleValue:NaN});case"IS_NULL":const i=xi(n.unaryFilter.field);return rt.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=xi(n.unaryFilter.field);return rt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=xi(n.unaryFilter.field);return rt.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ae(61313);default:return ae(60726)}}(t):t.fieldFilter!==void 0?function(n){return rt.create(xi(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ae(58110);default:return ae(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return dn.create(n.compositeFilter.filters.map(s=>v_(s)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return ae(1026)}}(n.compositeFilter.op))}(t):ae(30097,{filter:t})}function RA(t){return yA[t]}function NA(t){return vA[t]}function MA(t){return wA[t]}function Ai(t){return{fieldPath:t.canonicalString()}}function xi(t){return wt.fromServerFormat(t.fieldPath)}function w_(t){return t instanceof rt?function(n){if(n.op==="=="){if(jp(n.value))return{unaryFilter:{field:Ai(n.field),op:"IS_NAN"}};if(Mp(n.value))return{unaryFilter:{field:Ai(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(jp(n.value))return{unaryFilter:{field:Ai(n.field),op:"IS_NOT_NAN"}};if(Mp(n.value))return{unaryFilter:{field:Ai(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ai(n.field),op:NA(n.op),value:n.value}}}(t):t instanceof dn?function(n){const s=n.getFilters().map(i=>w_(i));return s.length===1?s[0]:{compositeFilter:{op:MA(n.op),filters:s}}}(t):ae(54877,{filter:t})}function jA(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function T_(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e,n,s,i,r=de.min(),o=de.min(),a=Tt.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=n,this.purpose=s,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new ys(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ys(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ys(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ys(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LA{constructor(e){this.gt=e}}function kA(t){const e=DA({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?ku(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FA{constructor(){this.Dn=new OA}addToCollectionParentIndex(e,n){return this.Dn.add(n),$.resolve()}getCollectionParents(e,n){return $.resolve(this.Dn.getEntries(n))}addFieldIndex(e,n){return $.resolve()}deleteFieldIndex(e,n){return $.resolve()}deleteAllFieldIndexes(e){return $.resolve()}createTargetIndexes(e,n){return $.resolve()}getDocumentsMatchingTarget(e,n){return $.resolve(null)}getIndexType(e,n){return $.resolve(0)}getFieldIndexes(e,n){return $.resolve([])}getNextCollectionGroupToUpdate(e){return $.resolve(null)}getMinOffset(e,n){return $.resolve(Cs.min())}getMinOffsetFromCollectionGroup(e,n){return $.resolve(Cs.min())}updateCollectionGroup(e,n,s){return $.resolve()}updateIndexEntries(e,n){return $.resolve()}}class OA{constructor(){this.index={}}add(e){const n=e.lastSegment(),s=e.popLast(),i=this.index[n]||new ht(Be.comparator),r=!i.has(s);return this.index[n]=i.add(s),r}has(e){const n=e.lastSegment(),s=e.popLast(),i=this.index[n];return i&&i.has(s)}getEntries(e){return(this.index[e]||new ht(Be.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},E_=41943040;class Ft{static withCacheSize(e){return new Ft(e,Ft.DEFAULT_COLLECTION_PERCENTILE,Ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ft.DEFAULT_COLLECTION_PERCENTILE=10,Ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ft.DEFAULT=new Ft(E_,Ft.DEFAULT_COLLECTION_PERCENTILE,Ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ft.DISABLED=new Ft(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new Vi(0)}static ur(){return new Vi(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qp="LruGarbageCollector",VA=1048576;function Kp([t,e],[n,s]){const i=Ee(t,n);return i===0?Ee(e,s):i}class BA{constructor(e){this.Tr=e,this.buffer=new ht(Kp),this.Ir=0}dr(){return++this.Ir}Er(e){const n=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(n);else{const s=this.buffer.last();Kp(n,s)<0&&(this.buffer=this.buffer.delete(s).add(n))}}get maxValue(){return this.buffer.last()[0]}}class UA{constructor(e,n,s){this.garbageCollector=e,this.asyncQueue=n,this.localStore=s,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){Q(qp,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Yi(n)?Q(qp,"Ignoring IndexedDB error during garbage collection: ",n):await zi(n)}await this.Rr(3e5)})}}class $A{constructor(e,n){this.Vr=e,this.params=n}calculateTargetCount(e,n){return this.Vr.mr(e).next(s=>Math.floor(n/100*s))}nthSequenceNumber(e,n){if(n===0)return $.resolve(Rl.ue);const s=new BA(n);return this.Vr.forEachTarget(e,i=>s.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>s.Er(i))).next(()=>s.maxValue)}removeTargets(e,n,s){return this.Vr.removeTargets(e,n,s)}removeOrphanedDocuments(e,n){return this.Vr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Q("LruGarbageCollector","Garbage collection skipped; disabled"),$.resolve(Yp)):this.getCacheSize(e).next(s=>s<this.params.cacheSizeCollectionThreshold?(Q("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Yp):this.pr(e,n))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,n){let s,i,r,o,a,u,h;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(Q("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(s=p,a=Date.now(),this.removeTargets(e,s,n))).next(p=>(r=p,u=Date.now(),this.removeOrphanedDocuments(e,s))).next(p=>(h=Date.now(),Ti()<=Ie.DEBUG&&Q("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${r} targets in `+(u-a)+`ms
	Removed ${p} documents in `+(h-u)+`ms
Total Duration: ${h-d}ms`),$.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:p})))}}function HA(t,e){return new $A(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WA{constructor(){this.changes=new li(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Ct.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const s=this.changes.get(n);return s!==void 0?$.resolve(s):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XA{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GA{constructor(e,n,s,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=s,this.indexManager=i}getDocument(e,n){let s=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(s=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(s!==null&&Hr(s.mutation,i,Ht.empty(),He.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(s=>this.getLocalViewOfDocuments(e,s,Se()).next(()=>s))}getLocalViewOfDocuments(e,n,s=Se()){const i=Js();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,s).next(r=>{let o=Nr();return r.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const s=Js();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,Se()))}populateOverlays(e,n,s){const i=[];return s.forEach(r=>{n.has(r)||i.push(r)}),this.documentOverlayCache.getOverlays(e,i).next(r=>{r.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,s,i){let r=es();const o=$r(),a=function(){return $r()}();return n.forEach((u,h)=>{const d=s.get(h.key);i.has(h.key)&&(d===void 0||d.mutation instanceof Os)?r=r.insert(h.key,h):d!==void 0?(o.set(h.key,d.mutation.getFieldMask()),Hr(d.mutation,h,d.mutation.getFieldMask(),He.now())):o.set(h.key,Ht.empty())}),this.recalculateAndSaveOverlays(e,r).next(u=>(u.forEach((h,d)=>o.set(h,d)),n.forEach((h,d)=>{var p;return a.set(h,new XA(d,(p=o.get(h))!==null&&p!==void 0?p:null))}),a))}recalculateAndSaveOverlays(e,n){const s=$r();let i=new ze((o,a)=>o-a),r=Se();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(u=>{const h=n.get(u);if(h===null)return;let d=s.get(u)||Ht.empty();d=a.applyToLocalView(h,d),s.set(u,d);const p=(i.get(a.batchId)||Se()).add(u);i=i.insert(a.batchId,p)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),h=u.key,d=u.value,p=i_();d.forEach(m=>{if(!r.has(m)){const y=u_(n.get(m),s.get(m));y!==null&&p.set(m,y),r=r.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,p))}return $.waitFor(o)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,n,s,i){return function(o){return ee.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):Z0(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,s,i):this.getDocumentsMatchingCollectionQuery(e,n,s,i)}getNextDocuments(e,n,s,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,s,i).next(r=>{const o=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,s.largestBatchId,i-r.size):$.resolve(Js());let a=eo,u=r;return o.next(h=>$.forEach(h,(d,p)=>(a<p.largestBatchId&&(a=p.largestBatchId),r.get(d)?$.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{u=u.insert(d,m)}))).next(()=>this.populateOverlays(e,h,r)).next(()=>this.computeViews(e,u,h,Se())).next(d=>({batchId:a,changes:s_(d)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new ee(n)).next(s=>{let i=Nr();return s.isFoundDocument()&&(i=i.insert(s.key,s)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,s,i){const r=n.collectionGroup;let o=Nr();return this.indexManager.getCollectionParents(e,r).next(a=>$.forEach(a,u=>{const h=function(p,m){return new qi(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(n,u.child(r));return this.getDocumentsMatchingCollectionQuery(e,h,s,i).next(d=>{d.forEach((p,m)=>{o=o.insert(p,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,s,i){let r;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,s.largestBatchId).next(o=>(r=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,s,r,i))).next(o=>{r.forEach((u,h)=>{const d=h.getKey();o.get(d)===null&&(o=o.insert(d,Ct.newInvalidDocument(d)))});let a=Nr();return o.forEach((u,h)=>{const d=r.get(u);d!==void 0&&Hr(d.mutation,h,Ht.empty(),He.now()),Ll(n,h)&&(a=a.insert(u,h))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zA{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,n){return $.resolve(this.Br.get(n))}saveBundleMetadata(e,n){return this.Br.set(n.id,function(i){return{id:i.id,version:i.version,createTime:In(i.createTime)}}(n)),$.resolve()}getNamedQuery(e,n){return $.resolve(this.Lr.get(n))}saveNamedQuery(e,n){return this.Lr.set(n.name,function(i){return{name:i.name,query:kA(i.bundledQuery),readTime:In(i.readTime)}}(n)),$.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YA{constructor(){this.overlays=new ze(ee.comparator),this.kr=new Map}getOverlay(e,n){return $.resolve(this.overlays.get(n))}getOverlays(e,n){const s=Js();return $.forEach(n,i=>this.getOverlay(e,i).next(r=>{r!==null&&s.set(i,r)})).next(()=>s)}saveOverlays(e,n,s){return s.forEach((i,r)=>{this.wt(e,n,r)}),$.resolve()}removeOverlaysForBatchId(e,n,s){const i=this.kr.get(s);return i!==void 0&&(i.forEach(r=>this.overlays=this.overlays.remove(r)),this.kr.delete(s)),$.resolve()}getOverlaysForCollection(e,n,s){const i=Js(),r=n.length+1,o=new ee(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,h=u.getKey();if(!n.isPrefixOf(h.path))break;h.path.length===r&&u.largestBatchId>s&&i.set(u.getKey(),u)}return $.resolve(i)}getOverlaysForCollectionGroup(e,n,s,i){let r=new ze((h,d)=>h-d);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===n&&h.largestBatchId>s){let d=r.get(h.largestBatchId);d===null&&(d=Js(),r=r.insert(h.largestBatchId,d)),d.set(h.getKey(),h)}}const a=Js(),u=r.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,d)=>a.set(h,d)),!(a.size()>=i)););return $.resolve(a)}wt(e,n,s){const i=this.overlays.get(s.key);if(i!==null){const o=this.kr.get(i.largestBatchId).delete(s.key);this.kr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new fA(n,s));let r=this.kr.get(n);r===void 0&&(r=Se(),this.kr.set(n,r)),this.kr.set(n,r.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qA{constructor(){this.sessionToken=Tt.EMPTY_BYTE_STRING}getSessionToken(e){return $.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,$.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td{constructor(){this.qr=new ht(ft.Qr),this.$r=new ht(ft.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,n){const s=new ft(e,n);this.qr=this.qr.add(s),this.$r=this.$r.add(s)}Kr(e,n){e.forEach(s=>this.addReference(s,n))}removeReference(e,n){this.Wr(new ft(e,n))}Gr(e,n){e.forEach(s=>this.removeReference(s,n))}zr(e){const n=new ee(new Be([])),s=new ft(n,e),i=new ft(n,e+1),r=[];return this.$r.forEachInRange([s,i],o=>{this.Wr(o),r.push(o.key)}),r}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const n=new ee(new Be([])),s=new ft(n,e),i=new ft(n,e+1);let r=Se();return this.$r.forEachInRange([s,i],o=>{r=r.add(o.key)}),r}containsKey(e){const n=new ft(e,0),s=this.qr.firstAfterOrEqual(n);return s!==null&&e.isEqual(s.key)}}class ft{constructor(e,n){this.key=e,this.Hr=n}static Qr(e,n){return ee.comparator(e.key,n.key)||Ee(e.Hr,n.Hr)}static Ur(e,n){return Ee(e.Hr,n.Hr)||ee.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KA{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.er=1,this.Yr=new ht(ft.Qr)}checkEmpty(e){return $.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,s,i){const r=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new dA(r,n,s,i);this.mutationQueue.push(o);for(const a of i)this.Yr=this.Yr.add(new ft(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return $.resolve(o)}lookupMutationBatch(e,n){return $.resolve(this.Zr(n))}getNextMutationBatchAfterBatchId(e,n){const s=n+1,i=this.Xr(s),r=i<0?0:i;return $.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return $.resolve(this.mutationQueue.length===0?Wh:this.er-1)}getAllMutationBatches(e){return $.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const s=new ft(n,0),i=new ft(n,Number.POSITIVE_INFINITY),r=[];return this.Yr.forEachInRange([s,i],o=>{const a=this.Zr(o.Hr);r.push(a)}),$.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,n){let s=new ht(Ee);return n.forEach(i=>{const r=new ft(i,0),o=new ft(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([r,o],a=>{s=s.add(a.Hr)})}),$.resolve(this.ei(s))}getAllMutationBatchesAffectingQuery(e,n){const s=n.path,i=s.length+1;let r=s;ee.isDocumentKey(r)||(r=r.child(""));const o=new ft(new ee(r),0);let a=new ht(Ee);return this.Yr.forEachWhile(u=>{const h=u.key.path;return!!s.isPrefixOf(h)&&(h.length===i&&(a=a.add(u.Hr)),!0)},o),$.resolve(this.ei(a))}ei(e){const n=[];return e.forEach(s=>{const i=this.Zr(s);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){Me(this.ti(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Yr;return $.forEach(n.mutations,i=>{const r=new ft(i.key,n.batchId);return s=s.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=s})}rr(e){}containsKey(e,n){const s=new ft(n,0),i=this.Yr.firstAfterOrEqual(s);return $.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,$.resolve()}ti(e,n){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const n=this.Xr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QA{constructor(e){this.ni=e,this.docs=function(){return new ze(ee.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const s=n.key,i=this.docs.get(s),r=i?i.size:0,o=this.ni(n);return this.docs=this.docs.insert(s,{document:n.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const s=this.docs.get(n);return $.resolve(s?s.document.mutableCopy():Ct.newInvalidDocument(n))}getEntries(e,n){let s=es();return n.forEach(i=>{const r=this.docs.get(i);s=s.insert(i,r?r.document.mutableCopy():Ct.newInvalidDocument(i))}),$.resolve(s)}getDocumentsMatchingQuery(e,n,s,i){let r=es();const o=n.path,a=new ee(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:h,value:{document:d}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||SE(IE(d),s)<=0||(i.has(d.key)||Ll(n,d))&&(r=r.insert(d.key,d.mutableCopy()))}return $.resolve(r)}getAllFromCollectionGroup(e,n,s,i){ae(9500)}ri(e,n){return $.forEach(this.docs,s=>n(s))}newChangeBuffer(e){return new JA(this)}getSize(e){return $.resolve(this.size)}}class JA extends WA{constructor(e){super(),this.Or=e}applyChanges(e){const n=[];return this.changes.forEach((s,i)=>{i.isValidDocument()?n.push(this.Or.addEntry(e,i)):this.Or.removeEntry(s)}),$.waitFor(n)}getFromCache(e,n){return this.Or.getEntry(e,n)}getAllFromCache(e,n){return this.Or.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZA{constructor(e){this.persistence=e,this.ii=new li(n=>zh(n),Yh),this.lastRemoteSnapshotVersion=de.min(),this.highestTargetId=0,this.si=0,this.oi=new td,this.targetCount=0,this._i=Vi.ar()}forEachTarget(e,n){return this.ii.forEach((s,i)=>n(i)),$.resolve()}getLastRemoteSnapshotVersion(e){return $.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return $.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),$.resolve(this.highestTargetId)}setTargetsMetadata(e,n,s){return s&&(this.lastRemoteSnapshotVersion=s),n>this.si&&(this.si=n),$.resolve()}hr(e){this.ii.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this._i=new Vi(n),this.highestTargetId=n),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,n){return this.hr(n),this.targetCount+=1,$.resolve()}updateTargetData(e,n){return this.hr(n),$.resolve()}removeTargetData(e,n){return this.ii.delete(n.target),this.oi.zr(n.targetId),this.targetCount-=1,$.resolve()}removeTargets(e,n,s){let i=0;const r=[];return this.ii.forEach((o,a)=>{a.sequenceNumber<=n&&s.get(a.targetId)===null&&(this.ii.delete(o),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),$.waitFor(r).next(()=>i)}getTargetCount(e){return $.resolve(this.targetCount)}getTargetData(e,n){const s=this.ii.get(n)||null;return $.resolve(s)}addMatchingKeys(e,n,s){return this.oi.Kr(n,s),$.resolve()}removeMatchingKeys(e,n,s){this.oi.Gr(n,s);const i=this.persistence.referenceDelegate,r=[];return i&&n.forEach(o=>{r.push(i.markPotentiallyOrphaned(e,o))}),$.waitFor(r)}removeMatchingKeysForTargetId(e,n){return this.oi.zr(n),$.resolve()}getMatchingKeysForTargetId(e,n){const s=this.oi.Jr(n);return $.resolve(s)}containsKey(e,n){return $.resolve(this.oi.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A_{constructor(e,n){this.ai={},this.overlays={},this.ui=new Rl(0),this.ci=!1,this.ci=!0,this.li=new qA,this.referenceDelegate=e(this),this.hi=new ZA(this),this.indexManager=new FA,this.remoteDocumentCache=function(i){return new QA(i)}(s=>this.referenceDelegate.Pi(s)),this.serializer=new LA(n),this.Ti=new zA(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new YA,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let s=this.ai[e.toKey()];return s||(s=new KA(n,this.referenceDelegate),this.ai[e.toKey()]=s),s}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,n,s){Q("MemoryPersistence","Starting transaction:",e);const i=new ex(this.ui.next());return this.referenceDelegate.Ii(),s(i).next(r=>this.referenceDelegate.di(i).next(()=>r)).toPromise().then(r=>(i.raiseOnCommittedEvent(),r))}Ei(e,n){return $.or(Object.values(this.ai).map(s=>()=>s.containsKey(e,n)))}}class ex extends CE{constructor(e){super(),this.currentSequenceNumber=e}}class nd{constructor(e){this.persistence=e,this.Ai=new td,this.Ri=null}static Vi(e){return new nd(e)}get mi(){if(this.Ri)return this.Ri;throw ae(60996)}addReference(e,n,s){return this.Ai.addReference(s,n),this.mi.delete(s.toString()),$.resolve()}removeReference(e,n,s){return this.Ai.removeReference(s,n),this.mi.add(s.toString()),$.resolve()}markPotentiallyOrphaned(e,n){return this.mi.add(n.toString()),$.resolve()}removeTarget(e,n){this.Ai.zr(n.targetId).forEach(i=>this.mi.add(i.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(r=>this.mi.add(r.toString()))}).next(()=>s.removeTargetData(e,n))}Ii(){this.Ri=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return $.forEach(this.mi,s=>{const i=ee.fromPath(s);return this.fi(e,i).next(r=>{r||n.removeEntry(i,de.min())})}).next(()=>(this.Ri=null,n.apply(e)))}updateLimboDocument(e,n){return this.fi(e,n).next(s=>{s?this.mi.delete(n.toString()):this.mi.add(n.toString())})}Pi(e){return 0}fi(e,n){return $.or([()=>$.resolve(this.Ai.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ei(e,n)])}}class nl{constructor(e,n){this.persistence=e,this.gi=new li(s=>RE(s.path),(s,i)=>s.isEqual(i)),this.garbageCollector=HA(this,n)}static Vi(e,n){return new nl(e,n)}Ii(){}di(e){return $.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}mr(e){const n=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(s=>n.next(i=>s+i))}yr(e){let n=0;return this.gr(e,s=>{n++}).next(()=>n)}gr(e,n){return $.forEach(this.gi,(s,i)=>this.Sr(e,s,i).next(r=>r?$.resolve():n(i)))}removeTargets(e,n,s){return this.persistence.getTargetCache().removeTargets(e,n,s)}removeOrphanedDocuments(e,n){let s=0;const i=this.persistence.getRemoteDocumentCache(),r=i.newChangeBuffer();return i.ri(e,o=>this.Sr(e,o,n).next(a=>{a||(s++,r.removeEntry(o,de.min()))})).next(()=>r.apply(e)).next(()=>s)}markPotentiallyOrphaned(e,n){return this.gi.set(n,e.currentSequenceNumber),$.resolve()}removeTarget(e,n){const s=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,n,s){return this.gi.set(s,e.currentSequenceNumber),$.resolve()}removeReference(e,n,s){return this.gi.set(s,e.currentSequenceNumber),$.resolve()}updateLimboDocument(e,n){return this.gi.set(n,e.currentSequenceNumber),$.resolve()}Pi(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=ja(e.data.value)),n}Sr(e,n,s){return $.or([()=>this.persistence.Ei(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.gi.get(n);return $.resolve(i!==void 0&&i>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sd{constructor(e,n,s,i){this.targetId=e,this.fromCache=n,this.Is=s,this.ds=i}static Es(e,n){let s=Se(),i=Se();for(const r of n.docChanges)switch(r.type){case 0:s=s.add(r.doc.key);break;case 1:i=i.add(r.doc.key)}return new sd(e,n.fromCache,s,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tx{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nx{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return Rv()?8:DE(Dt())>0?6:4}()}initialize(e,n){this.gs=e,this.indexManager=n,this.As=!0}getDocumentsMatchingQuery(e,n,s,i){const r={result:null};return this.ps(e,n).next(o=>{r.result=o}).next(()=>{if(!r.result)return this.ys(e,n,i,s).next(o=>{r.result=o})}).next(()=>{if(r.result)return;const o=new tx;return this.ws(e,n,o).next(a=>{if(r.result=a,this.Rs)return this.Ss(e,n,o,a.size)})}).next(()=>r.result)}Ss(e,n,s,i){return s.documentReadCount<this.Vs?(Ti()<=Ie.DEBUG&&Q("QueryEngine","SDK will not create cache indexes for query:",Ei(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),$.resolve()):(Ti()<=Ie.DEBUG&&Q("QueryEngine","Query:",Ei(n),"scans",s.documentReadCount,"local documents and returns",i,"documents as results."),s.documentReadCount>this.fs*i?(Ti()<=Ie.DEBUG&&Q("QueryEngine","The SDK decides to create cache indexes for query:",Ei(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,xn(n))):$.resolve())}ps(e,n){if(Op(n))return $.resolve(null);let s=xn(n);return this.indexManager.getIndexType(e,s).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=ku(n,null,"F"),s=xn(n)),this.indexManager.getDocumentsMatchingTarget(e,s).next(r=>{const o=Se(...r);return this.gs.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,s).next(u=>{const h=this.bs(n,a);return this.Ds(n,h,o,u.readTime)?this.ps(e,ku(n,null,"F")):this.vs(e,h,n,u)}))})))}ys(e,n,s,i){return Op(n)||i.isEqual(de.min())?$.resolve(null):this.gs.getDocuments(e,s).next(r=>{const o=this.bs(n,r);return this.Ds(n,o,s,i)?$.resolve(null):(Ti()<=Ie.DEBUG&&Q("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ei(n)),this.vs(e,o,n,xE(i,eo)).next(a=>a))})}bs(e,n){let s=new ht(t_(e));return n.forEach((i,r)=>{Ll(e,r)&&(s=s.add(r))}),s}Ds(e,n,s,i){if(e.limit===null)return!1;if(s.size!==n.size)return!0;const r=e.limitType==="F"?n.last():n.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}ws(e,n,s){return Ti()<=Ie.DEBUG&&Q("QueryEngine","Using full collection scan to execute query:",Ei(n)),this.gs.getDocumentsMatchingQuery(e,n,Cs.min(),s)}vs(e,n,s,i){return this.gs.getDocumentsMatchingQuery(e,s,i).next(r=>(n.forEach(o=>{r=r.insert(o.key,o)}),r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const id="LocalStore",sx=3e8;class ix{constructor(e,n,s,i){this.persistence=e,this.Cs=n,this.serializer=i,this.Fs=new ze(Ee),this.Ms=new li(r=>zh(r),Yh),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(s)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new GA(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Fs))}}function rx(t,e,n,s){return new ix(t,e,n,s)}async function x_(t,e){const n=me(t);return await n.persistence.runTransaction("Handle user change","readonly",s=>{let i;return n.mutationQueue.getAllMutationBatches(s).next(r=>(i=r,n.Ns(e),n.mutationQueue.getAllMutationBatches(s))).next(r=>{const o=[],a=[];let u=Se();for(const h of i){o.push(h.batchId);for(const d of h.mutations)u=u.add(d.key)}for(const h of r){a.push(h.batchId);for(const d of h.mutations)u=u.add(d.key)}return n.localDocuments.getDocuments(s,u).next(h=>({Bs:h,removedBatchIds:o,addedBatchIds:a}))})})}function ox(t,e){const n=me(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const i=e.batch.keys(),r=n.Os.newChangeBuffer({trackRemovals:!0});return function(a,u,h,d){const p=h.batch,m=p.keys();let y=$.resolve();return m.forEach(v=>{y=y.next(()=>d.getEntry(u,v)).next(w=>{const E=h.docVersions.get(v);Me(E!==null,48541),w.version.compareTo(E)<0&&(p.applyToRemoteDocument(w,h),w.isValidDocument()&&(w.setReadTime(h.commitVersion),d.addEntry(w)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(u,p))}(n,s,e,r).next(()=>r.apply(s)).next(()=>n.mutationQueue.performConsistencyCheck(s)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(s,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(a){let u=Se();for(let h=0;h<a.mutationResults.length;++h)a.mutationResults[h].transformResults.length>0&&(u=u.add(a.batch.mutations[h].key));return u}(e))).next(()=>n.localDocuments.getDocuments(s,i))})}function I_(t){const e=me(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.hi.getLastRemoteSnapshotVersion(n))}function ax(t,e){const n=me(t),s=e.snapshotVersion;let i=n.Fs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{const o=n.Os.newChangeBuffer({trackRemovals:!0});i=n.Fs;const a=[];e.targetChanges.forEach((d,p)=>{const m=i.get(p);if(!m)return;a.push(n.hi.removeMatchingKeys(r,d.removedDocuments,p).next(()=>n.hi.addMatchingKeys(r,d.addedDocuments,p)));let y=m.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.get(p)!==null?y=y.withResumeToken(Tt.EMPTY_BYTE_STRING,de.min()).withLastLimboFreeSnapshotVersion(de.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,s)),i=i.insert(p,y),function(w,E,C){return w.resumeToken.approximateByteSize()===0||E.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=sx?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0}(m,y,d)&&a.push(n.hi.updateTargetData(r,y))});let u=es(),h=Se();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(r,d))}),a.push(lx(r,o,e.documentUpdates).next(d=>{u=d.Ls,h=d.ks})),!s.isEqual(de.min())){const d=n.hi.getLastRemoteSnapshotVersion(r).next(p=>n.hi.setTargetsMetadata(r,r.currentSequenceNumber,s));a.push(d)}return $.waitFor(a).next(()=>o.apply(r)).next(()=>n.localDocuments.getLocalViewOfDocuments(r,u,h)).next(()=>u)}).then(r=>(n.Fs=i,r))}function lx(t,e,n){let s=Se(),i=Se();return n.forEach(r=>s=s.add(r)),e.getEntries(t,s).next(r=>{let o=es();return n.forEach((a,u)=>{const h=r.get(a);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(de.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):Q(id,"Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",u.version)}),{Ls:o,ks:i}})}function cx(t,e){const n=me(t);return n.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=Wh),n.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function ux(t,e){const n=me(t);return n.persistence.runTransaction("Allocate target","readwrite",s=>{let i;return n.hi.getTargetData(s,e).next(r=>r?(i=r,$.resolve(i)):n.hi.allocateTargetId(s).next(o=>(i=new ys(e,o,"TargetPurposeListen",s.currentSequenceNumber),n.hi.addTargetData(s,i).next(()=>i))))}).then(s=>{const i=n.Fs.get(s.targetId);return(i===null||s.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Fs=n.Fs.insert(s.targetId,s),n.Ms.set(e,s.targetId)),s})}async function Uu(t,e,n){const s=me(t),i=s.Fs.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,o=>s.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!Yi(o))throw o;Q(id,`Failed to update sequence numbers for target ${e}: ${o}`)}s.Fs=s.Fs.remove(e),s.Ms.delete(i.target)}function Qp(t,e,n){const s=me(t);let i=de.min(),r=Se();return s.persistence.runTransaction("Execute query","readwrite",o=>function(u,h,d){const p=me(u),m=p.Ms.get(d);return m!==void 0?$.resolve(p.Fs.get(m)):p.hi.getTargetData(h,d)}(s,o,xn(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,s.hi.getMatchingKeysForTargetId(o,a.targetId).next(u=>{r=u})}).next(()=>s.Cs.getDocumentsMatchingQuery(o,e,n?i:de.min(),n?r:Se())).next(a=>(hx(s,KE(e),a),{documents:a,qs:r})))}function hx(t,e,n){let s=t.xs.get(e)||de.min();n.forEach((i,r)=>{r.readTime.compareTo(s)>0&&(s=r.readTime)}),t.xs.set(e,s)}class Jp{constructor(){this.activeTargetIds=nA()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class dx{constructor(){this.Fo=new Jp,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,s){}addLocalQueryTarget(e,n=!0){return n&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,n,s){this.Mo[e]=n}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new Jp,Promise.resolve()}handleUserChange(e,n,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fx{xo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zp="ConnectivityMonitor";class eg{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){Q(Zp,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){Q(Zp,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ra=null;function $u(){return ra===null?ra=function(){return 268435456+Math.round(2147483648*Math.random())}():ra++,"0x"+ra.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cc="RestConnection",px={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class gx{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=n+"://"+e.host,this.Uo=`projects/${s}/databases/${i}`,this.Ko=this.databaseId.database===Qa?`project_id=${s}`:`project_id=${s}&database_id=${i}`}Wo(e,n,s,i,r){const o=$u(),a=this.Go(e,n.toUriEncodedString());Q(Cc,`Sending RPC '${e}' ${o}:`,a,s);const u={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(u,i,r);const{host:h}=new URL(a),d=Hi(h);return this.jo(e,a,u,s,d).then(p=>(Q(Cc,`Received RPC '${e}' ${o}: `,p),p),p=>{throw bs(Cc,`RPC '${e}' ${o} failed with error: `,p,"url: ",a,"request:",s),p})}Jo(e,n,s,i,r,o){return this.Wo(e,n,s,i,r)}zo(e,n,s){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Gi}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,r)=>e[r]=i),s&&s.headers.forEach((i,r)=>e[r]=i)}Go(e,n){const s=px[e];return`${this.$o}/v1/${n}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mx{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const It="WebChannelConnection";class _x extends gx{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,n,s,i,r){const o=$u();return new Promise((a,u)=>{const h=new b0;h.setWithCredentials(!0),h.listenOnce(C0.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Ma.NO_ERROR:const p=h.getResponseJson();Q(It,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),a(p);break;case Ma.TIMEOUT:Q(It,`RPC '${e}' ${o} timed out`),u(new q(U.DEADLINE_EXCEEDED,"Request time out"));break;case Ma.HTTP_ERROR:const m=h.getStatus();if(Q(It,`RPC '${e}' ${o} failed with status:`,m,"response text:",h.getResponseText()),m>0){let y=h.getResponseJson();Array.isArray(y)&&(y=y[0]);const v=y==null?void 0:y.error;if(v&&v.status&&v.message){const w=function(C){const A=C.toLowerCase().replace(/_/g,"-");return Object.values(U).indexOf(A)>=0?A:U.UNKNOWN}(v.status);u(new q(w,v.message))}else u(new q(U.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new q(U.UNAVAILABLE,"Connection failed."));break;default:ae(9055,{c_:e,streamId:o,l_:h.getLastErrorCode(),h_:h.getLastError()})}}finally{Q(It,`RPC '${e}' ${o} completed.`)}});const d=JSON.stringify(i);Q(It,`RPC '${e}' ${o} sending request:`,i),h.send(n,"POST",d,s,15)})}P_(e,n,s){const i=$u(),r=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=R0(),a=P0(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.zo(u.initMessageHeaders,n,s),u.encodeInitMessageHeaders=!0;const d=r.join("");Q(It,`Creating RPC '${e}' stream ${i}: ${d}`,u);const p=o.createWebChannel(d,u);this.T_(p);let m=!1,y=!1;const v=new mx({Ho:E=>{y?Q(It,`Not sending because RPC '${e}' stream ${i} is closed:`,E):(m||(Q(It,`Opening RPC '${e}' stream ${i} transport.`),p.open(),m=!0),Q(It,`RPC '${e}' stream ${i} sending:`,E),p.send(E))},Yo:()=>p.close()}),w=(E,C,A)=>{E.listen(C,R=>{try{A(R)}catch(N){setTimeout(()=>{throw N},0)}})};return w(p,Rr.EventType.OPEN,()=>{y||(Q(It,`RPC '${e}' stream ${i} transport opened.`),v.s_())}),w(p,Rr.EventType.CLOSE,()=>{y||(y=!0,Q(It,`RPC '${e}' stream ${i} transport closed`),v.__(),this.I_(p))}),w(p,Rr.EventType.ERROR,E=>{y||(y=!0,bs(It,`RPC '${e}' stream ${i} transport errored. Name:`,E.name,"Message:",E.message),v.__(new q(U.UNAVAILABLE,"The operation could not be completed")))}),w(p,Rr.EventType.MESSAGE,E=>{var C;if(!y){const A=E.data[0];Me(!!A,16349);const R=A,N=(R==null?void 0:R.error)||((C=R[0])===null||C===void 0?void 0:C.error);if(N){Q(It,`RPC '${e}' stream ${i} received error:`,N);const k=N.status;let j=function(_){const S=st[_];if(S!==void 0)return d_(S)}(k),I=N.message;j===void 0&&(j=U.INTERNAL,I="Unknown error status: "+k+" with message "+N.message),y=!0,v.__(new q(j,I)),p.close()}else Q(It,`RPC '${e}' stream ${i} received:`,A),v.a_(A)}}),w(a,D0.STAT_EVENT,E=>{E.stat===Du.PROXY?Q(It,`RPC '${e}' stream ${i} detected buffering proxy`):E.stat===Du.NOPROXY&&Q(It,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{v.o_()},0),v}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(n=>n===e)}}function Dc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vl(t){return new TA(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S_{constructor(e,n,s=1e3,i=1.5,r=6e4){this.Fi=e,this.timerId=n,this.d_=s,this.E_=i,this.A_=r,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const n=Math.floor(this.R_+this.p_()),s=Math.max(0,Date.now()-this.m_),i=Math.max(0,n-s);i>0&&Q("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${n} ms, last attempt: ${s} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tg="PersistentStream";class b_{constructor(e,n,s,i,r,o,a,u){this.Fi=e,this.w_=s,this.S_=i,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new S_(e,n)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():n&&n.code===U.RESOURCE_EXHAUSTED?(Jn(n.toString()),Jn("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):n&&n.code===U.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(n)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),n=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,i])=>{this.b_===n&&this.W_(s,i)},s=>{e(()=>{const i=new q(U.UNKNOWN,"Fetching auth token failed: "+s.message);return this.G_(i)})})}W_(e,n){const s=this.K_(this.b_);this.stream=this.z_(e,n),this.stream.Zo(()=>{s(()=>this.listener.Zo())}),this.stream.e_(()=>{s(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{s(()=>this.G_(i))}),this.stream.onMessage(i=>{s(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(e){return Q(tg,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return n=>{this.Fi.enqueueAndForget(()=>this.b_===e?n():(Q(tg,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class yx extends b_{constructor(e,n,s,i,r,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,s,i,o),this.serializer=r}z_(e,n){return this.connection.P_("Listen",e,n)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const n=xA(this.serializer,e),s=function(r){if(!("targetChange"in r))return de.min();const o=r.targetChange;return o.targetIds&&o.targetIds.length?de.min():o.readTime?In(o.readTime):de.min()}(e);return this.listener.J_(n,s)}H_(e){const n={};n.database=Bu(this.serializer),n.addTarget=function(r,o){let a;const u=o.target;if(a=ju(u)?{documents:bA(r,u)}:{query:CA(r,u).Vt},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=g_(r,o.resumeToken);const h=Fu(r,o.expectedCount);h!==null&&(a.expectedCount=h)}else if(o.snapshotVersion.compareTo(de.min())>0){a.readTime=tl(r,o.snapshotVersion.toTimestamp());const h=Fu(r,o.expectedCount);h!==null&&(a.expectedCount=h)}return a}(this.serializer,e);const s=PA(this.serializer,e);s&&(n.labels=s),this.k_(n)}Y_(e){const n={};n.database=Bu(this.serializer),n.removeTarget=e,this.k_(n)}}class vx extends b_{constructor(e,n,s,i,r,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,s,i,o),this.serializer=r}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,n){return this.connection.P_("Write",e,n)}j_(e){return Me(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Me(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){Me(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const n=SA(e.writeResults,e.commitTime),s=In(e.commitTime);return this.listener.ta(s,n)}na(){const e={};e.database=Bu(this.serializer),this.k_(e)}X_(e){const n={streamToken:this.lastStreamToken,writes:e.map(s=>IA(this.serializer,s))};this.k_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wx{}class Tx extends wx{constructor(e,n,s,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=s,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new q(U.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,n,s,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,o])=>this.connection.Wo(e,Ou(n,s),i,r,o)).catch(r=>{throw r.name==="FirebaseError"?(r.code===U.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new q(U.UNKNOWN,r.toString())})}Jo(e,n,s,i,r){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Jo(e,Ou(n,s),i,o,a,r)).catch(o=>{throw o.name==="FirebaseError"?(o.code===U.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new q(U.UNKNOWN,o.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class Ex{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(Jn(n),this._a=!1):Q("OnlineStateTracker",n)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ri="RemoteStore";class Ax{constructor(e,n,s,i,r){this.localStore=e,this.datastore=n,this.asyncQueue=s,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=r,this.Ea.xo(o=>{s.enqueueAndForget(async()=>{ci(this)&&(Q(ri,"Restarting streams for network reachability change."),await async function(u){const h=me(u);h.Ia.add(4),await bo(h),h.Aa.set("Unknown"),h.Ia.delete(4),await Bl(h)}(this))})}),this.Aa=new Ex(s,i)}}async function Bl(t){if(ci(t))for(const e of t.da)await e(!0)}async function bo(t){for(const e of t.da)await e(!1)}function C_(t,e){const n=me(t);n.Ta.has(e.targetId)||(n.Ta.set(e.targetId,e),ld(n)?ad(n):Ki(n).x_()&&od(n,e))}function rd(t,e){const n=me(t),s=Ki(n);n.Ta.delete(e),s.x_()&&D_(n,e),n.Ta.size===0&&(s.x_()?s.B_():ci(n)&&n.Aa.set("Unknown"))}function od(t,e){if(t.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(de.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ki(t).H_(e)}function D_(t,e){t.Ra.$e(e),Ki(t).Y_(e)}function ad(t){t.Ra=new _A({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>t.Ta.get(e)||null,lt:()=>t.datastore.serializer.databaseId}),Ki(t).start(),t.Aa.aa()}function ld(t){return ci(t)&&!Ki(t).M_()&&t.Ta.size>0}function ci(t){return me(t).Ia.size===0}function P_(t){t.Ra=void 0}async function xx(t){t.Aa.set("Online")}async function Ix(t){t.Ta.forEach((e,n)=>{od(t,e)})}async function Sx(t,e){P_(t),ld(t)?(t.Aa.la(e),ad(t)):t.Aa.set("Unknown")}async function bx(t,e,n){if(t.Aa.set("Online"),e instanceof p_&&e.state===2&&e.cause)try{await async function(i,r){const o=r.cause;for(const a of r.targetIds)i.Ta.has(a)&&(await i.remoteSyncer.rejectListen(a,o),i.Ta.delete(a),i.Ra.removeTarget(a))}(t,e)}catch(s){Q(ri,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await sl(t,s)}else if(e instanceof Fa?t.Ra.Ye(e):e instanceof f_?t.Ra.it(e):t.Ra.et(e),!n.isEqual(de.min()))try{const s=await I_(t.localStore);n.compareTo(s)>=0&&await function(r,o){const a=r.Ra.Pt(o);return a.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){const d=r.Ta.get(h);d&&r.Ta.set(h,d.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,h)=>{const d=r.Ta.get(u);if(!d)return;r.Ta.set(u,d.withResumeToken(Tt.EMPTY_BYTE_STRING,d.snapshotVersion)),D_(r,u);const p=new ys(d.target,u,h,d.sequenceNumber);od(r,p)}),r.remoteSyncer.applyRemoteEvent(a)}(t,n)}catch(s){Q(ri,"Failed to raise snapshot:",s),await sl(t,s)}}async function sl(t,e,n){if(!Yi(e))throw e;t.Ia.add(1),await bo(t),t.Aa.set("Offline"),n||(n=()=>I_(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{Q(ri,"Retrying IndexedDB access"),await n(),t.Ia.delete(1),await Bl(t)})}function R_(t,e){return e().catch(n=>sl(t,n,e))}async function Ul(t){const e=me(t),n=Ns(e);let s=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:Wh;for(;Cx(e);)try{const i=await cx(e.localStore,s);if(i===null){e.Pa.length===0&&n.B_();break}s=i.batchId,Dx(e,i)}catch(i){await sl(e,i)}N_(e)&&M_(e)}function Cx(t){return ci(t)&&t.Pa.length<10}function Dx(t,e){t.Pa.push(e);const n=Ns(t);n.x_()&&n.Z_&&n.X_(e.mutations)}function N_(t){return ci(t)&&!Ns(t).M_()&&t.Pa.length>0}function M_(t){Ns(t).start()}async function Px(t){Ns(t).na()}async function Rx(t){const e=Ns(t);for(const n of t.Pa)e.X_(n.mutations)}async function Nx(t,e,n){const s=t.Pa.shift(),i=Jh.from(s,e,n);await R_(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await Ul(t)}async function Mx(t,e){e&&Ns(t).Z_&&await async function(s,i){if(function(o){return gA(o)&&o!==U.ABORTED}(i.code)){const r=s.Pa.shift();Ns(s).N_(),await R_(s,()=>s.remoteSyncer.rejectFailedWrite(r.batchId,i)),await Ul(s)}}(t,e),N_(t)&&M_(t)}async function ng(t,e){const n=me(t);n.asyncQueue.verifyOperationInProgress(),Q(ri,"RemoteStore received new credentials");const s=ci(n);n.Ia.add(3),await bo(n),s&&n.Aa.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ia.delete(3),await Bl(n)}async function jx(t,e){const n=me(t);e?(n.Ia.delete(2),await Bl(n)):e||(n.Ia.add(2),await bo(n),n.Aa.set("Unknown"))}function Ki(t){return t.Va||(t.Va=function(n,s,i){const r=me(n);return r.ia(),new yx(s,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,i)}(t.datastore,t.asyncQueue,{Zo:xx.bind(null,t),e_:Ix.bind(null,t),n_:Sx.bind(null,t),J_:bx.bind(null,t)}),t.da.push(async e=>{e?(t.Va.N_(),ld(t)?ad(t):t.Aa.set("Unknown")):(await t.Va.stop(),P_(t))})),t.Va}function Ns(t){return t.ma||(t.ma=function(n,s,i){const r=me(n);return r.ia(),new vx(s,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,i)}(t.datastore,t.asyncQueue,{Zo:()=>Promise.resolve(),e_:Px.bind(null,t),n_:Mx.bind(null,t),ea:Rx.bind(null,t),ta:Nx.bind(null,t)}),t.da.push(async e=>{e?(t.ma.N_(),await Ul(t)):(await t.ma.stop(),t.Pa.length>0&&(Q(ri,`Stopping write stream with ${t.Pa.length} pending writes`),t.Pa=[]))})),t.ma}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cd{constructor(e,n,s,i,r){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=s,this.op=i,this.removalCallback=r,this.deferred=new qn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,s,i,r){const o=Date.now()+s,a=new cd(e,n,o,i,r);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new q(U.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ud(t,e){if(Jn("AsyncQueue",`${e}: ${t}`),Yi(t))return new q(U.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{static emptySet(e){return new Di(e.comparator)}constructor(e){this.comparator=e?(n,s)=>e(n,s)||ee.comparator(n.key,s.key):(n,s)=>ee.comparator(n.key,s.key),this.keyedMap=Nr(),this.sortedSet=new ze(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,s)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Di)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,r=s.getNext().key;if(!i.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const s=new Di;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=n,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sg{constructor(){this.fa=new ze(ee.comparator)}track(e){const n=e.doc.key,s=this.fa.get(n);s?e.type!==0&&s.type===3?this.fa=this.fa.insert(n,e):e.type===3&&s.type!==1?this.fa=this.fa.insert(n,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.fa=this.fa.insert(n,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.fa=this.fa.insert(n,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.fa=this.fa.remove(n):e.type===1&&s.type===2?this.fa=this.fa.insert(n,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.fa=this.fa.insert(n,{type:2,doc:e.doc}):ae(63341,{At:e,ga:s}):this.fa=this.fa.insert(n,e)}pa(){const e=[];return this.fa.inorderTraversal((n,s)=>{e.push(s)}),e}}class Bi{constructor(e,n,s,i,r,o,a,u,h){this.query=e,this.docs=n,this.oldDocs=s,this.docChanges=i,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,n,s,i,r){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new Bi(e,n,Di.emptySet(n),o,s,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&jl(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,s=e.docChanges;if(n.length!==s.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==s[i].type||!n[i].doc.isEqual(s[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lx{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}}class kx{constructor(){this.queries=ig(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(n,s){const i=me(n),r=i.queries;i.queries=ig(),r.forEach((o,a)=>{for(const u of a.wa)u.onError(s)})})(this,new q(U.ABORTED,"Firestore shutting down"))}}function ig(){return new li(t=>e_(t),jl)}async function j_(t,e){const n=me(t);let s=3;const i=e.query;let r=n.queries.get(i);r?!r.Sa()&&e.ba()&&(s=2):(r=new Lx,s=e.ba()?0:1);try{switch(s){case 0:r.ya=await n.onListen(i,!0);break;case 1:r.ya=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(o){const a=ud(o,`Initialization of query '${Ei(e.query)}' failed`);return void e.onError(a)}n.queries.set(i,r),r.wa.push(e),e.va(n.onlineState),r.ya&&e.Ca(r.ya)&&hd(n)}async function L_(t,e){const n=me(t),s=e.query;let i=3;const r=n.queries.get(s);if(r){const o=r.wa.indexOf(e);o>=0&&(r.wa.splice(o,1),r.wa.length===0?i=e.ba()?0:1:!r.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return n.queries.delete(s),n.onUnlisten(s,!0);case 1:return n.queries.delete(s),n.onUnlisten(s,!1);case 2:return n.onLastRemoteStoreUnlisten(s);default:return}}function Fx(t,e){const n=me(t);let s=!1;for(const i of e){const r=i.query,o=n.queries.get(r);if(o){for(const a of o.wa)a.Ca(i)&&(s=!0);o.ya=i}}s&&hd(n)}function Ox(t,e,n){const s=me(t),i=s.queries.get(e);if(i)for(const r of i.wa)r.onError(n);s.queries.delete(e)}function hd(t){t.Da.forEach(e=>{e.next()})}var Hu,rg;(rg=Hu||(Hu={})).Fa="default",rg.Cache="cache";class k_{constructor(e,n,s){this.query=e,this.Ma=n,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=s||{}}Ca(e){if(!this.options.includeMetadataChanges){const s=[];for(const i of e.docChanges)i.type!==3&&s.push(i);e=new Bi(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),n=!0):this.Ba(e,this.onlineState)&&(this.La(e),n=!0),this.Oa=e,n}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let n=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),n=!0),n}Ba(e,n){if(!e.fromCache||!this.ba())return!0;const s=n!=="Offline";return(!this.options.ka||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Na(e){if(e.docChanges.length>0)return!0;const n=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}La(e){e=Bi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==Hu.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F_{constructor(e){this.key=e}}class O_{constructor(e){this.key=e}}class Vx{constructor(e,n){this.query=e,this.Ha=n,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=Se(),this.mutatedKeys=Se(),this.Xa=t_(e),this.eu=new Di(this.Xa)}get tu(){return this.Ha}nu(e,n){const s=n?n.ru:new sg,i=n?n.eu:this.eu;let r=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1;const u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,p)=>{const m=i.get(d),y=Ll(this.query,p)?p:null,v=!!m&&this.mutatedKeys.has(m.key),w=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let E=!1;m&&y?m.data.isEqual(y.data)?v!==w&&(s.track({type:3,doc:y}),E=!0):this.iu(m,y)||(s.track({type:2,doc:y}),E=!0,(u&&this.Xa(y,u)>0||h&&this.Xa(y,h)<0)&&(a=!0)):!m&&y?(s.track({type:0,doc:y}),E=!0):m&&!y&&(s.track({type:1,doc:m}),E=!0,(u||h)&&(a=!0)),E&&(y?(o=o.add(y),r=w?r.add(d):r.delete(d)):(o=o.delete(d),r=r.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),r=r.delete(d.key),s.track({type:1,doc:d})}return{eu:o,ru:s,Ds:a,mutatedKeys:r}}iu(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,s,i){const r=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const o=e.ru.pa();o.sort((d,p)=>function(y,v){const w=E=>{switch(E){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ae(20277,{At:E})}};return w(y)-w(v)}(d.type,p.type)||this.Xa(d.doc,p.doc)),this.su(s),i=i!=null&&i;const a=n&&!i?this.ou():[],u=this.Za.size===0&&this.current&&!i?1:0,h=u!==this.Ya;return this.Ya=u,o.length!==0||h?{snapshot:new Bi(this.query,e.eu,r,o,e.mutatedKeys,u===0,h,!1,!!s&&s.resumeToken.approximateByteSize()>0),_u:a}:{_u:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new sg,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(n=>this.Ha=this.Ha.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ha=this.Ha.delete(n)),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=Se(),this.eu.forEach(s=>{this.au(s.key)&&(this.Za=this.Za.add(s.key))});const n=[];return e.forEach(s=>{this.Za.has(s)||n.push(new O_(s))}),this.Za.forEach(s=>{e.has(s)||n.push(new F_(s))}),n}uu(e){this.Ha=e.qs,this.Za=Se();const n=this.nu(e.documents);return this.applyChanges(n,!0)}cu(){return Bi.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}}const dd="SyncEngine";class Bx{constructor(e,n,s){this.query=e,this.targetId=n,this.view=s}}class Ux{constructor(e){this.key=e,this.lu=!1}}class $x{constructor(e,n,s,i,r,o){this.localStore=e,this.remoteStore=n,this.eventManager=s,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.hu={},this.Pu=new li(a=>e_(a),jl),this.Tu=new Map,this.Iu=new Set,this.du=new ze(ee.comparator),this.Eu=new Map,this.Au=new td,this.Ru={},this.Vu=new Map,this.mu=Vi.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}}async function Hx(t,e,n=!0){const s=W_(t);let i;const r=s.Pu.get(e);return r?(s.sharedClientState.addLocalQueryTarget(r.targetId),i=r.view.cu()):i=await V_(s,e,n,!0),i}async function Wx(t,e){const n=W_(t);await V_(n,e,!0,!1)}async function V_(t,e,n,s){const i=await ux(t.localStore,xn(e)),r=i.targetId,o=t.sharedClientState.addLocalQueryTarget(r,n);let a;return s&&(a=await Xx(t,e,r,o==="current",i.resumeToken)),t.isPrimaryClient&&n&&C_(t.remoteStore,i),a}async function Xx(t,e,n,s,i){t.gu=(p,m,y)=>async function(w,E,C,A){let R=E.view.nu(C);R.Ds&&(R=await Qp(w.localStore,E.query,!1).then(({documents:I})=>E.view.nu(I,R)));const N=A&&A.targetChanges.get(E.targetId),k=A&&A.targetMismatches.get(E.targetId)!=null,j=E.view.applyChanges(R,w.isPrimaryClient,N,k);return ag(w,E.targetId,j._u),j.snapshot}(t,p,m,y);const r=await Qp(t.localStore,e,!0),o=new Vx(e,r.qs),a=o.nu(r.documents),u=So.createSynthesizedTargetChangeForCurrentChange(n,s&&t.onlineState!=="Offline",i),h=o.applyChanges(a,t.isPrimaryClient,u);ag(t,n,h._u);const d=new Bx(e,n,o);return t.Pu.set(e,d),t.Tu.has(n)?t.Tu.get(n).push(e):t.Tu.set(n,[e]),h.snapshot}async function Gx(t,e,n){const s=me(t),i=s.Pu.get(e),r=s.Tu.get(i.targetId);if(r.length>1)return s.Tu.set(i.targetId,r.filter(o=>!jl(o,e))),void s.Pu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(i.targetId),s.sharedClientState.isActiveQueryTarget(i.targetId)||await Uu(s.localStore,i.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(i.targetId),n&&rd(s.remoteStore,i.targetId),Wu(s,i.targetId)}).catch(zi)):(Wu(s,i.targetId),await Uu(s.localStore,i.targetId,!0))}async function zx(t,e){const n=me(t),s=n.Pu.get(e),i=n.Tu.get(s.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(s.targetId),rd(n.remoteStore,s.targetId))}async function Yx(t,e,n){const s=tI(t);try{const i=await function(o,a){const u=me(o),h=He.now(),d=a.reduce((y,v)=>y.add(v.key),Se());let p,m;return u.persistence.runTransaction("Locally write mutations","readwrite",y=>{let v=es(),w=Se();return u.Os.getEntries(y,d).next(E=>{v=E,v.forEach((C,A)=>{A.isValidDocument()||(w=w.add(C))})}).next(()=>u.localDocuments.getOverlayedDocuments(y,v)).next(E=>{p=E;const C=[];for(const A of a){const R=uA(A,p.get(A.key).overlayedDocument);R!=null&&C.push(new Os(A.key,R,G0(R.value.mapValue),hn.exists(!0)))}return u.mutationQueue.addMutationBatch(y,h,C,a)}).next(E=>{m=E;const C=E.applyToLocalDocumentSet(p,w);return u.documentOverlayCache.saveOverlays(y,E.batchId,C)})}).then(()=>({batchId:m.batchId,changes:s_(p)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let h=o.Ru[o.currentUser.toKey()];h||(h=new ze(Ee)),h=h.insert(a,u),o.Ru[o.currentUser.toKey()]=h}(s,i.batchId,n),await Co(s,i.changes),await Ul(s.remoteStore)}catch(i){const r=ud(i,"Failed to persist write");n.reject(r)}}async function B_(t,e){const n=me(t);try{const s=await ax(n.localStore,e);e.targetChanges.forEach((i,r)=>{const o=n.Eu.get(r);o&&(Me(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.lu=!0:i.modifiedDocuments.size>0?Me(o.lu,14607):i.removedDocuments.size>0&&(Me(o.lu,42227),o.lu=!1))}),await Co(n,s,e)}catch(s){await zi(s)}}function og(t,e,n){const s=me(t);if(s.isPrimaryClient&&n===0||!s.isPrimaryClient&&n===1){const i=[];s.Pu.forEach((r,o)=>{const a=o.view.va(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const u=me(o);u.onlineState=a;let h=!1;u.queries.forEach((d,p)=>{for(const m of p.wa)m.va(a)&&(h=!0)}),h&&hd(u)}(s.eventManager,e),i.length&&s.hu.J_(i),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function qx(t,e,n){const s=me(t);s.sharedClientState.updateQueryState(e,"rejected",n);const i=s.Eu.get(e),r=i&&i.key;if(r){let o=new ze(ee.comparator);o=o.insert(r,Ct.newNoDocument(r,de.min()));const a=Se().add(r),u=new Ol(de.min(),new Map,new ze(Ee),o,a);await B_(s,u),s.du=s.du.remove(r),s.Eu.delete(e),fd(s)}else await Uu(s.localStore,e,!1).then(()=>Wu(s,e,n)).catch(zi)}async function Kx(t,e){const n=me(t),s=e.batch.batchId;try{const i=await ox(n.localStore,e);$_(n,s,null),U_(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await Co(n,i)}catch(i){await zi(i)}}async function Qx(t,e,n){const s=me(t);try{const i=await function(o,a){const u=me(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let d;return u.mutationQueue.lookupMutationBatch(h,a).next(p=>(Me(p!==null,37113),d=p.keys(),u.mutationQueue.removeMutationBatch(h,p))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,d,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,d)).next(()=>u.localDocuments.getDocuments(h,d))})}(s.localStore,e);$_(s,e,n),U_(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await Co(s,i)}catch(i){await zi(i)}}function U_(t,e){(t.Vu.get(e)||[]).forEach(n=>{n.resolve()}),t.Vu.delete(e)}function $_(t,e,n){const s=me(t);let i=s.Ru[s.currentUser.toKey()];if(i){const r=i.get(e);r&&(n?r.reject(n):r.resolve(),i=i.remove(e)),s.Ru[s.currentUser.toKey()]=i}}function Wu(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.Tu.get(e))t.Pu.delete(s),n&&t.hu.pu(s,n);t.Tu.delete(e),t.isPrimaryClient&&t.Au.zr(e).forEach(s=>{t.Au.containsKey(s)||H_(t,s)})}function H_(t,e){t.Iu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(rd(t.remoteStore,n),t.du=t.du.remove(e),t.Eu.delete(n),fd(t))}function ag(t,e,n){for(const s of n)s instanceof F_?(t.Au.addReference(s.key,e),Jx(t,s)):s instanceof O_?(Q(dd,"Document no longer in limbo: "+s.key),t.Au.removeReference(s.key,e),t.Au.containsKey(s.key)||H_(t,s.key)):ae(19791,{yu:s})}function Jx(t,e){const n=e.key,s=n.path.canonicalString();t.du.get(n)||t.Iu.has(s)||(Q(dd,"New document in limbo: "+n),t.Iu.add(s),fd(t))}function fd(t){for(;t.Iu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Iu.values().next().value;t.Iu.delete(e);const n=new ee(Be.fromString(e)),s=t.mu.next();t.Eu.set(s,new Ux(n)),t.du=t.du.insert(n,s),C_(t.remoteStore,new ys(xn(qh(n.path)),s,"TargetPurposeLimboResolution",Rl.ue))}}async function Co(t,e,n){const s=me(t),i=[],r=[],o=[];s.Pu.isEmpty()||(s.Pu.forEach((a,u)=>{o.push(s.gu(u,e,n).then(h=>{var d;if((h||n)&&s.isPrimaryClient){const p=h?!h.fromCache:(d=n==null?void 0:n.targetChanges.get(u.targetId))===null||d===void 0?void 0:d.current;s.sharedClientState.updateQueryState(u.targetId,p?"current":"not-current")}if(h){i.push(h);const p=sd.Es(u.targetId,h);r.push(p)}}))}),await Promise.all(o),s.hu.J_(i),await async function(u,h){const d=me(u);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>$.forEach(h,m=>$.forEach(m.Is,y=>d.persistence.referenceDelegate.addReference(p,m.targetId,y)).next(()=>$.forEach(m.ds,y=>d.persistence.referenceDelegate.removeReference(p,m.targetId,y)))))}catch(p){if(!Yi(p))throw p;Q(id,"Failed to update sequence numbers: "+p)}for(const p of h){const m=p.targetId;if(!p.fromCache){const y=d.Fs.get(m),v=y.snapshotVersion,w=y.withLastLimboFreeSnapshotVersion(v);d.Fs=d.Fs.insert(m,w)}}}(s.localStore,r))}async function Zx(t,e){const n=me(t);if(!n.currentUser.isEqual(e)){Q(dd,"User change. New user:",e.toKey());const s=await x_(n.localStore,e);n.currentUser=e,function(r,o){r.Vu.forEach(a=>{a.forEach(u=>{u.reject(new q(U.CANCELLED,o))})}),r.Vu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await Co(n,s.Bs)}}function eI(t,e){const n=me(t),s=n.Eu.get(e);if(s&&s.lu)return Se().add(s.key);{let i=Se();const r=n.Tu.get(e);if(!r)return i;for(const o of r){const a=n.Pu.get(o);i=i.unionWith(a.view.tu)}return i}}function W_(t){const e=me(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=B_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=eI.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=qx.bind(null,e),e.hu.J_=Fx.bind(null,e.eventManager),e.hu.pu=Ox.bind(null,e.eventManager),e}function tI(t){const e=me(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Kx.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Qx.bind(null,e),e}class il{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Vl(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,n){return null}Fu(e,n){return null}vu(e){return rx(this.persistence,new nx,e.initialUser,this.serializer)}Du(e){return new A_(nd.Vi,this.serializer)}bu(e){return new dx}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}il.provider={build:()=>new il};class nI extends il{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,n){Me(this.persistence.referenceDelegate instanceof nl,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new UA(s,e.asyncQueue,n)}Du(e){const n=this.cacheSizeBytes!==void 0?Ft.withCacheSize(this.cacheSizeBytes):Ft.DEFAULT;return new A_(s=>nl.Vi(s,n),this.serializer)}}class Xu{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>og(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Zx.bind(null,this.syncEngine),await jx(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new kx}()}createDatastore(e){const n=Vl(e.databaseInfo.databaseId),s=function(r){return new _x(r)}(e.databaseInfo);return function(r,o,a,u){return new Tx(r,o,a,u)}(e.authCredentials,e.appCheckCredentials,s,n)}createRemoteStore(e){return function(s,i,r,o,a){return new Ax(s,i,r,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>og(this.syncEngine,n,0),function(){return eg.C()?new eg:new fx}())}createSyncEngine(e,n){return function(i,r,o,a,u,h,d){const p=new $x(i,r,o,a,u,h);return d&&(p.fu=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(i){const r=me(i);Q(ri,"RemoteStore shutting down."),r.Ia.add(5),await bo(r),r.Ea.shutdown(),r.Aa.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}Xu.provider={build:()=>new Xu};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):Jn("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ms="FirestoreClient";class sI{constructor(e,n,s,i,r){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=s,this.databaseInfo=i,this.user=bt.UNAUTHENTICATED,this.clientId=Hh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(s,async o=>{Q(Ms,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(s,o=>(Q(Ms,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new qn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const s=ud(n,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function Pc(t,e){t.asyncQueue.verifyOperationInProgress(),Q(Ms,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener(async i=>{s.isEqual(i)||(await x_(e.localStore,i),s=i)}),e.persistence.setDatabaseDeletedListener(()=>{bs("Terminating Firestore due to IndexedDb database deletion"),t.terminate().then(()=>{Q("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{bs("Terminating Firestore due to IndexedDb database deletion failed",i)})}),t._offlineComponents=e}async function lg(t,e){t.asyncQueue.verifyOperationInProgress();const n=await iI(t);Q(Ms,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(s=>ng(e.remoteStore,s)),t.setAppCheckTokenChangeListener((s,i)=>ng(e.remoteStore,i)),t._onlineComponents=e}async function iI(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Q(Ms,"Using user provided OfflineComponentProvider");try{await Pc(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(i){return i.name==="FirebaseError"?i.code===U.FAILED_PRECONDITION||i.code===U.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(n))throw n;bs("Error using user provided cache. Falling back to memory cache: "+n),await Pc(t,new il)}}else Q(Ms,"Using default OfflineComponentProvider"),await Pc(t,new nI(void 0));return t._offlineComponents}async function G_(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Q(Ms,"Using user provided OnlineComponentProvider"),await lg(t,t._uninitializedComponentsProvider._online)):(Q(Ms,"Using default OnlineComponentProvider"),await lg(t,new Xu))),t._onlineComponents}function rI(t){return G_(t).then(e=>e.syncEngine)}async function z_(t){const e=await G_(t),n=e.eventManager;return n.onListen=Hx.bind(null,e.syncEngine),n.onUnlisten=Gx.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Wx.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=zx.bind(null,e.syncEngine),n}function oI(t,e,n={}){const s=new qn;return t.asyncQueue.enqueueAndForget(async()=>function(r,o,a,u,h){const d=new X_({next:m=>{d.Ou(),o.enqueueAndForget(()=>L_(r,p));const y=m.docs.has(a);!y&&m.fromCache?h.reject(new q(U.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&m.fromCache&&u&&u.source==="server"?h.reject(new q(U.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(m)},error:m=>h.reject(m)}),p=new k_(qh(a.path),d,{includeMetadataChanges:!0,ka:!0});return j_(r,p)}(await z_(t),t.asyncQueue,e,n,s)),s.promise}function aI(t,e,n={}){const s=new qn;return t.asyncQueue.enqueueAndForget(async()=>function(r,o,a,u,h){const d=new X_({next:m=>{d.Ou(),o.enqueueAndForget(()=>L_(r,p)),m.fromCache&&u.source==="server"?h.reject(new q(U.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(m)},error:m=>h.reject(m)}),p=new k_(a,d,{includeMetadataChanges:!0,ka:!0});return j_(r,p)}(await z_(t),t.asyncQueue,e,n,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y_(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cg=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q_="firestore.googleapis.com",ug=!0;class hg{constructor(e){var n,s;if(e.host===void 0){if(e.ssl!==void 0)throw new q(U.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=q_,this.ssl=ug}else this.host=e.host,this.ssl=(n=e.ssl)!==null&&n!==void 0?n:ug;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=E_;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<VA)throw new q(U.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}AE("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Y_((s=e.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new q(U.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new q(U.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new q(U.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,i){return s.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class $l{constructor(e,n,s,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=s,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hg({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new q(U.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new q(U.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hg(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new pE;switch(s.type){case"firstParty":return new yE(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new q(U.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const s=cg.get(n);s&&(Q("ComponentProvider","Removing Datastore"),cg.delete(n),s.terminate())}(this),Promise.resolve()}}function lI(t,e,n,s={}){var i;t=Zn(t,$l);const r=Hi(e),o=t._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:t._getEmulatorOptions()}),u=`${e}:${n}`;r&&(Om(`https://${u}`),Vm("Firestore",!0)),o.host!==q_&&o.host!==u&&bs("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h=Object.assign(Object.assign({},o),{host:u,ssl:r,emulatorOptions:s});if(!ei(h,a)&&(t._setSettings(h),s.mockUserToken)){let d,p;if(typeof s.mockUserToken=="string")d=s.mockUserToken,p=bt.MOCK_USER;else{d=Ev(s.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);const m=s.mockUserToken.sub||s.mockUserToken.user_id;if(!m)throw new q(U.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new bt(m)}t._authCredentials=new gE(new M0(d,p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui{constructor(e,n,s){this.converter=n,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new ui(this.firestore,e,this._query)}}class at{constructor(e,n,s){this.converter=n,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Is(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new at(this.firestore,e,this._key)}toJSON(){return{type:at._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,s){if(xo(n,at._jsonSchema))return new at(e,s||null,new ee(Be.fromString(n.referencePath)))}}at._jsonSchemaVersion="firestore/documentReference/1.0",at._jsonSchema={type:ot("string",at._jsonSchemaVersion),referencePath:ot("string")};class Is extends ui{constructor(e,n,s){super(e,n,qh(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new at(this.firestore,null,new ee(e))}withConverter(e){return new Is(this.firestore,e,this._path)}}function K_(t,e,...n){if(t=dt(t),L0("collection","path",e),t instanceof $l){const s=Be.fromString(e,...n);return xp(s),new Is(t,null,s)}{if(!(t instanceof at||t instanceof Is))throw new q(U.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Be.fromString(e,...n));return xp(s),new Is(t.firestore,null,s)}}function Do(t,e,...n){if(t=dt(t),arguments.length===1&&(e=Hh.newId()),L0("doc","path",e),t instanceof $l){const s=Be.fromString(e,...n);return Ap(s),new at(t,null,new ee(s))}{if(!(t instanceof at||t instanceof Is))throw new q(U.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Be.fromString(e,...n));return Ap(s),new at(t.firestore,t instanceof Is?t.converter:null,new ee(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dg="AsyncQueue";class fg{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new S_(this,"async_queue_retry"),this.oc=()=>{const s=Dc();s&&Q(dg,"Visibility state changed to "+s.visibilityState),this.F_.y_()},this._c=e;const n=Dc();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const n=Dc();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});const n=new qn;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!Yi(e))throw e;Q(dg,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(e){const n=this._c.then(()=>(this.nc=!0,e().catch(s=>{throw this.tc=s,this.nc=!1,Jn("INTERNAL UNHANDLED ERROR: ",pg(s)),s}).then(s=>(this.nc=!1,s))));return this._c=n,n}enqueueAfterDelay(e,n,s){this.ac(),this.sc.indexOf(e)>-1&&(n=0);const i=cd.createAndSchedule(this,e,n,s,r=>this.lc(r));return this.ec.push(i),i}ac(){this.tc&&ae(47125,{hc:pg(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(const n of this.ec)if(n.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((n,s)=>n.targetTimeMs-s.targetTimeMs);for(const n of this.ec)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){const n=this.ec.indexOf(e);this.ec.splice(n,1)}}function pg(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Qi extends $l{constructor(e,n,s,i){super(e,n,s,i),this.type="firestore",this._queue=new fg,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new fg(e),this._firestoreClient=void 0,await e}}}function cI(t,e){const n=typeof t=="object"?t:Hm(),s=typeof t=="string"?t:Qa,i=Ph(n,"firestore").getImmediate({identifier:s});if(!i._initialized){const r=wv("firestore");r&&lI(i,...r)}return i}function pd(t){if(t._terminated)throw new q(U.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||uI(t),t._firestoreClient}function uI(t){var e,n,s;const i=t._freezeSettings(),r=function(a,u,h,d){return new jE(a,u,h,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,Y_(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((s=i.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new sI(t._authCredentials,t._appCheckCredentials,t._queue,r,t._componentsProvider&&function(a){const u=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(u),_online:u}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Zt(Tt.fromBase64String(e))}catch(n){throw new q(U.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Zt(Tt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Zt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(xo(e,Zt._jsonSchema))return Zt.fromBase64String(e.bytes)}}Zt._jsonSchemaVersion="firestore/bytes/1.0",Zt._jsonSchema={type:ot("string",Zt._jsonSchemaVersion),bytes:ot("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new q(U.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new wt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wl{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new q(U.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new q(U.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ee(this._lat,e._lat)||Ee(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Sn._jsonSchemaVersion}}static fromJSON(e){if(xo(e,Sn._jsonSchema))return new Sn(e.latitude,e.longitude)}}Sn._jsonSchemaVersion="firestore/geoPoint/1.0",Sn._jsonSchema={type:ot("string",Sn._jsonSchemaVersion),latitude:ot("number"),longitude:ot("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(s,i){if(s.length!==i.length)return!1;for(let r=0;r<s.length;++r)if(s[r]!==i[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:bn._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(xo(e,bn._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new bn(e.vectorValues);throw new q(U.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}bn._jsonSchemaVersion="firestore/vectorValue/1.0",bn._jsonSchema={type:ot("string",bn._jsonSchemaVersion),vectorValues:ot("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hI=/^__.*__$/;class dI{constructor(e,n,s){this.data=e,this.fieldMask=n,this.fieldTransforms=s}toMutation(e,n){return this.fieldMask!==null?new Os(e,this.data,this.fieldMask,n,this.fieldTransforms):new Io(e,this.data,n,this.fieldTransforms)}}class Q_{constructor(e,n,s){this.data=e,this.fieldMask=n,this.fieldTransforms=s}toMutation(e,n){return new Os(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function J_(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ae(40011,{Ec:t})}}class gd{constructor(e,n,s,i,r,o){this.settings=e,this.databaseId=n,this.serializer=s,this.ignoreUndefinedProperties=i,r===void 0&&this.Ac(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new gd(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var n;const s=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.Rc({path:s,mc:!1});return i.fc(e),i}gc(e){var n;const s=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.Rc({path:s,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return rl(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(J_(this.Ec)&&hI.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class fI{constructor(e,n,s){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=s||Vl(e)}Dc(e,n,s,i=!1){return new gd({Ec:e,methodName:n,bc:s,path:wt.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function md(t){const e=t._freezeSettings(),n=Vl(t._databaseId);return new fI(t._databaseId,!!e.ignoreUndefinedProperties,n)}function pI(t,e,n,s,i,r={}){const o=t.Dc(r.merge||r.mergeFields?2:0,e,n,i);yd("Data must be an object, but it was:",o,s);const a=Z_(s,o);let u,h;if(r.merge)u=new Ht(o.fieldMask),h=o.fieldTransforms;else if(r.mergeFields){const d=[];for(const p of r.mergeFields){const m=Gu(e,p,n);if(!o.contains(m))throw new q(U.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);ty(d,m)||d.push(m)}u=new Ht(d),h=o.fieldTransforms.filter(p=>u.covers(p.field))}else u=null,h=o.fieldTransforms;return new dI(new Ot(a),u,h)}class Xl extends Wl{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Xl}}class _d extends Wl{_toFieldTransform(e){return new oA(e.path,new ro)}isEqual(e){return e instanceof _d}}function gI(t,e,n,s){const i=t.Dc(1,e,n);yd("Data must be an object, but it was:",i,s);const r=[],o=Ot.empty();Fs(s,(u,h)=>{const d=vd(e,u,n);h=dt(h);const p=i.gc(d);if(h instanceof Xl)r.push(d);else{const m=Po(h,p);m!=null&&(r.push(d),o.set(d,m))}});const a=new Ht(r);return new Q_(o,a,i.fieldTransforms)}function mI(t,e,n,s,i,r){const o=t.Dc(1,e,n),a=[Gu(e,s,n)],u=[i];if(r.length%2!=0)throw new q(U.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<r.length;m+=2)a.push(Gu(e,r[m])),u.push(r[m+1]);const h=[],d=Ot.empty();for(let m=a.length-1;m>=0;--m)if(!ty(h,a[m])){const y=a[m];let v=u[m];v=dt(v);const w=o.gc(y);if(v instanceof Xl)h.push(y);else{const E=Po(v,w);E!=null&&(h.push(y),d.set(y,E))}}const p=new Ht(h);return new Q_(d,p,o.fieldTransforms)}function _I(t,e,n,s=!1){return Po(n,t.Dc(s?4:3,e))}function Po(t,e){if(ey(t=dt(t)))return yd("Unsupported field value:",e,t),Z_(t,e);if(t instanceof Wl)return function(s,i){if(!J_(i.Ec))throw i.wc(`${s._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${s._methodName}() is not currently supported inside arrays`);const r=s._toFieldTransform(i);r&&i.fieldTransforms.push(r)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return function(s,i){const r=[];let o=0;for(const a of s){let u=Po(a,i.yc(o));u==null&&(u={nullValue:"NULL_VALUE"}),r.push(u),o++}return{arrayValue:{values:r}}}(t,e)}return function(s,i){if((s=dt(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return sA(i.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const r=He.fromDate(s);return{timestampValue:tl(i.serializer,r)}}if(s instanceof He){const r=new He(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:tl(i.serializer,r)}}if(s instanceof Sn)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Zt)return{bytesValue:g_(i.serializer,s._byteString)};if(s instanceof at){const r=i.databaseId,o=s.firestore._databaseId;if(!o.isEqual(r))throw i.wc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:ed(s.firestore._databaseId||i.databaseId,s._key.path)}}if(s instanceof bn)return function(o,a){return{mapValue:{fields:{[W0]:{stringValue:X0},[Ja]:{arrayValue:{values:o.toArray().map(h=>{if(typeof h!="number")throw a.wc("VectorValues must only contain numeric values.");return Kh(a.serializer,h)})}}}}}}(s,i);throw i.wc(`Unsupported field value: ${Pl(s)}`)}(t,e)}function Z_(t,e){const n={};return O0(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Fs(t,(s,i)=>{const r=Po(i,e.Vc(s));r!=null&&(n[s]=r)}),{mapValue:{fields:n}}}function ey(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof He||t instanceof Sn||t instanceof Zt||t instanceof at||t instanceof Wl||t instanceof bn)}function yd(t,e,n){if(!ey(n)||!k0(n)){const s=Pl(n);throw s==="an object"?e.wc(t+" a custom object"):e.wc(t+" "+s)}}function Gu(t,e,n){if((e=dt(e))instanceof Hl)return e._internalPath;if(typeof e=="string")return vd(t,e);throw rl("Field path arguments must be of type string or ",t,!1,void 0,n)}const yI=new RegExp("[~\\*/\\[\\]]");function vd(t,e,n){if(e.search(yI)>=0)throw rl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Hl(...e.split("."))._internalPath}catch{throw rl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function rl(t,e,n,s,i){const r=s&&!s.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(r||o)&&(u+=" (found",r&&(u+=` in field ${s}`),o&&(u+=` in document ${i}`),u+=")"),new q(U.INVALID_ARGUMENT,a+t+u)}function ty(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ny{constructor(e,n,s,i,r){this._firestore=e,this._userDataWriter=n,this._key=s,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new at(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new vI(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Gl("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class vI extends ny{data(){return super.data()}}function Gl(t,e){return typeof e=="string"?vd(t,e):e instanceof Hl?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wI(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new q(U.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class wd{}class sy extends wd{}function TI(t,e,...n){let s=[];e instanceof wd&&s.push(e),s=s.concat(n),function(r){const o=r.filter(u=>u instanceof Td).length,a=r.filter(u=>u instanceof zl).length;if(o>1||o>0&&a>0)throw new q(U.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const i of s)t=i._apply(t);return t}class zl extends sy{constructor(e,n,s){super(),this._field=e,this._op=n,this._value=s,this.type="where"}static _create(e,n,s){return new zl(e,n,s)}_apply(e){const n=this._parse(e);return iy(e._query,n),new ui(e.firestore,e.converter,Lu(e._query,n))}_parse(e){const n=md(e.firestore);return function(r,o,a,u,h,d,p){let m;if(h.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new q(U.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){mg(p,d);const v=[];for(const w of p)v.push(gg(u,r,w));m={arrayValue:{values:v}}}else m=gg(u,r,p)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||mg(p,d),m=_I(a,o,p,d==="in"||d==="not-in");return rt.create(h,d,m)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function EI(t,e,n){const s=e,i=Gl("where",t);return zl._create(i,s,n)}class Td extends wd{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Td(e,n)}_parse(e){const n=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return n.length===1?n[0]:dn.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(i,r){let o=i;const a=r.getFlattenedFilters();for(const u of a)iy(o,u),o=Lu(o,u)}(e._query,n),new ui(e.firestore,e.converter,Lu(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Ed extends sy{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new Ed(e,n)}_apply(e){const n=function(i,r,o){if(i.startAt!==null)throw new q(U.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new q(U.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new io(r,o)}(e._query,this._field,this._direction);return new ui(e.firestore,e.converter,function(i,r){const o=i.explicitOrderBy.concat([r]);return new qi(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,n))}}function AI(t,e="asc"){const n=e,s=Gl("orderBy",t);return Ed._create(s,n)}function gg(t,e,n){if(typeof(n=dt(n))=="string"){if(n==="")throw new q(U.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Z0(e)&&n.indexOf("/")!==-1)throw new q(U.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(Be.fromString(n));if(!ee.isDocumentKey(s))throw new q(U.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Np(t,new ee(s))}if(n instanceof at)return Np(t,n._key);throw new q(U.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Pl(n)}.`)}function mg(t,e){if(!Array.isArray(t)||t.length===0)throw new q(U.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function iy(t,e){const n=function(i,r){for(const o of i)for(const a of o.getFlattenedFilters())if(r.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new q(U.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new q(U.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class xI{convertValue(e,n="none"){switch(Rs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ze(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ps(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw ae(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const s={};return Fs(e,(i,r)=>{s[i]=this.convertValue(r,n)}),s}convertVectorValue(e){var n,s,i;const r=(i=(s=(n=e.fields)===null||n===void 0?void 0:n[Ja].arrayValue)===null||s===void 0?void 0:s.values)===null||i===void 0?void 0:i.map(o=>Ze(o.doubleValue));return new bn(r)}convertGeoPoint(e){return new Sn(Ze(e.latitude),Ze(e.longitude))}convertArray(e,n){return(e.values||[]).map(s=>this.convertValue(s,n))}convertServerTimestamp(e,n){switch(n){case"previous":const s=Ml(e);return s==null?null:this.convertValue(s,n);case"estimate":return this.convertTimestamp(to(e));default:return null}}convertTimestamp(e){const n=Ds(e);return new He(n.seconds,n.nanos)}convertDocumentKey(e,n){const s=Be.fromString(e);Me(T_(s),9688,{name:e});const i=new no(s.get(1),s.get(3)),r=new ee(s.popFirst(5));return i.isEqual(n)||Jn(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function II(t,e,n){let s;return s=t?t.toFirestore(e):e,s}class jr{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Zs extends ny{constructor(e,n,s,i,r,o){super(e,n,s,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Oa(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const s=this._document.data.field(Gl("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new q(U.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=Zs._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}Zs._jsonSchemaVersion="firestore/documentSnapshot/1.0",Zs._jsonSchema={type:ot("string",Zs._jsonSchemaVersion),bundleSource:ot("string","DocumentSnapshot"),bundleName:ot("string"),bundle:ot("string")};class Oa extends Zs{data(e={}){return super.data(e)}}class Pi{constructor(e,n,s,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new jr(i.hasPendingWrites,i.fromCache),this.query=s}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(s=>{e.call(n,new Oa(this._firestore,this._userDataWriter,s.key,s,new jr(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new q(U.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,r){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{const u=new Oa(i._firestore,i._userDataWriter,a.doc.key,a.doc,new jr(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>r||a.type!==3).map(a=>{const u=new Oa(i._firestore,i._userDataWriter,a.doc.key,a.doc,new jr(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,d=-1;return a.type!==0&&(h=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:SI(a.type),doc:u,oldIndex:h,newIndex:d}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new q(U.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Pi._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Hh.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],s=[],i=[];return this.docs.forEach(r=>{r._document!==null&&(n.push(r._document),s.push(this._userDataWriter.convertObjectMap(r._document.data.value.mapValue.fields,"previous")),i.push(r.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function SI(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ae(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ol(t){t=Zn(t,at);const e=Zn(t.firestore,Qi);return oI(pd(e),t._key).then(n=>PI(e,t,n))}Pi._jsonSchemaVersion="firestore/querySnapshot/1.0",Pi._jsonSchema={type:ot("string",Pi._jsonSchemaVersion),bundleSource:ot("string","QuerySnapshot"),bundleName:ot("string"),bundle:ot("string")};class ry extends xI{constructor(e){super(),this.firestore=e}convertBytes(e){return new Zt(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new at(this.firestore,null,n)}}function bI(t){t=Zn(t,ui);const e=Zn(t.firestore,Qi),n=pd(e),s=new ry(e);return wI(t._query),aI(n,t._query).then(i=>new Pi(e,s,t,i))}function oy(t,e,n,...s){t=Zn(t,at);const i=Zn(t.firestore,Qi),r=md(i);let o;return o=typeof(e=dt(e))=="string"||e instanceof Hl?mI(r,"updateDoc",t._key,e,n,s):gI(r,"updateDoc",t._key,e),Ad(i,[o.toMutation(t._key,hn.exists(!0))])}function CI(t){return Ad(Zn(t.firestore,Qi),[new Qh(t._key,hn.none())])}function DI(t,e){const n=Zn(t.firestore,Qi),s=Do(t),i=II(t.converter,e);return Ad(n,[pI(md(t.firestore),"addDoc",s._key,i,t.converter!==null,{}).toMutation(s._key,hn.exists(!1))]).then(()=>s)}function Ad(t,e){return function(s,i){const r=new qn;return s.asyncQueue.enqueueAndForget(async()=>Yx(await rI(s),i,r)),r.promise}(pd(t),e)}function PI(t,e,n){const s=n.docs.get(e._key),i=new ry(t);return new Zs(t,i,e._key,s,new jr(n.hasPendingWrites,n.fromCache),e.converter)}function Wr(){return new _d("serverTimestamp")}(function(e,n=!0){(function(i){Gi=i})(Wi),ji(new ti("firestore",(s,{instanceIdentifier:i,options:r})=>{const o=s.getProvider("app").getImmediate(),a=new Qi(new mE(s.getProvider("auth-internal")),new vE(o,s.getProvider("app-check-internal")),function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new q(U.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new no(h.options.projectId,d)}(o,i),o);return r=Object.assign({useFetchStreams:n},r),a._setSettings(r),a},"PUBLIC").setMultipleInstances(!0)),As(yp,vp,e),As(yp,vp,"esm2017")})();const RI={apiKey:"AIzaSyDJSUOgDq9-Naz0EWj_xHaEuGIeNbDGkH0",authDomain:"in01-24742.firebaseapp.com",projectId:"in01-24742",storageBucket:"in01-24742.firebasestorage.app",messagingSenderId:"825125559500",appId:"1:825125559500:web:976561b41dbcdd9883b669"},ay=$m(RI),Ji=uE(ay),Zi=cI(ay),ly=new Xn;ly.setCustomParameters({prompt:"select_account"});const NI=async(t,e)=>{try{return{user:(await Yw(Ji,t,e)).user,error:null}}catch(n){return{user:null,error:n.message}}},MI=async()=>{try{return{user:(await vT(Ji,ly)).user,error:null}}catch(t){const e=t;let n=e.message;switch(e.code){case"auth/popup-closed-by-user":n="로그인이 취소되었습니다.";break;case"auth/popup-blocked":n="팝업이 차단되었습니다. 팝업을 허용해주세요.";break;case"auth/cancelled-popup-request":n="로그인 요청이 취소되었습니다.";break;case"auth/account-exists-with-different-credential":n="이미 다른 방법으로 가입된 이메일입니다.";break;default:n="구글 로그인 중 오류가 발생했습니다."}return{user:null,error:n}}},jI=async(t,e,n)=>{try{const s=await zw(Ji,t,e);return n&&s.user&&await Kw(s.user,{displayName:n}),{user:s.user,error:null}}catch(s){return{user:null,error:s.message}}},LI=async()=>{try{return await Zw(Ji),{error:null}}catch(t){return{error:t.message}}},kI=t=>p0(Ji,t),Ro=()=>new Promise(t=>{const e=p0(Ji,n=>{e(),t(n)})}),cy=M.createContext(void 0),FI=({children:t})=>{const[e,n]=M.useState(null),[s,i]=M.useState(!0);M.useEffect(()=>{try{const o=kI(u=>{n(u),i(!1)}),a=setTimeout(()=>{i(u=>u&&(console.warn("⚠️ Firebase 인증 상태 확인 타임아웃 - 로딩 강제 종료"),!1))},5e3);return()=>{o(),clearTimeout(a)}}catch(o){console.error("❌ Firebase 인증 설정 에러:",o),i(!1)}},[]);const r={user:e,loading:s,isAuthenticated:!!e};return c.jsx(cy.Provider,{value:r,children:t})},uy=()=>{const t=M.useContext(cy);if(t===void 0)throw new Error("useAuth는 AuthProvider 내에서 사용해야 합니다.");return t};class OI extends M.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){console.error("🚨 ErrorBoundary caught an error:",e,n)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:c.jsx("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",padding:"20px",textAlign:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white"},children:c.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"16px",padding:"40px",maxWidth:"500px",backdropFilter:"blur(10px)"},children:[c.jsx("h1",{style:{fontSize:"48px",marginBottom:"20px"},children:"⚠️"}),c.jsx("h2",{style:{marginBottom:"16px"},children:"문제가 발생했습니다"}),c.jsx("p",{style:{marginBottom:"24px",opacity:.9},children:"예상치 못한 오류가 발생했습니다. 페이지를 새로고침하거나 잠시 후 다시 시도해주세요."}),c.jsx("button",{onClick:()=>window.location.reload(),style:{background:"white",color:"#667eea",border:"none",borderRadius:"8px",padding:"12px 24px",fontSize:"16px",fontWeight:"bold",cursor:"pointer",transition:"opacity 0.2s"},onMouseOver:e=>e.currentTarget.style.opacity="0.8",onMouseOut:e=>e.currentTarget.style.opacity="1",children:"페이지 새로고침"}),!1]})}):this.props.children}}const VI="_container_j6ddw_2",BI="_modalContent_j6ddw_18",UI="_header_j6ddw_30",$I="_content_j6ddw_51",HI="_formSection_j6ddw_55",WI="_form_j6ddw_55",XI="_spaceSettings_j6ddw_134",GI="_sectionTitle_j6ddw_140",zI="_spaceSizeSection_j6ddw_148",YI="_label_j6ddw_152",qI="_inputGroupTwoColumns_j6ddw_161",KI="_dimensionsSummary_j6ddw_175",QI="_summaryText_j6ddw_185",JI="_startButtonContainer_j6ddw_193",ZI="_loadingScreen_j6ddw_203",eS="_loadingSubtext_j6ddw_217",St={container:VI,modalContent:BI,header:UI,content:$I,formSection:HI,form:WI,spaceSettings:XI,sectionTitle:GI,spaceSizeSection:zI,label:YI,inputGroupTwoColumns:qI,dimensionsSummary:KI,summaryText:QI,startButtonContainer:JI,loadingScreen:ZI,loadingSubtext:eS},tS="_button_1gs6k_1",nS="_primary_1gs6k_14",sS="_secondary_1gs6k_28",iS="_small_1gs6k_43",rS="_medium_1gs6k_48",oS="_large_1gs6k_53",aS="_iconButton_1gs6k_59",lS="_toggle_1gs6k_65",cS="_active_1gs6k_72",yr={button:tS,primary:nS,secondary:sS,small:iS,medium:rS,large:oS,iconButton:aS,toggle:lS,active:cS},zu=({variant:t="primary",size:e="medium",isActive:n=!1,isIconButton:s=!1,className:i="",children:r,...o})=>{const a=[yr.button,yr[t],yr[e],s&&yr.iconButton,t==="toggle"&&n&&yr.active,i].filter(Boolean).join(" ");return c.jsx("button",{className:a,...o,children:r})},uS="_container_1v5y7_2",hS="_spinner_1v5y7_13",dS="_spinnerRing_1v5y7_19",fS="_spin_1v5y7_13",pS="_small_1v5y7_30",gS="_medium_1v5y7_36",mS="_large_1v5y7_42",_S="_dots_1v5y7_49",yS="_dot_1v5y7_49",vS="_bounce_1v5y7_1",wS="_message_1v5y7_76",TS="_fullscreen_1v5y7_106",Nn={container:uS,spinner:hS,spinnerRing:dS,spin:fS,small:pS,medium:gS,large:mS,dots:_S,dot:yS,bounce:vS,message:wS,fullscreen:TS},al=({message:t="로딩 중...",size:e="medium",type:n="spinner"})=>c.jsxs("div",{className:Nn.container,children:[n==="spinner"?c.jsx("div",{className:`${Nn.spinner} ${Nn[e]}`,children:c.jsx("div",{className:Nn.spinnerRing})}):c.jsxs("div",{className:Nn.dots,children:[c.jsx("div",{className:Nn.dot}),c.jsx("div",{className:Nn.dot}),c.jsx("div",{className:Nn.dot})]}),t&&c.jsx("p",{className:Nn.message,children:t})]}),Rc={basicInfo:{title:"",location:""},isDirty:!1},hy=_o()(t=>({...Rc,setBasicInfo:e=>t(n=>({basicInfo:{...n.basicInfo,...e},isDirty:!0})),resetBasicInfo:()=>t({basicInfo:Rc.basicInfo,isDirty:!0}),resetAll:()=>t({...Rc,isDirty:!1}),markAsSaved:()=>t({isDirty:!1})})),Xr={WIDTH:3600,HEIGHT:2400,DEPTH:1500},Nc={LEFT:50,RIGHT:50,TOP:10},_g={HEIGHT:65,FLOOR_FINISH_HEIGHT:50},yg={INTERIOR_COLOR:"#FFFFFF",DOOR_COLOR:"#FFFFFF"},Jt={WIDTH:{MIN:1200,MAX:8e3},HEIGHT:{MIN:2010,MAX:2410}},Gs={DEPTH:{MIN:130,MAX:780,DEFAULT_FALLBACK:580}},dy={width:Xr.WIDTH,height:Xr.HEIGHT,depth:Xr.DEPTH,installType:"built-in",wallConfig:{left:!0,right:!0},hasFloorFinish:!1,floorFinish:{height:_g.FLOOR_FINISH_HEIGHT},surroundType:"surround",frameSize:{left:Nc.LEFT,right:Nc.RIGHT,top:Nc.TOP},baseConfig:{type:"floor",height:_g.HEIGHT,placementType:"ground"},materialConfig:{interiorColor:yg.INTERIOR_COLOR,doorColor:yg.DOOR_COLOR}},Mc={isDirty:!1,spaceInfo:dy},Pt=_o()(t=>({...Mc,setSpaceInfo:e=>{t(n=>({spaceInfo:{...n.spaceInfo,...e},isDirty:!0}))},resetSpaceInfo:()=>t({spaceInfo:Mc.spaceInfo,isDirty:!0}),resetMaterialConfig:()=>t(e=>({spaceInfo:{...e.spaceInfo,materialConfig:{...e.spaceInfo.materialConfig,doorColor:"#FFFFFF"}},isDirty:!0})),resetAll:()=>t({...Mc,isDirty:!1}),markAsSaved:()=>t({isDirty:!1})})),ES=[{type:"built-in",label:"빌트인",description:"양쪽 벽이 막혀있는 기본형식"},{type:"semi-standing",label:"세미스탠딩",description:"한쪽만 벽으로 막혀있고 한쪽은 오픈된 형식"},{type:"free-standing",label:"프리스탠딩",description:"양쪽 벽이 없는 독립형 형식"}],AS="_container_1ycbi_1",xS="_fullWidth_1ycbi_7",IS="_label_1ycbi_11",SS="_inputWrapper_1ycbi_17",bS="_input_1ycbi_17",CS="_small_1ycbi_47",DS="_medium_1ycbi_52",PS="_large_1ycbi_57",RS="_error_1ycbi_63",NS="_errorMessage_1ycbi_72",MS="_leftIcon_1ycbi_78",jS="_rightIcon_1ycbi_78",LS="_hasLeftIcon_1ycbi_97",kS="_hasRightIcon_1ycbi_101",Wt={container:AS,fullWidth:xS,label:IS,inputWrapper:SS,input:bS,small:CS,medium:DS,large:PS,error:RS,errorMessage:NS,leftIcon:MS,rightIcon:jS,hasLeftIcon:LS,hasRightIcon:kS},Va=({size:t="medium",error:e,label:n,leftIcon:s,rightIcon:i,className:r="",fullWidth:o=!1,...a})=>{const u=[Wt.container,o&&Wt.fullWidth,r].filter(Boolean).join(" "),h=[Wt.input,Wt[t],e&&Wt.error,s&&Wt.hasLeftIcon,i&&Wt.hasRightIcon].filter(Boolean).join(" ");return c.jsxs("div",{className:u,children:[n&&c.jsx("label",{className:Wt.label,children:n}),c.jsxs("div",{className:Wt.inputWrapper,children:[s&&c.jsx("span",{className:Wt.leftIcon,children:s}),c.jsx("input",{className:h,...a}),i&&c.jsx("span",{className:Wt.rightIcon,children:i})]}),e&&c.jsx("span",{className:Wt.errorMessage,children:e})]})},FS="_container_arbjs_1",OS="_fullWidth_arbjs_7",VS="_label_arbjs_11",BS="_selectWrapper_arbjs_17",US="_select_arbjs_17",$S="_arrow_arbjs_45",HS="_small_arbjs_59",WS="_medium_arbjs_65",XS="_large_arbjs_71",GS="_error_arbjs_78",zS="_errorMessage_arbjs_87",Mn={container:FS,fullWidth:OS,label:VS,selectWrapper:BS,select:US,arrow:$S,small:HS,medium:WS,large:XS,error:GS,errorMessage:zS},YS=({options:t,size:e="medium",error:n,label:s,placeholder:i,className:r="",fullWidth:o=!1,value:a,defaultValue:u,...h})=>{const d=[Mn.container,o&&Mn.fullWidth,r].filter(Boolean).join(" "),p=[Mn.select,Mn[e],n&&Mn.error].filter(Boolean).join(" "),m=a!==void 0,v=m?{value:a,...h}:{defaultValue:!m&&i?"":u,...h};return c.jsxs("div",{className:d,children:[s&&c.jsx("label",{className:Mn.label,children:s}),c.jsxs("div",{className:Mn.selectWrapper,children:[c.jsxs("select",{className:p,...v,children:[i&&c.jsx("option",{value:"",disabled:!0,hidden:!0,children:i}),t.map(w=>c.jsx("option",{value:w.value,disabled:w.disabled,children:w.label},w.value))]}),c.jsx("span",{className:Mn.arrow})]}),n&&c.jsx("span",{className:Mn.errorMessage,children:n})]})},qS="_container_1jg9g_2",KS="_section_1jg9g_9",QS="_inlineLayout_1jg9g_28",JS="_titleField_1jg9g_34",ZS="_locationField_1jg9g_38",eb="_label_1jg9g_43",tb="_inputLabel_1jg9g_49",nb="_inputGroup_1jg9g_56",sb="_inputWrapper_1jg9g_108",ib="_inputWithUnit_1jg9g_114",rb="_input_1jg9g_49",ob="_inputWithUnitField_1jg9g_135",ab="_unit_1jg9g_139",lb="_inputError_1jg9g_148",cb="_errorMessage_1jg9g_153",ub="_radioGroup_1jg9g_166",hb="_toggleButtonGroup_1jg9g_205",db="_toggleButton_1jg9g_205",fb="_toggleButtonActive_1jg9g_239",pb="_button_1jg9g_249",gb="_buttonActive_1jg9g_264",mb="_description_1jg9g_271",_b="_infoBox_1jg9g_278",yb="_infoDetail_1jg9g_289",vb="_disabledLabel_1jg9g_340",wb="_disabledText_1jg9g_345",O={container:qS,section:KS,inlineLayout:QS,titleField:JS,locationField:ZS,label:eb,inputLabel:tb,inputGroup:nb,inputWrapper:sb,inputWithUnit:ib,input:rb,inputWithUnitField:ob,unit:ab,inputError:lb,errorMessage:cb,radioGroup:ub,toggleButtonGroup:hb,toggleButton:db,toggleButtonActive:fb,button:pb,buttonActive:gb,description:mb,infoBox:_b,infoDetail:yb,disabledLabel:vb,disabledText:wb},Tb=[{value:"master_bedroom",label:"안방"},{value:"small_bedroom",label:"작은방"},{value:"dressing_room",label:"드레스룸"},{value:"living_room",label:"거실"},{value:"kitchen",label:"주방"},{value:"entrance",label:"현관"},{value:"other",label:"기타"}],Eb=({basicInfo:t,onUpdate:e})=>c.jsx("div",{className:O.container,children:c.jsxs("div",{className:O.inlineLayout,children:[c.jsxs("div",{className:O.titleField,children:[c.jsx("span",{className:O.label,children:"디자인 제목"}),c.jsx(Va,{placeholder:"디자인 제목을 입력하세요",value:t.title,onChange:n=>e({title:n.target.value})})]}),c.jsxs("div",{className:O.locationField,children:[c.jsx("span",{className:O.label,children:"가구 위치"}),c.jsx(YS,{options:Tb,value:t.location,placeholder:"가구 위치를 선택하세요",onChange:n=>e({location:n.target.value})})]})]})}),fy=({spaceInfo:t,onUpdate:e,disabled:n=!1})=>{const[s,i]=M.useState(),r=(t==null?void 0:t.width)||Xr.WIDTH,[o,a]=M.useState(r.toString());M.useEffect(()=>{a(r.toString())},[r]);const u=p=>{(p===""||/^\d+$/.test(p))&&a(p)},h=()=>{const p=o;if(p===""){a(r.toString());return}const m=parseInt(p),y=Jt.WIDTH.MIN,v=Jt.WIDTH.MAX;m<y?i(`최소 ${y}mm 이상이어야 합니다`):m>v?i(`최대 ${v}mm 이하여야 합니다`):(i(""),e({width:m}))},d=p=>{p.key==="Enter"&&h()};return c.jsxs("div",{className:O.inputWrapper,children:[c.jsxs("label",{className:`${O.inputLabel} ${n?O.disabledLabel:""}`,children:["폭 (",Jt.WIDTH.MIN,"mm ~ ",Jt.WIDTH.MAX,"mm)",n&&c.jsx("span",{className:O.disabledText,children:" (스타일러장, 바지걸이장 배치시 수정불가)"})]}),c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:o,onChange:p=>u(p.target.value),onBlur:h,onKeyDown:d,className:`${O.input} ${O.inputWithUnitField} ${s?O.inputError:""}`,placeholder:`${Jt.WIDTH.MIN}-${Jt.WIDTH.MAX}`,disabled:n}),c.jsx("span",{className:O.unit,children:"mm"})]}),s&&c.jsx("div",{className:O.errorMessage,children:s})]})},py=({spaceInfo:t,onUpdate:e})=>{const[n,s]=M.useState(),i=(t==null?void 0:t.height)||Xr.HEIGHT,[r,o]=M.useState(i.toString());M.useEffect(()=>{o(i.toString())},[i]);const a=d=>{(d===""||/^\d+$/.test(d))&&o(d)},u=()=>{const d=r;if(d===""){o(i.toString());return}const p=parseInt(d),m=Jt.HEIGHT.MIN,y=Jt.HEIGHT.MAX;p<m?s(`최소 ${m}mm 이상이어야 합니다`):p>y?s(`최대 ${y}mm 이하여야 합니다`):(s(""),e({height:p}))},h=d=>{d.key==="Enter"&&u()};return c.jsxs("div",{className:O.inputWrapper,children:[c.jsxs("label",{className:O.inputLabel,children:["높이 (",Jt.HEIGHT.MIN,"mm ~ ",Jt.HEIGHT.MAX,"mm)"]}),c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:r,onChange:d=>a(d.target.value),onBlur:u,onKeyDown:h,className:`${O.input} ${O.inputWithUnitField} ${n?O.inputError:""}`,placeholder:`${Jt.HEIGHT.MIN}-${Jt.HEIGHT.MAX}`}),c.jsx("span",{className:O.unit,children:"mm"})]}),n&&c.jsx("div",{className:O.errorMessage,children:n})]})},gy=({spaceInfo:t,onUpdate:e})=>{const n=i=>{let r={...t.wallConfig};switch(i){case"built-in":r={left:!0,right:!0};break;case"semi-standing":r={left:!0,right:!1};break;case"free-standing":r={left:!1,right:!1};break}e({installType:i,wallConfig:r})},s=i=>{e({wallConfig:{left:i==="left",right:i==="right"}})};return c.jsxs("div",{className:O.container,children:[c.jsx("div",{className:O.section,children:c.jsx("div",{className:O.toggleButtonGroup,children:ES.map(i=>c.jsx("button",{className:`${O.toggleButton} ${t.installType===i.type?O.toggleButtonActive:""}`,onClick:()=>n(i.type),children:i.label},i.type))})}),t.installType==="semi-standing"&&c.jsxs("div",{className:O.section,children:[c.jsx("span",{className:O.label,children:"벽 위치"}),c.jsxs("div",{className:O.toggleButtonGroup,children:[c.jsx("button",{className:`${O.toggleButton} ${t.wallConfig.left?O.toggleButtonActive:""}`,onClick:()=>s("left"),children:"좌측"}),c.jsx("button",{className:`${O.toggleButton} ${t.wallConfig.right?O.toggleButtonActive:""}`,onClick:()=>s("right"),children:"우측"})]})]})]})},Ab=({spaceInfo:t,onUpdate:e})=>{var r,o,a,u;const[n,s]=M.useState(((o=(r=t.floorFinish)==null?void 0:r.height)==null?void 0:o.toString())||"20");M.useEffect(()=>{var h,d;s(((d=(h=t.floorFinish)==null?void 0:h.height)==null?void 0:d.toString())||"20")},[(a=t.floorFinish)==null?void 0:a.height]);const i=h=>{if(h)e({hasFloorFinish:!1,floorFinish:void 0});else{const d=parseInt(n)||20;e({hasFloorFinish:!0,floorFinish:{height:d}})}};return t.hasFloorFinish?t.height-(((u=t.floorFinish)==null?void 0:u.height)||0):t.height,c.jsx("div",{className:O.container,children:c.jsx("div",{className:O.section,children:c.jsxs("div",{className:O.toggleButtonGroup,children:[c.jsx("button",{className:`${O.toggleButton} ${t.hasFloorFinish?O.toggleButtonActive:""}`,onClick:()=>i(!1),children:"있음"}),c.jsx("button",{className:`${O.toggleButton} ${t.hasFloorFinish?"":O.toggleButtonActive}`,onClick:()=>i(!0),children:"없음"})]})})})},xb=580,Ib=10,vr=18,my=t=>{var i;const e=t.width,n=t.hasFloorFinish?t.height-(((i=t.floorFinish)==null?void 0:i.height)||0):t.height,s=t.depth;return{width:e,height:n,depth:s}},pt=t=>{const e=No(t),n=_y(t),s=vy(t),i=yy(t);let r;t.surroundType==="no-surround"&&t.gapConfig?r=t.width-t.gapConfig.size*2:r=t.width-e.left-e.right;let o=t.height;t.hasFloorFinish&&(o-=n),o-=s,o-=i;const a=t.depth;let u;return t.surroundType==="no-surround"&&t.gapConfig?u=t.gapConfig.size:u=e.left,t.surroundType==="no-surround"&&t.gapConfig&&console.log(`📐 [내경계산] 이격거리${t.gapConfig.size}mm: 내경너비=${r}, 시작위치X=${u}`),{width:r,height:o,depth:a,startX:u,startY:i+n,startZ:0}},Sb=t=>t?t.depth:xb,bb=()=>600,_y=t=>!t.hasFloorFinish||!t.floorFinish?0:t.floorFinish.height,No=t=>{const{installType:e,wallConfig:n,frameSize:s,surroundType:i}=t;if(i==="no-surround")return{left:0,right:0,leftMm:0,rightMm:0};let r=0,o=0;const a=10,u=(s==null?void 0:s.left)||a,h=(s==null?void 0:s.right)||a;switch(e){case"built-in":r=u,o=h;break;case"semi-standing":n.left&&!n.right?(r=u,o=vr):!n.left&&n.right?(r=vr,o=h):(r=u,o=vr);break;case"free-standing":r=vr,o=vr;break;default:r=u,o=h}return{left:r,right:o,leftMm:r,rightMm:o}},Cb=t=>{let e;if(t.surroundType==="no-surround"&&t.gapConfig)e=t.width-t.gapConfig.size*2,console.log(`🔧 [프레임폭] 이격거리${t.gapConfig.size}mm: 프레임폭=${e}mm`);else{const n=No(t);e=t.width-n.leftMm-n.rightMm}return{width:e,widthMm:e}},yy=t=>{var e;return((e=t.baseConfig)==null?void 0:e.type)==="floor"?t.baseConfig.height||65:0},vy=t=>{var e;return((e=t.frameSize)==null?void 0:e.top)||Ib};class Wn{static mmToThreeUnits(e){return e*.01}static calculateInternalWidth(e){const n=No(e),s=e.width;return e.surroundType==="no-surround"&&e.gapConfig?s-e.gapConfig.size*2:s-n.left-n.right}static getColumnCountLimits(e){const o=Math.ceil(e/600),a=Math.floor(e/300.01),u=e<=600,h=e<=1200;return{minColumns:o,maxColumns:a,canUseSingle:u,canUseDual:h,columnWidthWillBe:d=>Math.floor(e/d)}}static validateColumnCount(e,n){const s=Wn.getColumnCountLimits(n),i=Math.floor(n/e);return{isValid:e>=s.minColumns&&e<=s.maxColumns&&i>300,columnWidth:i,limits:s}}static getDefaultColumnCount(e){return e<=600?1:Math.round(e/600)}}class wy{static calculateSpaceIndexing(e){var E;const n=No(e),s=e.width,i=Wn.calculateInternalWidth(e);let r;e.customColumnCount?r=e.customColumnCount:r=Wn.getDefaultColumnCount(i);const o=Math.floor(i/r),a=i-o*r,u=Math.floor(a/2);let h;e.surroundType==="no-surround"&&e.gapConfig?h=-(s/2)+e.gapConfig.size+u:h=-(s/2)+n.left+u;const d=[];for(let C=0;C<=r;C++){const A=h+C*o;d.push(A)}const p=[];for(let C=0;C<r;C++){const R=d[C]+o/2;p.push(R)}const m=p.map(C=>Wn.mmToThreeUnits(C)),y=d.map(C=>Wn.mmToThreeUnits(C));e.surroundType==="no-surround"&&e.gapConfig&&console.log(`🎯 [가구위치] 이격거리${e.gapConfig.size}mm: 내경시작X=${h}, 첫번째컬럼=${(E=m[0])==null?void 0:E.toFixed(3)}`);const v=[],w=[];for(let C=0;C<r-1;C++){const A=p[C],R=p[C+1],N=(A+R)/2;v.push(N),w.push(Wn.mmToThreeUnits(N))}return{columnCount:r,columnPositions:p,threeUnitPositions:m,columnBoundaries:d,threeUnitBoundaries:y,dualColumnPositions:v,threeUnitDualPositions:w,columnWidth:o,internalWidth:i,internalStartX:h,threeUnitColumnWidth:Wn.mmToThreeUnits(o)}}static findClosestColumnIndex(e,n){const{threeUnitPositions:s,threeUnitBoundaries:i,columnCount:r}=n,o=i[0],a=i[r];if(e.x<o)return console.log(`위치 (${e.x.toFixed(2)})가 왼쪽 경계 (${o.toFixed(2)}) 밖에 있습니다. 첫 번째 컬럼 선택.`),0;if(e.x>a)return console.log(`위치 (${e.x.toFixed(2)})가 오른쪽 경계 (${a.toFixed(2)}) 밖에 있습니다. 마지막 컬럼 선택.`),r-1;for(let p=0;p<r;p++){const m=i[p],y=i[p+1];if(e.x>=m&&e.x<=y)return console.log(`위치 (${e.x.toFixed(2)})가 컬럼 ${p+1} 내부에 있습니다. 경계: [${m.toFixed(2)}, ${y.toFixed(2)}]`),p}let u=0,h=Number.MAX_VALUE;const d=s.map((p,m)=>{const y=Math.abs(e.x-p);return{index:m,columnX:p,distance:y}});return console.log("컬럼 거리 계산:",d.map(p=>`컬럼 ${p.index+1}: ${p.distance.toFixed(4)} (위치: ${p.columnX.toFixed(2)})`).join(", ")),d.forEach(({index:p,distance:m})=>{m<h&&(h=m,u=p)}),console.log(`가장 가까운 컬럼: ${u+1} (거리: ${h.toFixed(4)})`),u}static findSlotIndexFromPosition(e,n,s=!1){return s&&n.threeUnitDualPositions?n.threeUnitDualPositions.findIndex(r=>Math.abs(r-e.x)<.1):n.threeUnitPositions.findIndex(r=>Math.abs(r-e.x)<.1)}}const gt=wy.calculateSpaceIndexing,Db=Wn.calculateInternalWidth,Pb=wy.findSlotIndexFromPosition,vg={internalWidth:0,columnCount:0,columnWidth:0,internalHeight:0,internalDepth:0,columnPositions:[],threeUnitPositions:[],columnBoundaries:[],dualColumnPositions:[],isCalculated:!1,lastCalculatedSpaceInfo:null},er=_o(t=>({...vg,recalculateFromSpaceInfo:e=>{try{const n={...e,width:Math.max(600,e.width),height:Math.max(1e3,e.height)},s=Db(n),i=gt(n),r=pt(n);t({internalWidth:s,columnCount:i.columnCount,columnWidth:i.columnWidth,internalHeight:r.height,internalDepth:r.depth,columnPositions:i.columnPositions,threeUnitPositions:i.threeUnitPositions,columnBoundaries:i.columnBoundaries,dualColumnPositions:i.dualColumnPositions,isCalculated:!0,lastCalculatedSpaceInfo:n})}catch(n){console.error("❌ [derivedSpaceStore 계산 오류]",n),console.error("파생 상태 계산 중 오류 발생:",n),t({internalWidth:Math.max(0,e.width-100),columnCount:1,columnWidth:Math.max(300,e.width-100),internalHeight:Math.max(0,e.height-200),internalDepth:580,columnPositions:[0],threeUnitPositions:[0],columnBoundaries:[0,Math.max(300,e.width-100)],dualColumnPositions:[],isCalculated:!0,lastCalculatedSpaceInfo:e})}},reset:()=>{t(vg)}})),Rb=(t,e,n)=>{const s=er(),i=18,r=M.useMemo(()=>{if(!(t.surroundType==="no-surround")||!t.gapConfig)return null;const h=t.gapConfig.size;return t.width-h*2},[t.surroundType,t.gapConfig,t.width]),o=M.useMemo(()=>{if(!(t.surroundType==="surround")||!t.frameSize)return null;const h=t.width,d=e?t.frameSize.left||10:i,p=n?t.frameSize.right||10:i;return h-d-p},[t.surroundType,t.frameSize,t.width,e,n]),a=M.useMemo(()=>{if(s.isCalculated)return{columnCount:s.columnCount,columnWidth:s.columnWidth};const u=gt(t);return{columnCount:u.columnCount,columnWidth:u.columnWidth}},[s.isCalculated,s.columnCount,s.columnWidth,t]);return{noSurroundFrameWidth:r,surroundFrameWidth:o,columnInfo:a}},Nb=({surroundType:t,onSurroundTypeChange:e,disabled:n=!1})=>{const s=t==="surround",i=t==="no-surround";return c.jsx("div",{className:O.section,children:c.jsxs("div",{className:O.toggleButtonGroup,children:[c.jsx("button",{className:`${O.toggleButton} ${i?O.toggleButtonActive:""}`,onClick:()=>!n&&e("no-surround"),disabled:n,children:"있음"}),c.jsx("button",{className:`${O.toggleButton} ${s?O.toggleButtonActive:""}`,onClick:()=>!n&&e("surround"),disabled:n,children:"없음"})]})})},Mb=({gapSize:t,onGapSizeChange:e})=>c.jsxs("div",{className:O.section,children:[c.jsx("span",{className:O.label,children:"이격거리 설정"}),c.jsx("p",{className:O.description,children:"노서라운드 옵션 선택 시 이격거리를 선택해주세요:"}),c.jsxs("div",{className:O.radioGroup,children:[c.jsx("button",{className:`${O.button} ${t===2?O.buttonActive:""}`,onClick:()=>e(2),children:"2mm"}),c.jsx("button",{className:`${O.button} ${t===3?O.buttonActive:""}`,onClick:()=>e(3),children:"3mm"})]})]}),jb=({frameSize:t,hasLeftWall:e,hasRightWall:n,isSurround:s,surroundFrameWidth:i,noSurroundFrameWidth:r,gapSize:o,spaceWidth:a,columnInfo:u,onFrameSizeChange:h,onFrameSizeBlur:d,onKeyDown:p})=>s?c.jsxs("div",{className:O.section,children:[c.jsx("span",{className:O.label,children:"프레임 설정"}),c.jsx("div",{className:O.description,children:"벽이 있는 쪽은 40~100mm 범위에서 조정 가능하며, 벽이 없는 쪽은 18mm 엔드패널로 고정됩니다."}),i&&c.jsxs("div",{className:O.infoBox,style:{marginBottom:"12px"},children:[c.jsxs("span",{children:["프레임 폭 내경: ",c.jsxs("strong",{children:[i,"mm"]})]}),c.jsxs("span",{className:O.infoDetail,children:["(전체 폭 ",a,"mm - 좌측 프레임 ",e?t.left:18,"mm - 우측 프레임 ",n?t.right:18,"mm)"]}),c.jsxs("span",{className:O.infoDetail,style:{marginTop:"4px"},children:["슬롯 수: ",c.jsxs("strong",{children:[u.columnCount,"개"]})," / 슬롯당 너비: ",c.jsxs("strong",{children:[u.columnWidth,"mm"]})]})]}),c.jsxs("div",{className:O.inputGroup,style:{gridTemplateColumns:"1fr 1fr 1fr"},children:[c.jsxs("div",{className:O.inputWrapper,children:[c.jsx("label",{className:O.inputLabel,children:"좌측 (40~100mm)"}),c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:e?t.left:18,onChange:y=>h("left",y.target.value),onBlur:()=>d("left"),onKeyDown:y=>p(y,"left"),className:`${O.input} ${O.inputWithUnitField} ${e?"":O.inputError}`,placeholder:"50",disabled:!e}),c.jsx("span",{className:O.unit,children:"mm"})]})]}),c.jsxs("div",{className:O.inputWrapper,children:[c.jsx("label",{className:O.inputLabel,children:"우측 (40~100mm)"}),c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:n?t.right:18,onChange:y=>h("right",y.target.value),onBlur:()=>d("right"),onKeyDown:y=>p(y,"right"),className:`${O.input} ${O.inputWithUnitField} ${n?"":O.inputError}`,placeholder:"50",disabled:!n}),c.jsx("span",{className:O.unit,children:"mm"})]})]}),c.jsxs("div",{className:O.inputWrapper,children:[c.jsx("label",{className:O.inputLabel,children:"상단 (10~200mm)"}),c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:t.top,onChange:y=>h("top",y.target.value),onBlur:()=>d("top"),onKeyDown:y=>p(y,"top"),className:`${O.input} ${O.inputWithUnitField}`,placeholder:"10"}),c.jsx("span",{className:O.unit,children:"mm"})]})]})]})]}):c.jsxs("div",{className:O.section,children:[c.jsx("span",{className:O.label,children:"프레임 설정"}),c.jsxs("p",{className:O.description,children:["노서라운드에서는 좌우 프레임이 제거되고, 선택한 이격거리(",o,"mm)에 따라 상/하단 프레임 폭이 자동 계산됩니다."]}),r&&c.jsxs("div",{className:O.infoBox,style:{marginBottom:"12px"},children:[c.jsxs("span",{children:["프레임 폭 내경: ",c.jsxs("strong",{children:[r,"mm"]})]}),c.jsxs("span",{className:O.infoDetail,children:["(전체 폭 ",a,"mm - 좌우 이격거리 각 ",o,"mm)"]}),c.jsxs("span",{className:O.infoDetail,style:{marginTop:"4px"},children:["슬롯 수: ",c.jsxs("strong",{children:[u.columnCount,"개"]})," / 슬롯당 너비: ",c.jsxs("strong",{children:[u.columnWidth,"mm"]})]})]}),c.jsx("div",{className:O.inputGroup,children:c.jsxs("div",{className:O.inputWrapper,children:[c.jsx("label",{className:O.inputLabel,children:"상단 (mm)"}),c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:t.top,onChange:y=>h("top",y.target.value),onBlur:()=>d("top"),onKeyDown:y=>p(y,"top"),className:`${O.input} ${O.inputWithUnitField}`,placeholder:"50"}),c.jsx("span",{className:O.unit,children:"mm"})]})]})})]}),Lb=({spaceInfo:t,onUpdate:e,disabled:n=!1})=>{var j;const s=er(),i=M.useRef(t),r=t.surroundType==="surround",o=t.surroundType==="no-surround",a=t.wallConfig.left,u=t.wallConfig.right,h=18,[d,p]=M.useState(()=>t.frameSize?{left:!a&&r?h:t.frameSize.left,right:!u&&r?h:t.frameSize.right,top:t.frameSize.top}:{left:50,right:50,top:50}),[m,y]=M.useState(((j=t.gapConfig)==null?void 0:j.size)||2),{noSurroundFrameWidth:v,surroundFrameWidth:w,columnInfo:E}=Rb(t,a,u);M.useEffect(()=>{const I=i.current,T=t;(I.width!==T.width||I.surroundType!==T.surroundType||JSON.stringify(I.frameSize)!==JSON.stringify(T.frameSize)||JSON.stringify(I.gapConfig)!==JSON.stringify(T.gapConfig)||I.customColumnCount!==T.customColumnCount)&&(s.recalculateFromSpaceInfo(t),i.current=t)},[t,s]),M.useEffect(()=>{if(r&&t.frameSize){let I=!1;const T={...t.frameSize};!a&&T.left!==h&&(T.left=h,I=!0),!u&&T.right!==h&&(T.right=h,I=!0),I&&setTimeout(()=>{e({frameSize:T})},0)}},[r,a,u,t.frameSize,e]);const C=I=>{const T={surroundType:I};I==="surround"?(T.frameSize={left:a?50:h,right:u?50:h,top:10},T.gapConfig=void 0):(T.frameSize={left:0,right:0,top:10},T.gapConfig={size:2}),e(T)},A=(I,T)=>{if(!(I==="left"&&!a||I==="right"&&!u)&&(T===""||/^\d+$/.test(T))){const _={...d,[I]:T===""?"":parseInt(T)};p(_)}},R=I=>{if(!t.frameSize||I==="left"&&!a||I==="right"&&!u)return;let T=d[I];typeof T=="string"&&(T=T===""?10:parseInt(T)),I==="left"||I==="right"?(T<40&&(T=40),T>100&&(T=100)):(T<10&&(T=10),T>200&&(T=200)),p(S=>({...S,[I]:T}));const _=t.frameSize[I];T!==_&&e({frameSize:{...t.frameSize,[I]:T}})},N=(I,T)=>{I.key==="Enter"&&R(T)},k=I=>{y(I),e({gapConfig:{size:I}})};return c.jsxs("div",{className:O.container,children:[c.jsx(Nb,{surroundType:t.surroundType||"surround",onSurroundTypeChange:C,disabled:n}),o&&c.jsx(Mb,{gapSize:m,onGapSizeChange:k}),c.jsx(jb,{frameSize:d,hasLeftWall:a,hasRightWall:u,isSurround:r,surroundFrameWidth:w,noSurroundFrameWidth:v,gapSize:m,spaceWidth:t.width,columnInfo:E,onFrameSizeChange:A,onFrameSizeBlur:R,onKeyDown:N})]})},kb=({baseConfig:t,onBaseTypeChange:e})=>{const n=(t==null?void 0:t.type)==="floor"||!t,s=(t==null?void 0:t.type)==="stand";return c.jsx("div",{className:O.section,children:c.jsxs("div",{className:O.toggleButtonGroup,children:[c.jsx("button",{className:`${O.toggleButton} ${n?O.toggleButtonActive:""}`,onClick:()=>e("floor"),children:"있음"}),c.jsx("button",{className:`${O.toggleButton} ${s?O.toggleButtonActive:""}`,onClick:()=>e("stand"),children:"없음"})]})})},Fb=({baseConfig:t,baseHeight:e,floatHeight:n,onPlacementTypeChange:s,onHeightChange:i,onFloatHeightChange:r,onHeightBlur:o,onFloatHeightBlur:a,onKeyDown:u,onFloatKeyDown:h})=>{const d=(t==null?void 0:t.type)==="floor"||!t,p=(t==null?void 0:t.type)==="stand",m=(t==null?void 0:t.placementType)==="ground",y=(t==null?void 0:t.placementType)==="float";return c.jsxs(c.Fragment,{children:[d&&c.jsxs("div",{className:O.section,children:[c.jsx("span",{className:O.label,children:"받침대 높이 (mm)"}),c.jsx("p",{className:O.description,children:"받침대는 바닥마감재 위에 적용되며, 기본값은 65mm입니다. (50-100mm)"}),c.jsx("div",{className:O.inputWrapper,children:c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:e,onChange:v=>i(v.target.value),onBlur:o,onKeyDown:u,className:`${O.input} ${O.inputWithUnitField}`,placeholder:"65"}),c.jsx("span",{className:O.unit,children:"mm"})]})}),c.jsxs("p",{className:O.description,children:["받침대는 바닥마감재 위에서부터 ",e,"mm 길이로 설치됩니다."]})]}),p&&c.jsxs("div",{className:O.section,children:[c.jsx("span",{className:O.label,children:"배치 설정"}),c.jsxs("div",{className:O.radioGroup,children:[c.jsx("button",{className:`${O.button} ${m?O.buttonActive:""}`,onClick:()=>s("ground"),children:"바닥에 배치"}),c.jsx("button",{className:`${O.button} ${y?O.buttonActive:""}`,onClick:()=>s("float"),children:"띄워서 배치"})]})]}),p&&y&&c.jsxs("div",{className:O.section,children:[c.jsx("span",{className:O.label,children:"띄움 높이 (mm)"}),c.jsx("div",{className:O.inputWrapper,children:c.jsxs("div",{className:O.inputWithUnit,children:[c.jsx("input",{type:"text",value:n,onChange:v=>r(v.target.value),onBlur:a,onKeyDown:h,className:`${O.input} ${O.inputWithUnitField}`,placeholder:"60"}),c.jsx("span",{className:O.unit,children:"mm"})]})}),c.jsxs("p",{className:O.description,children:["바닥으로부터 ",n,"mm 높이가 띄워집니다."]})]})]})},Ob=({spaceInfo:t,onUpdate:e,disabled:n=!1})=>{const[s,i]=M.useState(()=>{var w,E;return((E=(w=t.baseConfig)==null?void 0:w.height)==null?void 0:E.toString())||"65"}),[r,o]=M.useState(()=>{var w,E;return((E=(w=t.baseConfig)==null?void 0:w.floatHeight)==null?void 0:E.toString())||"60"});M.useEffect(()=>{t.baseConfig&&(i(t.baseConfig.height),o(t.baseConfig.floatHeight||60))},[t.baseConfig]);const a=w=>{const E=t.baseConfig||{type:"floor",height:65};e({baseConfig:{...E,type:w,...w==="floor"?{}:{placementType:E.placementType||"ground"}}})},u=w=>{const E=t.baseConfig||{type:"stand",height:65};e({baseConfig:{...E,placementType:w,...w==="float"?{floatHeight:E.floatHeight||60}:{}}})},h=w=>{(w===""||/^\d+$/.test(w))&&i(w)},d=w=>{(w===""||/^\d+$/.test(w))&&o(w)},p=()=>{const w=t.baseConfig||{type:"floor",height:65};let E=s;typeof E=="string"&&(E=E===""?65:parseInt(E)),E<50&&(E=50),E>100&&(E=100),i(E),E!==w.height&&e({baseConfig:{...w,height:E}})},m=()=>{const w=t.baseConfig||{type:"stand",height:0,floatHeight:60};let E=r;typeof E=="string"&&(E=E===""?60:parseInt(E)),E<0&&(E=0),E>200&&(E=200),o(E),E!==w.floatHeight&&e({baseConfig:{...w,floatHeight:E}})},y=w=>{w.key==="Enter"&&p()},v=w=>{w.key==="Enter"&&m()};return c.jsxs("div",{className:O.container,children:[c.jsx(kb,{baseConfig:t.baseConfig,onBaseTypeChange:a}),c.jsx(Fb,{baseConfig:t.baseConfig,baseHeight:s,floatHeight:r,onPlacementTypeChange:u,onHeightChange:h,onFloatHeightChange:d,onHeightBlur:p,onFloatHeightBlur:m,onKeyDown:y,onFloatKeyDown:v})]})},De=_o(t=>({placedModules:[],selectedLibraryModuleId:null,selectedPlacedModuleId:null,isFurniturePlacementMode:!1,editMode:!1,editingModuleId:null,currentDragData:null,addModule:e=>{t(n=>({placedModules:[...n.placedModules,e]}))},removeModule:e=>{t(n=>({placedModules:n.placedModules.filter(s=>s.id!==e)}))},moveModule:(e,n)=>{t(s=>({placedModules:s.placedModules.map(i=>i.id===e?{...i,position:n}:i)}))},updatePlacedModule:(e,n)=>{t(s=>({placedModules:s.placedModules.map(i=>i.id===e?{...i,...n}:i)}))},clearAllModules:()=>{t({placedModules:[]})},setPlacedModules:e=>{t(n=>({placedModules:typeof e=="function"?e(n.placedModules):e}))},setSelectedLibraryModuleId:e=>{t({selectedLibraryModuleId:e})},setSelectedPlacedModuleId:e=>{t({selectedPlacedModuleId:e})},clearAllSelections:()=>{t({selectedLibraryModuleId:null,selectedPlacedModuleId:null})},setFurniturePlacementMode:e=>{t({isFurniturePlacementMode:e})},setEditMode:e=>{t({editMode:e})},setEditingModuleId:e=>{t({editingModuleId:e})},exitEditMode:()=>{t({editMode:!1,editingModuleId:null})},setCurrentDragData:e=>{t({currentDragData:e})},clearDragData:()=>{t({currentDragData:null})},setAllDoors:e=>{t(n=>({placedModules:n.placedModules.map(s=>({...s,hasDoor:e}))}))}})),tr="projects",Vb=async t=>{try{const e=await Ro();if(!e)return{id:null,error:"로그인이 필요합니다."};const n={userId:e.uid,title:t.title,createdAt:Wr(),updatedAt:Wr(),version:"1.0.0",projectData:t.projectData,spaceConfig:t.spaceConfig,furniture:t.furniture,stats:{furnitureCount:t.furniture.placedModules.length,lastOpenedAt:Wr()}};return{id:(await DI(K_(Zi,tr),n)).id,error:null}}catch(e){return console.error("프로젝트 생성 에러:",e),{id:null,error:"프로젝트 생성 중 오류가 발생했습니다."}}},Ty=async t=>{try{const e=await Ro();if(!e)return{project:null,error:"로그인이 필요합니다."};const n=Do(Zi,tr,t),s=await ol(n);if(!s.exists())return{project:null,error:"프로젝트를 찾을 수 없습니다."};const i=s.data();if(i.userId!==e.uid)return{project:null,error:"프로젝트에 접근할 권한이 없습니다."};const r={id:s.id,...i};return await $b(t),{project:r,error:null}}catch(e){return console.error("프로젝트 불러오기 에러:",e),{project:null,error:"프로젝트 불러오기 중 오류가 발생했습니다."}}},Ey=async(t,e,n)=>{var s;try{const i=await Ro();if(!i)return{error:"로그인이 필요합니다."};const r=Do(Zi,tr,t),o=await ol(r);if(!o.exists()||o.data().userId!==i.uid)return{error:"프로젝트에 접근할 권한이 없습니다."};const a={updatedAt:Wr(),...e.title&&{title:e.title},...e.projectData&&{projectData:e.projectData},...e.spaceConfig&&{spaceConfig:e.spaceConfig},...e.furniture&&{furniture:e.furniture,"stats.furnitureCount":e.furniture.placedModules.length},...n&&{thumbnail:n}};e.spaceConfig&&(console.log("🔥 Firebase 저장 - spaceConfig 입력:",e.spaceConfig),console.log("🔥 Firebase 저장 - materialConfig 입력:",e.spaceConfig.materialConfig)),console.log("🔥 Firebase 저장 - 최종 updateData:",a),await oy(r,a);const u=await ol(r);if(u.exists()){const h=u.data();console.log("🔥 Firebase 저장 후 확인 - spaceConfig:",h.spaceConfig),console.log("🔥 Firebase 저장 후 확인 - materialConfig:",(s=h.spaceConfig)==null?void 0:s.materialConfig)}return{error:null}}catch(i){return console.error("프로젝트 업데이트 에러:",i),{error:"프로젝트 업데이트 중 오류가 발생했습니다."}}},Bb=async t=>{try{const e=await Ro();if(!e)return{error:"로그인이 필요합니다."};const n=Do(Zi,tr,t),s=await ol(n);return!s.exists()||s.data().userId!==e.uid?{error:"프로젝트에 접근할 권한이 없습니다."}:(await CI(n),{error:null})}catch(e){return console.error("프로젝트 삭제 에러:",e),{error:"프로젝트 삭제 중 오류가 발생했습니다."}}},Ub=async()=>{try{const t=await Ro();if(!t)return{projects:[],error:"로그인이 필요합니다."};const e=TI(K_(Zi,tr),EI("userId","==",t.uid),AI("updatedAt","desc")),n=await bI(e),s=[];return n.forEach(i=>{var o,a,u,h;const r=i.data();s.push({id:i.id,title:r.title,updatedAt:r.updatedAt,furnitureCount:((o=r.stats)==null?void 0:o.furnitureCount)||0,spaceSize:{width:((a=r.spaceConfig)==null?void 0:a.width)||0,height:((u=r.spaceConfig)==null?void 0:u.height)||0,depth:((h=r.spaceConfig)==null?void 0:h.depth)||0},thumbnail:r.thumbnail})}),{projects:s,error:null}}catch(t){return console.error("프로젝트 목록 가져오기 에러:",t),{projects:[],error:"프로젝트 목록을 가져오는 중 오류가 발생했습니다."}}},$b=async t=>{try{const e=Do(Zi,tr,t);await oy(e,{"stats.lastOpenedAt":Wr()})}catch(e){console.error("마지막 열람 시간 업데이트 에러:",e)}},Hb=()=>{const t=document.querySelectorAll("canvas");for(const e of t)if((e.getContext("webgl")||e.getContext("webgl2"))&&e.offsetWidth>100&&e.offsetHeight>100)return e;return null},Wb=(t,e={})=>{try{const{width:n=300,height:s=200,quality:i=.8}=e;if(t.width===0||t.height===0)return console.warn("캔버스 크기가 0입니다."),null;const r=document.createElement("canvas"),o=r.getContext("2d");return o?(r.width=n,r.height=s,o.fillStyle="#f5f5f5",o.fillRect(0,0,n,s),o.drawImage(t,0,0,t.width,t.height,0,0,n,s),r.toDataURL("image/png",i)):(console.error("임시 캔버스 컨텍스트를 생성할 수 없습니다."),null)}catch(n){return console.error("썸네일 캡처 실패:",n),null}},Xb=async()=>{const t=Hb();if(!t)return console.warn("3D 캔버스를 찾을 수 없어 썸네일을 생성할 수 없습니다."),null;if(t.offsetWidth===0||t.offsetHeight===0)return console.warn("캔버스가 보이지 않는 상태입니다."),null;console.log("📸 3D 캔버스 썸네일 캡처 시작...",{canvasSize:`${t.width}x${t.height}`,displaySize:`${t.offsetWidth}x${t.offsetHeight}`}),await new Promise(e=>setTimeout(e,500));for(let e=1;e<=3;e++)try{const n=Wb(t,{width:300,height:200,quality:.7});if(n&&n.length>1e3)return console.log(`📸 썸네일 캡처 성공 (${e}번째 시도)`),n;e<3&&await new Promise(s=>setTimeout(s,100))}catch(n){console.warn(`썸네일 캡처 시도 ${e} 실패:`,n)}return console.warn("모든 썸네일 캡처 시도 실패"),null},Ay=(t,e)=>{const n=document.createElement("canvas"),s=n.getContext("2d");if(!s)return"";n.width=300,n.height=200;const i=s.createLinearGradient(0,0,300,200);i.addColorStop(0,"#f3e8d6"),i.addColorStop(1,"#d4b896"),s.fillStyle=i,s.fillRect(0,0,300,200),s.fillStyle="#8B4513",s.font="bold 16px Arial",s.textAlign="center";const r=Math.round(t.width),o=Math.round(t.height),a=Math.round(t.depth);return s.fillText(`${r} × ${o} × ${a}mm`,150,80),s.font="14px Arial",s.fillText(`가구 ${e}개`,150,120),s.fillStyle="#3B82F6",s.fillRect(10,10,40,20),s.fillStyle="white",s.font="bold 12px Arial",s.textAlign="left",s.fillText("V5.0",15,24),n.toDataURL("image/png",.8)},Gb=()=>{const t=Il(),[e]=bm(),[n,s]=M.useState(!1),[i,r]=M.useState(!1),[o,a]=M.useState(null),{basicInfo:u,setBasicInfo:h,resetAll:d}=hy(),{spaceInfo:p,setSpaceInfo:m,resetAll:y}=Pt(),{clearAllModules:v,setPlacedModules:w,placedModules:E}=De(),C=async j=>{s(!0);try{const{project:I,error:T}=await Ty(j);if(T){console.error("프로젝트 로드 에러:",T),alert("프로젝트를 불러오는데 실패했습니다: "+T),t("/");return}I&&(h(I.projectData),m(I.spaceConfig),w(I.furniture.placedModules),a(j),console.log("✅ 프로젝트 로드 성공:",I.title),console.log("🎨 로드된 materialConfig:",I.spaceConfig.materialConfig))}catch(I){console.error("프로젝트 로드 실패:",I),alert("프로젝트 로드 중 오류가 발생했습니다."),t("/")}finally{s(!1)}};M.useEffect(()=>{const j=e.get("projectId");j?C(j):(d(),y(),v(),a(null))},[e]);const A=j=>{h(j)},R=j=>{m(j)},N=async()=>{if(u.title&&u.location){if(o){r(!0);try{const I=Ay(p,E.length),{error:T}=await Ey(o,{title:u.title,projectData:u,spaceConfig:p,furniture:{placedModules:E}},I);if(T){console.error("프로젝트 저장 에러:",T),alert("프로젝트 저장에 실패했습니다: "+T),r(!1);return}console.log("✅ 프로젝트 저장 후 Configurator로 이동");try{new BroadcastChannel("project-updates").postMessage({type:"PROJECT_SAVED",projectId:o,timestamp:Date.now()}),console.log("📡 다른 창에 프로젝트 업데이트 알림 전송 (Step0)")}catch(_){console.warn("BroadcastChannel 전송 실패 (무시 가능):",_)}}catch(I){console.error("프로젝트 저장 실패:",I),alert("프로젝트 저장 중 오류가 발생했습니다."),r(!1);return}r(!1)}const j=o?`/configurator?projectId=${o}`:"/configurator";t(j)}},k=u.title&&u.location;return n?c.jsxs("div",{className:St.loadingScreen,children:[c.jsx(al,{message:"프로젝트를 불러오는 중...",size:"large",type:"spinner"}),c.jsx("p",{className:St.loadingSubtext,children:"잠시만 기다려주세요."})]}):c.jsx("div",{className:St.container,"data-debug":void 0,"data-component":"Step0",children:c.jsxs("div",{className:St.modalContent,"data-debug-element":"modalContent",children:[c.jsx("div",{className:St.header,"data-debug-element":"header",children:c.jsxs("div",{children:[c.jsx("h1",{children:"벽장 제작"}),c.jsx("p",{children:"기본 정보와 공간 크기를 설정해주세요."})]})}),c.jsx("div",{className:St.content,"data-debug-element":"content",children:c.jsxs("div",{className:St.formSection,"data-debug-element":"formSection",children:[c.jsxs("div",{className:St.form,"data-debug-element":"form",children:[c.jsx(Eb,{basicInfo:u,onUpdate:A}),c.jsxs("div",{className:St.spaceSettings,"data-debug-element":"spaceSettings",children:[c.jsx("h3",{className:St.sectionTitle,children:"공간 정보"}),c.jsxs("div",{className:St.spaceSizeSection,children:[c.jsx("span",{className:St.label,children:"공간 크기"}),c.jsx("div",{className:St.dimensionsSummary,children:c.jsxs("span",{className:St.summaryText,children:[p.width," × ",p.height," mm (깊이: ",p.depth,"mm 고정)"]})}),c.jsxs("div",{className:St.inputGroupTwoColumns,children:[c.jsx(fy,{spaceInfo:p,onUpdate:R}),c.jsx(py,{spaceInfo:p,onUpdate:R})]})]}),c.jsx(gy,{spaceInfo:p,onUpdate:R})]})]}),c.jsx("div",{className:St.startButtonContainer,"data-debug-element":"startButtonContainer",children:c.jsx(zu,{variant:"primary",size:"large",onClick:N,disabled:!k||i,"data-debug-element":"startButton",children:i?"저장 중...":"벽장 제작 시작하기"})})]})})]})})},wg={viewMode:"2D",view2DDirection:"front",doorsOpen:!0,showDimensions:!0,selectedModuleForProperties:null},nr=_o()(B1(t=>({...wg,setViewMode:e=>t({viewMode:e}),setView2DDirection:e=>t({view2DDirection:e}),toggleDoors:()=>t(e=>({doorsOpen:!e.doorsOpen})),toggleDimensions:()=>t(e=>({showDimensions:!e.showDimensions})),setSelectedModuleForProperties:e=>t({selectedModuleForProperties:e}),resetUI:()=>t(wg)}),{name:"ui-store",partialize:t=>({viewMode:t.viewMode,view2DDirection:t.view2DDirection,showDimensions:t.showDimensions})})),se={BASIC_THICKNESS:18,DEFAULT_DEPTH:600,TYPE1_DRAWER_HEIGHT:600,TYPE2_BOTTOM_HEIGHT:1025,TYPE4_DRAWER_HEIGHT:1e3,DRAWER_HEIGHTS_2TIER:[255,255],DRAWER_HEIGHTS_4TIER:[255,255,176,176],DRAWER_GAP:24,STYLER_WIDTH:694,PANTSHANGER_WIDTH:564,SAFETY_SHELF_POSITION:2050,SAFETY_SHELF_THRESHOLD:2300,COLORS:{TYPE1:"#8D6E63",TYPE2:"#303F9F",TYPE4:"#0097A7",STYLER:"#4CAF50",PANTSHANGER:"#9C27B0"}},js=(t,e,n=se.SAFETY_SHELF_POSITION,s=se.SAFETY_SHELF_THRESHOLD)=>{if(e<=s)return t;let i=0;return t.map(r=>{const o=i,a=i+r.height;if(i+=r.height,r.type==="hanging"&&n>=o&&n<a){const u=n-o;return{...r,count:1,shelfPositions:[u]}}return r})},Vs=(t,e,n,s,i,r,o,a)=>({id:t,name:e,category:"full",dimensions:{width:n,height:s,depth:i},color:r,description:o,isDynamic:!0,hasDoor:!1,widthOptions:[n],type:"box",defaultDepth:a||se.DEFAULT_DEPTH,modelConfig:{basicThickness:se.BASIC_THICKNESS,hasOpenFront:!0}}),zb=(t,e)=>{const n=se.TYPE1_DRAWER_HEIGHT,s=e-n,i=[{type:"drawer",heightType:"absolute",height:n,count:2,drawerHeights:se.DRAWER_HEIGHTS_2TIER,gapHeight:se.DRAWER_GAP},{type:"hanging",heightType:"absolute",height:s}],r=js(i,e),o=Vs(`single-2drawer-hanging-${t}`,`2단서랍+옷장 ${t}mm`,t,e,se.DEFAULT_DEPTH,se.COLORS.TYPE1,e>se.SAFETY_SHELF_THRESHOLD?`하단 2단 서랍장 + 상단 옷장 (안전선반 포함) | 폭 ${t}mm`:`하단 2단 서랍장 + 상단 옷장 | 폭 ${t}mm`,se.DEFAULT_DEPTH);return{...o,modelConfig:{...o.modelConfig,sections:r}}},Yb=(t,e)=>{const n=se.TYPE2_BOTTOM_HEIGHT,s=e-n,i=[{type:"shelf",heightType:"absolute",height:n,count:1,shelfPositions:[n-18-9]},{type:"hanging",heightType:"absolute",height:s}],r=js(i,e),o=Vs(`single-2hanging-${t}`,`2단 옷장 ${t}mm`,t,e,se.DEFAULT_DEPTH,se.COLORS.TYPE2,e>se.SAFETY_SHELF_THRESHOLD?`하단 짧은옷장 + 상단 긴옷장 (안전선반 포함) | 폭 ${t}mm`:`하단 짧은옷장 + 상단 긴옷장 | 폭 ${t}mm`);return{...o,modelConfig:{...o.modelConfig,sections:r}}},qb=(t,e)=>{const n=se.TYPE4_DRAWER_HEIGHT,s=e-n,i=[{type:"drawer",heightType:"absolute",height:n,count:4,drawerHeights:se.DRAWER_HEIGHTS_4TIER,gapHeight:se.DRAWER_GAP},{type:"hanging",heightType:"absolute",height:s}],r=js(i,e),o=Vs(`single-4drawer-hanging-${t}`,`4단서랍+옷장 ${t}mm`,t,e,se.DEFAULT_DEPTH,se.COLORS.TYPE4,e>se.SAFETY_SHELF_THRESHOLD?`4단 서랍장 + 옷장 복합형 (안전선반 포함) | 폭 ${t}mm`:`4단 서랍장 + 옷장 복합형 | 폭 ${t}mm`);return{...o,modelConfig:{...o.modelConfig,sections:r}}},Kb=(t,e)=>{const n=se.TYPE1_DRAWER_HEIGHT,s=e-n,i=[{type:"drawer",heightType:"absolute",height:n,count:2,drawerHeights:se.DRAWER_HEIGHTS_2TIER,gapHeight:se.DRAWER_GAP},{type:"hanging",heightType:"absolute",height:s}],r=js(i,e),o=Vs(`dual-2drawer-hanging-${t}`,`듀얼 2단서랍+옷장 ${t}mm`,t,e,se.DEFAULT_DEPTH,se.COLORS.TYPE1,e>se.SAFETY_SHELF_THRESHOLD?`듀얼 하단 2단 서랍장 + 상단 옷장 (안전선반 포함) | 폭 ${t}mm`:`듀얼 하단 2단 서랍장 + 상단 옷장 | 폭 ${t}mm`);return{...o,modelConfig:{...o.modelConfig,sections:r}}},Qb=(t,e)=>{const n=se.TYPE2_BOTTOM_HEIGHT,s=e-n,i=[{type:"shelf",heightType:"absolute",height:n,count:1,shelfPositions:[n-18-9]},{type:"hanging",heightType:"absolute",height:s}],r=js(i,e),o=Vs(`dual-2hanging-${t}`,`듀얼 2단 옷장 ${t}mm`,t,e,se.DEFAULT_DEPTH,se.COLORS.TYPE2,e>se.SAFETY_SHELF_THRESHOLD?`듀얼 하단 짧은옷장 + 상단 긴옷장 (안전선반 포함) | 폭 ${t}mm`:`듀얼 하단 짧은옷장 + 상단 긴옷장 | 폭 ${t}mm`);return{...o,modelConfig:{...o.modelConfig,sections:r}}},Jb=(t,e)=>{const n=se.TYPE4_DRAWER_HEIGHT,s=e-n,i=[{type:"drawer",heightType:"absolute",height:n,count:4,drawerHeights:se.DRAWER_HEIGHTS_4TIER,gapHeight:se.DRAWER_GAP},{type:"hanging",heightType:"absolute",height:s}],r=js(i,e),o=Vs(`dual-4drawer-hanging-${t}`,`듀얼 4단서랍+옷장 ${t}mm`,t,e,se.DEFAULT_DEPTH,se.COLORS.TYPE4,e>se.SAFETY_SHELF_THRESHOLD?`듀얼 4단 서랍장 + 옷장 복합형 (안전선반 포함) | 폭 ${t}mm`:`듀얼 4단 서랍장 + 옷장 복합형 | 폭 ${t}mm`);return{...o,modelConfig:{...o.modelConfig,sections:r}}},Zb=(t,e)=>{const n=se.TYPE1_DRAWER_HEIGHT,s=e-n,i=[{type:"drawer",heightType:"absolute",height:n,count:2,drawerHeights:se.DRAWER_HEIGHTS_2TIER,gapHeight:se.DRAWER_GAP},{type:"hanging",heightType:"absolute",height:s}],r=[{type:"hanging",heightType:"absolute",height:e}],o=js(i,e),a=js(r,e),u=Vs(`dual-2drawer-styler-${t}`,`듀얼 서랍+스타일러 ${t}mm`,t,e,600,se.COLORS.STYLER,e>se.SAFETY_SHELF_THRESHOLD?`좌측 서랍+옷장 + 우측 스타일러장 (안전선반 포함) | 폭 ${t}mm`:`좌측 서랍+옷장 + 우측 스타일러장 | 폭 ${t}mm`,600);return{...u,modelConfig:{...u.modelConfig,rightAbsoluteWidth:se.STYLER_WIDTH,rightAbsoluteDepth:660,hasSharedMiddlePanel:!1,leftSections:o,rightSections:a}}},eC=(t,e)=>{const n=se.TYPE4_DRAWER_HEIGHT,s=e-n,i=Vs(`dual-4drawer-pantshanger-${t}`,`듀얼 서랍+바지걸이 ${t}mm`,t,e,se.DEFAULT_DEPTH,se.COLORS.PANTSHANGER,e>se.SAFETY_SHELF_THRESHOLD?`좌측 4단서랍+옷장 + 우측 바지걸이+옷장 (통합 안전선반) | 폭 ${t}mm`:`좌측 4단서랍+옷장 + 우측 바지걸이+옷장 | 폭 ${t}mm`);return{...i,modelConfig:{...i.modelConfig,rightAbsoluteWidth:se.PANTSHANGER_WIDTH,hasSharedMiddlePanel:!0,middlePanelHeight:n,hasSharedSafetyShelf:e>se.SAFETY_SHELF_THRESHOLD,safetyShelfHeight:se.SAFETY_SHELF_POSITION,leftSections:[{type:"drawer",heightType:"absolute",height:n,count:4,drawerHeights:se.DRAWER_HEIGHTS_4TIER,gapHeight:se.DRAWER_GAP},{type:"hanging",heightType:"absolute",height:s}],rightSections:[{type:"hanging",heightType:"absolute",height:n},{type:"hanging",heightType:"absolute",height:s}]}}},tC=(t,e)=>{const{height:n}=t;let s;e?s=e:s={width:3600,height:2400,depth:580,installType:"built-in",wallConfig:{left:!0,right:!0},hasFloorFinish:!1,surroundType:"surround"};const i=gt(s),r=i.columnWidth,o=i.columnCount,a=[];if(a.push(zb(r,n)),a.push(Yb(r,n)),a.push(qb(r,n)),o>=2){const u=r*2;a.push(Kb(u,n)),a.push(Qb(u,n)),a.push(Jb(u,n)),a.push(Zb(u,n)),a.push(eC(u,n))}return a},xy=(t,e)=>[...tC(t,e)],Iy=[],nC=(t,e,n)=>{const s=xy(e,n),i=Iy;return[...s,...i].filter(r=>r.category===t)},ut=(t,e,n)=>{if(e){const i=xy(e,n).find(r=>r.id===t);if(i)return i}return Iy.find(s=>s.id===t)},lo=(t,e,n,s,i)=>{const r=gt(s),o=pt(s);if(t<0||e&&t>=r.columnCount-1||!e&&t>=r.columnCount)return!1;const a=e?[t,t+1]:[t];for(const u of n){if(i&&u.id===i)continue;const h=ut(u.moduleId,o,s);if(!h)continue;const d=Math.abs(h.dimensions.width-r.columnWidth*2)<50;let p=-1;if(d&&r.threeUnitDualPositions?p=r.threeUnitDualPositions.findIndex(m=>Math.abs(m-u.position.x)<.1):p=r.threeUnitPositions.findIndex(m=>Math.abs(m-u.position.x)<.1),p>=0){const m=d?[p,p+1]:[p];if(a.some(v=>m.includes(v)))return!1}}return!0},Ui=(t,e,n,s,i,r)=>{const o=gt(i),a=e==="left"?-1:1,u=o.columnCount-(n?1:0);for(let h=t+a;e==="right"?h<=u:h>=0;h+=a)if(lo(h,n,s,i,r))return h;return null},sC=({setPlacedModules:t})=>{const[e,n]=M.useState(!1),s=M.useCallback((i,r)=>{t(o=>{if(o.length===0)return o;const a=gt(i),u=gt(r);(a.columnCount!==u.columnCount||a.columnWidth!==u.columnWidth)&&console.log(`🔄 컬럼 변경: ${a.columnCount}개(${a.columnWidth}mm) → ${u.columnCount}개(${u.columnWidth}mm)`);const h=[];return o.forEach(d=>{const p=pt(i),m=ut(d.moduleId,p,i);let y;if(m){const A=Math.abs(m.dimensions.width-a.columnWidth*2)<50;y=Pb(d.position,a,A)}if(y===void 0||y<0){h.push({...d,isValidInCurrentSpace:!1});return}let v=d.moduleId,w=!1;const E=[/^dual-([^-]+(?:-[^-]+)*)-(\d+)$/];for(const A of E){const R=d.moduleId.match(A);if(R){const N=parseInt(R[2]);if(Math.abs(N-a.columnWidth*2)<50){v=d.moduleId.replace(A,`dual-$1-${u.columnWidth*2}`),w=!0;break}}}if(!w){const A=[/^single-([^-]+(?:-[^-]+)*)-(\d+)$/];let R=!1;for(const N of A)if(d.moduleId.match(N)){v=d.moduleId.replace(N,`single-$1-${u.columnWidth}`),R=!0;break}R||(v=`single-open-${u.columnWidth}`)}if(y>=u.columnCount){const A=u.columnCount-(w?2:1);if(A>=0)y=A;else{h.push({...d,isValidInCurrentSpace:!1});return}}if(w&&y+1>=u.columnCount&&(v=v.replace(/^dual-/,"single-").replace(/-(\d+)$/,`-${u.columnWidth}`),w=!1),!lo(y,w,h,r,d.id)){let A=Ui(y,"right",w,h,r,d.id);if(A===null&&(A=Ui(y,"left",w,h,r,d.id)),A!==null)y=A;else{h.push({...d,isValidInCurrentSpace:!1});return}}let C;w&&u.threeUnitDualPositions?C=u.threeUnitDualPositions[y]:C=u.threeUnitPositions[y],h.push({...d,moduleId:v,position:{...d.position,x:C},slotIndex:y,isDualSlot:v.includes("dual"),isValidInCurrentSpace:!0})}),h})},[t]);return{spaceChangeMode:e,setSpaceChangeMode:n,updateFurnitureForNewSpace:s}},iC="_header_vaqh0_1",rC="_container_vaqh0_19",oC="_logoSection_vaqh0_39",aC="_logo_vaqh0_39",lC="_title_vaqh0_73",cC="_centerActions_vaqh0_91",uC="_actionButton_vaqh0_103",hC="_doorNotInstalled_vaqh0_167",dC="_doorInstalled_vaqh0_189",fC="_rightActions_vaqh0_211",pC="_convertButton_vaqh0_223",gC="_logoutButton_vaqh0_267",mC="_profileButton_vaqh0_313",_C="_saveSuccess_vaqh0_351",yC="_saveError_vaqh0_383",ct={header:iC,container:rC,logoSection:oC,logo:aC,title:lC,centerActions:cC,actionButton:uC,doorNotInstalled:hC,doorInstalled:dC,rightActions:fC,convertButton:pC,logoutButton:gC,profileButton:mC,saveSuccess:_C,saveError:yC},vC=({title:t,onSave:e,onPrevious:n,onNext:s,onHelp:i,onConvert:r,onLogout:o,onProfile:a,saving:u=!1,saveStatus:h="idle",hasDoorsInstalled:d=!1,onDoorInstallationToggle:p})=>c.jsxs("header",{className:ct.header,children:[c.jsxs("div",{className:ct.container,children:[c.jsxs("div",{className:ct.logoSection,children:[c.jsx("div",{className:ct.logo,children:c.jsx("img",{src:"/inshow.svg",alt:"Logo"})}),c.jsx("h1",{className:ct.title,children:t})]}),c.jsxs("div",{className:ct.centerActions,children:[c.jsxs("button",{className:ct.actionButton,onClick:e,disabled:u,children:[c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"17,21 17,13 7,13 7,21",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"7,3 7,8 15,8",stroke:"currentColor",strokeWidth:"2"})]}),u?"저장 중...":"저장"]}),p&&c.jsxs("button",{className:`${ct.actionButton} ${d?ct.doorInstalled:ct.doorNotInstalled}`,onClick:p,children:[c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),c.jsx("circle",{cx:"9",cy:"12",r:"1",fill:"currentColor"}),d&&c.jsx("path",{d:"M8 12l2 2 4-4",stroke:"currentColor",strokeWidth:"2",fill:"none"})]}),"도어설치"]}),n&&c.jsxs("button",{className:ct.actionButton,onClick:n,children:[c.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:c.jsx("polyline",{points:"15,18 9,12 15,6",stroke:"currentColor",strokeWidth:"2"})}),"이전"]}),s&&c.jsxs("button",{className:ct.actionButton,onClick:s,children:[c.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:c.jsx("polyline",{points:"9,18 15,12 9,6",stroke:"currentColor",strokeWidth:"2"})}),"다음"]}),i&&c.jsxs("button",{className:ct.actionButton,onClick:i,children:[c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),c.jsx("path",{d:"m9,9a3,3 0 1 1 5.83,1c0,2-3,3-3,3",stroke:"currentColor",strokeWidth:"2"}),c.jsx("circle",{cx:"12",cy:"17",r:"1",fill:"currentColor"})]}),"도움말"]})]}),c.jsxs("div",{className:ct.rightActions,children:[r&&c.jsxs("button",{className:ct.convertButton,onClick:r,children:["컨버팅",c.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:c.jsx("polyline",{points:"9,18 15,12 9,6",stroke:"currentColor",strokeWidth:"2"})})]}),o&&c.jsxs("button",{className:ct.logoutButton,onClick:o,children:[c.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"16,17 21,12 16,7",stroke:"currentColor",strokeWidth:"2"}),c.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12",stroke:"currentColor",strokeWidth:"2"})]}),"로그아웃"]}),a&&c.jsx("button",{className:ct.profileButton,onClick:a,children:c.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"}),c.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z",stroke:"currentColor",strokeWidth:"2"})]})})]})]}),h==="success"&&c.jsx("div",{className:ct.saveSuccess,children:"✓ 저장되었습니다"}),h==="error"&&c.jsx("div",{className:ct.saveError,children:"✕ 저장에 실패했습니다"})]}),wC="_sidebar_6s7kp_1",TC="_open_6s7kp_25",EC="_tabList_6s7kp_33",AC="_tabButton_6s7kp_49",xC="_active_6s7kp_87",IC="_tabIcon_6s7kp_119",SC="_tabLabel_6s7kp_151",bC="_userSection_6s7kp_189",CC="_userAvatar_6s7kp_199",DC="_avatar_6s7kp_211",PC="_onlineIndicator_6s7kp_237",rn={sidebar:wC,open:TC,tabList:EC,tabButton:AC,active:xC,tabIcon:IC,tabLabel:SC,userSection:bC,userAvatar:CC,avatar:DC,onlineIndicator:PC},RC=({activeTab:t,onTabClick:e,isOpen:n})=>{const s=[{id:"module",icon:c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),c.jsx("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),c.jsx("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),c.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"})]}),label:"모듈"},{id:"material",icon:c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"7.5,4.21 12,6.81 16.5,4.21",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"7.5,19.79 7.5,14.6 3,12",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"21,12 16.5,14.6 16.5,19.79",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"3.27,6.96 12,12.01 20.73,6.96",stroke:"currentColor",strokeWidth:"2"}),c.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12",stroke:"currentColor",strokeWidth:"2"})]}),label:"재질"},{id:"structure",icon:c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",stroke:"currentColor",strokeWidth:"2"}),c.jsx("polyline",{points:"9,22 9,12 15,12 15,22",stroke:"currentColor",strokeWidth:"2"})]}),label:"구조물"},{id:"etc",icon:c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"}),c.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z",stroke:"currentColor",strokeWidth:"2"})]}),label:"기타"}];return c.jsxs("aside",{className:`${rn.sidebar} ${n?rn.open:""}`,children:[c.jsx("div",{className:rn.tabList,children:s.map(i=>c.jsxs("button",{className:`${rn.tabButton} ${t===i.id?rn.active:""}`,onClick:()=>e(i.id),title:i.label,children:[c.jsx("div",{className:rn.tabIcon,children:i.icon}),c.jsx("span",{className:rn.tabLabel,children:i.label})]},i.id))}),c.jsx("div",{className:rn.userSection,children:c.jsxs("div",{className:rn.userAvatar,children:[c.jsx("div",{className:rn.avatar,children:c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",strokeWidth:"2"}),c.jsx("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"})]})}),c.jsx("div",{className:rn.onlineIndicator,children:c.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",children:c.jsx("path",{d:"M9 12l2 2 4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})})]})},NC="_viewerControls_7nn0n_1",MC="_leftControls_7nn0n_29",jC="_toggleGroup_7nn0n_41",LC="_toggleIcon_7nn0n_53",kC="_toggleLabel_7nn0n_61",FC="_on_7nn0n_103",OC="_off_7nn0n_111",VC="_switchHandle_7nn0n_119",BC="_checkboxGroup_7nn0n_157",UC="_checkboxLabel_7nn0n_169",$C="_checkbox_7nn0n_157",HC="_checkmark_7nn0n_201",WC="_rightControls_7nn0n_257",XC="_renderModeGroup_7nn0n_271",GC="_renderModeButton_7nn0n_287",zC="_active_7nn0n_329",YC="_viewModeGroup_7nn0n_349",qC="_viewModeButton_7nn0n_363",KC="_viewDirectionGroup_7nn0n_427",QC="_viewDirectionButton_7nn0n_441",je={viewerControls:NC,leftControls:MC,toggleGroup:jC,toggleIcon:LC,toggleLabel:kC,switch:"_switch_7nn0n_81",on:FC,off:OC,switchHandle:VC,checkboxGroup:BC,checkboxLabel:UC,checkbox:$C,checkmark:HC,rightControls:WC,renderModeGroup:XC,renderModeButton:GC,active:zC,viewModeGroup:YC,viewModeButton:qC,viewDirectionGroup:KC,viewDirectionButton:QC},JC=({viewMode:t,onViewModeChange:e,viewDirection:n,onViewDirectionChange:s,renderMode:i,onRenderModeChange:r,showAll:o,onShowAllToggle:a,showDimensions:u,onShowDimensionsToggle:h,showGuides:d,onShowGuidesToggle:p,doorsOpen:m,onDoorsToggle:y})=>{const{view2DDirection:v,setView2DDirection:w}=nr(),E=[{id:"3D",label:"3D"},{id:"2D",label:"2D"}],C=[{id:"front",label:"정면"},{id:"top",label:"상부"},{id:"left",label:"좌측면"},{id:"right",label:"우측면"}],A=[{id:"solid",label:"Solid"},{id:"wireframe",label:"Wireframe"}],R=N=>{w(N),s(N)};return c.jsxs("div",{className:je.viewerControls,children:[c.jsxs("div",{className:je.leftControls,children:[c.jsxs("div",{className:je.toggleGroup,children:[c.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",className:je.toggleIcon,children:[c.jsx("path",{d:"M3 17h18M3 12h18M3 7h18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),c.jsx("circle",{cx:"21",cy:"7",r:"1",fill:"currentColor"}),c.jsx("circle",{cx:"21",cy:"12",r:"1",fill:"currentColor"}),c.jsx("circle",{cx:"21",cy:"17",r:"1",fill:"currentColor"})]}),c.jsx("span",{className:je.toggleLabel,children:u?"ON":"OFF"}),c.jsx("button",{className:`${je.switch} ${u?je.on:je.off}`,onClick:h,children:c.jsx("div",{className:je.switchHandle})})]}),c.jsxs("div",{className:je.checkboxGroup,children:[c.jsxs("label",{className:je.checkboxLabel,children:[c.jsx("input",{type:"checkbox",checked:o,onChange:a,className:je.checkbox}),c.jsx("span",{className:je.checkmark}),"모두"]}),c.jsxs("label",{className:je.checkboxLabel,children:[c.jsx("input",{type:"checkbox",checked:u,onChange:h,className:je.checkbox}),c.jsx("span",{className:je.checkmark}),"치수"]}),c.jsxs("label",{className:je.checkboxLabel,children:[c.jsx("input",{type:"checkbox",checked:d,onChange:p,className:je.checkbox}),c.jsx("span",{className:je.checkmark}),"가이드"]})]})]}),c.jsxs("div",{className:je.rightControls,children:[c.jsx("div",{className:je.renderModeGroup,children:A.map(N=>c.jsx("button",{className:`${je.renderModeButton} ${i===N.id?je.active:""}`,onClick:()=>r(N.id),children:N.label},N.id))}),c.jsx("div",{className:je.viewModeGroup,children:E.map(N=>c.jsx("button",{className:`${je.viewModeButton} ${t===N.id?je.active:""}`,onClick:()=>e(N.id),children:N.label},N.id))}),c.jsx("div",{className:je.viewDirectionGroup,children:C.map(N=>c.jsx("button",{className:`${je.viewDirectionButton} ${v===N.id?je.active:""}`,onClick:()=>R(N.id),children:N.label},N.id))})]})]})},ZC=()=>({room:{floor:{color:"#e2e8f0",roughness:.5},walls:{color:"#f8fafc",roughness:.3}},furniture:{color:"#64748b",roughness:.2}}),Sy=M.createContext(null),e6=({spaceInfo:t,svgSize:e,renderMode:n="wireframe",children:s})=>{const i=ZC(),r=my(t),o={spaceInfo:t,canvasSize:e,styles:i,renderMode:n,roomDimensions:r};return c.jsx(Sy.Provider,{value:o,children:s})},t6=.01,n6={BASE_FOV:50,SMALL_WIDTH_THRESHOLD:1e3,MEDIUM_WIDTH_THRESHOLD:1500,LARGE_WIDTH_THRESHOLD:2e3,SMALL_ADJUSTMENT:5,MEDIUM_ADJUSTMENT:0,LARGE_ADJUSTMENT:-5,XLARGE_ADJUSTMENT:-10},s6=t=>{const{BASE_FOV:e,SMALL_WIDTH_THRESHOLD:n,MEDIUM_WIDTH_THRESHOLD:s,LARGE_WIDTH_THRESHOLD:i,SMALL_ADJUSTMENT:r,MEDIUM_ADJUSTMENT:o,LARGE_ADJUSTMENT:a,XLARGE_ADJUSTMENT:u}=n6;return t<=n?e+r:t<=s?e+o:t<=i?e+a:e+u},ll=t=>t*t6,i6=(t,e,n,s=0)=>{const i=Math.sqrt(t*t+e*e+n*n),r=1.2,a=50*Math.PI/180,h=Math.max(t,e,n)/2/Math.tan(a/2),d=i/2/Math.tan(a/2),p=Math.max(h,d),m=ll(p*r);return Math.max(8,Math.min(150,m))},r6=t=>[0,ll(t*.5),0],o6=(t="3D",e=[0,5,10])=>{const{spaceInfo:n}=Pt(),{placedModules:s}=De();return M.useMemo(()=>{const r=t==="2D",o=e,a=r6(n.height),u=s6(n.width);return{position:o,target:a,fov:u,is2DMode:r,spaceWidth:n.width,spaceHeight:n.height}},[t,n.height,n.width,n.depth,e,s.length])},a6=()=>{const t=M.useCallback(s=>{s.preventDefault()},[]),e=M.useCallback(s=>{s.preventDefault()},[]),n=M.useCallback(s=>{s.preventDefault()},[]);return{handleDrop:t,handleDragOver:e,handleDragLeave:n}},qt={NEAR_PLANE:.1,FAR_PLANE:1e3,MIN_DISTANCE:5,MAX_DISTANCE:200,POLAR_ANGLE_MIN:Math.PI/2-Math.PI/18,POLAR_ANGLE_MAX:Math.PI/2+Math.PI/18,AZIMUTH_ANGLE_MIN:-Math.PI/12,AZIMUTH_ANGLE_MAX:Math.PI/12},oa={BACKGROUND_COLOR:"#ffffff"},l6=(t,e="3D",n,s)=>{const[i,r]=M.useState(!1);M.useEffect(()=>{const u=p=>{p.altKey&&r(!0)},h=p=>{p.altKey||r(!1)};window.addEventListener("keydown",u),window.addEventListener("keyup",h);const d=()=>r(!1);return window.addEventListener("blur",d),()=>{window.removeEventListener("keydown",u),window.removeEventListener("keyup",h),window.removeEventListener("blur",d)}},[]);const o=M.useMemo(()=>{if(!n||!s)return{minDistance:qt.MIN_DISTANCE,maxDistance:qt.MAX_DISTANCE};const u=Math.max(n,s),h=y=>y*.01,d=qt.MIN_DISTANCE,p=h(u*8),m=Math.max(qt.MAX_DISTANCE,p);return{minDistance:d,maxDistance:m}},[n,s]);return M.useMemo(()=>{const u=e==="2D";return{enabled:!0,target:t,minPolarAngle:u?void 0:qt.POLAR_ANGLE_MIN,maxPolarAngle:u?void 0:qt.POLAR_ANGLE_MAX,minAzimuthAngle:u?void 0:qt.AZIMUTH_ANGLE_MIN,maxAzimuthAngle:u?void 0:qt.AZIMUTH_ANGLE_MAX,enablePan:!0,enableZoom:!0,enableRotate:!u,minDistance:o.minDistance,maxDistance:o.maxDistance,mouseButtons:{LEFT:i?vc.PAN:void 0,MIDDLE:vc.PAN,RIGHT:u?void 0:vc.ROTATE},touches:{ONE:void 0,TWO:J1.PAN}}},[t,e,i,o])},Tg=t=>{const e=["map","normalMap","bumpMap","displacementMap","specularMap","emissiveMap","metalnessMap","roughnessMap","aoMap","envMap"],n=t;e.forEach(s=>{const i=n[s];i instanceof Z1&&i.dispose()}),t.dispose()},c6=()=>{const{gl:t,scene:e}=Sh();return M.useEffect(()=>()=>{e.traverse(n=>{n instanceof Dm&&(n.geometry&&n.geometry.dispose(),n.material&&(Array.isArray(n.material)?n.material.forEach(s=>{Tg(s)}):Tg(n.material)))});try{t.dispose(),console.log("Three.js resources cleaned up")}catch(n){console.warn("Failed to clean up Three.js resources:",n)}console.log("Scene cleanup completed")},[e,t]),null};function u6(t){return t!==null&&typeof t=="object"&&"connect"in t&&"disconnect"in t}const h6=({children:t,cameraPosition:e,viewMode:n="3D",renderMode:s="wireframe"})=>{const[i,r]=M.useState(!1),[o,a]=M.useState(()=>`canvas-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),[u,h]=M.useState(0),d=M.useRef(null),p=M.useRef(null),m=M.useRef(null),y=o6(n,e),v=a6(),w=l6(y.target,n,y.spaceWidth,y.spaceHeight),E=M.useCallback(()=>{if(console.log("Force cleaning up WebGL context..."),p.current){try{p.current.dispose(),p.current.forceContextLoss()}catch(A){console.warn("Error disposing renderer:",A)}p.current=null}if(d.current){try{const A=d.current.getContext("webgl"),R=d.current.getContext("webgl2"),N=d.current.getContext("experimental-webgl");[A,R,N].forEach(k=>{if(k){const j=k.getExtension("WEBGL_lose_context");j&&j.loseContext()}}),d.current.width=1,d.current.height=1,d.current.style.display="none"}catch(A){console.warn("Error cleaning up canvas context:",A)}d.current.parentNode&&d.current.parentNode.removeChild(d.current),d.current=null}m.current&&m.current.querySelectorAll("canvas").forEach(R=>{try{const N=R.getContext("webgl")||R.getContext("webgl2");if(N){const k=N.getExtension("WEBGL_lose_context");k&&k.loseContext()}R.parentNode&&R.parentNode.removeChild(R)}catch(N){console.warn("Error cleaning up stray canvas:",N)}})},[]),C=M.useCallback(()=>{E();const A=Date.now(),R=Math.random().toString(36).substr(2,9),N=`canvas-${n}-${A}-${R}`;console.log("Regenerating canvas with key:",N),a(N),h(k=>k+1)},[n,E]);return M.useEffect(()=>(r(!0),()=>{r(!1),E()}),[E]),M.useEffect(()=>{i&&(console.log("ViewMode changed, regenerating canvas..."),C())},[n,i,C]),M.useEffect(()=>{const A=N=>{console.warn("WebGL context lost event triggered"),N.preventDefault(),C()},R=()=>{console.log("WebGL context restored")};if(d.current)return d.current.addEventListener("webglcontextlost",A),d.current.addEventListener("webglcontextrestored",R),()=>{d.current&&(d.current.removeEventListener("webglcontextlost",A),d.current.removeEventListener("webglcontextrestored",R))}},[C]),i?c.jsx("div",{ref:m,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,right:0,bottom:0,touchAction:"none"},onDrop:v.handleDrop,onDragOver:v.handleDragOver,onDragLeave:v.handleDragLeave,children:c.jsxs(U1,{shadows:!0,style:{background:oa.BACKGROUND_COLOR,cursor:"default",touchAction:"none"},dpr:[1,2],gl:{powerPreference:"high-performance",antialias:!0,alpha:!1,stencil:!0,depth:!0,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!1,logarithmicDepthBuffer:!0,precision:"highp"},onCreated:({gl:A,events:R,scene:N})=>{if(console.log("Canvas created with key:",o),d.current=A.domElement,p.current=A,A.setPixelRatio(Math.min(window.devicePixelRatio,2)),A.shadowMap.enabled=!0,A.shadowMap.type=ev,A.shadowMap.autoUpdate=!0,A.shadowMap.needsUpdate=!0,A.capabilities.maxTextureSize=4096,A.setRenderTarget(null),A.clear(!0,!0,!0),A.toneMapping=tv,A.toneMappingExposure=1,A.outputColorSpace=nv,A.setClearColor(new it(oa.BACKGROUND_COLOR),1),A.autoClear=!0,A.autoClearColor=!0,A.autoClearDepth=!0,A.autoClearStencil=!0,A.sortObjects=!0,A.localClippingEnabled=!0,A.domElement.style.display="block",A.domElement.setAttribute("data-canvas-key",o),N&&(N.background=new it(oa.BACKGROUND_COLOR),N.fog=null,console.log("Scene environment setup - allowing Environment component to set scene.environment")),R&&u6(R))try{R.disconnect(),R.connect(A.domElement)}catch(k){console.warn("Error connecting events:",k)}console.log("Professional-grade canvas setup completed successfully")},onPointerMissed:()=>{console.log("Canvas pointer event working")},children:[c.jsx(c6,{}),y.is2DMode?c.jsx($1,{makeDefault:!0,position:y.position,left:-y.spaceWidth*.01*.8,right:y.spaceWidth*.01*.8,top:y.spaceHeight*.01*.8,bottom:-y.spaceHeight*.01*.8,near:qt.NEAR_PLANE,far:qt.FAR_PLANE}):c.jsx(H1,{makeDefault:!0,position:y.position,fov:y.fov,near:qt.NEAR_PLANE,far:qt.FAR_PLANE}),c.jsx(W1,{enabled:w.enabled,target:w.target,minPolarAngle:w.minPolarAngle,maxPolarAngle:w.maxPolarAngle,minAzimuthAngle:w.minAzimuthAngle,maxAzimuthAngle:w.maxAzimuthAngle,enablePan:w.enablePan,enableZoom:w.enableZoom,enableRotate:w.enableRotate,minDistance:w.minDistance,maxDistance:w.maxDistance,mouseButtons:w.mouseButtons,touches:w.touches,makeDefault:!0}),t]},`${o}-${u}`)}):c.jsx("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",background:oa.BACKGROUND_COLOR},children:c.jsx("p",{children:"Loading 3D viewer..."})})};class jn{static createCanvas(e=256,n=256){const s=document.createElement("canvas");s.width=e,s.height=n;const i=s.getContext("2d");return{canvas:s,context:i}}static createVerticalGradient(e,n,s){const i=e.createLinearGradient(0,0,0,n);return s.forEach(({position:r,color:o})=>{i.addColorStop(r,o)}),i}static createHorizontalGradient(e,n,s){const i=e.createLinearGradient(0,0,n,0);return s.forEach(({position:r,color:o})=>{i.addColorStop(r,o)}),i}static createWallGradientTexture(){const{canvas:e,context:n}=this.createCanvas(),s=this.createVerticalGradient(n,256,[{position:0,color:"#e0e0e0"},{position:.3,color:"#d8d8d8"},{position:.7,color:"#d0d0d0"},{position:1,color:"#c8c8c8"}]);return n.fillStyle=s,n.fillRect(0,0,256,256),new Ut(e)}static createOuterWallGradientTexture(){const{canvas:e,context:n}=this.createCanvas(),s=this.createVerticalGradient(n,256,[{position:0,color:"#f8f8f8"},{position:.3,color:"#f4f4f4"},{position:.7,color:"#f0f0f0"},{position:1,color:"#ececec"}]);return n.fillStyle=s,n.fillRect(0,0,256,256),new Ut(e)}static createFloorGradientTexture(){const{canvas:e,context:n}=this.createCanvas(),s=this.createHorizontalGradient(n,256,[{position:0,color:"#ffffff"},{position:.2,color:"#ffffff"},{position:.3,color:"#dddddd"},{position:.6,color:"#aaaaaa"},{position:1,color:"#888888"}]);return n.fillStyle=s,n.fillRect(0,0,256,256),new Ut(e)}static createDepthBasedWallGradientTexture(){const{canvas:e,context:n}=this.createCanvas(1024,512),s=this.createHorizontalGradient(n,1024,[{position:0,color:"#555555"},{position:.1,color:"#777777"},{position:.25,color:"#999999"},{position:.4,color:"#bbbbbb"},{position:.6,color:"#dddddd"},{position:.8,color:"#eeeeee"},{position:.95,color:"#f8f8f8"},{position:1,color:"#fafafa"}]);return n.fillStyle=s,n.fillRect(0,0,1024,512),new Ut(e)}static createDepthTransparencyTexture(){const{canvas:e,context:n}=this.createCanvas(512,256),s=this.createHorizontalGradient(n,512,[{position:0,color:"rgba(100, 100, 100, 1.0)"},{position:.3,color:"rgba(120, 120, 120, 0.8)"},{position:.5,color:"rgba(150, 150, 150, 0.6)"},{position:.7,color:"rgba(180, 180, 180, 0.4)"},{position:.85,color:"rgba(220, 220, 220, 0.2)"},{position:1,color:"rgba(250, 250, 250, 0.0)"}]);return n.fillStyle=s,n.fillRect(0,0,512,256),new Ut(e)}static createLeftWallDepthTransparencyTexture(){const{canvas:e,context:n}=this.createCanvas(512,256),s=this.createHorizontalGradient(n,512,[{position:0,color:"#ffffff"},{position:.3,color:"#e0e0e0"},{position:.6,color:"#999999"},{position:.8,color:"#666666"},{position:1,color:"#444444"}]);return n.fillStyle=s,n.fillRect(0,0,512,256),new Ut(e)}static createTopWallDepthTransparencyTexture(){const{canvas:e,context:n}=this.createCanvas(512,256),s=this.createVerticalGradient(n,256,[{position:0,color:"#ffffff"},{position:.3,color:"#e0e0e0"},{position:.6,color:"#999999"},{position:.8,color:"#666666"},{position:1,color:"#444444"}]);return n.fillStyle=s,n.fillRect(0,0,512,256),new Ut(e)}static createRightWallDepthTransparencyTexture(){const{canvas:e,context:n}=this.createCanvas(512,256),s=this.createHorizontalGradient(n,512,[{position:0,color:"#ffffff"},{position:.3,color:"#e0e0e0"},{position:.6,color:"#999999"},{position:.8,color:"#666666"},{position:1,color:"#444444"}]);return n.fillStyle=s,n.fillRect(0,0,512,256),new Ut(e)}static createSideFrameGradientTexture(){const{canvas:e,context:n}=this.createCanvas(),s=this.createVerticalGradient(n,256,[{position:0,color:"#f0f0f0"},{position:.2,color:"#e8e8e8"},{position:.5,color:"#e0e0e0"},{position:.8,color:"#d8d8d8"},{position:1,color:"#d0d0d0"}]);return n.fillStyle=s,n.fillRect(0,0,256,256),new Ut(e)}static createFrontToBackGradientTexture(){const{canvas:e,context:n}=this.createCanvas(),s=this.createHorizontalGradient(n,256,[{position:0,color:"#e8e8e8"},{position:.3,color:"#e0e0e0"},{position:.7,color:"#d8d8d8"},{position:1,color:"#d0d0d0"}]);return n.fillStyle=s,n.fillRect(0,0,256,256),new Ut(e)}static createHorizontalGradientTexture(){const{canvas:e,context:n}=this.createCanvas(),s=this.createHorizontalGradient(n,256,[{position:0,color:"#f0f0f0"},{position:.25,color:"#e8e8e8"},{position:.5,color:"#e0e0e0"},{position:.75,color:"#d8d8d8"},{position:1,color:"#d0d0d0"}]);return n.fillStyle=s,n.fillRect(0,0,256,256),new Ut(e)}static createLeftHorizontalGradientTexture(){const{canvas:e,context:n}=this.createCanvas(),s=this.createHorizontalGradient(n,256,[{position:0,color:"#d0d0d0"},{position:.25,color:"#d8d8d8"},{position:.5,color:"#e0e0e0"},{position:.75,color:"#e8e8e8"},{position:1,color:"#f0f0f0"}]);return n.fillStyle=s,n.fillRect(0,0,256,256),new Ut(e)}}class yt{static getCachedMaterial(e,n){return this.materialCache.has(e)||this.materialCache.set(e,n()),this.materialCache.get(e)}static optimizeTexture(e){e.wrapS=Vf,e.wrapT=Vf,e.magFilter=sv,e.minFilter=iv,e.generateMipmaps=!0}static createBasicMaterial(e,n={}){return this.optimizeTexture(e),new Pm({map:e,transparent:n.transparent||!1,opacity:n.opacity||1,side:n.side||rv,fog:n.fog!==void 0?n.fog:!1,...n.alphaTest&&{alphaTest:n.alphaTest},...n.emissive&&{emissive:n.emissive}})}static createWallMaterial(e="#e0e0e0"){return this.getCachedMaterial(`wall_${e}`,()=>{const n=jn.createWallGradientTexture();return new Qt({map:n,color:e,roughness:.9,metalness:0,side:vn,envMapIntensity:.3,bumpScale:.02,transparent:!1,opacity:1})})}static createOuterWallMaterial(){return this.getCachedMaterial("outerWall",()=>{const e=jn.createOuterWallGradientTexture();return new Qt({map:e,color:"#f8f8f8",roughness:.85,metalness:0,side:vn,envMapIntensity:.2,transparent:!1,opacity:1})})}static createFloorMaterial(){return this.getCachedMaterial("floor",()=>{const e=jn.createFloorGradientTexture();return this.createBasicMaterial(e)})}static createDepthBasedWallMaterial(){return this.getCachedMaterial("depthWall",()=>{const e=jn.createDepthBasedWallGradientTexture();return new Qt({map:e,transparent:!0,opacity:.95,side:vn,fog:!1,roughness:.8,metalness:0})})}static createDepthTransparencyMaterial(){return this.getCachedMaterial("depthTransparency",()=>{const e=jn.createDepthTransparencyTexture();return this.createBasicMaterial(e,{transparent:!0,opacity:1,side:vn,fog:!1,alphaTest:.01,emissive:new it(.2,.2,.2)})})}static createDirectionalTransparencyMaterial(e){let n;switch(e){case"left":n=jn.createLeftWallDepthTransparencyTexture();break;case"top":n=jn.createTopWallDepthTransparencyTexture();break;case"right":n=jn.createRightWallDepthTransparencyTexture();break;default:n=jn.createDepthTransparencyTexture()}return this.optimizeTexture(n),new Qt({map:n,transparent:!1,opacity:1,side:vn,fog:!1,roughness:.8,metalness:0})}static createFlatMaterial(e="#ffffff"){return this.getCachedMaterial(`flat-${e}`,()=>new vu({color:new it(e),transparent:!1,fog:!1}))}static createEdgeLineMaterial(e="#000000"){return this.getCachedMaterial(`edge-${e}`,()=>new ov({color:new it(e),linewidth:1}))}static createSolidFrameMaterial(e="#d0d0d0"){const n=new it(e);return new Qt({color:n,transparent:!1,metalness:0,roughness:.4,envMapIntensity:.6,emissive:n.clone().multiplyScalar(.015)})}static createSolidWallMaterial(e="#e8e8e8"){return this.getCachedMaterial(`solidWall-${e}`,()=>new Qt({color:new it(e),roughness:.8,metalness:0,side:vn,transparent:!1,opacity:1}))}static createShaderGradientWallMaterial(e="horizontal"){const n=`
      varying vec2 vUv;
      varying vec3 vPosition;
      
      void main() {
        vUv = uv;
        vPosition = position;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,s=`
        uniform vec3 colorStart;
        uniform vec3 colorEnd;
        uniform float direction;
        uniform float reverse;
        
        varying vec2 vUv;
        varying vec3 vPosition;
        
        void main() {
          float gradientFactor;
          
          if (direction < 0.5) {
            // 수평 그라데이션 (0.0 = 왼쪽/앞쪽, 1.0 = 오른쪽/뒤쪽)
            gradientFactor = vUv.x;
          } else {
            // 수직 그라데이션 (0.0 = 아래/앞쪽, 1.0 = 위/뒤쪽)
            gradientFactor = vUv.y;
          }
          
          // reverse가 1.0이면 그라데이션 방향 반전
          if (reverse > 0.5) {
            gradientFactor = 1.0 - gradientFactor;
          }
          
          vec3 color = mix(colorStart, colorEnd, gradientFactor);
          gl_FragColor = vec4(color, 1.0);
        }
      `,i=e==="horizontal-reverse"||e==="vertical-reverse",r=e==="vertical"||e==="vertical-reverse"?1:0;return new Bf({vertexShader:n,fragmentShader:s,uniforms:{colorStart:{value:new it("#ffffff")},colorEnd:{value:new it("#d0d0d0")},direction:{value:r},reverse:{value:i?1:0}},side:vn,transparent:!1})}static createCornerShaderMaterial(){const e=`
      varying vec2 vUv;
      varying vec3 vPosition;
      varying vec3 vNormal;
      
      void main() {
        vUv = uv;
        vPosition = position;
        vNormal = normalMatrix * normal;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,n=`
      uniform vec3 centerColor;
      uniform vec3 edgeColor;
      uniform float intensity;
      
      varying vec2 vUv;
      varying vec3 vPosition;
      varying vec3 vNormal;
      
      void main() {
        // UV 좌표를 이용한 거리 계산 (중앙에서 가장자리로)
        vec2 center = vec2(0.5, 0.5);
        float distanceFromCenter = distance(vUv, center);
        
        // 0.0 (중앙)에서 0.707 (코너)까지의 거리를 0-1로 정규화
        float normalizedDistance = min(distanceFromCenter / 0.707, 1.0);
        
        // 강도 조절
        float gradientFactor = pow(normalizedDistance, intensity);
        
        vec3 color = mix(centerColor, edgeColor, gradientFactor);
        gl_FragColor = vec4(color, 1.0);
      }
    `;return new Bf({vertexShader:e,fragmentShader:n,uniforms:{centerColor:{value:new it("#ffffff")},edgeColor:{value:new it("#dddddd")},intensity:{value:1.5}},side:vn,transparent:!1})}static createEdgeShadowMaterial(){return new vu({color:"#888888",transparent:!0,opacity:.3,side:vn})}static clearCache(){this.materialCache.forEach(e=>{e.dispose()}),this.materialCache.clear()}static getGlobalEdgeLineMaterial(){return this.globalEdgeLineMaterial||(this.globalEdgeLineMaterial=this.createEdgeLineMaterial("#000000")),this.globalEdgeLineMaterial}}yc(yt,"materialCache",new Map),yc(yt,"globalEdgeLineMaterial",null);const be=()=>{const t=M.useContext(Sy);if(!t)throw new Error("useSpace3DView must be used within a Space3DViewProvider");return t},Yu=(t,e,n,s,i,r)=>{var o;try{const a=n.getBoundingClientRect(),u=new av;u.x=(t-a.left)/a.width*2-1,u.y=-((e-a.top)/a.height)*2+1;const h=new lv;h.setFromCamera(u,s);const d=[];i.traverse(m=>{var y;((y=m.userData)==null?void 0:y.type)==="slot-collider"&&d.push(m)});const p=h.intersectObjects(d);if(p.length>0){const y=(o=p[0].object.userData)==null?void 0:o.slotIndex,v=gt(r);if(typeof y=="number"&&y>=0&&y<v.columnCount)return y}return null}catch(a){return console.error("Slot raycast detection error:",a),null}},Ba=(t,e)=>{const n=pt(e),s=gt(e),i=ut(t,n,e);return i?Math.abs(i.dimensions.width-s.columnWidth*2)<50:!1},d6=t=>{const e=pt(t),n=gt(t),s=i=>i*.01;return{width:s(n.columnWidth)-1,height:s(e.height),depth:s(e.depth)+1}},f6=t=>{var i;const e=r=>r*.01,n=t.hasFloorFinish&&t.floorFinish?t.floorFinish.height:0,s=((i=t.baseConfig)==null?void 0:i.height)||0;if(!t.baseConfig||t.baseConfig.type==="floor")return e(n+s);if(t.baseConfig.type==="stand")if(t.baseConfig.placementType==="float"){const r=t.baseConfig.floatHeight||0;return e(n+r)}else return e(n);else return e(n)},p6=(t,e,n)=>{const s=gt(n);return Ba(e,n)?s.threeUnitDualPositions&&s.threeUnitDualPositions[t]!==void 0?s.threeUnitDualPositions[t]:(console.error("Dual position not available for slot:",t),null):s.threeUnitPositions[t]},g6=({spaceInfo:t})=>{const e=De(y=>y.placedModules),n=De(y=>y.moveModule),s=De(y=>y.setFurniturePlacementMode),[i,r]=M.useState(null),o=M.useRef(!1),{camera:a,scene:u}=Sh(),h=pt(t),d=(y,v)=>{if(console.log("🖱️ 드래그 시작:",v,"button:",y.button),y.button!==0){console.log("❌ 왼쪽 버튼이 아님, 드래그 취소");return}y.stopPropagation(),r(v),o.current=!0,console.log("✅ 드래그 상태 설정 완료:",{draggingModuleId:v,isDragging:o.current}),s(!0);const w=y.target;w&&w.setPointerCapture&&(w.setPointerCapture(y.pointerId),console.log("📌 포인터 캡처 설정")),document.body.style.cursor="grabbing"},p=y=>{if(!o.current||!i)return;const v=y.nativeEvent.target;let w=Yu(y.nativeEvent.clientX,y.nativeEvent.clientY,v,a,u,t);if(console.log("🎯 드래그 중 레이캐스팅:",{mouseX:y.nativeEvent.clientX,mouseY:y.nativeEvent.clientY,detectedSlot:w}),w!==null){console.log("✅ 슬롯 감지됨:",w);const E=e.find(j=>j.id===i);if(!E)return;const C=ut(E.moduleId,h,t);if(!C)return;const A=gt(t),R=A.columnWidth,N=Math.abs(C.dimensions.width-R*2)<50;if(!lo(w,N,e,t,i)){let j=Ui(w,"right",N,e,t,i);if(j===null&&(j=Ui(w,"left",N,e,t,i)),j!==null)w=j;else return}let k;if(N)if(A.threeUnitDualPositions&&A.threeUnitDualPositions[w]!==void 0)k=A.threeUnitDualPositions[w];else return;else k=A.threeUnitPositions[w];console.log("📍 가구 이동:",{slotIndex:w,finalX:k,currentX:E.position.x,isDualFurniture:N}),n(i,{x:k,y:E.position.y,z:E.position.z})}else console.log("❌ 슬롯 감지 실패")},m=()=>{o.current&&(o.current=!1,r(null),s(!1))};return{draggingModuleId:i,isDragging:o.current,handlePointerDown:d,handlePointerMove:p,handlePointerUp:m}},m6=()=>{const t=De(h=>h.editMode),e=De(h=>h.editingModuleId),n=De(h=>h.setEditMode),s=De(h=>h.setEditingModuleId),i=De(h=>h.removeModule),[r,o]=M.useState(!1),a=M.useRef(!1);return{dragMode:r,setDragMode:o,editMode:t,setEditMode:n,editingModuleId:e,setEditingModuleId:s,handleFurnitureClick:(h,d)=>{a.current||(h.stopPropagation(),r?(i(d),o(!1)):(n(!0),s(d)))},isDragging:a}},_6=({spaceInfo:t})=>{const e=De(d=>d.placedModules),n=De(d=>d.removeModule),s=De(d=>d.moveModule),i=De(d=>d.editMode),r=De(d=>d.editingModuleId),o=De(d=>d.setEditMode),a=De(d=>d.setEditingModuleId),u=pt(t),h=gt(t);M.useEffect(()=>{const d=p=>{if(!i||!r)return;const m=e.find(C=>C.id===r);if(!m)return;const y=ut(m.moduleId,u,t);if(!y)return;const v=h.columnWidth,w=Math.abs(y.dimensions.width-v*2)<50;let E=-1;if(w?h.threeUnitDualPositions&&(E=h.threeUnitDualPositions.findIndex(C=>Math.abs(C-m.position.x)<.1)):E=h.threeUnitPositions.findIndex(C=>Math.abs(C-m.position.x)<.1),E!==-1)switch(p.key){case"Delete":case"Backspace":n(r),o(!1),a(null),p.preventDefault();break;case"ArrowLeft":{const C=Ui(E,"left",w,e,t,r);if(C!==null){let A;w&&h.threeUnitDualPositions?A=h.threeUnitDualPositions[C]:A=h.threeUnitPositions[C],s(r,{...m.position,x:A})}p.preventDefault();break}case"ArrowRight":{const C=Ui(E,"right",w,e,t,r);if(C!==null){let A;w&&h.threeUnitDualPositions?A=h.threeUnitDualPositions[C]:A=h.threeUnitPositions[C],s(r,{...m.position,x:A})}p.preventDefault();break}case"Escape":o(!1),a(null),p.preventDefault();break;case"Enter":o(!1),a(null),p.preventDefault();break}};if(i)return document.addEventListener("keydown",d),()=>{document.removeEventListener("keydown",d)}},[i,r,e,h,n,s,u,t,o,a])},y6=9,Ln=t=>t*.01,rs=(t,e={})=>{const{color:n,internalHeight:s,customDepth:i,isDragging:r=!1}=e,{spaceInfo:o}=Pt(),a=o.materialConfig||{interiorColor:"#FFFFFF",doorColor:"#FFFFFF"},u=t.modelConfig||{basicThickness:18,hasOpenFront:!0,hasShelf:!1,shelfCount:0},h=Ln(u.basicThickness||18),d=Ln(y6),p=Ln(t.dimensions.width),m=Ln(s||t.dimensions.height),y=i||t.dimensions.depth,v=Ln(y),w=p-h*2,E=m-h*2,C=v-Ln(8),A=Ln(4),R=new Rm({color:new it(n||a.interiorColor),clearcoat:.1,clearcoatRoughness:.8,metalness:0,roughness:.7,reflectivity:.2,transparent:r,opacity:r?.4:1}),N=n||a.doorColor,k=(T,_)=>{switch(T.heightType||"percentage"){case"absolute":{const D=Ln(T.height);return Math.min(D,_)}case"percentage":default:return _*(T.height/100)}};return{material:R,doorColor:N,width:p,height:m,depth:v,innerWidth:w,innerHeight:E,actualDepthMm:y,basicThickness:h,backPanelThickness:d,adjustedDepthForShelves:C,shelfZOffset:A,calculateSectionHeight:k,isMultiSectionFurniture:()=>{const{sections:T}=u;return!!(T&&T.length>=2)},getSectionHeights:()=>{const{sections:T}=u;if(!T||T.length===0)return[];const _=m-h*2,D=T.filter(x=>x.heightType==="absolute").reduce((x,V)=>x+k(V,_),0),P=_-D;return T.map(x=>x.heightType==="absolute"?k(x,_):k(x,P))},mmToThreeUnits:Ln,modelConfig:u}},fs=({args:t,position:e,material:n,renderMode:s,isInternalSurface:i=!1})=>{const r=M.useMemo(()=>new ai(...t),[t]),o=M.useMemo(()=>new bh(r),[r]),a=M.useMemo(()=>{if(i&&n instanceof Qt){const u=n.clone();return u.emissive=new it(0),u.roughness=.8,u.envMapIntensity=0,u}return n},[n,i]);return c.jsxs("group",{position:e,children:[s==="solid"&&c.jsx("mesh",{geometry:r,receiveShadow:!0,castShadow:!0,children:c.jsx("primitive",{object:a})}),c.jsx("lineSegments",{geometry:o,children:c.jsx("lineBasicMaterial",{color:"#888888",linewidth:1})})]})},hi=({width:t,height:e,depth:n,innerWidth:s,innerHeight:i,basicThickness:r,backPanelThickness:o,adjustedDepthForShelves:a,shelfZOffset:u,material:h,isMultiSectionFurniture:d,getSectionHeights:p,mmToThreeUnits:m,children:y})=>{const{renderMode:v}=be();return c.jsxs("group",{children:[d()?c.jsx(c.Fragment,{children:p().map((w,E)=>{let C=-e/2+r;for(let R=0;R<E;R++)C+=p()[R];const A=C+w/2-r;return c.jsxs(et.Fragment,{children:[c.jsx(fs,{args:[r,w,n],position:[-t/2+r/2,A,0],material:h,renderMode:v}),c.jsx(fs,{args:[r,w,n],position:[t/2-r/2,A,0],material:h,renderMode:v}),E<p().length-1&&c.jsx(fs,{args:[s,r,a-r],position:[0,A+w/2+r/2,r/2+u],material:h,renderMode:v})]},`side-panels-${E}`)})}):c.jsxs(c.Fragment,{children:[c.jsx(fs,{args:[r,e,n],position:[-t/2+r/2,0,0],material:h,renderMode:v}),c.jsx(fs,{args:[r,e,n],position:[t/2-r/2,0,0],material:h,renderMode:v})]}),c.jsx(fs,{args:[s,r,n],position:[0,e/2-r/2,0],material:h,renderMode:v,isInternalSurface:!0}),c.jsx(fs,{args:[s,r,n],position:[0,-e/2+r/2,0],material:h,renderMode:v,isInternalSurface:!0}),c.jsx(fs,{args:[s+m(10),i+m(10),o],position:[0,0,-n/2+o/2+m(17)],material:h,renderMode:v,isInternalSurface:!0}),y]})},jc=({args:t,position:e,material:n,renderMode:s})=>{const r=(o=>{if(o instanceof Qt){const a=o.clone();return a.roughness=.6,a.envMapIntensity=0,a.emissive=new it(0),a}return n})(n);return c.jsxs("group",{position:e,children:[s==="solid"&&c.jsxs("mesh",{receiveShadow:!0,castShadow:!0,children:[c.jsx("boxGeometry",{args:t}),c.jsx("primitive",{object:r})]}),c.jsxs("lineSegments",{children:[c.jsx("edgesGeometry",{args:[new ai(...t)]}),c.jsx("lineBasicMaterial",{color:"#888888",linewidth:1})]})]})},Ii=({shelfCount:t,innerWidth:e,innerHeight:n,depth:s,basicThickness:i,material:r,yOffset:o=0,zOffset:a=0,shelfPositions:u,isTopFinishPanel:h,renderMode:d})=>{if(t<=0)return null;const p=y=>y*.01;if(h&&t===1){const y=n/2-i/2;return c.jsx("group",{position:[0,o,0],children:c.jsx(jc,{args:[e,i,s-i],position:[0,y,i/2+a],material:r,renderMode:d})})}if(u&&u.length===t)return c.jsx("group",{position:[0,o,0],children:u.map((y,v)=>{const w=-n/2+p(y);return c.jsx(jc,{args:[e,i,s-i],position:[0,w,i/2+a],material:r,renderMode:d},`shelf-${v}`)})});const m=n/(t+1);return c.jsx("group",{position:[0,o,0],children:Array.from({length:t},(y,v)=>{const w=-n/2+m*(v+1);return c.jsx(jc,{args:[e,i,s-i],position:[0,w,i/2+a],material:r,renderMode:d},`shelf-${v}`)})})},vi=({args:t,position:e,material:n,renderMode:s})=>{const r=(o=>{if(o instanceof Qt){const a=o.clone();return a.roughness=.6,a.envMapIntensity=0,a.emissive=new it(0),a}return n})(n);return c.jsxs("group",{position:e,children:[s==="solid"&&c.jsxs("mesh",{receiveShadow:!0,castShadow:!0,children:[c.jsx("boxGeometry",{args:t}),c.jsx("primitive",{object:r})]}),c.jsxs("lineSegments",{children:[c.jsx("edgesGeometry",{args:[new ai(...t)]}),c.jsx("lineBasicMaterial",{color:"#888888",linewidth:1})]})]})},xd=({drawerCount:t,innerWidth:e,innerHeight:n,depth:s,basicThickness:i,yOffset:r=0,drawerHeights:o,gapHeight:a=0,material:u,renderMode:h})=>{if(t<=0)return null;const d=v=>v*.01,p=d(0),m=d(20),y=(v,w,E,C,A)=>{const[R,N,k]=C,j=E-d(47),I=j-m,T=k-m/2;return c.jsxs("group",{children:[c.jsx(vi,{args:[v-d(76)-d(26),d(5),I-d(26)],position:[R,N-w/2+i+d(15)+d(5)/2,T],material:u,renderMode:h}),c.jsx(vi,{args:[v-d(76),w-d(30),i],position:[R,N,T+I/2-i/2],material:u,renderMode:h}),c.jsx(vi,{args:[v-d(76),w-d(30),i],position:[R,N,T-I/2+i/2],material:u,renderMode:h}),c.jsx(vi,{args:[i,w-d(30),I-i*2],position:[R-v/2+i/2+d(38),N,T],material:u,renderMode:h}),c.jsx(vi,{args:[i,w-d(30),I-i*2],position:[R+v/2-i/2-d(38),N,T],material:u,renderMode:h}),c.jsx(vi,{args:[v,w,m],position:[R,N,k+j/2-m/2],material:u,renderMode:h})]},A)};if(o&&o.length===t&&a>0){let v=-n/2;return v+=d(a),c.jsx("group",{position:[0,r,p],children:o.map((w,E)=>{const C=v+d(w)/2,A=y(e-d(24),d(w)-i/2,s-i,[0,C,i/2],`custom-drawer-${E}`);return v+=d(w+a),A})})}else{const v=n/t;return c.jsx("group",{position:[0,r,p],children:Array.from({length:t},(w,E)=>{const C=-n/2+(E+.5)*v;return y(e-d(24),v-i/2,s-i,[0,C,i/2],`drawer-${E}`)})})}},di=({modelConfig:t,height:e,innerWidth:n,depth:s,adjustedDepthForShelves:i,basicThickness:r,shelfZOffset:o,material:a,renderMode:u,calculateSectionHeight:h})=>{const d=()=>{const{sections:p}=t;if(!p||p.length===0)return null;const m=e-r*2,v=p.filter(A=>A.heightType==="absolute").reduce((A,R)=>A+h(R,m),0),w=m-v,E=p.map(A=>({...A,calculatedHeight:A.heightType==="absolute"?h(A,m):h(A,w)}));let C=-e/2+r;return E.map((A,R)=>{const N=A.calculatedHeight,k=C+N/2;let j=null;switch(A.type){case"shelf":A.count&&A.count>0&&(j=c.jsx(Ii,{shelfCount:A.count,innerWidth:n,innerHeight:N,depth:i,basicThickness:r,material:a,yOffset:k,zOffset:o,shelfPositions:A.shelfPositions,isTopFinishPanel:A.isTopFinishPanel,renderMode:u}));break;case"hanging":A.count&&A.count>0&&(j=c.jsx(Ii,{shelfCount:A.count,innerWidth:n,innerHeight:N,depth:i,basicThickness:r,material:a,yOffset:k,zOffset:o,shelfPositions:A.shelfPositions,isTopFinishPanel:A.isTopFinishPanel,renderMode:u}));break;case"drawer":A.count&&A.count>0&&(j=c.jsx(xd,{drawerCount:A.count,innerWidth:n,innerHeight:N,depth:s,basicThickness:r,yOffset:k,drawerHeights:A.drawerHeights,gapHeight:A.gapHeight,material:a,renderMode:u}));break}return C+=N,c.jsx("group",{children:j},`section-${R}`)})};return c.jsx(c.Fragment,{children:d()})};var Id=jo(),ge=t=>Mo(t,Id),Sd=jo();ge.write=t=>Mo(t,Sd);var Yl=jo();ge.onStart=t=>Mo(t,Yl);var bd=jo();ge.onFrame=t=>Mo(t,bd);var Cd=jo();ge.onFinish=t=>Mo(t,Cd);var Ri=[];ge.setTimeout=(t,e)=>{const n=ge.now()+e,s=()=>{const r=Ri.findIndex(o=>o.cancel==s);~r&&Ri.splice(r,1),ws-=~r?1:0},i={time:n,handler:t,cancel:s};return Ri.splice(by(n),0,i),ws+=1,Cy(),i};var by=t=>~(~Ri.findIndex(e=>e.time>t)||~Ri.length);ge.cancel=t=>{Yl.delete(t),bd.delete(t),Cd.delete(t),Id.delete(t),Sd.delete(t)};ge.sync=t=>{qu=!0,ge.batchedUpdates(t),qu=!1};ge.throttle=t=>{let e;function n(){try{t(...e)}finally{e=null}}function s(...i){e=i,ge.onStart(n)}return s.handler=t,s.cancel=()=>{Yl.delete(n),e=null},s};var Dd=typeof window<"u"?window.requestAnimationFrame:()=>{};ge.use=t=>Dd=t;ge.now=typeof performance<"u"?()=>performance.now():Date.now;ge.batchedUpdates=t=>t();ge.catch=console.error;ge.frameLoop="always";ge.advance=()=>{ge.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):Py()};var vs=-1,ws=0,qu=!1;function Mo(t,e){qu?(e.delete(t),t(0)):(e.add(t),Cy())}function Cy(){vs<0&&(vs=0,ge.frameLoop!=="demand"&&Dd(Dy))}function v6(){vs=-1}function Dy(){~vs&&(Dd(Dy),ge.batchedUpdates(Py))}function Py(){const t=vs;vs=ge.now();const e=by(vs);if(e&&(Ry(Ri.splice(0,e),n=>n.handler()),ws-=e),!ws){v6();return}Yl.flush(),Id.flush(t?Math.min(64,vs-t):16.667),bd.flush(),Sd.flush(),Cd.flush()}function jo(){let t=new Set,e=t;return{add(n){ws+=e==t&&!t.has(n)?1:0,t.add(n)},delete(n){return ws-=e==t&&t.has(n)?1:0,t.delete(n)},flush(n){e.size&&(t=new Set,ws-=e.size,Ry(e,s=>s(n)&&t.add(s)),ws+=t.size,e=t)}}}function Ry(t,e){t.forEach(n=>{try{e(n)}catch(s){ge.catch(s)}})}var w6=Object.defineProperty,T6=(t,e)=>{for(var n in e)w6(t,n,{get:e[n],enumerable:!0})},fn={};T6(fn,{assign:()=>A6,colors:()=>Ss,createStringInterpolator:()=>Rd,skipAnimation:()=>My,to:()=>Ny,willAdvance:()=>Nd});function Ku(){}var E6=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),z={arr:Array.isArray,obj:t=>!!t&&t.constructor.name==="Object",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",und:t=>t===void 0};function Hn(t,e){if(z.arr(t)){if(!z.arr(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return t===e}var Ne=(t,e)=>t.forEach(e);function ts(t,e,n){if(z.arr(t)){for(let s=0;s<t.length;s++)e.call(n,t[s],`${s}`);return}for(const s in t)t.hasOwnProperty(s)&&e.call(n,t[s],s)}var tn=t=>z.und(t)?[]:z.arr(t)?t:[t];function Gr(t,e){if(t.size){const n=Array.from(t);t.clear(),Ne(n,e)}}var Lr=(t,...e)=>Gr(t,n=>n(...e)),Pd=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Rd,Ny,Ss=null,My=!1,Nd=Ku,A6=t=>{t.to&&(Ny=t.to),t.now&&(ge.now=t.now),t.colors!==void 0&&(Ss=t.colors),t.skipAnimation!=null&&(My=t.skipAnimation),t.createStringInterpolator&&(Rd=t.createStringInterpolator),t.requestAnimationFrame&&ge.use(t.requestAnimationFrame),t.batchedUpdates&&(ge.batchedUpdates=t.batchedUpdates),t.willAdvance&&(Nd=t.willAdvance),t.frameLoop&&(ge.frameLoop=t.frameLoop)},zr=new Set,en=[],Lc=[],cl=0,ql={get idle(){return!zr.size&&!en.length},start(t){cl>t.priority?(zr.add(t),ge.onStart(x6)):(jy(t),ge(Qu))},advance:Qu,sort(t){if(cl)ge.onFrame(()=>ql.sort(t));else{const e=en.indexOf(t);~e&&(en.splice(e,1),Ly(t))}},clear(){en=[],zr.clear()}};function x6(){zr.forEach(jy),zr.clear(),ge(Qu)}function jy(t){en.includes(t)||Ly(t)}function Ly(t){en.splice(I6(en,e=>e.priority>t.priority),0,t)}function Qu(t){const e=Lc;for(let n=0;n<en.length;n++){const s=en[n];cl=s.priority,s.idle||(Nd(s),s.advance(t),s.idle||e.push(s))}return cl=0,Lc=en,Lc.length=0,en=e,en.length>0}function I6(t,e){const n=t.findIndex(e);return n<0?t.length:n}var S6={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},ln="[-+]?\\d*\\.?\\d+",ul=ln+"%";function Kl(...t){return"\\(\\s*("+t.join(")\\s*,\\s*(")+")\\s*\\)"}var b6=new RegExp("rgb"+Kl(ln,ln,ln)),C6=new RegExp("rgba"+Kl(ln,ln,ln,ln)),D6=new RegExp("hsl"+Kl(ln,ul,ul)),P6=new RegExp("hsla"+Kl(ln,ul,ul,ln)),R6=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,N6=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,M6=/^#([0-9a-fA-F]{6})$/,j6=/^#([0-9a-fA-F]{8})$/;function L6(t){let e;return typeof t=="number"?t>>>0===t&&t>=0&&t<=4294967295?t:null:(e=M6.exec(t))?parseInt(e[1]+"ff",16)>>>0:Ss&&Ss[t]!==void 0?Ss[t]:(e=b6.exec(t))?(wi(e[1])<<24|wi(e[2])<<16|wi(e[3])<<8|255)>>>0:(e=C6.exec(t))?(wi(e[1])<<24|wi(e[2])<<16|wi(e[3])<<8|xg(e[4]))>>>0:(e=R6.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=j6.exec(t))?parseInt(e[1],16)>>>0:(e=N6.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=D6.exec(t))?(Eg(Ag(e[1]),aa(e[2]),aa(e[3]))|255)>>>0:(e=P6.exec(t))?(Eg(Ag(e[1]),aa(e[2]),aa(e[3]))|xg(e[4]))>>>0:null}function kc(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function Eg(t,e,n){const s=n<.5?n*(1+e):n+e-n*e,i=2*n-s,r=kc(i,s,t+1/3),o=kc(i,s,t),a=kc(i,s,t-1/3);return Math.round(r*255)<<24|Math.round(o*255)<<16|Math.round(a*255)<<8}function wi(t){const e=parseInt(t,10);return e<0?0:e>255?255:e}function Ag(t){return(parseFloat(t)%360+360)%360/360}function xg(t){const e=parseFloat(t);return e<0?0:e>1?255:Math.round(e*255)}function aa(t){const e=parseFloat(t);return e<0?0:e>100?1:e/100}function Ig(t){let e=L6(t);if(e===null)return t;e=e||0;const n=(e&4278190080)>>>24,s=(e&16711680)>>>16,i=(e&65280)>>>8,r=(e&255)/255;return`rgba(${n}, ${s}, ${i}, ${r})`}var co=(t,e,n)=>{if(z.fun(t))return t;if(z.arr(t))return co({range:t,output:e,extrapolate:n});if(z.str(t.output[0]))return Rd(t);const s=t,i=s.output,r=s.range||[0,1],o=s.extrapolateLeft||s.extrapolate||"extend",a=s.extrapolateRight||s.extrapolate||"extend",u=s.easing||(h=>h);return h=>{const d=F6(h,r);return k6(h,r[d],r[d+1],i[d],i[d+1],u,o,a,s.map)}};function k6(t,e,n,s,i,r,o,a,u){let h=u?u(t):t;if(h<e){if(o==="identity")return h;o==="clamp"&&(h=e)}if(h>n){if(a==="identity")return h;a==="clamp"&&(h=n)}return s===i?s:e===n?t<=e?s:i:(e===-1/0?h=-h:n===1/0?h=h-e:h=(h-e)/(n-e),h=r(h),s===-1/0?h=-h:i===1/0?h=h+s:h=h*(i-s)+s,h)}function F6(t,e){for(var n=1;n<e.length-1&&!(e[n]>=t);++n);return n-1}var O6={linear:t=>t},uo=Symbol.for("FluidValue.get"),$i=Symbol.for("FluidValue.observers"),En=t=>!!(t&&t[uo]),Kt=t=>t&&t[uo]?t[uo]():t,Sg=t=>t[$i]||null;function V6(t,e){t.eventObserved?t.eventObserved(e):t(e)}function hl(t,e){const n=t[$i];n&&n.forEach(s=>{V6(s,e)})}var B6=class{constructor(t){if(!t&&!(t=this.get))throw Error("Unknown getter");U6(this,t)}},U6=(t,e)=>ky(t,uo,e);function Lo(t,e){if(t[uo]){let n=t[$i];n||ky(t,$i,n=new Set),n.has(e)||(n.add(e),t.observerAdded&&t.observerAdded(n.size,e))}return e}function dl(t,e){const n=t[$i];if(n&&n.has(e)){const s=n.size-1;s?n.delete(e):t[$i]=null,t.observerRemoved&&t.observerRemoved(s,e)}}var ky=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),Ua=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,$6=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,bg=new RegExp(`(${Ua.source})(%|[a-z]+)`,"i"),H6=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,Ql=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,Fy=t=>{const[e,n]=W6(t);if(!e||Pd())return t;const s=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(s)return s.trim();if(n&&n.startsWith("--")){const i=window.getComputedStyle(document.documentElement).getPropertyValue(n);return i||t}else{if(n&&Ql.test(n))return Fy(n);if(n)return n}return t},W6=t=>{const e=Ql.exec(t);if(!e)return[,];const[,n,s]=e;return[n,s]},Fc,X6=(t,e,n,s,i)=>`rgba(${Math.round(e)}, ${Math.round(n)}, ${Math.round(s)}, ${i})`,Oy=t=>{Fc||(Fc=Ss?new RegExp(`(${Object.keys(Ss).join("|")})(?!\\w)`,"g"):/^\b$/);const e=t.output.map(r=>Kt(r).replace(Ql,Fy).replace($6,Ig).replace(Fc,Ig)),n=e.map(r=>r.match(Ua).map(Number)),i=n[0].map((r,o)=>n.map(a=>{if(!(o in a))throw Error('The arity of each "output" value must be equal');return a[o]})).map(r=>co({...t,output:r}));return r=>{var u;const o=!bg.test(e[0])&&((u=e.find(h=>bg.test(h)))==null?void 0:u.replace(Ua,""));let a=0;return e[0].replace(Ua,()=>`${i[a++](r)}${o||""}`).replace(H6,X6)}},Md="react-spring: ",Vy=t=>{const e=t;let n=!1;if(typeof e!="function")throw new TypeError(`${Md}once requires a function parameter`);return(...s)=>{n||(e(...s),n=!0)}},G6=Vy(console.warn);function z6(){G6(`${Md}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var Y6=Vy(console.warn);function q6(){Y6(`${Md}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function Jl(t){return z.str(t)&&(t[0]=="#"||/\d/.test(t)||!Pd()&&Ql.test(t)||t in(Ss||{}))}var jd=Pd()?M.useEffect:M.useLayoutEffect,K6=()=>{const t=M.useRef(!1);return jd(()=>(t.current=!0,()=>{t.current=!1}),[]),t};function By(){const t=M.useState()[1],e=K6();return()=>{e.current&&t(Math.random())}}var Uy=t=>M.useEffect(t,Q6),Q6=[];function Cg(t){const e=M.useRef(void 0);return M.useEffect(()=>{e.current=t}),e.current}var ho=Symbol.for("Animated:node"),J6=t=>!!t&&t[ho]===t,Tn=t=>t&&t[ho],Ld=(t,e)=>E6(t,ho,e),Zl=t=>t&&t[ho]&&t[ho].getPayload(),$y=class{constructor(){Ld(this,this)}getPayload(){return this.payload||[]}},ec=class Hy extends $y{constructor(e){super(),this._value=e,this.done=!0,this.durationProgress=0,z.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new Hy(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,n){return z.num(e)&&(this.lastPosition=e,n&&(e=Math.round(e/n)*n,this.done&&(this.lastPosition=e))),this._value===e?!1:(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,z.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}},fl=class Wy extends ec{constructor(e){super(0),this._string=null,this._toString=co({output:[e,e]})}static create(e){return new Wy(e)}getValue(){const e=this._string;return e??(this._string=this._toString(this._value))}setValue(e){if(z.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else if(super.setValue(e))this._string=null;else return!1;return!0}reset(e){e&&(this._toString=co({output:[this.getValue(),e]})),this._value=0,super.reset()}},pl={dependencies:null},kd=class extends $y{constructor(t){super(),this.source=t,this.setValue(t)}getValue(t){const e={};return ts(this.source,(n,s)=>{J6(n)?e[s]=n.getValue(t):En(n)?e[s]=Kt(n):t||(e[s]=n)}),e}setValue(t){this.source=t,this.payload=this._makePayload(t)}reset(){this.payload&&Ne(this.payload,t=>t.reset())}_makePayload(t){if(t){const e=new Set;return ts(t,this._addToPayload,e),Array.from(e)}}_addToPayload(t){pl.dependencies&&En(t)&&pl.dependencies.add(t);const e=Zl(t);e&&Ne(e,n=>this.add(n))}},Z6=class Xy extends kd{constructor(e){super(e)}static create(e){return new Xy(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){const n=this.getPayload();return e.length==n.length?n.map((s,i)=>s.setValue(e[i])).some(Boolean):(super.setValue(e.map(e5)),!0)}};function e5(t){return(Jl(t)?fl:ec).create(t)}function Ju(t){const e=Tn(t);return e?e.constructor:z.arr(t)?Z6:Jl(t)?fl:ec}var Dg=(t,e)=>{const n=!z.fun(t)||t.prototype&&t.prototype.isReactComponent;return M.forwardRef((s,i)=>{const r=M.useRef(null),o=n&&M.useCallback(v=>{r.current=s5(i,v)},[i]),[a,u]=n5(s,e),h=By(),d=()=>{const v=r.current;if(n&&!v)return;(v?e.applyAnimatedValues(v,a.getValue(!0)):!1)===!1&&h()},p=new t5(d,u),m=M.useRef(void 0);jd(()=>(m.current=p,Ne(u,v=>Lo(v,p)),()=>{m.current&&(Ne(m.current.deps,v=>dl(v,m.current)),ge.cancel(m.current.update))})),M.useEffect(d,[]),Uy(()=>()=>{const v=m.current;Ne(v.deps,w=>dl(w,v))});const y=e.getComponentProps(a.getValue());return M.createElement(t,{...y,ref:o})})},t5=class{constructor(t,e){this.update=t,this.deps=e}eventObserved(t){t.type=="change"&&ge.write(this.update)}};function n5(t,e){const n=new Set;return pl.dependencies=n,t.style&&(t={...t,style:e.createAnimatedStyle(t.style)}),t=new kd(t),pl.dependencies=null,[t,n]}function s5(t,e){return t&&(z.fun(t)?t(e):t.current=e),e}var Pg=Symbol.for("AnimatedComponent"),i5=(t,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:n=i=>new kd(i),getComponentProps:s=i=>i}={})=>{const i={applyAnimatedValues:e,createAnimatedStyle:n,getComponentProps:s},r=o=>{const a=Rg(o)||"Anonymous";return z.str(o)?o=r[o]||(r[o]=Dg(o,i)):o=o[Pg]||(o[Pg]=Dg(o,i)),o.displayName=`Animated(${a})`,o};return ts(t,(o,a)=>{z.arr(t)&&(a=Rg(o)),r[a]=r(o)}),{animated:r}},Rg=t=>z.str(t)?t:t&&z.str(t.displayName)?t.displayName:z.fun(t)&&t.name||null;function Ks(t,...e){return z.fun(t)?t(...e):t}var Yr=(t,e)=>t===!0||!!(e&&t&&(z.fun(t)?t(e):tn(t).includes(e))),Gy=(t,e)=>z.obj(t)?e&&t[e]:t,zy=(t,e)=>t.default===!0?t[e]:t.default?t.default[e]:void 0,r5=t=>t,Fd=(t,e=r5)=>{let n=o5;t.default&&t.default!==!0&&(t=t.default,n=Object.keys(t));const s={};for(const i of n){const r=e(t[i],i);z.und(r)||(s[i]=r)}return s},o5=["config","onProps","onStart","onChange","onPause","onResume","onRest"],a5={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function l5(t){const e={};let n=0;if(ts(t,(s,i)=>{a5[i]||(e[i]=s,n++)}),n)return e}function Yy(t){const e=l5(t);if(e){const n={to:e};return ts(t,(s,i)=>i in e||(n[i]=s)),n}return{...t}}function fo(t){return t=Kt(t),z.arr(t)?t.map(fo):Jl(t)?fn.createStringInterpolator({range:[0,1],output:[t,t]})(1):t}function c5(t){for(const e in t)return!0;return!1}function Zu(t){return z.fun(t)||z.arr(t)&&z.obj(t[0])}function u5(t,e){var n;(n=t.ref)==null||n.delete(t),e==null||e.delete(t)}function h5(t,e){var n;e&&t.ref!==e&&((n=t.ref)==null||n.delete(t),e.add(t),t.ref=e)}var d5={default:{tension:170,friction:26}},eh={...d5.default,mass:1,damping:1,easing:O6.linear,clamp:!1},f5=class{constructor(){this.velocity=0,Object.assign(this,eh)}};function p5(t,e,n){n&&(n={...n},Ng(n,e),e={...n,...e}),Ng(t,e),Object.assign(t,e);for(const o in eh)t[o]==null&&(t[o]=eh[o]);let{frequency:s,damping:i}=t;const{mass:r}=t;return z.und(s)||(s<.01&&(s=.01),i<0&&(i=0),t.tension=Math.pow(2*Math.PI/s,2)*r,t.friction=4*Math.PI*i*r/s),t}function Ng(t,e){if(!z.und(e.decay))t.duration=void 0;else{const n=!z.und(e.tension)||!z.und(e.friction);(n||!z.und(e.frequency)||!z.und(e.damping)||!z.und(e.mass))&&(t.duration=void 0,t.decay=void 0),n&&(t.frequency=void 0)}}var Mg=[],g5=class{constructor(){this.changed=!1,this.values=Mg,this.toValues=null,this.fromValues=Mg,this.config=new f5,this.immediate=!1}};function qy(t,{key:e,props:n,defaultProps:s,state:i,actions:r}){return new Promise((o,a)=>{let u,h,d=Yr(n.cancel??(s==null?void 0:s.cancel),e);if(d)y();else{z.und(n.pause)||(i.paused=Yr(n.pause,e));let v=s==null?void 0:s.pause;v!==!0&&(v=i.paused||Yr(v,e)),u=Ks(n.delay||0,e),v?(i.resumeQueue.add(m),r.pause()):(r.resume(),m())}function p(){i.resumeQueue.add(m),i.timeouts.delete(h),h.cancel(),u=h.time-ge.now()}function m(){u>0&&!fn.skipAnimation?(i.delayed=!0,h=ge.setTimeout(y,u),i.pauseQueue.add(p),i.timeouts.add(h)):y()}function y(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(p),i.timeouts.delete(h),t<=(i.cancelId||0)&&(d=!0);try{r.start({...n,callId:t,cancel:d},o)}catch(v){a(v)}}})}var Od=(t,e)=>e.length==1?e[0]:e.some(n=>n.cancelled)?Ni(t.get()):e.every(n=>n.noop)?Ky(t.get()):on(t.get(),e.every(n=>n.finished)),Ky=t=>({value:t,noop:!0,finished:!0,cancelled:!1}),on=(t,e,n=!1)=>({value:t,finished:e,cancelled:n}),Ni=t=>({value:t,cancelled:!0,finished:!1});function Qy(t,e,n,s){const{callId:i,parentId:r,onRest:o}=e,{asyncTo:a,promise:u}=n;return!r&&t===a&&!e.reset?u:n.promise=(async()=>{n.asyncId=i,n.asyncTo=t;const h=Fd(e,(E,C)=>C==="onRest"?void 0:E);let d,p;const m=new Promise((E,C)=>(d=E,p=C)),y=E=>{const C=i<=(n.cancelId||0)&&Ni(s)||i!==n.asyncId&&on(s,!1);if(C)throw E.result=C,p(E),E},v=(E,C)=>{const A=new jg,R=new Lg;return(async()=>{if(fn.skipAnimation)throw po(n),R.result=on(s,!1),p(R),R;y(A);const N=z.obj(E)?{...E}:{...C,to:E};N.parentId=i,ts(h,(j,I)=>{z.und(N[I])&&(N[I]=j)});const k=await s.start(N);return y(A),n.paused&&await new Promise(j=>{n.resumeQueue.add(j)}),k})()};let w;if(fn.skipAnimation)return po(n),on(s,!1);try{let E;z.arr(t)?E=(async C=>{for(const A of C)await v(A)})(t):E=Promise.resolve(t(v,s.stop.bind(s))),await Promise.all([E.then(d),m]),w=on(s.get(),!0,!1)}catch(E){if(E instanceof jg)w=E.result;else if(E instanceof Lg)w=E.result;else throw E}finally{i==n.asyncId&&(n.asyncId=r,n.asyncTo=r?a:void 0,n.promise=r?u:void 0)}return z.fun(o)&&ge.batchedUpdates(()=>{o(w,s,s.item)}),w})()}function po(t,e){Gr(t.timeouts,n=>n.cancel()),t.pauseQueue.clear(),t.resumeQueue.clear(),t.asyncId=t.asyncTo=t.promise=void 0,e&&(t.cancelId=e)}var jg=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},Lg=class extends Error{constructor(){super("SkipAnimationSignal")}},th=t=>t instanceof Vd,m5=1,Vd=class extends B6{constructor(){super(...arguments),this.id=m5++,this._priority=0}get priority(){return this._priority}set priority(t){this._priority!=t&&(this._priority=t,this._onPriorityChange(t))}get(){const t=Tn(this);return t&&t.getValue()}to(...t){return fn.to(this,t)}interpolate(...t){return z6(),fn.to(this,t)}toJSON(){return this.get()}observerAdded(t){t==1&&this._attach()}observerRemoved(t){t==0&&this._detach()}_attach(){}_detach(){}_onChange(t,e=!1){hl(this,{type:"change",parent:this,value:t,idle:e})}_onPriorityChange(t){this.idle||ql.sort(this),hl(this,{type:"priority",parent:this,priority:t})}},oi=Symbol.for("SpringPhase"),Jy=1,nh=2,sh=4,Oc=t=>(t[oi]&Jy)>0,ps=t=>(t[oi]&nh)>0,wr=t=>(t[oi]&sh)>0,kg=(t,e)=>e?t[oi]|=nh|Jy:t[oi]&=~nh,Fg=(t,e)=>e?t[oi]|=sh:t[oi]&=~sh,_5=class extends Vd{constructor(t,e){if(super(),this.animation=new g5,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!z.und(t)||!z.und(e)){const n=z.obj(t)?{...t}:{...e,from:t};z.und(n.default)&&(n.default=!0),this.start(n)}}get idle(){return!(ps(this)||this._state.asyncTo)||wr(this)}get goal(){return Kt(this.animation.to)}get velocity(){const t=Tn(this);return t instanceof ec?t.lastVelocity||0:t.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return Oc(this)}get isAnimating(){return ps(this)}get isPaused(){return wr(this)}get isDelayed(){return this._state.delayed}advance(t){let e=!0,n=!1;const s=this.animation;let{toValues:i}=s;const{config:r}=s,o=Zl(s.to);!o&&En(s.to)&&(i=tn(Kt(s.to))),s.values.forEach((h,d)=>{if(h.done)return;const p=h.constructor==fl?1:o?o[d].lastPosition:i[d];let m=s.immediate,y=p;if(!m){if(y=h.lastPosition,r.tension<=0){h.done=!0;return}let v=h.elapsedTime+=t;const w=s.fromValues[d],E=h.v0!=null?h.v0:h.v0=z.arr(r.velocity)?r.velocity[d]:r.velocity;let C;const A=r.precision||(w==p?.005:Math.min(1,Math.abs(p-w)*.001));if(z.und(r.duration))if(r.decay){const R=r.decay===!0?.998:r.decay,N=Math.exp(-(1-R)*v);y=w+E/(1-R)*(1-N),m=Math.abs(h.lastPosition-y)<=A,C=E*N}else{C=h.lastVelocity==null?E:h.lastVelocity;const R=r.restVelocity||A/10,N=r.clamp?0:r.bounce,k=!z.und(N),j=w==p?h.v0>0:w<p;let I,T=!1;const _=1,S=Math.ceil(t/_);for(let D=0;D<S&&(I=Math.abs(C)>R,!(!I&&(m=Math.abs(p-y)<=A,m)));++D){k&&(T=y==p||y>p==j,T&&(C=-C*N,y=p));const P=-r.tension*1e-6*(y-p),x=-r.friction*.001*C,V=(P+x)/r.mass;C=C+V*_,y=y+C*_}}else{let R=1;r.duration>0&&(this._memoizedDuration!==r.duration&&(this._memoizedDuration=r.duration,h.durationProgress>0&&(h.elapsedTime=r.duration*h.durationProgress,v=h.elapsedTime+=t)),R=(r.progress||0)+v/this._memoizedDuration,R=R>1?1:R<0?0:R,h.durationProgress=R),y=w+r.easing(R)*(p-w),C=(y-h.lastPosition)/t,m=R==1}h.lastVelocity=C,Number.isNaN(y)&&(console.warn("Got NaN while animating:",this),m=!0)}o&&!o[d].done&&(m=!1),m?h.done=!0:e=!1,h.setValue(y,r.round)&&(n=!0)});const a=Tn(this),u=a.getValue();if(e){const h=Kt(s.to);(u!==h||n)&&!r.decay?(a.setValue(h),this._onChange(h)):n&&r.decay&&this._onChange(u),this._stop()}else n&&this._onChange(u)}set(t){return ge.batchedUpdates(()=>{this._stop(),this._focus(t),this._set(t)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(ps(this)){const{to:t,config:e}=this.animation;ge.batchedUpdates(()=>{this._onStart(),e.decay||this._set(t,!1),this._stop()})}return this}update(t){return(this.queue||(this.queue=[])).push(t),this}start(t,e){let n;return z.und(t)?(n=this.queue||[],this.queue=[]):n=[z.obj(t)?t:{...e,to:t}],Promise.all(n.map(s=>this._update(s))).then(s=>Od(this,s))}stop(t){const{to:e}=this.animation;return this._focus(this.get()),po(this._state,t&&this._lastCallId),ge.batchedUpdates(()=>this._stop(e,t)),this}reset(){this._update({reset:!0})}eventObserved(t){t.type=="change"?this._start():t.type=="priority"&&(this.priority=t.priority+1)}_prepareNode(t){const e=this.key||"";let{to:n,from:s}=t;n=z.obj(n)?n[e]:n,(n==null||Zu(n))&&(n=void 0),s=z.obj(s)?s[e]:s,s==null&&(s=void 0);const i={to:n,from:s};return Oc(this)||(t.reverse&&([n,s]=[s,n]),s=Kt(s),z.und(s)?Tn(this)||this._set(n):this._set(s)),i}_update({...t},e){const{key:n,defaultProps:s}=this;t.default&&Object.assign(s,Fd(t,(o,a)=>/^on/.test(a)?Gy(o,n):o)),Vg(this,t,"onProps"),Er(this,"onProps",t,this);const i=this._prepareNode(t);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const r=this._state;return qy(++this._lastCallId,{key:n,props:t,defaultProps:s,state:r,actions:{pause:()=>{wr(this)||(Fg(this,!0),Lr(r.pauseQueue),Er(this,"onPause",on(this,Tr(this,this.animation.to)),this))},resume:()=>{wr(this)&&(Fg(this,!1),ps(this)&&this._resume(),Lr(r.resumeQueue),Er(this,"onResume",on(this,Tr(this,this.animation.to)),this))},start:this._merge.bind(this,i)}}).then(o=>{if(t.loop&&o.finished&&!(e&&o.noop)){const a=Zy(t);if(a)return this._update(a,!0)}return o})}_merge(t,e,n){if(e.cancel)return this.stop(!0),n(Ni(this));const s=!z.und(t.to),i=!z.und(t.from);if(s||i)if(e.callId>this._lastToId)this._lastToId=e.callId;else return n(Ni(this));const{key:r,defaultProps:o,animation:a}=this,{to:u,from:h}=a;let{to:d=u,from:p=h}=t;i&&!s&&(!e.default||z.und(d))&&(d=p),e.reverse&&([d,p]=[p,d]);const m=!Hn(p,h);m&&(a.from=p),p=Kt(p);const y=!Hn(d,u);y&&this._focus(d);const v=Zu(e.to),{config:w}=a,{decay:E,velocity:C}=w;(s||i)&&(w.velocity=0),e.config&&!v&&p5(w,Ks(e.config,r),e.config!==o.config?Ks(o.config,r):void 0);let A=Tn(this);if(!A||z.und(d))return n(on(this,!0));const R=z.und(e.reset)?i&&!e.default:!z.und(p)&&Yr(e.reset,r),N=R?p:this.get(),k=fo(d),j=z.num(k)||z.arr(k)||Jl(k),I=!v&&(!j||Yr(o.immediate||e.immediate,r));if(y){const D=Ju(d);if(D!==A.constructor)if(I)A=this._set(k);else throw Error(`Cannot animate between ${A.constructor.name} and ${D.name}, as the "to" prop suggests`)}const T=A.constructor;let _=En(d),S=!1;if(!_){const D=R||!Oc(this)&&m;(y||D)&&(S=Hn(fo(N),k),_=!S),(!Hn(a.immediate,I)&&!I||!Hn(w.decay,E)||!Hn(w.velocity,C))&&(_=!0)}if(S&&ps(this)&&(a.changed&&!R?_=!0:_||this._stop(u)),!v&&((_||En(u))&&(a.values=A.getPayload(),a.toValues=En(d)?null:T==fl?[1]:tn(k)),a.immediate!=I&&(a.immediate=I,!I&&!R&&this._set(u)),_)){const{onRest:D}=a;Ne(v5,x=>Vg(this,e,x));const P=on(this,Tr(this,u));Lr(this._pendingCalls,P),this._pendingCalls.add(n),a.changed&&ge.batchedUpdates(()=>{var x;a.changed=!R,D==null||D(P,this),R?Ks(o.onRest,P):(x=a.onStart)==null||x.call(a,P,this)})}R&&this._set(N),v?n(Qy(e.to,e,this._state,this)):_?this._start():ps(this)&&!y?this._pendingCalls.add(n):n(Ky(N))}_focus(t){const e=this.animation;t!==e.to&&(Sg(this)&&this._detach(),e.to=t,Sg(this)&&this._attach())}_attach(){let t=0;const{to:e}=this.animation;En(e)&&(Lo(e,this),th(e)&&(t=e.priority+1)),this.priority=t}_detach(){const{to:t}=this.animation;En(t)&&dl(t,this)}_set(t,e=!0){const n=Kt(t);if(!z.und(n)){const s=Tn(this);if(!s||!Hn(n,s.getValue())){const i=Ju(n);!s||s.constructor!=i?Ld(this,i.create(n)):s.setValue(n),s&&ge.batchedUpdates(()=>{this._onChange(n,e)})}}return Tn(this)}_onStart(){const t=this.animation;t.changed||(t.changed=!0,Er(this,"onStart",on(this,Tr(this,t.to)),this))}_onChange(t,e){e||(this._onStart(),Ks(this.animation.onChange,t,this)),Ks(this.defaultProps.onChange,t,this),super._onChange(t,e)}_start(){const t=this.animation;Tn(this).reset(Kt(t.to)),t.immediate||(t.fromValues=t.values.map(e=>e.lastPosition)),ps(this)||(kg(this,!0),wr(this)||this._resume())}_resume(){fn.skipAnimation?this.finish():ql.start(this)}_stop(t,e){if(ps(this)){kg(this,!1);const n=this.animation;Ne(n.values,i=>{i.done=!0}),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),hl(this,{type:"idle",parent:this});const s=e?Ni(this.get()):on(this.get(),Tr(this,t??n.to));Lr(this._pendingCalls,s),n.changed&&(n.changed=!1,Er(this,"onRest",s,this))}}};function Tr(t,e){const n=fo(e),s=fo(t.get());return Hn(s,n)}function Zy(t,e=t.loop,n=t.to){const s=Ks(e);if(s){const i=s!==!0&&Yy(s),r=(i||t).reverse,o=!i||i.reset;return go({...t,loop:e,default:!1,pause:void 0,to:!r||Zu(n)?n:void 0,from:o?t.from:void 0,reset:o,...i})}}function go(t){const{to:e,from:n}=t=Yy(t),s=new Set;return z.obj(e)&&Og(e,s),z.obj(n)&&Og(n,s),t.keys=s.size?Array.from(s):null,t}function y5(t){const e=go(t);return z.und(e.default)&&(e.default=Fd(e)),e}function Og(t,e){ts(t,(n,s)=>n!=null&&e.add(s))}var v5=["onStart","onRest","onChange","onPause","onResume"];function Vg(t,e,n){t.animation[n]=e[n]!==zy(e,n)?Gy(e[n],t.key):void 0}function Er(t,e,...n){var s,i,r,o;(i=(s=t.animation)[e])==null||i.call(s,...n),(o=(r=t.defaultProps)[e])==null||o.call(r,...n)}var w5=["onStart","onChange","onRest"],T5=1,E5=class{constructor(t,e){this.id=T5++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),e&&(this._flush=e),t&&this.start({default:!0,...t})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(t=>t.idle&&!t.isDelayed&&!t.isPaused)}get item(){return this._item}set item(t){this._item=t}get(){const t={};return this.each((e,n)=>t[n]=e.get()),t}set(t){for(const e in t){const n=t[e];z.und(n)||this.springs[e].set(n)}}update(t){return t&&this.queue.push(go(t)),this}start(t){let{queue:e}=this;return t?e=tn(t).map(go):this.queue=[],this._flush?this._flush(this,e):(i1(this,e),ih(this,e))}stop(t,e){if(t!==!!t&&(e=t),e){const n=this.springs;Ne(tn(e),s=>n[s].stop(!!t))}else po(this._state,this._lastAsyncId),this.each(n=>n.stop(!!t));return this}pause(t){if(z.und(t))this.start({pause:!0});else{const e=this.springs;Ne(tn(t),n=>e[n].pause())}return this}resume(t){if(z.und(t))this.start({pause:!1});else{const e=this.springs;Ne(tn(t),n=>e[n].resume())}return this}each(t){ts(this.springs,t)}_onFrame(){const{onStart:t,onChange:e,onRest:n}=this._events,s=this._active.size>0,i=this._changed.size>0;(s&&!this._started||i&&!this._started)&&(this._started=!0,Gr(t,([a,u])=>{u.value=this.get(),a(u,this,this._item)}));const r=!s&&this._started,o=i||r&&n.size?this.get():null;i&&e.size&&Gr(e,([a,u])=>{u.value=o,a(u,this,this._item)}),r&&(this._started=!1,Gr(n,([a,u])=>{u.value=o,a(u,this,this._item)}))}eventObserved(t){if(t.type=="change")this._changed.add(t.parent),t.idle||this._active.add(t.parent);else if(t.type=="idle")this._active.delete(t.parent);else return;ge.onFrame(this._onFrame)}};function ih(t,e){return Promise.all(e.map(n=>e1(t,n))).then(n=>Od(t,n))}async function e1(t,e,n){const{keys:s,to:i,from:r,loop:o,onRest:a,onResolve:u}=e,h=z.obj(e.default)&&e.default;o&&(e.loop=!1),i===!1&&(e.to=null),r===!1&&(e.from=null);const d=z.arr(i)||z.fun(i)?i:void 0;d?(e.to=void 0,e.onRest=void 0,h&&(h.onRest=void 0)):Ne(w5,w=>{const E=e[w];if(z.fun(E)){const C=t._events[w];e[w]=({finished:A,cancelled:R})=>{const N=C.get(E);N?(A||(N.finished=!1),R&&(N.cancelled=!0)):C.set(E,{value:null,finished:A||!1,cancelled:R||!1})},h&&(h[w]=e[w])}});const p=t._state;e.pause===!p.paused?(p.paused=e.pause,Lr(e.pause?p.pauseQueue:p.resumeQueue)):p.paused&&(e.pause=!0);const m=(s||Object.keys(t.springs)).map(w=>t.springs[w].start(e)),y=e.cancel===!0||zy(e,"cancel")===!0;(d||y&&p.asyncId)&&m.push(qy(++t._lastAsyncId,{props:e,state:p,actions:{pause:Ku,resume:Ku,start(w,E){y?(po(p,t._lastAsyncId),E(Ni(t))):(w.onRest=a,E(Qy(d,w,p,t)))}}})),p.paused&&await new Promise(w=>{p.resumeQueue.add(w)});const v=Od(t,await Promise.all(m));if(o&&v.finished&&!(n&&v.noop)){const w=Zy(e,o,i);if(w)return i1(t,[w]),e1(t,w,!0)}return u&&ge.batchedUpdates(()=>u(v,t,t.item)),v}function Bg(t,e){const n={...t.springs};return e&&Ne(tn(e),s=>{z.und(s.keys)&&(s=go(s)),z.obj(s.to)||(s={...s,to:void 0}),s1(n,s,i=>n1(i))}),t1(t,n),n}function t1(t,e){ts(e,(n,s)=>{t.springs[s]||(t.springs[s]=n,Lo(n,t))})}function n1(t,e){const n=new _5;return n.key=t,e&&Lo(n,e),n}function s1(t,e,n){e.keys&&Ne(e.keys,s=>{(t[s]||(t[s]=n(s)))._prepareNode(e)})}function i1(t,e){Ne(e,n=>{s1(t.springs,n,s=>n1(s,t))})}var A5=M.createContext({pause:!1,immediate:!1}),x5=()=>{const t=[],e=function(s){q6();const i=[];return Ne(t,(r,o)=>{if(z.und(s))i.push(r.start());else{const a=n(s,r,o);a&&i.push(r.start(a))}}),i};e.current=t,e.add=function(s){t.includes(s)||t.push(s)},e.delete=function(s){const i=t.indexOf(s);~i&&t.splice(i,1)},e.pause=function(){return Ne(t,s=>s.pause(...arguments)),this},e.resume=function(){return Ne(t,s=>s.resume(...arguments)),this},e.set=function(s){Ne(t,(i,r)=>{const o=z.fun(s)?s(r,i):s;o&&i.set(o)})},e.start=function(s){const i=[];return Ne(t,(r,o)=>{if(z.und(s))i.push(r.start());else{const a=this._getProps(s,r,o);a&&i.push(r.start(a))}}),i},e.stop=function(){return Ne(t,s=>s.stop(...arguments)),this},e.update=function(s){return Ne(t,(i,r)=>i.update(this._getProps(s,i,r))),this};const n=function(s,i,r){return z.fun(s)?s(r,i):s};return e._getProps=n,e};function I5(t,e,n){const s=z.fun(e)&&e;s&&!n&&(n=[]);const i=M.useMemo(()=>s||arguments.length==3?x5():void 0,[]),r=M.useRef(0),o=By(),a=M.useMemo(()=>({ctrls:[],queue:[],flush(C,A){const R=Bg(C,A);return r.current>0&&!a.queue.length&&!Object.keys(R).some(k=>!C.springs[k])?ih(C,A):new Promise(k=>{t1(C,R),a.queue.push(()=>{k(ih(C,A))}),o()})}}),[]),u=M.useRef([...a.ctrls]),h=M.useRef([]),d=Cg(t)||0;M.useMemo(()=>{Ne(u.current.slice(t,d),C=>{u5(C,i),C.stop(!0)}),u.current.length=t,p(d,t)},[t]),M.useMemo(()=>{p(0,Math.min(d,t))},n);function p(C,A){for(let R=C;R<A;R++){const N=u.current[R]||(u.current[R]=new E5(null,a.flush)),k=s?s(R,N):e[R];k&&(h.current[R]=y5(k))}}const m=u.current.map((C,A)=>Bg(C,h.current[A])),y=M.useContext(A5),v=Cg(y),w=y!==v&&c5(y);jd(()=>{r.current++,a.ctrls=u.current;const{queue:C}=a;C.length&&(a.queue=[],Ne(C,A=>A())),Ne(u.current,(A,R)=>{i==null||i.add(A),w&&A.start({default:y});const N=h.current[R];N&&(h5(A,N.ref),A.ref?A.queue.push(N):A.start(N))})}),Uy(()=>()=>{Ne(a.ctrls,C=>C.stop(!0))});const E=m.map(C=>({...C}));return i?[E,i]:E}function la(t,e){const n=z.fun(t),[[s],i]=I5(1,n?t:[t],n?[]:e);return n||arguments.length==2?[s,i]:s}var S5=class extends Vd{constructor(t,e){super(),this.source=t,this.idle=!0,this._active=new Set,this.calc=co(...e);const n=this._get(),s=Ju(n);Ld(this,s.create(n))}advance(t){const e=this._get(),n=this.get();Hn(e,n)||(Tn(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&Ug(this._active)&&Vc(this)}_get(){const t=z.arr(this.source)?this.source.map(Kt):tn(Kt(this.source));return this.calc(...t)}_start(){this.idle&&!Ug(this._active)&&(this.idle=!1,Ne(Zl(this),t=>{t.done=!1}),fn.skipAnimation?(ge.batchedUpdates(()=>this.advance()),Vc(this)):ql.start(this))}_attach(){let t=1;Ne(tn(this.source),e=>{En(e)&&Lo(e,this),th(e)&&(e.idle||this._active.add(e),t=Math.max(t,e.priority+1))}),this.priority=t,this._start()}_detach(){Ne(tn(this.source),t=>{En(t)&&dl(t,this)}),this._active.clear(),Vc(this)}eventObserved(t){t.type=="change"?t.idle?this.advance():(this._active.add(t.parent),this._start()):t.type=="idle"?this._active.delete(t.parent):t.type=="priority"&&(this.priority=tn(this.source).reduce((e,n)=>Math.max(e,(th(n)?n.priority:0)+1),0))}};function b5(t){return t.idle!==!1}function Ug(t){return!t.size||Array.from(t).every(b5)}function Vc(t){t.idle||(t.idle=!0,Ne(Zl(t),e=>{e.done=!0}),hl(t,{type:"idle",parent:t}))}fn.assign({createStringInterpolator:Oy,to:(t,e)=>new S5(t,e)});var C5=["primitive"].concat(Object.keys(cv).filter(t=>/^[A-Z]/.test(t)).map(t=>t[0].toLowerCase()+t.slice(1)));fn.assign({createStringInterpolator:Oy,colors:S6,frameLoop:"demand"});X1(()=>{ge.advance()});var D5=i5(C5,{applyAnimatedValues:G1}),ca=D5.animated;const ua=({args:t,position:e,material:n,renderMode:s})=>{const i=M.useMemo(()=>new ai(...t),[t]),r=M.useMemo(()=>new bh(i),[i]);return c.jsxs("group",{position:e,children:[s==="solid"&&c.jsx("mesh",{geometry:i,receiveShadow:!0,castShadow:!0,children:c.jsx("primitive",{object:n})}),c.jsx("lineSegments",{geometry:r,children:c.jsx("lineBasicMaterial",{color:"#666666",linewidth:1})})]})},os=({moduleWidth:t,moduleDepth:e,hingePosition:n="right",spaceInfo:s,color:i})=>{var le,re,fe,Z;const{spaceInfo:r}=Pt(),{doorsOpen:o}=nr(),{renderMode:a}=be(),u=s||r,h=u.materialConfig||{interiorColor:"#FFFFFF",doorColor:"#FFFFFF"};let d=i||h.doorColor;if(typeof d=="string"&&(/^#([0-9a-fA-F]{8})$/.test(d)&&(d="#"+d.slice(1,7)),/^rgba\(/.test(d))){const te=d.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);te&&(d=`#${(+te[1]).toString(16).padStart(2,"0")}${(+te[2]).toString(16).padStart(2,"0")}${(+te[3]).toString(16).padStart(2,"0")}`)}const p=a!=="solid"&&!!i,m=()=>a==="solid"?new Qt({color:d,metalness:0,roughness:.6,envMapIntensity:0,emissive:new it(0),transparent:!1,opacity:1}):p?new Qt({color:d,metalness:0,roughness:.6,envMapIntensity:0,emissive:new it(0),transparent:!0,opacity:.4}):new Qt({color:d,metalness:0,roughness:.6,envMapIntensity:0,emissive:new it(0),transparent:!0,opacity:.3});console.log("🚪 DoorModule 렌더링:",{propColor:i,propSpaceInfo:s==null?void 0:s.materialConfig,storeSpaceInfo:r.materialConfig,currentSpaceInfo:u.materialConfig,materialConfig:h,finalDoorColor:d});const v=gt(s).columnWidth,w=Math.abs(t-v*2)<50,E=te=>te*.01,A=E(20),R=s.height,N=s.hasFloorFinish&&((le=s.floorFinish)==null?void 0:le.height)||0,k=R-N,j=E(k-30);let I;if(((re=s.baseConfig)==null?void 0:re.type)==="floor"){const te=((fe=s.frameSize)==null?void 0:fe.top)||50,Ae=s.baseConfig.height||65;I=(N>0,E(te)/2-E(Ae)/2)}else{const te=((Z=s.frameSize)==null?void 0:Z.top)||50;I=(N>0,E(te)/2)}const T=E(e)+E(20),S=18/2,D=E(S),P=la({rotation:o?-4*Math.PI/9:0,config:{tension:70,friction:20}}),x=la({rotation:o?4*Math.PI/9:0,config:{tension:70,friction:20}}),V=la({rotation:o?-4*Math.PI/9:0,config:{tension:70,friction:20}}),Y=la({rotation:o?4*Math.PI/9:0,config:{tension:70,friction:20}});if(w){const te=t,Ae=(te-1.5-1.5-3)/2,ce=E(Ae),ie=E(-te/2+1.5+Ae/2),Rt=E(te/2-1.5-Ae/2);return c.jsxs("group",{children:[c.jsx("group",{position:[ie-ce/2+D,I,T/2],children:c.jsx(ca.group,{"rotation-y":V.rotation,children:c.jsx(ua,{position:[ce/2-D,.1,0],args:[ce,j,A],material:m(),renderMode:a})})}),c.jsx("group",{position:[Rt+ce/2-D,I,T/2],children:c.jsx(ca.group,{"rotation-y":Y.rotation,children:c.jsx(ua,{position:[-ce/2+D,.1,0],args:[ce,j,A],material:m(),renderMode:a})})})]})}else{const te=t-1.5-1.5,Ae=E(te);return n==="left"?c.jsx("group",{position:[-E(t)/2+E(1.5)+D,I,T/2],children:c.jsx(ca.group,{"rotation-y":P.rotation,children:c.jsx(ua,{position:[Ae/2-D,.1,0],args:[Ae,j,A],material:m(),renderMode:a})})}):c.jsx("group",{position:[E(t)/2-E(1.5)-D,I,T/2],children:c.jsx(ca.group,{"rotation-y":x.rotation,children:c.jsx(ua,{position:[-Ae/2+D,.1,0],args:[Ae,j,A],material:m(),renderMode:a})})})}},P5=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=rs(t,{color:e,internalHeight:n,customDepth:i,isDragging:a});return c.jsxs(hi,{...u,children:[c.jsx(di,{modelConfig:u.modelConfig,height:u.height,innerWidth:u.innerWidth,depth:u.depth,adjustedDepthForShelves:u.adjustedDepthForShelves,basicThickness:u.basicThickness,shelfZOffset:u.shelfZOffset,material:u.material,calculateSectionHeight:u.calculateSectionHeight,renderMode:be().renderMode}),s&&o&&c.jsx(os,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},R5=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=rs(t,{color:e,internalHeight:n,customDepth:i,isDragging:a});return c.jsxs(hi,{...u,children:[c.jsx(di,{modelConfig:u.modelConfig,height:u.height,innerWidth:u.innerWidth,depth:u.depth,adjustedDepthForShelves:u.adjustedDepthForShelves,basicThickness:u.basicThickness,shelfZOffset:u.shelfZOffset,material:u.material,calculateSectionHeight:u.calculateSectionHeight,renderMode:be().renderMode}),s&&o&&c.jsx(os,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},N5=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=rs(t,{color:e,internalHeight:n,customDepth:i,isDragging:a});return c.jsxs(hi,{...u,children:[c.jsx(di,{modelConfig:u.modelConfig,height:u.height,innerWidth:u.innerWidth,depth:u.depth,adjustedDepthForShelves:u.adjustedDepthForShelves,basicThickness:u.basicThickness,shelfZOffset:u.shelfZOffset,material:u.material,calculateSectionHeight:u.calculateSectionHeight,renderMode:be().renderMode}),s&&o&&c.jsx(os,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},M5=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=rs(t,{color:e,internalHeight:n,customDepth:i,isDragging:a});return c.jsxs(hi,{...u,children:[c.jsx(di,{modelConfig:u.modelConfig,height:u.height,innerWidth:u.innerWidth,depth:u.depth,adjustedDepthForShelves:u.adjustedDepthForShelves,basicThickness:u.basicThickness,shelfZOffset:u.shelfZOffset,material:u.material,calculateSectionHeight:u.calculateSectionHeight,renderMode:be().renderMode}),s&&o&&c.jsx(os,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},j5=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=rs(t,{color:e,internalHeight:n,customDepth:i,isDragging:a});return c.jsxs(hi,{...u,children:[c.jsx(di,{modelConfig:u.modelConfig,height:u.height,innerWidth:u.innerWidth,depth:u.depth,adjustedDepthForShelves:u.adjustedDepthForShelves,basicThickness:u.basicThickness,shelfZOffset:u.shelfZOffset,material:u.material,calculateSectionHeight:u.calculateSectionHeight,renderMode:be().renderMode}),s&&o&&c.jsx(os,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},L5=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=rs(t,{color:e,internalHeight:n,customDepth:i,isDragging:a});return c.jsxs(hi,{...u,children:[c.jsx(di,{modelConfig:u.modelConfig,height:u.height,innerWidth:u.innerWidth,depth:u.depth,adjustedDepthForShelves:u.adjustedDepthForShelves,basicThickness:u.basicThickness,shelfZOffset:u.shelfZOffset,material:u.material,calculateSectionHeight:u.calculateSectionHeight,renderMode:be().renderMode}),s&&o&&c.jsx(os,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},mn=({args:t,position:e,material:n,renderMode:s="solid"})=>c.jsxs("group",{position:e,children:[s==="solid"&&c.jsxs("mesh",{receiveShadow:!0,castShadow:!0,children:[c.jsx("boxGeometry",{args:t}),c.jsx("primitive",{object:n})]}),c.jsxs("lineSegments",{children:[c.jsx("edgesGeometry",{args:[new ai(...t)]}),c.jsx("lineBasicMaterial",{color:"#666666",linewidth:2})]})]}),k5=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=rs(t,{color:e,internalHeight:n,customDepth:i,isDragging:a}),{width:h,height:d,innerWidth:p,innerHeight:m,basicThickness:y,backPanelThickness:v,material:w,calculateSectionHeight:E,mmToThreeUnits:C,modelConfig:A}=u,R=A.rightAbsoluteWidth;let N,k,j,I;R?(k=C(R),N=p-k-y,j=-(k+y)/2,I=(N+y)/2):(N=p/2,k=p/2,j=-p/4,I=p/4);const T=A.rightAbsoluteDepth;let _,S,D,P;T?(D=i||600,_=C(D),P=T,S=C(P)):(D=P=i||600,_=S=C(D));const x=()=>{const Y=A.leftSections||[];if(Y.length===0)return[d-y*2];const le=d-y*2,fe=Y.filter(te=>te.heightType==="absolute").reduce((te,Ae)=>te+E(Ae,le),0),Z=le-fe;return Y.map(te=>te.heightType==="absolute"?E(te,le):E(te,Z))},V=()=>{const Y=A.leftSections||[],le=A.rightSections||[];if(Y.length===0&&le.length===0)return null;const re=_-y,fe=y/2,Z=C(642),te=C(18)/2+(_-S)/2,Ae=()=>{if(Y.length===0)return null;const ie=d-y*2,ne=Y.filter(J=>J.heightType==="absolute").reduce((J,xe)=>J+E(xe,ie),0),ye=ie-ne,We=Y.map(J=>({...J,calculatedHeight:J.heightType==="absolute"?E(J,ie):E(J,ye)}));let Ye=-d/2;return We.map((J,xe)=>{const Je=J.calculatedHeight,Le=Ye+Je/2;let lt=null;switch(J.type){case"shelf":J.count&&J.count>0&&(lt=c.jsx(Ii,{shelfCount:J.count,innerWidth:N,innerHeight:Je,depth:re,basicThickness:y,material:w,yOffset:Le,zOffset:fe,shelfPositions:J.shelfPositions,isTopFinishPanel:J.isTopFinishPanel,renderMode:be().renderMode}));break;case"hanging":J.count&&J.count>0?lt=c.jsx(Ii,{shelfCount:J.count,innerWidth:N,innerHeight:Je,depth:re,basicThickness:y,material:w,yOffset:Le,zOffset:fe,shelfPositions:J.shelfPositions,isTopFinishPanel:J.isTopFinishPanel,renderMode:be().renderMode}):lt=null;break;case"drawer":J.count&&J.count>0&&(lt=c.jsx(xd,{drawerCount:J.count,innerWidth:N,innerHeight:Je,depth:_,basicThickness:y,yOffset:Le,drawerHeights:J.drawerHeights,gapHeight:J.gapHeight,material:w,renderMode:be().renderMode}));break}let Dn=null;return xe<We.length-1&&(Dn=c.jsx(mn,{args:[N,y,re-y],position:[0,Le+Je/2+y/2,y/2+fe],material:w,renderMode:be().renderMode})),Ye+=Je,c.jsxs("group",{children:[lt,Dn]},`left-section-${xe}`)})},ce=()=>{if(le.length===0)return null;const ie=d-y*2,ne=le.filter(J=>J.heightType==="absolute").reduce((J,xe)=>J+E(xe,ie),0),ye=ie-ne,We=le.map(J=>({...J,calculatedHeight:J.heightType==="absolute"?E(J,ie):E(J,ye)}));let Ye=-d/2;return We.map((J,xe)=>{const Je=J.calculatedHeight,Le=Ye+Je/2;let lt=null;switch(J.type){case"hanging":J.count&&J.count>0?lt=c.jsx(Ii,{shelfCount:J.count,innerWidth:k,innerHeight:Je,depth:Z,basicThickness:y,material:w,yOffset:Le,zOffset:te,shelfPositions:J.shelfPositions,isTopFinishPanel:J.isTopFinishPanel,renderMode:be().renderMode}):lt=null;break;case"shelf":J.count&&J.count>0&&(lt=c.jsx(Ii,{shelfCount:J.count,innerWidth:k,innerHeight:Je,depth:Z,basicThickness:y,material:w,yOffset:Le,zOffset:te,shelfPositions:J.shelfPositions,isTopFinishPanel:J.isTopFinishPanel,renderMode:be().renderMode}));break}return Ye+=Je,c.jsx("group",{children:lt},`right-section-${xe}`)})};return c.jsxs(c.Fragment,{children:[c.jsx("group",{position:[j,0,0],children:Ae()}),c.jsx("group",{position:[I,0,0],children:ce()}),x().map((ie,Rt)=>{let ne=-d/2;for(let J=0;J<Rt;J++)ne+=x()[J];const ye=ne+ie/2,We=Math.max(_,S),Ye=_>S?0:(_-S)/2;return c.jsx(mn,{args:[y,ie,We],position:[(N-k)/2,ye,Ye],material:w,renderMode:be().renderMode},`middle-panel-${Rt}`)})]})};return c.jsxs("group",{children:[x().map((Y,le)=>{let re=-d/2;for(let Z=0;Z<le;Z++)re+=x()[Z];const fe=re+Y/2;return c.jsx(mn,{args:[y,Y,_],position:[-h/2+y/2,fe,0],material:w,renderMode:be().renderMode},`left-side-panel-${le}`)}),c.jsx(mn,{args:[y,d,S],position:[h/2-y/2,0,(_-S)/2],material:w,renderMode:be().renderMode}),c.jsxs(c.Fragment,{children:[c.jsx(mn,{args:[N,y,_],position:[j,d/2-y/2,0],material:w,renderMode:be().renderMode}),c.jsx(mn,{args:[k,y,S],position:[I,d/2-y/2,(_-S)/2],material:w,renderMode:be().renderMode})]}),c.jsxs(c.Fragment,{children:[c.jsx(mn,{args:[N,y,_],position:[j,-d/2+y/2,0],material:w,renderMode:be().renderMode}),c.jsx(mn,{args:[k,y,S],position:[I,-d/2+y/2,(_-S)/2],material:w,renderMode:be().renderMode})]}),c.jsxs(c.Fragment,{children:[c.jsx(mn,{args:[N+C(10),m+C(10),v],position:[j,0,-_/2+v/2+C(17)],material:w,renderMode:be().renderMode}),c.jsx(mn,{args:[k+C(10),m+C(10),v],position:[I,0,-S/2+v/2+C(17)+(_-S)/2],material:w,renderMode:be().renderMode})]}),V(),s&&o&&c.jsx(os,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},kn=({args:t,position:e,material:n,renderMode:s="solid"})=>c.jsxs("group",{position:e,children:[s==="solid"&&c.jsxs("mesh",{receiveShadow:!0,castShadow:!0,children:[c.jsx("boxGeometry",{args:t}),c.jsx("primitive",{object:n})]}),c.jsxs("lineSegments",{children:[c.jsx("edgesGeometry",{args:[new ai(...t)]}),c.jsx("lineBasicMaterial",{color:"#666666",linewidth:2})]})]}),F5=({moduleData:t,color:e,internalHeight:n,hasDoor:s,customDepth:i,hingePosition:r="right",spaceInfo:o,isDragging:a=!1})=>{const u=rs(t,{color:e,internalHeight:n,customDepth:i,isDragging:a}),{width:h,height:d,depth:p,innerWidth:m,innerHeight:y,basicThickness:v,backPanelThickness:w,adjustedDepthForShelves:E,shelfZOffset:C,material:A,calculateSectionHeight:R,mmToThreeUnits:N,modelConfig:k}=u,j=k.rightAbsoluteWidth;let I,T,_,S;j?(T=N(j),I=m-T-v,_=-(T+v)/2,S=(I+v)/2):(I=m/2,T=m/2,_=-m/4,S=m/4);const D=k.hasSharedMiddlePanel||!1,P=k.middlePanelHeight||0,x=k.hasSharedSafetyShelf||!1,V=k.safetyShelfHeight||0,Y=()=>{const le=k.leftSections||[],re=k.rightSections||[];if(le.length===0&&re.length===0)return null;const fe=()=>{if(le.length===0)return null;const te=d-v*2,ce=le.filter(ye=>ye.heightType==="absolute").reduce((ye,We)=>ye+R(We,te),0),ie=te-ce,Rt=le.map(ye=>({...ye,calculatedHeight:ye.heightType==="absolute"?R(ye,te):R(ye,ie)}));let ne=-d/2+v;return Rt.map((ye,We)=>{const Ye=ye.calculatedHeight,J=ne+Ye/2;let xe=null;switch(ye.type){case"drawer":ye.count&&ye.count>0&&(xe=c.jsx(xd,{drawerCount:ye.count,innerWidth:I,innerHeight:Ye,depth:p,basicThickness:v,yOffset:J,drawerHeights:ye.drawerHeights,gapHeight:ye.gapHeight,material:A,renderMode:be().renderMode}));break;case"hanging":xe=null;break}return ne+=Ye,c.jsx("group",{children:xe},`left-section-${We}`)})},Z=()=>{if(re.length===0)return null;const te=d-v*2,ce=re.filter(ne=>ne.heightType==="absolute").reduce((ne,ye)=>ne+R(ye,te),0),ie=te-ce;return re.map(ne=>({...ne,calculatedHeight:ne.heightType==="absolute"?R(ne,te):R(ne,ie)})).map((ne,ye)=>{let We=null;switch(ne.type){case"hanging":We=null;break}return c.jsx("group",{children:We},`right-section-${ye}`)})};return c.jsxs(c.Fragment,{children:[c.jsx("group",{position:[_,0,0],children:fe()}),c.jsx("group",{position:[S,0,0],children:Z()}),D&&P>0&&c.jsx(kn,{args:[v,N(P+9),E-v],position:[(I-T)/2,-d/2+v+N(P+9)/2-N(18),v/2+C],material:A,renderMode:be().renderMode}),D&&P>0&&c.jsx(kn,{args:[m,v,E-v],position:[0,-d/2+v+N(P),v/2+C],material:A,renderMode:be().renderMode}),x&&V>0&&c.jsx(kn,{args:[m,v,E-v],position:[0,-d/2+v+N(V),v/2+C],material:A,renderMode:be().renderMode})]})};return c.jsxs("group",{children:[c.jsx(kn,{args:[v,d,p],position:[-h/2+v/2,0,0],material:A,renderMode:be().renderMode}),c.jsx(kn,{args:[v,d,p],position:[h/2-v/2,0,0],material:A,renderMode:be().renderMode}),c.jsx(kn,{args:[m,v,p],position:[0,d/2-v/2,0],material:A,renderMode:be().renderMode}),c.jsxs(c.Fragment,{children:[c.jsx(kn,{args:[I,v,p],position:[_,-d/2+v/2,0],material:A,renderMode:be().renderMode}),c.jsx(kn,{args:[T,v,p],position:[S,-d/2+v/2,0],material:A,renderMode:be().renderMode})]}),c.jsx(kn,{args:[m+N(10),y+N(10),w],position:[0,0,-p/2+w/2+N(17)],material:A,renderMode:be().renderMode}),Y(),s&&o&&c.jsx(os,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:r,spaceInfo:o,color:u.doorColor})]})},r1=({moduleData:t,color:e,isDragging:n=!1,internalHeight:s,hasDoor:i,customDepth:r,hingePosition:o="right",spaceInfo:a})=>{Pt();const u=rs(t,{color:e,internalHeight:s,customDepth:r,isDragging:n});return t.id.includes("dual-4drawer-hanging")?c.jsx(L5,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):t.id.includes("dual-2drawer-hanging")?c.jsx(M5,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):t.id.includes("dual-2hanging")?c.jsx(j5,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):t.id.includes("single-4drawer-hanging")?c.jsx(N5,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):t.id.includes("single-2drawer-hanging")?c.jsx(P5,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):t.id.includes("single-2hanging")?c.jsx(R5,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):t.id.includes("dual-2drawer-styler")?c.jsx(k5,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):t.id.includes("dual-4drawer-pantshanger")?c.jsx(F5,{moduleData:t,color:e,isDragging:n,internalHeight:s,hasDoor:n?!1:i,customDepth:r,hingePosition:o,spaceInfo:a}):c.jsxs(hi,{...u,children:[c.jsx(di,{modelConfig:u.modelConfig,height:u.height,innerWidth:u.innerWidth,depth:u.depth,adjustedDepthForShelves:u.adjustedDepthForShelves,basicThickness:u.basicThickness,shelfZOffset:u.shelfZOffset,material:u.material,calculateSectionHeight:u.calculateSectionHeight,renderMode:be().renderMode}),i&&a&&c.jsx(os,{moduleWidth:t.dimensions.width,moduleDepth:u.actualDepthMm,hingePosition:o,spaceInfo:a,color:n?u.doorColor:void 0})]})},O5=({placedModule:t,spaceInfo:e,furnitureStartY:n,isDragMode:s,isEditMode:i,isDraggingThis:r,onPointerDown:o,onPointerMove:a,onPointerUp:u,onDoubleClick:h})=>{var x;const d=pt(e),p=ut(t.moduleId,d,e);if(!p)return null;const m=V=>V*.01,y=m(p.dimensions.width);let v=d.height;if(((x=e.baseConfig)==null?void 0:x.type)==="stand"&&e.baseConfig.placementType==="float"){const V=e.baseConfig.floatHeight||0;v=d.height-V}const w=m(v),E=t.customDepth||p.dimensions.depth,C=m(E),R=m(20),N=1500,k=600,j=m(N),I=m(k),S=-j/2+(j-I)/2+I/2-R-C/2,P=r||i||s?r?"#66ff66":i?"#ffaa00":s?"#ff6666":void 0:void 0;return c.jsxs("group",{position:[t.position.x,n+w/2,S],rotation:[0,t.rotation*Math.PI/180,0],onDoubleClick:V=>h(V,t.id),onPointerDown:V=>o(V,t.id),onPointerMove:V=>a(V),onPointerUp:u,onPointerOver:()=>{document.body.style.cursor=s?"grab":r?"grabbing":"grab"},onPointerOut:()=>{document.body.style.cursor="default"},children:[e.surroundType==="no-surround"&&e.gapConfig&&(console.log(`🪑 [가구위치] 이격거리${e.gapConfig.size}mm: X=${t.position.x.toFixed(3)}, 폭=${p.dimensions.width}mm`),null),p.type==="box"?c.jsx(r1,{moduleData:p,isDragging:s||r||i,color:P,internalHeight:v,hasDoor:t.hasDoor??!1,customDepth:E,hingePosition:t.hingePosition||"right",spaceInfo:e}):c.jsxs(c.Fragment,{children:[c.jsx(z1,{args:[y,w,C],children:c.jsx("meshPhysicalMaterial",{color:P,clearcoat:.1,clearcoatRoughness:.8,metalness:0,roughness:.7,reflectivity:.2,transparent:s||r||i,opacity:s||r||i?.8:1})}),c.jsx(Y1,{color:r?"#00ff00":i?"#ff8800":s?"#ff0000":"#cccccc",threshold:1,scale:1.001}),i&&c.jsx("primitive",{object:(()=>{const V=document.createElement("canvas"),Y=V.getContext("2d");V.width=256,V.height=128,Y.fillStyle="rgba(255, 140, 0, 0.9)",Y.fillRect(0,0,256,128),Y.fillStyle="#ffffff",Y.font="16px Arial",Y.textAlign="center",Y.fillText("편집 모드",128,25),Y.font="12px Arial",Y.fillText("더블클릭으로 진입",128,40),Y.fillText("드래그: 이동",128,55),Y.fillText("←→: 이동",128,70),Y.fillText("Del: 삭제",128,85),Y.fillText("Esc: 해제",128,100);const le=new Ut(V),re=new vu({map:le,transparent:!0,depthTest:!1}),fe=new uv(3,1.5),Z=new Dm(fe,re);return Z.position.set(0,w+2,0),Z.renderOrder=1002,Z})()})]})]})},V5=()=>{var u;const{spaceInfo:t}=Pt(),e=De(h=>h.placedModules),n=h=>h*.01,s=t.hasFloorFinish&&t.floorFinish?t.floorFinish.height:0,i=((u=t.baseConfig)==null?void 0:u.height)||0;let r;if(!t.baseConfig||t.baseConfig.type==="floor")r=n(s+i);else if(t.baseConfig.type==="stand")if(t.baseConfig.placementType==="float"){const h=t.baseConfig.floatHeight||0;r=n(s+h)}else r=n(s);else r=n(s);const o=m6(),a=g6({spaceInfo:t});return _6({spaceInfo:t}),c.jsx("group",{children:e.map(h=>{const d=o.dragMode,p=o.editMode&&o.editingModuleId===h.id,m=a.draggingModuleId===h.id;return c.jsx(O5,{placedModule:h,spaceInfo:t,furnitureStartY:r,isDragMode:d,isEditMode:p,isDraggingThis:m,onPointerDown:a.handlePointerDown,onPointerMove:a.handlePointerMove,onPointerUp:a.handlePointerUp,onDoubleClick:o.handleFurnitureClick},h.id)})})},he=t=>t*.01,nt=18,Fn=({args:t,position:e,material:n,renderMode:s})=>{const i=M.useMemo(()=>new ai(...t),[t]),r=M.useMemo(()=>new bh(i),[i]);return c.jsxs("group",{position:e,children:[s==="solid"&&c.jsx("mesh",{geometry:i,receiveShadow:!0,castShadow:!0,children:c.jsx("primitive",{object:n})}),c.jsx("lineSegments",{geometry:r,children:c.jsx("lineBasicMaterial",{color:"#666666",linewidth:1})})]})},B5=({spaceInfo:t,floorColor:e="#FF9966",viewMode:n="3D",materialConfig:s})=>{var fi,pi;const{renderMode:i}=be(),{width:r,height:o}=my(t),a=_y(t),u=Sb(t),h=bb(),d=No(t),p=Cb(t),m=vy(t),y=yy(t),v=he(r),w=he(o),E=he(u),C=he(h),A=he(a),R={left:he(d.left),right:he(d.right)},N={width:he(p.width)},k=he(m),j=he(y),I=M.useCallback(()=>{const Us=(s==null?void 0:s.doorColor)||"#FFFFFF";return new Rm({color:new it(Us),transparent:i==="wireframe",opacity:i==="wireframe"?.3:1,clearcoat:.1,clearcoatRoughness:.8,metalness:0,roughness:.7,reflectivity:.2,envMapIntensity:0,emissive:new it(0)})},[s==null?void 0:s.doorColor,i]),T=M.useMemo(()=>I(),[I]),_=M.useMemo(()=>I(),[I]),S=M.useMemo(()=>I(),[I]),D=M.useMemo(()=>I(),[I]),P=M.useMemo(()=>I(),[I]),x=M.useMemo(()=>I(),[I]),V=M.useMemo(()=>I(),[I]),Y=M.useMemo(()=>I(),[I]),le=M.useMemo(()=>yt.createWallMaterial(),[]),re=M.useMemo(()=>yt.createWallMaterial(),[]),fe=M.useMemo(()=>yt.createWallMaterial(),[]),Z=-v/2,te=0,Ae=-E/2,ce=Ae+(E-C)/2,ie=0,Rt=he(300),ne=E+Rt,ye=Ae,We=N.width,Ye=N.width,J=t.surroundType==="no-surround"?0:Z+R.left+We/2,xe=t.hasFloorFinish&&A>0?A:0,Je=((fi=t.baseConfig)==null?void 0:fi.type)==="stand"&&((pi=t.baseConfig)==null?void 0:pi.placementType)==="float"?he(t.baseConfig.floatHeight||0):0,Le=w-Je,lt=xe+w-k/2,pn=xe+Je+Le/2,{wallConfig:mt}=t;return c.jsxs("group",{position:[0,0,ie],children:[n==="3D"&&c.jsxs(c.Fragment,{children:[c.jsxs("mesh",{position:[-v/2-.001,xe+w/2,ye+ne/2],rotation:[0,Math.PI/2,0],children:[c.jsx("planeGeometry",{args:[ne,w]}),c.jsx("primitive",{object:yt.createShaderGradientWallMaterial("horizontal")})]}),c.jsxs("mesh",{position:[v/2+.001,xe+w/2,ye+ne/2],rotation:[0,-Math.PI/2,0],children:[c.jsx("planeGeometry",{args:[ne,w]}),c.jsx("primitive",{object:yt.createShaderGradientWallMaterial("horizontal-reverse")})]}),c.jsxs("mesh",{position:[Z+v/2,xe+w+.001,ye+ne/2],rotation:[Math.PI/2,0,0],children:[c.jsx("planeGeometry",{args:[v,ne]}),c.jsx("primitive",{object:yt.createShaderGradientWallMaterial("vertical-reverse")})]}),c.jsxs("mesh",{position:[Z+v/2,xe-.001,ye+ne/2],rotation:[-Math.PI/2,0,0],children:[c.jsx("planeGeometry",{args:[v,ne]}),c.jsx("primitive",{object:yt.createShaderGradientWallMaterial("vertical")})]}),!1,c.jsxs("mesh",{position:[Z+v/2,xe+w/2,Ae-.01],children:[c.jsx("planeGeometry",{args:[v,w]}),c.jsx("meshStandardMaterial",{color:"#ffffff",transparent:!0,opacity:0,side:vn})]}),c.jsxs("mesh",{position:[-v/2,xe+w/2,Ae+E/2],rotation:[0,0,0],children:[c.jsx("planeGeometry",{args:[.02,w]}),c.jsx("primitive",{object:yt.createEdgeShadowMaterial()})]}),c.jsxs("mesh",{position:[v/2,xe+w/2,Ae+E/2],rotation:[0,0,0],children:[c.jsx("planeGeometry",{args:[.02,w]}),c.jsx("primitive",{object:yt.createEdgeShadowMaterial()})]}),c.jsxs("mesh",{position:[Z+v/2,xe+w,Ae+E/2],rotation:[0,0,Math.PI/2],children:[c.jsx("planeGeometry",{args:[.02,v]}),c.jsx("primitive",{object:yt.createEdgeShadowMaterial()})]}),c.jsxs("mesh",{position:[Z+v/2,xe,Ae+E/2],rotation:[0,0,Math.PI/2],children:[c.jsx("planeGeometry",{args:[.02,v]}),c.jsx("primitive",{object:yt.createEdgeShadowMaterial()})]}),c.jsxs("mesh",{position:[-v/2,xe+w,ye+ne/2],rotation:[Math.PI/2,0,0],children:[c.jsx("planeGeometry",{args:[.02,ne]}),c.jsx("primitive",{object:yt.createEdgeShadowMaterial()})]}),c.jsxs("mesh",{position:[v/2,xe+w,ye+ne/2],rotation:[Math.PI/2,0,0],children:[c.jsx("planeGeometry",{args:[.02,ne]}),c.jsx("primitive",{object:yt.createEdgeShadowMaterial()})]}),c.jsxs("mesh",{position:[-v/2,xe,ye+ne/2],rotation:[Math.PI/2,0,0],children:[c.jsx("planeGeometry",{args:[.02,ne]}),c.jsx("primitive",{object:yt.createEdgeShadowMaterial()})]}),c.jsxs("mesh",{position:[v/2,xe,ye+ne/2],rotation:[Math.PI/2,0,0],children:[c.jsx("planeGeometry",{args:[.02,ne]}),c.jsx("primitive",{object:yt.createEdgeShadowMaterial()})]})]}),t.hasFloorFinish&&A>0&&c.jsx(Fn,{args:[v,A,ne],position:[Z+v/2,te+A/2,ye+ne/2],material:new Pm({color:e,transparent:!0,opacity:.3}),renderMode:i}),t.surroundType!=="no-surround"&&(t.installType==="built-in"||t.installType==="semi-standing"||t.installType==="free-standing")&&c.jsx(Fn,{args:[R.left,Le,t.installType==="semi-standing"&&!(mt!=null&&mt.left)||t.installType==="free-standing"?C-he(nt):he(nt)],position:[Z+R.left/2,pn,ce+C/2-he(nt)/2],material:_,renderMode:i}),t.surroundType!=="no-surround"&&(t.installType==="built-in"||t.installType==="semi-standing"||t.installType==="free-standing")&&c.jsx(Fn,{args:[R.right,Le,t.installType==="semi-standing"&&!(mt!=null&&mt.right)||t.installType==="free-standing"?C-he(nt):he(nt)],position:[Z+v-R.right/2,pn,ce+C/2-he(nt)/2],material:D,renderMode:i}),m>0&&c.jsxs(c.Fragment,{children:[t.surroundType==="no-surround"&&t.gapConfig&&console.log(`🔧 [상단프레임] 이격거리${t.gapConfig.size}mm: 실제폭=${p.width}mm, Three.js=${Ye.toFixed(2)}`),c.jsx(Fn,{args:[Ye,k,he(nt)],position:[J,lt,ce+C/2-he(nt)/2-he(30)],material:x,renderMode:i})]}),m>18&&c.jsx("group",{position:[J,lt-k/2+he(nt)/2,ce+C/2-he(nt)/2],rotation:[Math.PI/2,0,0],children:c.jsx(Fn,{args:[Ye,he(40),he(nt)],position:[0,0,0],material:V,renderMode:i})}),t.surroundType!=="no-surround"&&(t.installType==="built-in"||t.installType==="semi-standing"&&(mt==null?void 0:mt.left))&&c.jsx("group",{position:[Z+R.left+he(40)/2-he(29),pn,ce+C/2-he(nt)/2-he(30)],rotation:[0,Math.PI/2,0],children:c.jsx(Fn,{args:[he(40),Le,he(nt)],position:[0,0,0],material:S,renderMode:i})}),t.surroundType!=="no-surround"&&(t.installType==="built-in"||t.installType==="semi-standing"&&(mt==null?void 0:mt.right))&&c.jsx("group",{position:[Z+v-R.right-he(40)/2+he(29),pn,ce+C/2-he(nt)/2-he(30)],rotation:[0,Math.PI/2,0],children:c.jsx(Fn,{args:[he(40),Le,he(nt)],position:[0,0,0],material:P,renderMode:i})}),y>0&&c.jsxs(c.Fragment,{children:[t.surroundType==="no-surround"&&t.gapConfig&&console.log(`🔧 [하부프레임] 이격거리${t.gapConfig.size}mm: 실제폭=${p.width}mm, Three.js=${Ye.toFixed(2)}`),c.jsx(Fn,{args:[Ye,j,he(nt)],position:[J,xe+j/2,ce+C/2-he(nt)/2-he(30)],material:T,renderMode:i})]}),y>0&&c.jsx("group",{position:[J,xe+j-he(nt)/2,ce+C/2-he(nt)/2-he(30)],rotation:[-Math.PI/2,0,0],children:c.jsx(Fn,{args:[Ye,he(40),he(nt)],position:[0,0,0],material:Y,renderMode:i})}),c.jsx(V5,{})]})},U5=({columnIndex:t,columnWidth:e,position:n,internalSpace:s})=>{const i=s.height*.01,r=e*.01,o=s.depth*.01;return c.jsx("mesh",{position:[n.x,n.y+i/2,n.z],userData:{columnIndex:t,isDropTarget:!0},visible:!1,children:c.jsx("boxGeometry",{args:[r,i,o]})})},$5=()=>{var y;const{spaceInfo:t}=Pt(),e=gt(t),{columnCount:n,threeUnitBoundaries:s}=e;if(n<=1)return null;const i=pt(t),r=v=>v*.01,o=r(i.startY),a=o+r(i.height),h=-r(i.depth/2),d=t.hasFloorFinish&&t.floorFinish?t.floorFinish.height:0,p=((y=t.baseConfig)==null?void 0:y.height)||0,m=(d+p)*.01;return c.jsxs("group",{children:[c.jsx(H,{points:[new zt(s[0],o,h),new zt(s[s.length-1],o,h)],color:"#2ECC71",lineWidth:1,dashed:!0,dashSize:.2,gapSize:.1}),c.jsx(H,{points:[new zt(s[0],a,h),new zt(s[s.length-1],a,h)],color:"#2ECC71",lineWidth:1,dashed:!0,dashSize:.2,gapSize:.1}),s.map((v,w)=>c.jsxs(et.Fragment,{children:[c.jsx(H,{points:[new zt(v,o,h),new zt(v,a,h)],color:"#2ECC71",lineWidth:1,dashed:!0,dashSize:.2,gapSize:.1},`vertical-guide-${w}`),c.jsx(H,{points:[new zt(v,o,h),new zt(v,o,h+r(700))],color:"#2ECC71",lineWidth:1,dashed:!0,dashSize:.2,gapSize:.1},`z-guide-floor-${w}`),c.jsx(H,{points:[new zt(v,a,h),new zt(v,a,h+r(700))],color:"#2ECC71",lineWidth:1,dashed:!0,dashSize:.2,gapSize:.1},`z-guide-ceiling-${w}`)]},`vertical-guide-group-${w}`)),e.threeUnitPositions.map((v,w)=>c.jsx(U5,{columnIndex:w,columnWidth:e.columnWidth,position:{x:v,y:m,z:0},internalSpace:i},`column-${w}`))]})},H5=({viewDirection:t})=>{const{spaceInfo:e}=Pt(),{placedModules:n}=De(),{view2DDirection:s,showDimensions:i}=nr(),r=M.useRef(null),o=t||s;if(M.useEffect(()=>{r.current&&(r.current.renderOrder=999999,r.current.traverse(_=>{"material"in _&&_.material&&(_.renderOrder=999999,_.material instanceof hv&&(_.material.depthTest=!1,_.material.depthWrite=!1,_.material.needsUpdate=!0))}))},[o,i,n]),!i)return null;const a=_=>_*.01,u=a(e.height),h=gt(e),{threeUnitBoundaries:d,columnCount:p}=h,m=n.length>0,y=o==="3D",v=u+a(m?y?350:280:y?270:200),w=-a(y?250:200),E=-a(e.width/2),C=e.frameSize||{left:50,right:50,top:50},A=(_,S,D=.015)=>{const P=new zt(S[0]-_[0],S[1]-_[1],S[2]-_[2]).normalize(),x=new zt(-P.y,P.x,0).multiplyScalar(D);return[[_[0]+P.x*D+x.x,_[1]+P.y*D+x.y,_[2]],_,[_[0]+P.x*D-x.x,_[1]+P.y*D-x.y,_[2]]]},R=()=>{switch(o){case"3D":case"front":return k();case"left":return j();case"right":return I();case"top":return T();default:return k()}},N=y?.5:0,k=()=>c.jsxs("group",{position:[0,0,N],renderOrder:9999,children:[c.jsxs("group",{children:[c.jsx(H,{points:[[E,v,.002],[a(e.width)+E,v,.002]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([E,v,.002],[E+.05,v,.002]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([a(e.width)+E,v,.002],[a(e.width)+E-.05,v,.002]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[a(e.width)/2+E,v+a(40),.01],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",children:e.width}),c.jsx(H,{points:[[E,0,.001],[E,v+a(20),.001]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[a(e.width)+E,0,.001],[a(e.width)+E,v+a(20),.001]],color:"#666666",lineWidth:1})]}),c.jsxs("group",{children:[c.jsx(H,{points:[[E,v-a(60),.002],[E+a(C.left),v-a(60),.002]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([E,v-a(60),.002],[E+.02,v-a(60),.002]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([E+a(C.left),v-a(60),.002],[E+a(C.left)-.02,v-a(60),.002]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[E+a(C.left)/2,v-a(30),.01],fontSize:.5,color:"black",anchorX:"center",anchorY:"middle",children:C.left}),c.jsx(H,{points:[[E,u,.001],[E,v-a(40),.001]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[E+a(C.left),u,.001],[E+a(C.left),v-a(40),.001]],color:"#666666",lineWidth:1})]}),c.jsxs("group",{children:[c.jsx(H,{points:[[a(e.width)+E-a(C.right),v-a(60),.002],[a(e.width)+E,v-a(60),.002]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([a(e.width)+E-a(C.right),v-a(60),.002],[a(e.width)+E-a(C.right)+.02,v-a(60),.002]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([a(e.width)+E,v-a(60),.002],[a(e.width)+E-.02,v-a(60),.002]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[a(e.width)+E-a(C.right)/2,v-a(30),.01],fontSize:.5,color:"black",anchorX:"center",anchorY:"middle",children:C.right}),c.jsx(H,{points:[[a(e.width)+E-a(C.right),u,.001],[a(e.width)+E-a(C.right),v-a(40),.001]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[a(e.width)+E,u,.001],[a(e.width)+E,v-a(40),.001]],color:"#666666",lineWidth:1})]}),!1,c.jsxs("group",{children:[c.jsx(H,{points:[[w+E,0,.002],[w+E,u,.002]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([w+E,0,.002],[w+E,.05,.002]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([w+E,u,.002],[w+E,u-.05,.002]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[w+E-a(60),u/2,.01],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:e.height}),c.jsx(H,{points:[[E,0,.001],[w+E-a(20),0,.001]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[E,u,.001],[w+E-a(20),u,.001]],color:"#666666",lineWidth:1})]}),c.jsx("group",{children:(()=>{var re;const _=a(e.width)+E+a(y?120:200),S=C.top,D=((re=e.baseConfig)==null?void 0:re.height)||65,P=e.height-S-D,x=0,V=a(D),Y=a(D+P),le=u;return c.jsxs(c.Fragment,{children:[c.jsxs("group",{children:[c.jsx(H,{points:[[_,x,.002],[_,V,.002]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_,x,.002],[_,.03,.002]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_,V,.002],[_,V-.03,.002]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[_+a(y?30:60),a(D/2),.01],fontSize:.5,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:D})]}),c.jsxs("group",{children:[c.jsx(H,{points:[[_,V,.002],[_,Y,.002]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_,V,.002],[_,V+.03,.002]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_,Y,.002],[_,Y-.03,.002]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[_+a(y?30:60),a(D+P/2),.01],fontSize:.5,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:P})]}),c.jsxs("group",{children:[c.jsx(H,{points:[[_,Y,.002],[_,le,.002]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_,Y,.002],[_,Y+.03,.002]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_,le,.002],[_,le-.03,.002]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[_+a(y?30:60),a(e.height-S/2),.01],fontSize:.5,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:S})]}),c.jsx(H,{points:[[a(e.width)+E,x,.001],[_+a(y?10:20),x,.001]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[a(e.width)+E,V,.001],[_+a(y?10:20),V,.001]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[a(e.width)+E,Y,.001],[_+a(y?10:20),Y,.001]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[a(e.width)+E,le,.001],[_+a(y?10:20),le,.001]],color:"#666666",lineWidth:1})]})})()}),n.length>0&&n.map((_,S)=>{var fe,Z,te,Ae,ce,ie;const D=ut(_.moduleId,{width:e.width,height:e.height,depth:e.depth},e);if(!D)return null;const P=a(D.dimensions.width),x=_.position.x-P/2,V=_.position.x+P/2,Y=v-a(120),le=D.id.includes("dual");le?(fe=D.modelConfig)!=null&&fe.leftSections||(Z=D.modelConfig)!=null&&Z.sections:(te=D.modelConfig)!=null&&te.sections,le&&((Ae=D.modelConfig)!=null&&Ae.rightSections||(ce=D.modelConfig)!=null&&ce.sections);let re;return le?(ie=D.modelConfig)!=null&&ie.rightAbsoluteWidth?(re=D.modelConfig.rightAbsoluteWidth,D.dimensions.width-re):(D.dimensions.width/2,re=D.dimensions.width/2):(D.dimensions.width,re=0),c.jsxs("group",{renderOrder:999999,children:[c.jsx(H,{points:[[x,u,.001],[x,u,.001]],color:"#cccccc",lineWidth:1,dashed:!0,dashSize:.02,gapSize:.01,renderOrder:999999}),c.jsx(H,{points:[[V,u,.001],[V,u,.001]],color:"#cccccc",lineWidth:1,dashed:!0,dashSize:.02,gapSize:.01,renderOrder:999999}),c.jsx(H,{points:[[x,Y,.002],[V,Y,.002]],color:"#666666",lineWidth:1,renderOrder:999999}),c.jsx(H,{points:A([x,Y,.002],[x+.02,Y,.002],.01),color:"#666666",lineWidth:1,renderOrder:999999}),c.jsx(H,{points:A([V,Y,.002],[V-.02,Y,.002],.01),color:"#666666",lineWidth:1,renderOrder:999999}),c.jsx(Ke,{position:[_.position.x,Y-a(30),.01],fontSize:.5,color:"#666666",anchorX:"center",anchorY:"middle",renderOrder:999999,children:D.dimensions.width}),c.jsx(H,{points:[[x,u,.001],[x,v+a(20),.001]],color:"#666666",lineWidth:1,renderOrder:999999}),c.jsx(H,{points:[[V,u,.001],[V,v+a(20),.001]],color:"#666666",lineWidth:1,renderOrder:999999})]},`module-guide-${S}`)})]}),j=()=>{const _=a(e.depth),S=e.frameSize||{top:50},D=u+a(150),P=-a(200);return c.jsxs("group",{children:[c.jsx(H,{points:[[0,D,0],[0,D,_]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([0,D,0],[0,D,.05]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([0,D,_],[0,D,_-.05]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[0,D+a(40),_/2],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",children:e.depth}),c.jsx(H,{points:[[0,0,0],[0,D+a(20),0]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[0,0,_],[0,D+a(20),_]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[0,0,P],[0,u,P]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([0,0,P],[0,.05,P]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([0,u,P],[0,u-.05,P]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[0,u/2,P-a(60)],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:e.height}),c.jsx(H,{points:[[0,0,0],[0,0,P-a(20)]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[0,u,0],[0,u,P-a(20)]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[0,u,P+a(60)],[0,u+a(S.top),P+a(60)]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([0,u,P+a(60)],[0,u+.02,P+a(60)]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([0,u+a(S.top),P+a(60)],[0,u+a(S.top)-.02,P+a(60)]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[0,u+a(S.top/2),P+a(100)],fontSize:.5,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:S.top}),n.map((x,V)=>{const Y=ut(x.moduleId,{width:e.width,height:e.height,depth:e.depth},e);if(!Y)return null;const le=x.customDepth||Y.dimensions.depth,re=a(le),fe=D-a(80);return c.jsxs("group",{children:[c.jsx(H,{points:[[0,fe,0],[0,fe,re]],color:"#ff9800",lineWidth:1}),c.jsx(H,{points:A([0,fe,0],[0,fe,.03],.015),color:"#ff9800",lineWidth:1}),c.jsx(H,{points:A([0,fe,re],[0,fe,re-.03],.015),color:"#ff9800",lineWidth:1}),c.jsxs(Ke,{position:[0,fe+a(30),re/2],fontSize:.4,color:"#ff9800",anchorX:"center",anchorY:"middle",children:[le,"mm"]})]},`left-module-dim-${V}`)})]})},I=()=>{const _=a(e.width),S=a(e.depth),D=e.frameSize||{top:50},P=u+a(150),x=-a(200);return c.jsxs("group",{children:[c.jsx(H,{points:[[_,P,0],[_,P,S]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_,P,0],[_,P,.05]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_,P,S],[_,P,S-.05]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[_,P+a(40),S/2],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",children:e.depth}),c.jsx(H,{points:[[_,0,0],[_,P+a(20),0]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[_,0,S],[_,P+a(20),S]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[_,0,x],[_,u,x]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_,0,x],[_,.05,x]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_,u,x],[_,u-.05,x]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[_,u/2,x-a(60)],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:e.height}),c.jsx(H,{points:[[_,0,0],[_,0,x-a(20)]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[_,u,0],[_,u,x-a(20)]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[_,u,x+a(60)],[_,u+a(D.top),x+a(60)]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_,u,x+a(60)],[_,u+.02,x+a(60)]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_,u+a(D.top),x+a(60)],[_,u+a(D.top)-.02,x+a(60)]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[_,u+a(D.top/2),x+a(100)],fontSize:.5,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:D.top}),n.map((V,Y)=>{const le=ut(V.moduleId,{width:e.width,height:e.height,depth:e.depth},e);if(!le)return null;const re=V.customDepth||le.dimensions.depth,fe=a(re),Z=P-a(80);return c.jsxs("group",{children:[c.jsx(H,{points:[[_,Z,0],[_,Z,fe]],color:"#ff9800",lineWidth:1}),c.jsx(H,{points:A([_,Z,0],[_,Z,.03],.015),color:"#ff9800",lineWidth:1}),c.jsx(H,{points:A([_,Z,fe],[_,Z,fe-.03],.015),color:"#ff9800",lineWidth:1}),c.jsxs(Ke,{position:[_,Z+a(30),fe/2],fontSize:.4,color:"#ff9800",anchorX:"center",anchorY:"middle",children:[re,"mm"]})]},`right-module-dim-${Y}`)})]})},T=()=>{const _=a(e.width),S=a(e.depth),D=e.frameSize||{left:50,right:50},P=-a(150),x=-a(200),V=-a(e.width/2);return c.jsxs("group",{children:[c.jsx(H,{points:[[V,u,P],[_+V,u,P]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([V,u,P],[V+.05,u,P]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_+V,u,P],[_+V-.05,u,P]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[_/2+V,u,P-a(40)],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",children:e.width}),c.jsx(H,{points:[[V,u,0],[V,u,P-a(20)]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[_+V,u,0],[_+V,u,P-a(20)]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[V,u,P+a(60)],[V+a(D.left),u,P+a(60)]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([V,u,P+a(60)],[V+.02,u,P+a(60)]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([V+a(D.left),u,P+a(60)],[V+a(D.left)-.02,u,P+a(60)]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[V+a(D.left/2),u,P+a(100)],fontSize:.5,color:"black",anchorX:"center",anchorY:"middle",children:D.left}),c.jsx(H,{points:[[_+V-a(D.right),u,P+a(60)],[_+V,u,P+a(60)]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_+V-a(D.right),u,P+a(60)],[_+V-a(D.right)+.02,u,P+a(60)]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([_+V,u,P+a(60)],[_+V-.02,u,P+a(60)]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[_+V-a(D.right/2),u,P+a(100)],fontSize:.5,color:"black",anchorX:"center",anchorY:"middle",children:D.right}),c.jsx(H,{points:[[x+V,u,0],[x+V,u,S]],color:"#666666",lineWidth:1}),c.jsx(H,{points:A([x+V,u,0],[x+V,u,.05]),color:"#666666",lineWidth:1}),c.jsx(H,{points:A([x+V,u,S],[x+V,u,S-.05]),color:"#666666",lineWidth:1}),c.jsx(Ke,{position:[x+V-a(60),u,S/2],fontSize:.6,color:"black",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:e.depth}),c.jsx(H,{points:[[V,u,0],[x+V-a(20),u,0]],color:"#666666",lineWidth:1}),c.jsx(H,{points:[[V,u,S],[x+V-a(20),u,S]],color:"#666666",lineWidth:1}),n.map((Y,le)=>{const re=ut(Y.moduleId,{width:e.width,height:e.height,depth:e.depth},e);if(!re)return null;const fe=a(re.dimensions.width),Z=Y.customDepth||re.dimensions.depth,te=a(Z),Ae=Y.position.x-fe/2,ce=Y.position.x+fe/2,ie=P+a(120);return c.jsxs("group",{children:[c.jsx(H,{points:[[Ae,u,ie],[ce,u,ie]],color:"#ff9800",lineWidth:1}),c.jsx(H,{points:A([Ae,u,ie],[Ae+.02,u,ie],.015),color:"#ff9800",lineWidth:1}),c.jsx(H,{points:A([ce,u,ie],[ce-.02,u,ie],.015),color:"#ff9800",lineWidth:1}),c.jsxs(Ke,{position:[Y.position.x,u,ie-a(30)],fontSize:.4,color:"#ff9800",anchorX:"center",anchorY:"middle",children:[re.dimensions.width,"mm"]}),c.jsx(H,{points:[[ce+a(40),u,0],[ce+a(40),u,te]],color:"#4caf50",lineWidth:1}),c.jsx(H,{points:A([ce+a(40),u,0],[ce+a(40),u,.02],.01),color:"#4caf50",lineWidth:1}),c.jsx(H,{points:A([ce+a(40),u,te],[ce+a(40),u,te-.02],.01),color:"#4caf50",lineWidth:1}),c.jsxs(Ke,{position:[ce+a(80),u,te/2],fontSize:.35,color:"#4caf50",anchorX:"center",anchorY:"middle",rotation:[0,0,-Math.PI/2],children:[Z,"mm"]})]},`top-module-dim-${le}`)})]})};return c.jsx("group",{ref:r,renderOrder:999999,children:R()})},W5=({spaceInfo:t})=>{const e=De(v=>v.placedModules),n=De(v=>v.addModule),s=De(v=>v.currentDragData),i=De(v=>v.setCurrentDragData),{camera:r,scene:o}=Sh(),[a,u]=M.useState(null),h=pt(t),d=gt(t),p=et.useCallback((v,w)=>{var _;if(!s)return!1;let E;try{const S=(_=v.dataTransfer)==null?void 0:_.getData("application/json");if(!S)return!1;E=JSON.parse(S)}catch(S){return console.error("Error parsing drag data:",S),!1}if(!E||E.type!=="furniture")return!1;const C=Yu(v.clientX,v.clientY,w,r,o,t);if(C===null)return!1;const A=Ba(E.moduleData.id,t);if(!lo(C,A,e,t))return!1;const R=p6(C,E.moduleData.id,t);if(R===null)return!1;const N=`placed-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,k=ut(E.moduleData.id,h,t),I=(S=>{if(console.log("⚙️ [SlotDropZones] getDefaultDepth 계산:",{moduleId:S==null?void 0:S.id,moduleName:S==null?void 0:S.name,moduleDefaultDepth:S==null?void 0:S.defaultDepth,spaceDepth:t.depth}),S!=null&&S.defaultDepth){const x=Math.min(S.defaultDepth,t.depth);return console.log("✅ [SlotDropZones] defaultDepth 사용:",{moduleDefaultDepth:S.defaultDepth,spaceDepth:t.depth,finalResult:x}),x}const D=Math.floor(t.depth*.9),P=Math.min(D,580);return console.log("⚠️ [SlotDropZones] fallback 사용:",{spaceBasedDepth:D,fallbackLimit:580,finalResult:P,reason:"moduleData?.defaultDepth가 없음"}),P})(k),T={id:N,moduleId:E.moduleData.id,position:{x:R,y:0,z:0},rotation:0,hasDoor:E.moduleData.hasDoor??!1,customDepth:I,slotIndex:C,isDualSlot:A,isValidInCurrentSpace:!0};return n(T),i(null),!0},[s,r,o,t,h,e,n,i]);M.useEffect(()=>(window.handleSlotDrop=p,()=>{delete window.handleSlotDrop}),[p]),M.useEffect(()=>{var C;if(!s)return;const v=A=>{A.preventDefault();const R=document.querySelector("canvas");if(!R)return;const N=Yu(A.clientX,A.clientY,R,r,o,t);if(N!==null&&s){const k=Ba(s.moduleData.id,t);lo(N,k,e,t)?u(N):u(null)}else u(N)},w=()=>{u(null)},E=(C=document.querySelector("canvas"))==null?void 0:C.parentElement;return E&&(E.addEventListener("dragover",v),E.addEventListener("dragleave",w)),()=>{E&&(E.removeEventListener("dragover",v),E.removeEventListener("dragleave",w))}},[s,r,o,t,e]);const m=d6(t),y=f6(t);return c.jsxs("group",{children:[d.threeUnitPositions.map((v,w)=>c.jsxs("mesh",{position:[v,y+m.height/2,0],userData:{slotIndex:w,isSlotCollider:!0,type:"slot-collider"},visible:!1,children:[c.jsx("boxGeometry",{args:[m.width,m.height,m.depth]}),c.jsx("meshBasicMaterial",{transparent:!0,opacity:0})]},`slot-collider-${w}`)),d.threeUnitPositions.map((v,w)=>{let E=!1;s&&(E=Ba(s.moduleData.id,t));let C=!1;if(a!==null&&s&&(E?C=w===a||w===a+1:C=w===a),!C||!s)return null;const A=ut(s.moduleData.id,h,t);if(!A)return null;const N=(Z=>{if(Z!=null&&Z.defaultDepth)return Math.min(Z.defaultDepth,t.depth);const te=Math.floor(t.depth*.9);return Math.min(te,580)})(A),k=A.dimensions.height*.01,j=y+k/2;let I=v;if(E&&a!==null&&w===a){const Z=d.threeUnitPositions[w+1];Z!==void 0&&(I=(v+Z)/2)}else if(E&&a!==null&&w===a+1)return null;const T=Z=>Z*.01,S=T(20),D=1500,P=600,x=T(D),V=T(P),le=-x/2+(x-V)/2,re=T(N),fe=le+V/2-S-re/2;return c.jsx("group",{position:[I,j,fe],children:c.jsx(r1,{moduleData:A,color:"#88ff88",isDragging:!0,internalHeight:A.dimensions.height,hasDoor:!1,customDepth:N,spaceInfo:t})},`furniture-preview-${w}`)})]})},X5="_shortcutsPanel_c1pi5_1",G5="_collapsed_c1pi5_14",z5="_expanded_c1pi5_25",Y5="_header_c1pi5_31",q5="_title_c1pi5_40",K5="_expandButton_c1pi5_51",Q5="_expandIcon_c1pi5_72",J5="_collapseButton_c1pi5_79",Z5="_shortcuts_c1pi5_1",e4="_shortcutItem_c1pi5_111",t4="_key_c1pi5_119",n4="_action_c1pi5_136",Xt={shortcutsPanel:X5,collapsed:G5,expanded:z5,header:Y5,title:q5,expandButton:K5,expandIcon:Q5,collapseButton:J5,shortcuts:Z5,shortcutItem:e4,key:t4,action:n4},s4=()=>{const[t,e]=M.useState(!1),n=[{key:"좌클릭",action:"가구 선택/이동"},{key:"더블클릭",action:"가구 편집모드"},{key:"휠클릭",action:"화면 이동"},{key:"Option+드래그",action:"화면 이동"},{key:"우클릭",action:"카메라 회전"},{key:"휠스크롤",action:"줌 인/아웃"},{key:"←/→",action:"가구 이동"},{key:"Del",action:"가구 삭제"},{key:"Esc",action:"편집 종료"}],s=()=>{e(!t)};return c.jsx("div",{className:`${Xt.shortcutsPanel} ${t?Xt.expanded:Xt.collapsed}`,children:t?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:Xt.header,children:[c.jsx("div",{className:Xt.title,children:"조작법"}),c.jsx("button",{className:Xt.collapseButton,onClick:s,"aria-label":"조작법 접기",title:"접기",children:"↑"})]}),c.jsx("div",{className:Xt.shortcuts,children:n.map((i,r)=>c.jsxs("div",{className:Xt.shortcutItem,children:[c.jsx("span",{className:Xt.key,children:i.key}),c.jsx("span",{className:Xt.action,children:i.action})]},r))})]}):c.jsx("button",{className:Xt.expandButton,onClick:s,"aria-label":"조작법 보기",title:"조작법 보기",children:c.jsx("span",{className:Xt.expandIcon,children:"↓"})})})},i4=t=>{const{spaceInfo:e,svgSize:n,viewMode:s="3D",setViewMode:i,renderMode:r="wireframe"}=t,o=Cm(),{spaceInfo:a}=Pt(),{placedModules:u}=De(),{view2DDirection:h}=nr(),d=a.materialConfig||{interiorColor:"#FFFFFF",doorColor:"#FFFFFF"},p=M.useMemo(()=>{const{width:w,height:E,depth:C=600}=e,A=i6(w,E,C,u.length),R=0,N=ll(E*.5),k=0,j=[R,N,A];if(s==="3D")return j;switch(h){case"front":return j;case"left":return[-A,N,k];case"right":return[A,N,k];case"top":return[R,ll(E+A*10),k];default:return j}},[e,s,h,u.length]),m=M.useMemo(()=>`${o.pathname}-${s}-${h}`,[o.pathname,s,h]),y=w=>{w.preventDefault(),w.stopPropagation();const E=w.currentTarget.querySelector("canvas");if(!E)return;const C=window.handleSlotDrop;typeof C=="function"&&C(w.nativeEvent,E)},v=w=>{w.preventDefault()};return M.useEffect(()=>()=>{(()=>{document.querySelectorAll("canvas").forEach(C=>{const A=C.getContext("2d");A&&A.clearRect(0,0,C.width,C.height);const R=C.getContext("webgl")||C.getContext("webgl2");if(R&&!R.isContextLost())try{const N=R.getExtension("WEBGL_lose_context");N&&N.loseContext()}catch(N){console.log("WebGL context cleanup error:",N)}})})()},[]),c.jsx(e6,{spaceInfo:e,svgSize:n,renderMode:r,children:c.jsxs("div",{style:{width:"100%",height:"100%",minHeight:"400px",position:"relative"},onDrop:y,onDragOver:v,children:[c.jsx(h6,{cameraPosition:p,viewMode:s,renderMode:r,children:c.jsxs(et.Suspense,{fallback:null,children:[c.jsx("directionalLight",{position:[5,15,20],intensity:2.5,color:"#ffffff",castShadow:!0,"shadow-mapSize-width":4096,"shadow-mapSize-height":4096,"shadow-camera-far":50,"shadow-camera-left":-25,"shadow-camera-right":25,"shadow-camera-top":25,"shadow-camera-bottom":-25,"shadow-bias":-1e-4,"shadow-radius":8,"shadow-normalBias":.015}),c.jsx("directionalLight",{position:[-8,10,15],intensity:.6,color:"#ffffff"}),c.jsx("directionalLight",{position:[8,10,15],intensity:.6,color:"#ffffff"}),c.jsx("ambientLight",{intensity:.5,color:"#ffffff"}),c.jsx(B5,{spaceInfo:e,viewMode:s,materialConfig:d}),s==="3D"&&c.jsx($5,{}),c.jsx(H5,{viewDirection:s==="3D"?"3D":h}),c.jsx(W5,{spaceInfo:e})]})}),c.jsx(s4,{})]},m)})},r4=et.memo(i4),o4="_container_4zesp_1",a4="_tabMenu_4zesp_7",l4="_tabButton_4zesp_16",c4="_activeTab_4zesp_33",u4="_thumbnailGrid_4zesp_41",h4="_thumbnailItem_4zesp_49",d4="_disabled_4zesp_76",f4="_thumbnailImage_4zesp_89",p4="_disabledOverlay_4zesp_105",g4="_emptyMessage_4zesp_124",kt={container:o4,tabMenu:a4,tabButton:l4,activeTab:c4,thumbnailGrid:u4,thumbnailItem:h4,disabled:d4,thumbnailImage:f4,disabledOverlay:p4,emptyMessage:g4},Un=t=>{const e=`/250709in/images/furniture-thumbnails/${t}`;return console.log(`🖼️ [썸네일 경로] ${t} → ${e}`),e},$g={"single-2drawer-hanging":Un("single-2drawer-hanging.png"),"single-2hanging":Un("single-2hanging.png"),"single-4drawer-hanging":Un("single-4drawer-hanging.png"),"dual-2drawer-hanging":Un("dual-2drawer-hanging.png"),"dual-2hanging":Un("dual-2hanging.png"),"dual-4drawer-hanging":Un("dual-4drawer-hanging.png"),"dual-2drawer-styler":Un("dual-2drawer-styler.png"),"dual-4drawer-pantshanger":Un("dual-4drawer-pantshanger.png")},m4=({module:t,iconPath:e,isValid:n})=>{const s=De(a=>a.setFurniturePlacementMode),i=De(a=>a.setCurrentDragData),r=a=>{if(!n){a.preventDefault();return}s(!0);const u={type:"furniture",moduleData:{id:t.id,name:t.name,dimensions:t.dimensions,type:t.type||"default",color:t.color,hasDoor:t.hasDoor||!1}};a.dataTransfer.setData("application/json",JSON.stringify(u)),a.dataTransfer.setData("text/plain",t.id),a.dataTransfer.effectAllowed="copy",i(u)},o=()=>{s(!1),i(null)};return c.jsxs("div",{className:`${kt.thumbnailItem} ${n?"":kt.disabled}`,draggable:n,onDragStart:r,onDragEnd:o,title:n?`드래그하여 배치: ${t.name}`:"현재 공간에 배치할 수 없습니다",children:[c.jsx("div",{className:kt.thumbnailImage,children:c.jsx("img",{src:e,alt:t.name,onError:a=>{const u=a.target;u.dataset.fallbackAttempted||(u.dataset.fallbackAttempted="true",u.src=Un("single-2drawer-hanging.png"))}})}),!n&&c.jsx("div",{className:kt.disabledOverlay})]})},_4=()=>{const[t,e]=M.useState("all"),{spaceInfo:n}=Pt(),s=pt(n),i=gt(n),r=i.columnWidth,o=nC("full",s,n),{singleModules:a,dualModules:u}=M.useMemo(()=>i.columnCount<=1?{singleModules:o,dualModules:[]}:o.reduce((y,v)=>{const w=v.dimensions.width;if(Math.abs(w-r)<=30)y.singleModules.push(v);else if(Math.abs(w-r*2)<=30){if((v.id.includes("dual-2drawer-styler-")||v.id.includes("dual-4drawer-pantshanger-"))&&r<550)return y;y.dualModules.push(v)}else if(w<r*1.5)y.singleModules.push(v);else{if((v.id.includes("dual-2drawer-styler-")||v.id.includes("dual-4drawer-pantshanger-"))&&r<550)return y;y.dualModules.push(v)}return y},{singleModules:[],dualModules:[]}),[o,r,i.columnCount]),h=t==="all"?[...a,...u]:t==="single"?a:u,d=m=>{const y=m.replace(/-\d+$/,"");return $g[y]||$g["single-2drawer-hanging"]},p=m=>m.dimensions.width<=s.width&&m.dimensions.height<=s.height&&m.dimensions.depth<=s.depth;return c.jsxs("div",{className:kt.container,children:[c.jsxs("div",{className:kt.tabMenu,children:[c.jsxs("button",{className:`${kt.tabButton} ${t==="all"?kt.activeTab:""}`,onClick:()=>e("all"),children:["전체 (",a.length+u.length,")"]}),c.jsxs("button",{className:`${kt.tabButton} ${t==="single"?kt.activeTab:""}`,onClick:()=>e("single"),children:["싱글 (",a.length,")"]}),c.jsxs("button",{className:`${kt.tabButton} ${t==="dual"?kt.activeTab:""}`,onClick:()=>e("dual"),children:["듀얼 (",u.length,")"]})]}),c.jsx("div",{className:kt.thumbnailGrid,children:h.length>0?h.map(m=>{const y=d(m.id),v=p(m);return c.jsx(m4,{module:m,iconPath:y,isValid:v},m.id)}):c.jsx("div",{className:kt.emptyMessage,children:"이 유형에 맞는 가구가 없습니다"})})]})},y4="_overlay_yemqx_1",v4="_panel_yemqx_14",w4="_header_yemqx_26",T4="_title_yemqx_35",E4="_closeButton_yemqx_42",A4="_content_yemqx_62",x4="_moduleInfo_yemqx_68",I4="_modulePreview_yemqx_74",S4="_moduleBox_yemqx_86",b4="_moduleDetails_yemqx_93",C4="_moduleName_yemqx_97",D4="_property_yemqx_104",P4="_propertyLabel_yemqx_114",R4="_propertyValue_yemqx_122",N4="_placeholder_yemqx_129",Ve={overlay:y4,panel:v4,header:w4,title:T4,closeButton:E4,content:A4,moduleInfo:x4,modulePreview:I4,moduleBox:S4,moduleDetails:b4,moduleName:C4,property:D4,propertyLabel:P4,propertyValue:R4,placeholder:N4},M4=()=>{const{spaceInfo:t}=Pt(),{selectedModuleForProperties:e,setSelectedModuleForProperties:n}=nr();if(!e)return null;const s=pt(t),i=ut(e,s,t);if(!i)return null;const r=()=>{n(null)},o=a=>{a.target===a.currentTarget&&r()};return c.jsx("div",{className:Ve.overlay,onClick:o,children:c.jsxs("div",{className:Ve.panel,children:[c.jsxs("div",{className:Ve.header,children:[c.jsx("h3",{className:Ve.title,children:"가구 속성"}),c.jsx("button",{className:Ve.closeButton,onClick:r,children:"✕"})]}),c.jsxs("div",{className:Ve.content,children:[c.jsxs("div",{className:Ve.moduleInfo,children:[c.jsx("div",{className:Ve.modulePreview,children:c.jsx("div",{className:Ve.moduleBox,style:{backgroundColor:i.color,aspectRatio:`${i.dimensions.width} / ${i.dimensions.height}`}})}),c.jsxs("div",{className:Ve.moduleDetails,children:[c.jsx("h4",{className:Ve.moduleName,children:i.name}),c.jsxs("div",{className:Ve.property,children:[c.jsx("span",{className:Ve.propertyLabel,children:"크기:"}),c.jsxs("span",{className:Ve.propertyValue,children:[i.dimensions.width," × ",i.dimensions.height," × ",i.dimensions.depth,"mm"]})]}),c.jsxs("div",{className:Ve.property,children:[c.jsx("span",{className:Ve.propertyLabel,children:"타입:"}),c.jsx("span",{className:Ve.propertyValue,children:i.type||"기본"})]}),c.jsxs("div",{className:Ve.property,children:[c.jsx("span",{className:Ve.propertyLabel,children:"도어:"}),c.jsx("span",{className:Ve.propertyValue,children:i.hasDoor?"있음":"없음"})]}),i.description&&c.jsxs("div",{className:Ve.property,children:[c.jsx("span",{className:Ve.propertyLabel,children:"설명:"}),c.jsx("span",{className:Ve.propertyValue,children:i.description})]}),i.isDynamic&&c.jsxs("div",{className:Ve.property,children:[c.jsx("span",{className:Ve.propertyLabel,children:"맞춤형:"}),c.jsx("span",{className:Ve.propertyValue,children:"예"})]})]})]}),c.jsx("div",{className:Ve.placeholder,children:c.jsx("p",{children:"추가 속성 설정은 곧 추가될 예정입니다."})})]})]})})},j4="_overlay_pi4u7_1",L4="_panel_pi4u7_15",k4="_header_pi4u7_38",F4="_title_pi4u7_48",O4="_closeButton_pi4u7_54",V4="_content_pi4u7_73",B4="_moduleInfo_pi4u7_79",U4="_modulePreview_pi4u7_87",$4="_moduleBox_pi4u7_99",H4="_moduleDetails_pi4u7_106",W4="_moduleName_pi4u7_110",X4="_property_pi4u7_117",G4="_propertyLabel_pi4u7_127",z4="_propertyValue_pi4u7_135",Y4="_propertySection_pi4u7_142",q4="_sectionTitle_pi4u7_150",K4="_depthInputWrapper_pi4u7_160",Q4="_inputWithUnit_pi4u7_166",J4="_depthInput_pi4u7_160",Z4="_inputError_pi4u7_188",e3="_unit_pi4u7_193",t3="_errorMessage_pi4u7_201",n3="_depthRange_pi4u7_207",s3="_doorSelector_pi4u7_247",i3="_hingeSubSection_pi4u7_255",r3="_subSectionTitle_pi4u7_260",o3="_hingeSelector_pi4u7_267",a3="_radioLabel_pi4u7_273",l3="_radioText_pi4u7_293",c3="_editGuide_pi4u7_304",we={overlay:j4,panel:L4,header:k4,title:F4,closeButton:O4,content:V4,moduleInfo:B4,modulePreview:U4,moduleBox:$4,moduleDetails:H4,moduleName:W4,property:X4,propertyLabel:G4,propertyValue:z4,propertySection:Y4,sectionTitle:q4,depthInputWrapper:K4,inputWithUnit:Q4,depthInput:J4,inputError:Z4,unit:e3,errorMessage:t3,depthRange:n3,doorSelector:s3,hingeSubSection:i3,subSectionTitle:r3,hingeSelector:o3,radioLabel:a3,radioText:l3,editGuide:c3},u3=()=>{const{spaceInfo:t}=Pt(),e=De(x=>x.placedModules),n=De(x=>x.updatePlacedModule),s=De(x=>x.editMode),i=De(x=>x.editingModuleId),r=De(x=>x.setEditMode),o=De(x=>x.setEditingModuleId),a=e.find(x=>x.id===i),u=M.useCallback(x=>{if(x!=null&&x.defaultDepth)return Math.min(x.defaultDepth,t.depth);const V=Math.floor(t.depth*.9);return Math.min(V,Gs.DEPTH.DEFAULT_FALLBACK)},[t.depth]),[h,d]=M.useState(580),[p,m]=M.useState("580"),[y,v]=M.useState(""),[w,E]=M.useState("right"),[C,A]=M.useState(!1);if(M.useEffect(()=>{if(a){const x=pt(t),V=ut(a.moduleId,x,t),Y=a.customDepth||u(V||void 0);d(Y),m(Y.toString()),E(a.hingePosition||"right"),A(a.hasDoor??!1)}},[a,t,u]),!s||!i||!a)return null;const R=pt(t),N=ut(a.moduleId,R,t);if(!N)return null;const k=a.moduleId.includes("dual"),j=()=>{r(!1),o(null)},I=x=>{d(x),i&&n(i,{customDepth:x})},T=x=>{(x===""||/^\d+$/.test(x))&&(m(x),v(""))},_=()=>{const x=p;if(x===""){m(h.toString());return}const V=parseInt(x),Y=Gs.DEPTH.MIN,le=Math.min(t.depth,Gs.DEPTH.MAX);V<Y?v(`최소 ${Y}mm 이상이어야 합니다`):V>le?v(`최대 ${le}mm 이하여야 합니다`):(v(""),I(V))},S=x=>{x.key==="Enter"&&_()},D=x=>{E(x),i&&n(i,{hingePosition:x})},P=x=>{A(x),i&&n(i,{hasDoor:x})};return c.jsx("div",{className:we.overlay,children:c.jsxs("div",{className:we.panel,children:[c.jsxs("div",{className:we.header,children:[c.jsx("h3",{className:we.title,children:"가구 편집"}),c.jsx("button",{className:we.closeButton,onClick:j,children:"✕"})]}),c.jsxs("div",{className:we.content,children:[c.jsxs("div",{className:we.moduleInfo,children:[c.jsx("div",{className:we.modulePreview,children:c.jsx("div",{className:we.moduleBox,style:{backgroundColor:N.color,aspectRatio:`${N.dimensions.width} / ${N.dimensions.height}`}})}),c.jsxs("div",{className:we.moduleDetails,children:[c.jsx("h4",{className:we.moduleName,children:N.name}),c.jsxs("div",{className:we.property,children:[c.jsx("span",{className:we.propertyLabel,children:"크기:"}),c.jsxs("span",{className:we.propertyValue,children:[N.dimensions.width," × ",N.dimensions.height," × ",h,"mm"]})]}),c.jsxs("div",{className:we.property,children:[c.jsx("span",{className:we.propertyLabel,children:"위치:"}),c.jsxs("span",{className:we.propertyValue,children:["X: ",Math.round(a.position.x*100),"mm, Z: ",Math.round(a.position.z*100),"mm"]})]})]})]}),c.jsxs("div",{className:we.propertySection,children:[c.jsx("h5",{className:we.sectionTitle,children:"가구 깊이"}),c.jsxs("div",{className:we.depthInputWrapper,children:[c.jsxs("div",{className:we.inputWithUnit,children:[c.jsx("input",{type:"text",value:p,onChange:x=>T(x.target.value),onBlur:_,onKeyDown:S,className:`${we.depthInput} ${y?we.inputError:""}`,placeholder:`${Gs.DEPTH.MIN}-${Gs.DEPTH.MAX}`}),c.jsx("span",{className:we.unit,children:"mm"})]}),y&&c.jsx("div",{className:we.errorMessage,children:y}),c.jsxs("div",{className:we.depthRange,children:["범위: ",Gs.DEPTH.MIN,"mm ~ ",Math.min(t.depth,Gs.DEPTH.MAX),"mm"]})]})]}),N.hasDoor&&c.jsxs("div",{className:we.propertySection,children:[c.jsx("h5",{className:we.sectionTitle,children:"도어 유무"}),c.jsxs("div",{className:we.doorSelector,children:[c.jsxs("label",{className:we.radioLabel,children:[c.jsx("input",{type:"radio",name:"doorOption",value:"none",checked:!C,onChange:()=>P(!1)}),c.jsx("span",{className:we.radioText,children:"없음 (오픈형으로 설치)"})]}),c.jsxs("label",{className:we.radioLabel,children:[c.jsx("input",{type:"radio",name:"doorOption",value:"with-door",checked:C,onChange:()=>P(!0)}),c.jsx("span",{className:we.radioText,children:"있음 (문짝으로 설치)"})]})]}),C&&!k&&c.jsxs("div",{className:we.hingeSubSection,children:[c.jsx("h6",{className:we.subSectionTitle,children:"힌지 위치"}),c.jsxs("div",{className:we.hingeSelector,children:[c.jsxs("label",{className:we.radioLabel,children:[c.jsx("input",{type:"radio",name:"hingePosition",value:"left",checked:w==="left",onChange:()=>D("left")}),c.jsx("span",{className:we.radioText,children:"왼쪽 (오른쪽으로 열림)"})]}),c.jsxs("label",{className:we.radioLabel,children:[c.jsx("input",{type:"radio",name:"hingePosition",value:"right",checked:w==="right",onChange:()=>D("right")}),c.jsx("span",{className:we.radioText,children:"오른쪽 (왼쪽으로 열림)"})]})]})]})]}),c.jsxs("div",{className:we.editGuide,children:[c.jsx("p",{children:"• 가구를 더블클릭하여 편집모드에 진입할 수 있습니다"}),c.jsx("p",{children:"• 마우스 드래그로 가구를 이동할 수 있습니다"}),c.jsx("p",{children:"• 키보드 화살표로 가구를 이동할 수 있습니다"}),c.jsx("p",{children:"• Delete 키로 가구를 삭제할 수 있습니다"}),c.jsx("p",{children:"• Esc 키로 편집을 종료할 수 있습니다"})]})]})]})})};function tc(){return(tc=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t}).apply(this,arguments)}function o1(t,e){if(t==null)return{};var n,s,i={},r=Object.keys(t);for(s=0;s<r.length;s++)e.indexOf(n=r[s])>=0||(i[n]=t[n]);return i}function rh(t){var e=M.useRef(t),n=M.useRef(function(s){e.current&&e.current(s)});return e.current=t,n.current}var mo=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=1),t>n?n:t<e?e:t},qr=function(t){return"touches"in t},oh=function(t){return t&&t.ownerDocument.defaultView||self},Hg=function(t,e,n){var s=t.getBoundingClientRect(),i=qr(e)?function(r,o){for(var a=0;a<r.length;a++)if(r[a].identifier===o)return r[a];return r[0]}(e.touches,n):e;return{left:mo((i.pageX-(s.left+oh(t).pageXOffset))/s.width),top:mo((i.pageY-(s.top+oh(t).pageYOffset))/s.height)}},Wg=function(t){!qr(t)&&t.preventDefault()},a1=et.memo(function(t){var e=t.onMove,n=t.onKey,s=o1(t,["onMove","onKey"]),i=M.useRef(null),r=rh(e),o=rh(n),a=M.useRef(null),u=M.useRef(!1),h=M.useMemo(function(){var y=function(E){Wg(E),(qr(E)?E.touches.length>0:E.buttons>0)&&i.current?r(Hg(i.current,E,a.current)):w(!1)},v=function(){return w(!1)};function w(E){var C=u.current,A=oh(i.current),R=E?A.addEventListener:A.removeEventListener;R(C?"touchmove":"mousemove",y),R(C?"touchend":"mouseup",v)}return[function(E){var C=E.nativeEvent,A=i.current;if(A&&(Wg(C),!function(N,k){return k&&!qr(N)}(C,u.current)&&A)){if(qr(C)){u.current=!0;var R=C.changedTouches||[];R.length&&(a.current=R[0].identifier)}A.focus(),r(Hg(A,C,a.current)),w(!0)}},function(E){var C=E.which||E.keyCode;C<37||C>40||(E.preventDefault(),o({left:C===39?.05:C===37?-.05:0,top:C===40?.05:C===38?-.05:0}))},w]},[o,r]),d=h[0],p=h[1],m=h[2];return M.useEffect(function(){return m},[m]),et.createElement("div",tc({},s,{onTouchStart:d,onMouseDown:d,className:"react-colorful__interactive",ref:i,onKeyDown:p,tabIndex:0,role:"slider"}))}),Bd=function(t){return t.filter(Boolean).join(" ")},l1=function(t){var e=t.color,n=t.left,s=t.top,i=s===void 0?.5:s,r=Bd(["react-colorful__pointer",t.className]);return et.createElement("div",{className:r,style:{top:100*i+"%",left:100*n+"%"}},et.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:e}}))},cn=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=Math.pow(10,e)),Math.round(n*t)/n},h3=function(t){var e=t.s,n=t.v,s=t.a,i=(200-e)*n/100;return{h:cn(t.h),s:cn(i>0&&i<200?e*n/100/(i<=100?i:200-i)*100:0),l:cn(i/2),a:cn(s,2)}},ah=function(t){var e=h3(t);return"hsl("+e.h+", "+e.s+"%, "+e.l+"%)"},d3=function(t){return{h:cn(t.h),s:cn(t.s),v:cn(t.v),a:cn(t.a,2)}},f3=et.memo(function(t){var e=t.hue,n=t.onChange,s=Bd(["react-colorful__hue",t.className]);return et.createElement("div",{className:s},et.createElement(a1,{onMove:function(i){n({h:360*i.left})},onKey:function(i){n({h:mo(e+360*i.left,0,360)})},"aria-label":"Hue","aria-valuenow":cn(e),"aria-valuemax":"360","aria-valuemin":"0"},et.createElement(l1,{className:"react-colorful__hue-pointer",left:e/360,color:ah({h:e,s:100,v:100,a:1})})))}),p3=et.memo(function(t){var e=t.hsva,n=t.onChange,s={backgroundColor:ah({h:e.h,s:100,v:100,a:1})};return et.createElement("div",{className:"react-colorful__saturation",style:s},et.createElement(a1,{onMove:function(i){n({s:100*i.left,v:100-100*i.top})},onKey:function(i){n({s:mo(e.s+100*i.left,0,100),v:mo(e.v-100*i.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+cn(e.s)+"%, Brightness "+cn(e.v)+"%"},et.createElement(l1,{className:"react-colorful__saturation-pointer",top:1-e.v/100,left:e.s/100,color:ah(e)})))}),c1=function(t,e){if(t===e)return!0;for(var n in t)if(t[n]!==e[n])return!1;return!0};function g3(t,e,n){var s=rh(n),i=M.useState(function(){return t.toHsva(e)}),r=i[0],o=i[1],a=M.useRef({color:e,hsva:r});M.useEffect(function(){if(!t.equal(e,a.current.color)){var h=t.toHsva(e);a.current={hsva:h,color:e},o(h)}},[e,t]),M.useEffect(function(){var h;c1(r,a.current.hsva)||t.equal(h=t.fromHsva(r),a.current.color)||(a.current={hsva:r,color:h},s(h))},[r,t,s]);var u=M.useCallback(function(h){o(function(d){return Object.assign({},d,h)})},[]);return[r,u]}var m3=typeof window<"u"?M.useLayoutEffect:M.useEffect,_3=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},Xg=new Map,y3=function(t){m3(function(){var e=t.current?t.current.ownerDocument:document;if(e!==void 0&&!Xg.has(e)){var n=e.createElement("style");n.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,Xg.set(e,n);var s=_3();s&&n.setAttribute("nonce",s),e.head.appendChild(n)}},[])},v3=function(t){var e=t.className,n=t.colorModel,s=t.color,i=s===void 0?n.defaultColor:s,r=t.onChange,o=o1(t,["className","colorModel","color","onChange"]),a=M.useRef(null);y3(a);var u=g3(n,i,r),h=u[0],d=u[1],p=Bd(["react-colorful",e]);return et.createElement("div",tc({},o,{ref:a,className:p}),et.createElement(p3,{hsva:h,onChange:d}),et.createElement(f3,{hue:h.h,onChange:d,className:"react-colorful__last-control"}))},w3={defaultColor:{h:0,s:0,v:0},toHsva:function(t){return{h:t.h,s:t.s,v:t.v,a:1}},fromHsva:function(t){var e=d3(t);return{h:e.h,s:e.s,v:e.v}},equal:c1},Gg=function(t){return et.createElement(v3,tc({},t,{colorModel:w3}))};const T3="_container_auesn_1",E3="_header_auesn_8",A3="_title_auesn_14",x3="_tabNavigation_auesn_22",I3="_tab_auesn_22",S3="_activeTab_auesn_48",b3="_tabIcon_auesn_55",C3="_tabLabel_auesn_59",D3="_content_auesn_65",P3="_tabContent_auesn_71",R3="_section_auesn_76",N3="_sectionTitle_auesn_84",M3="_sectionDescription_auesn_93",j3="_colorSection_auesn_101",L3="_colorPicker_auesn_108",k3="_controlLabel_auesn_121",F3="_colorPalette_auesn_128",O3="_savedColors_auesn_134",V3="_colorButton_auesn_140",B3="_addColorButton_auesn_159",U3="_currentColor_auesn_193",$3="_currentColorDisplay_auesn_201",H3="_colorPreview_auesn_208",W3="_colorCode_auesn_216",X3="_selectedColor_auesn_228",_e={container:T3,header:E3,title:A3,tabNavigation:x3,tab:I3,activeTab:S3,tabIcon:b3,tabLabel:C3,content:D3,tabContent:P3,section:R3,sectionTitle:N3,sectionDescription:M3,colorSection:j3,colorPicker:L3,controlLabel:k3,colorPalette:F3,savedColors:O3,colorButton:V3,addColorButton:B3,currentColor:U3,currentColorDisplay:$3,colorPreview:H3,colorCode:W3,selectedColor:X3},Bc=t=>{(!t||typeof t!="string")&&(t="#FFFFFF");const e=parseInt(t.slice(1,3),16)/255,n=parseInt(t.slice(3,5),16)/255,s=parseInt(t.slice(5,7),16)/255,i=Math.max(e,n,s),r=Math.min(e,n,s),o=i-r;let a=0;const u=i===0?0:o/i,h=i;return o!==0&&(i===e?a=(n-s)/o%6:i===n?a=(s-e)/o+2:a=(e-n)/o+4),a=a*60,a<0&&(a+=360),{h:a,s:u*100,v:h*100}},G3=t=>{const{h:e,s:n,v:s}=t,i=n/100,r=s/100,o=r*i,a=o*(1-Math.abs(e/60%2-1)),u=r-o;let h,d,p;return e>=0&&e<60?(h=o,d=a,p=0):e>=60&&e<120?(h=a,d=o,p=0):e>=120&&e<180?(h=0,d=o,p=a):e>=180&&e<240?(h=0,d=a,p=o):e>=240&&e<300?(h=a,d=0,p=o):(h=o,d=0,p=a),h=Math.round((h+u)*255),d=Math.round((d+u)*255),p=Math.round((p+u)*255),`#${h.toString(16).padStart(2,"0")}${d.toString(16).padStart(2,"0")}${p.toString(16).padStart(2,"0")}`},z3=()=>{const[t,e]=M.useState("interior"),{spaceInfo:n,setSpaceInfo:s}=Pt(),i=n.materialConfig||{interiorColor:"#FFFFFF",doorColor:"#FFFFFF"},r=t==="interior"?i.interiorColor||"#FFFFFF":i.doorColor||"#FFFFFF",[o,a]=M.useState(()=>Bc(r)),[u,h]=M.useState(!1);M.useMemo(()=>{const C=Bc(r);a(C)},[r]);const d=C=>{const A=t==="interior"?"interiorColor":"doorColor",R={...i,[A]:C};console.log("🎨 MaterialPanel 색상 업데이트 시작:",{activeTab:t,propertyKey:A,oldColor:i[A],newColor:C,oldMaterialConfig:i,newMaterialConfig:R}),s({materialConfig:R}),setTimeout(()=>{var k;const N=Pt.getState().spaceInfo;console.log("🎨 MaterialPanel 업데이트 후 Store 상태:",{updatedMaterialConfig:N.materialConfig,expectedColor:C,actualColor:(k=N.materialConfig)==null?void 0:k[A]})},100)},p=C=>{a(C)},m=()=>{console.log("🎨 MaterialPanel 드래그 시작:",{activeTab:t}),h(!0)},y=()=>{if(console.log("🎨 MaterialPanel 드래그 완료:",{isDragging:u,activeTab:t,localHsv:o}),u){const C=G3(o);console.log("🎨 MaterialPanel HSV → HEX 변환:",{localHsv:o,hexColor:C,activeTab:t}),d(C),h(!1)}},v=C=>{console.log("🎨 MaterialPanel 색상 선택:",{color:C,activeTab:t});const A=Bc(C);a(A),d(C)},w=[{id:"interior",label:"내부",icon:"🟫"},{id:"door",label:"도어",icon:"🚪"}],E=()=>{switch(t){case"interior":return c.jsx("div",{className:_e.tabContent,children:c.jsxs("div",{className:_e.section,children:[c.jsx("h4",{className:_e.sectionTitle,children:"내부 색상"}),c.jsx("p",{className:_e.sectionDescription,children:"모든 가구의 내부 색상이 동일하게 적용됩니다."}),c.jsxs("div",{className:_e.currentColor,children:[c.jsx("label",{className:_e.controlLabel,children:"현재 색상"}),c.jsxs("div",{className:_e.currentColorDisplay,children:[c.jsx("div",{className:_e.colorPreview,style:{backgroundColor:r}}),c.jsx("span",{className:_e.colorCode,children:r})]})]}),c.jsxs("div",{className:_e.colorSection,children:[c.jsx("div",{className:_e.colorPicker,children:c.jsx(Gg,{color:o,onChange:p,onMouseDown:m,onMouseUp:y})}),c.jsxs("div",{className:_e.colorPalette,children:[c.jsx("label",{className:_e.controlLabel,children:"저장된 색상"}),c.jsxs("div",{className:_e.savedColors,children:[["#333333","#666666","#999999","#CCCCCC","#F5F5F5","#FFFFFF"].map((C,A)=>c.jsx("button",{className:`${_e.colorButton} ${r===C?_e.selectedColor:""}`,style:{backgroundColor:C},title:C,onClick:()=>v(C)},A)),c.jsx("button",{className:_e.addColorButton,title:"색상 추가",children:"+"})]})]})]})]})});case"door":return c.jsx("div",{className:_e.tabContent,children:c.jsxs("div",{className:_e.section,children:[c.jsx("h4",{className:_e.sectionTitle,children:"도어 색상"}),c.jsx("p",{className:_e.sectionDescription,children:"모든 가구의 도어 색상이 동일하게 적용됩니다."}),c.jsxs("div",{className:_e.currentColor,children:[c.jsx("label",{className:_e.controlLabel,children:"현재 색상"}),c.jsxs("div",{className:_e.currentColorDisplay,children:[c.jsx("div",{className:_e.colorPreview,style:{backgroundColor:r}}),c.jsx("span",{className:_e.colorCode,children:r})]})]}),c.jsxs("div",{className:_e.colorSection,children:[c.jsx("div",{className:_e.colorPicker,children:c.jsx(Gg,{color:o,onChange:p,onMouseDown:m,onMouseUp:y})}),c.jsxs("div",{className:_e.colorPalette,children:[c.jsx("label",{className:_e.controlLabel,children:"저장된 색상"}),c.jsxs("div",{className:_e.savedColors,children:[["#000000","#8B4513","#654321","#D2691E","#F4A460","#DEB887"].map((C,A)=>c.jsx("button",{className:`${_e.colorButton} ${r===C?_e.selectedColor:""}`,style:{backgroundColor:C},title:C,onClick:()=>v(C)},A)),c.jsx("button",{className:_e.addColorButton,title:"색상 추가",children:"+"})]})]})]})]})});default:return null}};return c.jsxs("div",{className:_e.container,children:[c.jsx("div",{className:_e.header,children:c.jsx("h3",{className:_e.title,children:"재질"})}),c.jsx("div",{className:_e.tabNavigation,children:w.map(C=>c.jsxs("button",{className:`${_e.tab} ${t===C.id?_e.activeTab:""}`,onClick:()=>{console.log("🎨 MaterialPanel 탭 변경:",{from:t,to:C.id,currentMaterialConfig:i}),e(C.id)},children:[c.jsx("span",{className:_e.tabIcon,children:C.icon}),c.jsx("span",{className:_e.tabLabel,children:C.label})]},C.id))}),c.jsx("div",{className:_e.content,children:E()})]})};function Y3(t){const e=Math.sqrt(Math.pow(t,2)+Math.pow(t,2))/2;return-(t-Math.sqrt(Math.pow(t,2)-Math.pow(e,2)))/e}function B(t,e,n){return{x:t??0,y:e??0,z:n??0}}function Xe(t,e){return{x:t??0,y:e??0}}class Vt{static next(){return(++Vt.seed).toString(16).toUpperCase()}static peek(){return(Vt.seed+1).toString(16).toUpperCase()}static clear(){Vt.seed=0}}Vt.seed=0;class q3{constructor(){this.handle=Vt.next()}dxfy(e){e.type("ENDBLK"),e.handle(this.handle),e.push(330,this.ownerObjectHandle),e.subclassMarker("AcDbEntity"),e.layerName("0"),e.subclassMarker("AcDbBlockEnd")}}const ha=(t,e)=>({tl:t,br:e});class Ue{static centerRadiusBBox(e,n){return ha(B(e.x-n,e.y+n),B(e.x+n,e.y-n))}static pointBBox(e){return ha(B(e.x-100,e.y+100),B(e.x+100,e.y-100))}static lineBBox(e,n){const s=e.x>n.x?e.x:n.x,i=e.x<n.x?e.x:n.x,r=e.y>n.y?e.y:n.y,o=e.y<n.y?e.y:n.y,a=e.z>n.z?e.z:n.z,u=e.z<n.z?e.z:n.z;return ha(B(i,r,u),B(s,o,a))}static verticesBBox(e){let n=-1/0,s=-1/0,i=1/0,r=1/0;for(let o=0;o<e.length;o++){const{x:a,y:u}=e[o];n<a&&(n=a),s<u&&(s=u),i>a&&(i=a),r>u&&(r=u)}return ha(B(i,s),B(n,r))}static boundingBox(e){if(e.length===0)return Ue.pointBBox(B());const n=[];for(let s=0;s<e.length;s++){const i=e[s];n.push(i.tl,i.br)}return Ue.verticesBBox(n)}static boundingBoxCenter(e){return B(e.tl.x+(e.br.x-e.tl.x)/2,e.br.y+(e.tl.y-e.br.y)/2,0)}static boundingBoxHeight(e){return e.tl.y-e.br.y}}var gl,lh,ch;(function(t){t[t.None=0]="None",t[t.Frozen=1]="Frozen",t[t.FrozenInNewViewports=2]="FrozenInNewViewports",t[t.Locked=4]="Locked",t[t.XRefDependent=16]="XRefDependent",t[t.XRefResolved=32]="XRefResolved"})(gl||(gl={})),function(t){t[t.None=0]="None",t[t.DescribeShape=1]="DescribeShape",t[t.VerticalText=4]="VerticalText",t[t.XRefDependent=16]="XRefDependent",t[t.XRefResolved=32]="XRefResolved"}(lh||(lh={})),function(t){t[t.None=0]="None",t[t.PaperSpace=1]="PaperSpace",t[t.XRefDependent=16]="XRefDependent",t[t.XRefResolved=32]="XRefResolved"}(ch||(ch={}));class Bs{constructor(e){this.type=e,this.handle=Vt.next()}dxfy(e){e.type(this.type),e.handle(this.handle),e.push(330,this.ownerObjectHandle),e.subclassMarker("AcDbSymbolTableRecord")}}class Mi extends Bs{constructor(e,n,s,i){super("LAYER"),this.name=e,this.colorNumber=n,this.lineType=s,this.flags=i??gl.None}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbLayerTableRecord"),e.name(this.name),e.push(70,this.flags),e.colorNumber(this.colorNumber),e.push(420,this.trueColor),e.lineType(this.lineType),e.push(370,0),e.push(390,0),e.push(347,this.materialObject)}}Mi.layerZeroName="0";const K3=[[["00","00","00"],0,["0","0","0"]],[["FF","00","00"],1,["255","0","0"]],[["FF","FF","00"],2,["255","255","0"]],[["00","FF","00"],3,["0","255","0"]],[["00","FF","FF"],4,["0","255","255"]],[["00","00","FF"],5,["0","0","255"]],[["FF","00","FF"],6,["255","0","255"]],[["FF","FF","FF"],7,["255","255","255"]],[["41","41","41"],8,["65","65","65"]],[["80","80","80"],9,["128","128","128"]],[["FF","00","00"],10,["255","0","0"]],[["FF","AA","AA"],11,["255","170","170"]],[["BD","00","00"],12,["189","0","0"]],[["BD","7E","7E"],13,["189","126","126"]],[["81","00","00"],14,["129","0","0"]],[["81","56","56"],15,["129","86","86"]],[["68","00","00"],16,["104","0","0"]],[["68","45","45"],17,["104","69","69"]],[["4F","00","00"],18,["79","0","0"]],[["4F","35","35"],19,["79","53","53"]],[["FF","3F","00"],20,["255","63","0"]],[["FF","BF","AA"],21,["255","191","170"]],[["BD","2E","00"],22,["189","46","0"]],[["BD","8D","7E"],23,["189","141","126"]],[["81","1F","00"],24,["129","31","0"]],[["81","60","56"],25,["129","96","86"]],[["68","19","00"],26,["104","25","0"]],[["68","4E","45"],27,["104","78","69"]],[["4F","13","00"],28,["79","19","0"]],[["4F","3B","35"],29,["79","59","53"]],[["FF","7F","00"],30,["255","127","0"]],[["FF","D4","AA"],31,["255","212","170"]],[["BD","5E","00"],32,["189","94","0"]],[["BD","9D","7E"],33,["189","157","126"]],[["81","40","00"],34,["129","64","0"]],[["81","6B","56"],35,["129","107","86"]],[["68","34","00"],36,["104","52","0"]],[["68","56","45"],37,["104","86","69"]],[["4F","27","00"],38,["79","39","0"]],[["4F","42","35"],39,["79","66","53"]],[["FF","BF","00"],40,["255","191","0"]],[["FF","EA","AA"],41,["255","234","170"]],[["BD","8D","00"],42,["189","141","0"]],[["BD","AD","7E"],43,["189","173","126"]],[["81","60","00"],44,["129","96","0"]],[["81","76","56"],45,["129","118","86"]],[["68","4E","00"],46,["104","78","0"]],[["68","5F","45"],47,["104","95","69"]],[["4F","3B","00"],48,["79","59","0"]],[["4F","49","35"],49,["79","73","53"]],[["FF","FF","00"],50,["255","255","0"]],[["FF","FF","AA"],51,["255","255","170"]],[["BD","BD","00"],52,["189","189","0"]],[["BD","BD","7E"],53,["189","189","126"]],[["81","81","00"],54,["129","129","0"]],[["81","81","56"],55,["129","129","86"]],[["68","68","00"],56,["104","104","0"]],[["68","68","45"],57,["104","104","69"]],[["4F","4F","00"],58,["79","79","0"]],[["4F","4F","35"],59,["79","79","53"]],[["BF","FF","00"],60,["191","255","0"]],[["EA","FF","AA"],61,["234","255","170"]],[["8D","BD","00"],62,["141","189","0"]],[["AD","BD","7E"],63,["173","189","126"]],[["60","81","00"],64,["96","129","0"]],[["76","81","56"],65,["118","129","86"]],[["4E","68","00"],66,["78","104","0"]],[["5F","68","45"],67,["95","104","69"]],[["3B","4F","00"],68,["59","79","0"]],[["49","4F","35"],69,["73","79","53"]],[["7F","FF","00"],70,["127","255","0"]],[["D4","FF","AA"],71,["212","255","170"]],[["5E","BD","00"],72,["94","189","0"]],[["9D","BD","7E"],73,["157","189","126"]],[["40","81","00"],74,["64","129","0"]],[["6B","81","56"],75,["107","129","86"]],[["34","68","00"],76,["52","104","0"]],[["56","68","45"],77,["86","104","69"]],[["27","4F","00"],78,["39","79","0"]],[["42","4F","35"],79,["66","79","53"]],[["3F","FF","00"],80,["63","255","0"]],[["BF","FF","AA"],81,["191","255","170"]],[["2E","BD","00"],82,["46","189","0"]],[["8D","BD","7E"],83,["141","189","126"]],[["1F","81","00"],84,["31","129","0"]],[["60","81","56"],85,["96","129","86"]],[["19","68","00"],86,["25","104","0"]],[["4E","68","45"],87,["78","104","69"]],[["13","4F","00"],88,["19","79","0"]],[["3B","4F","35"],89,["59","79","53"]],[["00","FF","00"],90,["0","255","0"]],[["AA","FF","AA"],91,["170","255","170"]],[["00","BD","00"],92,["0","189","0"]],[["7E","BD","7E"],93,["126","189","126"]],[["00","81","00"],94,["0","129","0"]],[["56","81","56"],95,["86","129","86"]],[["00","68","00"],96,["0","104","0"]],[["45","68","45"],97,["69","104","69"]],[["00","4F","00"],98,["0","79","0"]],[["35","4F","35"],99,["53","79","53"]],[["00","FF","3F"],100,["0","255","63"]],[["AA","FF","BF"],101,["170","255","191"]],[["00","BD","2E"],102,["0","189","46"]],[["7E","BD","8D"],103,["126","189","141"]],[["00","81","1F"],104,["0","129","31"]],[["56","81","60"],105,["86","129","96"]],[["00","68","19"],106,["0","104","25"]],[["45","68","4E"],107,["69","104","78"]],[["00","4F","13"],108,["0","79","19"]],[["35","4F","3B"],109,["53","79","59"]],[["00","FF","7F"],110,["0","255","127"]],[["AA","FF","D4"],111,["170","255","212"]],[["00","BD","5E"],112,["0","189","94"]],[["7E","BD","9D"],113,["126","189","157"]],[["00","81","40"],114,["0","129","64"]],[["56","81","6B"],115,["86","129","107"]],[["00","68","34"],116,["0","104","52"]],[["45","68","56"],117,["69","104","86"]],[["00","4F","27"],118,["0","79","39"]],[["35","4F","42"],119,["53","79","66"]],[["00","FF","BF"],120,["0","255","191"]],[["AA","FF","EA"],121,["170","255","234"]],[["00","BD","8D"],122,["0","189","141"]],[["7E","BD","AD"],123,["126","189","173"]],[["00","81","60"],124,["0","129","96"]],[["56","81","76"],125,["86","129","118"]],[["00","68","4E"],126,["0","104","78"]],[["45","68","5F"],127,["69","104","95"]],[["00","4F","3B"],128,["0","79","59"]],[["35","4F","49"],129,["53","79","73"]],[["00","FF","FF"],130,["0","255","255"]],[["AA","FF","FF"],131,["170","255","255"]],[["00","BD","BD"],132,["0","189","189"]],[["7E","BD","BD"],133,["126","189","189"]],[["00","81","81"],134,["0","129","129"]],[["56","81","81"],135,["86","129","129"]],[["00","68","68"],136,["0","104","104"]],[["45","68","68"],137,["69","104","104"]],[["00","4F","4F"],138,["0","79","79"]],[["35","4F","4F"],139,["53","79","79"]],[["00","BF","FF"],140,["0","191","255"]],[["AA","EA","FF"],141,["170","234","255"]],[["00","8D","BD"],142,["0","141","189"]],[["7E","AD","BD"],143,["126","173","189"]],[["00","60","81"],144,["0","96","129"]],[["56","76","81"],145,["86","118","129"]],[["00","4E","68"],146,["0","78","104"]],[["45","5F","68"],147,["69","95","104"]],[["00","3B","4F"],148,["0","59","79"]],[["35","49","4F"],149,["53","73","79"]],[["00","7F","FF"],150,["0","127","255"]],[["AA","D4","FF"],151,["170","212","255"]],[["00","5E","BD"],152,["0","94","189"]],[["7E","9D","BD"],153,["126","157","189"]],[["00","40","81"],154,["0","64","129"]],[["56","6B","81"],155,["86","107","129"]],[["00","34","68"],156,["0","52","104"]],[["45","56","68"],157,["69","86","104"]],[["00","27","4F"],158,["0","39","79"]],[["35","42","4F"],159,["53","66","79"]],[["00","3F","FF"],160,["0","63","255"]],[["AA","BF","FF"],161,["170","191","255"]],[["00","2E","BD"],162,["0","46","189"]],[["7E","8D","BD"],163,["126","141","189"]],[["00","1F","81"],164,["0","31","129"]],[["56","60","81"],165,["86","96","129"]],[["00","19","68"],166,["0","25","104"]],[["45","4E","68"],167,["69","78","104"]],[["00","13","4F"],168,["0","19","79"]],[["35","3B","4F"],169,["53","59","79"]],[["00","00","FF"],170,["0","0","255"]],[["AA","AA","FF"],171,["170","170","255"]],[["00","00","BD"],172,["0","0","189"]],[["7E","7E","BD"],173,["126","126","189"]],[["00","00","81"],174,["0","0","129"]],[["56","56","81"],175,["86","86","129"]],[["00","00","68"],176,["0","0","104"]],[["45","45","68"],177,["69","69","104"]],[["00","00","4F"],178,["0","0","79"]],[["35","35","4F"],179,["53","53","79"]],[["3F","00","FF"],180,["63","0","255"]],[["BF","AA","FF"],181,["191","170","255"]],[["2E","00","BD"],182,["46","0","189"]],[["8D","7E","BD"],183,["141","126","189"]],[["1F","00","81"],184,["31","0","129"]],[["60","56","81"],185,["96","86","129"]],[["19","00","68"],186,["25","0","104"]],[["4E","45","68"],187,["78","69","104"]],[["13","00","4F"],188,["19","0","79"]],[["3B","35","4F"],189,["59","53","79"]],[["7F","00","FF"],190,["127","0","255"]],[["D4","AA","FF"],191,["212","170","255"]],[["5E","00","BD"],192,["94","0","189"]],[["9D","7E","BD"],193,["157","126","189"]],[["40","00","81"],194,["64","0","129"]],[["6B","56","81"],195,["107","86","129"]],[["34","00","68"],196,["52","0","104"]],[["56","45","68"],197,["86","69","104"]],[["27","00","4F"],198,["39","0","79"]],[["42","35","4F"],199,["66","53","79"]],[["BF","00","FF"],200,["191","0","255"]],[["EA","AA","FF"],201,["234","170","255"]],[["8D","00","BD"],202,["141","0","189"]],[["AD","7E","BD"],203,["173","126","189"]],[["60","00","81"],204,["96","0","129"]],[["76","56","81"],205,["118","86","129"]],[["4E","00","68"],206,["78","0","104"]],[["5F","45","68"],207,["95","69","104"]],[["3B","00","4F"],208,["59","0","79"]],[["49","35","4F"],209,["73","53","79"]],[["FF","00","FF"],210,["255","0","255"]],[["FF","AA","FF"],211,["255","170","255"]],[["BD","00","BD"],212,["189","0","189"]],[["BD","7E","BD"],213,["189","126","189"]],[["81","00","81"],214,["129","0","129"]],[["81","56","81"],215,["129","86","129"]],[["68","00","68"],216,["104","0","104"]],[["68","45","68"],217,["104","69","104"]],[["4F","00","4F"],218,["79","0","79"]],[["4F","35","4F"],219,["79","53","79"]],[["FF","00","BF"],220,["255","0","191"]],[["FF","AA","EA"],221,["255","170","234"]],[["BD","00","8D"],222,["189","0","141"]],[["BD","7E","AD"],223,["189","126","173"]],[["81","00","60"],224,["129","0","96"]],[["81","56","76"],225,["129","86","118"]],[["68","00","4E"],226,["104","0","78"]],[["68","45","5F"],227,["104","69","95"]],[["4F","00","3B"],228,["79","0","59"]],[["4F","35","49"],229,["79","53","73"]],[["FF","00","7F"],230,["255","0","127"]],[["FF","AA","D4"],231,["255","170","212"]],[["BD","00","5E"],232,["189","0","94"]],[["BD","7E","9D"],233,["189","126","157"]],[["81","00","40"],234,["129","0","64"]],[["81","56","6B"],235,["129","86","107"]],[["68","00","34"],236,["104","0","52"]],[["68","45","56"],237,["104","69","86"]],[["4F","00","27"],238,["79","0","39"]],[["4F","35","42"],239,["79","53","66"]],[["FF","00","3F"],240,["255","0","63"]],[["FF","AA","BF"],241,["255","170","191"]],[["BD","00","2E"],242,["189","0","46"]],[["BD","7E","8D"],243,["189","126","141"]],[["81","00","1F"],244,["129","0","31"]],[["81","56","60"],245,["129","86","96"]],[["68","00","19"],246,["104","0","25"]],[["68","45","4E"],247,["104","69","78"]],[["4F","00","13"],248,["79","0","19"]],[["4F","35","3B"],249,["79","53","59"]],[["33","33","33"],250,["51","51","51"]],[["50","50","50"],251,["80","80","80"]],[["69","69","69"],252,["105","105","105"]],[["82","82","82"],253,["130","130","130"]],[["BE","BE","BE"],254,["190","190","190"]],[["FF","FF","FF"],255,["255","255","255"]]];function zg(t){let e="";const n=K3.find(s=>{const[,i]=s;return i===t});if(n){const[s]=n,[i,r,o]=s;e=`${i}${r}${o}`}return e}class Q3{constructor(e){this.name=e,this.tags=[]}add(e,n){this.tags.push({code:e,value:n})}dxfy(e){e.push(102,`{${this.name}`);for(const n of this.tags)e.push(n.code,n.value);e.push(102,"}")}}class J3{constructor(){this.lines=[]}push(e,n){n!=null&&this.lines.push(e,n)}stringify(){return this.lines.join(`
`)}start(e){this.push(0,"SECTION"),this.push(2,e)}end(){this.push(0,"ENDSEC")}variableName(e){this.push(9,e)}type(e){this.push(0,e)}primaryText(e){this.push(1,e)}name(e,n=2){this.push(n,e)}handle(e){this.push(5,e)}lineType(e){this.push(6,e)}textStyle(e){this.push(7,e)}layerName(e){this.push(8,e)}point2d(e,n=0){this.push(10+n,e==null?void 0:e.x),this.push(20+n,e==null?void 0:e.y)}point3d(e,n=0){this.point2d(e,n),this.push(30+n,e==null?void 0:e.z)}elevation(e){this.push(38,e)}thickness(e){this.push(39,e)}visibilty(e){e!=null&&this.push(60,e?0:1)}colorNumber(e){this.push(62,e)}subclassMarker(e){this.push(100,e)}}var uh,ml,_l,ke;function Fe(t,e,n,s){if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)}function kr(t,e,n,s,i){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n}function Ge(t,e){return{code:t,value:e}}function Yg(t,e=255){const n=[],s=[];for(let i=0;i<t.length;i++){const r=t[i];s.length===e||i===t.length-1?(n.push(s.join("")),s.length=0):s.push(r)}return n}(function(t){t[t.Red=1]="Red",t[t.Green=3]="Green",t[t.Cyan=4]="Cyan",t[t.Blue=5]="Blue",t[t.Magenta=6]="Magenta",t[t.White=7]="White",t[t.Black=0]="Black",t[t.Yellow=2]="Yellow"})(uh||(uh={})),function(t){t[t.Unitless=0]="Unitless",t[t.Inches=1]="Inches",t[t.Feet=2]="Feet",t[t.Miles=3]="Miles",t[t.Millimeters=4]="Millimeters",t[t.Centimeters=5]="Centimeters",t[t.Meters=6]="Meters",t[t.Kilometers=7]="Kilometers",t[t.Microinches=8]="Microinches",t[t.Mils=9]="Mils",t[t.Yards=10]="Yards",t[t.Angstroms=11]="Angstroms",t[t.Nanometers=12]="Nanometers",t[t.Microns=13]="Microns",t[t.Decimeters=14]="Decimeters",t[t.Decameters=15]="Decameters",t[t.Hectometers=16]="Hectometers",t[t.Gigameters=17]="Gigameters",t[t.AstronomicalUnits=18]="AstronomicalUnits",t[t.LightYears=19]="LightYears",t[t.Parsecs=20]="Parsecs",t[t.USSurveyFeet=21]="USSurveyFeet",t[t.USSurveyInch=22]="USSurveyInch",t[t.USSurveyYard=23]="USSurveyYard",t[t.USSurveyMile=24]="USSurveyMile"}(ml||(ml={})),function(t){t.Continuous="Continuous"}(_l||(_l={})),typeof SuppressedError=="function"&&SuppressedError;class Z3{constructor(e){ke.set(this,void 0),this.name=e,kr(this,ke,[])}clear(){Fe(this,ke,"f").length=0}string(e){Yg(e).forEach(n=>Fe(this,ke,"f").push(Ge(1e3,n)))}beginList(){Fe(this,ke,"f").push(Ge(1002,"{"))}endList(){Fe(this,ke,"f").push(Ge(1002,"}"))}layerName(e){Fe(this,ke,"f").push(Ge(1003,e))}binaryData(e){Yg(e).forEach(n=>Fe(this,ke,"f").push(Ge(1004,n)))}databaseHandle(e){Fe(this,ke,"f").push(Ge(1005,e))}point(e){Fe(this,ke,"f").push(Ge(1010,e.x)),Fe(this,ke,"f").push(Ge(1020,e.y)),Fe(this,ke,"f").push(Ge(1030,e.z))}position(e){Fe(this,ke,"f").push(Ge(1011,e.x)),Fe(this,ke,"f").push(Ge(1021,e.y)),Fe(this,ke,"f").push(Ge(1031,e.z))}displacement(e){Fe(this,ke,"f").push(Ge(1012,e.x)),Fe(this,ke,"f").push(Ge(1022,e.y)),Fe(this,ke,"f").push(Ge(1032,e.z))}direction(e){Fe(this,ke,"f").push(Ge(1013,e.x)),Fe(this,ke,"f").push(Ge(1023,e.y)),Fe(this,ke,"f").push(Ge(1033,e.z))}real(e){Fe(this,ke,"f").push(Ge(1040,e))}distance(e){Fe(this,ke,"f").push(Ge(1041,e))}scale(e){Fe(this,ke,"f").push(Ge(1042,e))}integer(e){Fe(this,ke,"f").push(Ge(1070,e))}long(e){Fe(this,ke,"f").push(Ge(1071,e))}dxfy(e){e.push(1001,this.name),e.push(1002,"{"),Fe(this,ke,"f").forEach(n=>e.push(n.code,n.value)),e.push(1002,"}")}}ke=new WeakMap;class X{set angle(e){this.patternsData.forEach(n=>n.lineAngle=e)}constructor(e){this.name=e,this.patternsData=[],this.scale=1}dxfy(e){e.push(78,this.patternsData.length);for(const n of this.patternsData){e.push(53,n.lineAngle),e.push(43,n.x),e.push(44,n.y),e.push(45,n.offsetX*this.scale),e.push(46,n.offsetY*this.scale),e.push(79,n.dashLengthItems.length);for(const s of n.dashLengthItems)e.push(49,s*this.scale)}}add(e){this.patternsData.push(e)}}const W=new Map,Uc=new X("ANGLE");Uc.add({lineAngle:0,x:0,y:0,offsetX:.275,offsetY:.2,dashLengthItems:[-.075]}),Uc.add({lineAngle:90,x:0,y:0,offsetX:.275,offsetY:.2,dashLengthItems:[-.075]}),W.set("ANGLE",Uc);const qg=new X("ANSI31");qg.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:1.25,dashLengthItems:[]}),W.set("ANSI31",qg);const Kg=new X("ANSI32");Kg.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),W.set("ANSI32",Kg);const $c=new X("ANSI33");$c.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:9.525,dashLengthItems:[]}),$c.add({lineAngle:45,x:4.49013,y:0,offsetX:0,offsetY:9.525,dashLengthItems:[]}),W.set("ANSI33",$c);const Hc=new X("ANSI34");Hc.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),Hc.add({lineAngle:45,x:4.49013,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[3.175,-1.5875]}),W.set("ANSI34",Hc);const Ar=new X("ANSI35");Ar.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:19.05,dashLengthItems:[]}),Ar.add({lineAngle:45,x:4.49013,y:0,offsetX:0,offsetY:19.05,dashLengthItems:[]}),Ar.add({lineAngle:45,x:8.98026,y:0,offsetX:0,offsetY:19.05,dashLengthItems:[]}),Ar.add({lineAngle:45,x:13.4704,y:0,offsetX:0,offsetY:19.05,dashLengthItems:[]}),W.set("ANSI35",Ar);const Wc=new X("ANSI36");Wc.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),Wc.add({lineAngle:45,x:4.49013,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[7.9375,-1.5875,0,-1.5875]}),W.set("ANSI36",Wc);const Qg=new X("ANSI37");Qg.add({lineAngle:45,x:0,y:0,offsetX:5.55625,offsetY:3.175,dashLengthItems:[7.9375,-1.5875,0,-1.5875]}),W.set("ANSI37",Qg);const Xc=new X("ANSI38");Xc.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),Xc.add({lineAngle:135,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),W.set("ANSI38",Xc);const Gc=new X("AR_B816");Gc.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),Gc.add({lineAngle:135,x:0,y:0,offsetX:6.35,offsetY:3.175,dashLengthItems:[7.9375,-4.7625]}),W.set("AR_B816",Gc);const zc=new X("AR_B816C");zc.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:203.2,dashLengthItems:[]}),zc.add({lineAngle:90,x:0,y:0,offsetX:203.2,offsetY:203.2,dashLengthItems:[203.2,-203.2]}),W.set("AR_B816C",zc);const xr=new X("AR_B88");xr.add({lineAngle:0,x:0,y:0,offsetX:203.2,offsetY:203.2,dashLengthItems:[396.875,-9.525]}),xr.add({lineAngle:0,x:-203.2,y:9.525,offsetX:203.2,offsetY:203.2,dashLengthItems:[396.875,-9.525]}),xr.add({lineAngle:90,x:0,y:0,offsetX:203.2,offsetY:203.2,dashLengthItems:[-212.725,193.675]}),xr.add({lineAngle:90,x:-9.525,y:0,offsetX:203.2,offsetY:203.2,dashLengthItems:[-212.725,193.675]}),W.set("AR_B88",xr);const Yc=new X("AR_BRELM");Yc.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:203.2,dashLengthItems:[]}),Yc.add({lineAngle:90,x:0,y:0,offsetX:203.2,offsetY:101.6,dashLengthItems:[203.2,-203.2]}),W.set("AR_BRELM",Yc);const On=new X("AR_BRSTD");On.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:135.484,dashLengthItems:[193.675,-9.525]}),On.add({lineAngle:0,x:0,y:57.15,offsetX:0,offsetY:135.484,dashLengthItems:[193.675,-9.525]}),On.add({lineAngle:0,x:50.8,y:67.7418,offsetX:0,offsetY:135.484,dashLengthItems:[92.075,-9.525]}),On.add({lineAngle:0,x:50.8,y:124.892,offsetX:0,offsetY:135.484,dashLengthItems:[92.075,-9.525]}),On.add({lineAngle:90,x:0,y:0,offsetX:0,offsetY:203.2,dashLengthItems:[57.15,-78.334]}),On.add({lineAngle:90,x:-9.525,y:0,offsetX:0,offsetY:203.2,dashLengthItems:[57.15,-78.334]}),On.add({lineAngle:90,x:50.8,y:67.7418,offsetX:0,offsetY:101.6,dashLengthItems:[57.15,-78.334]}),On.add({lineAngle:90,x:41.275,y:67.7418,offsetX:0,offsetY:101.6,dashLengthItems:[57.15,-78.334]}),W.set("AR_BRSTD",On);const qc=new X("AR_CONC");qc.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:67.7418,dashLengthItems:[]}),qc.add({lineAngle:90,x:0,y:0,offsetX:67.7418,offsetY:101.6,dashLengthItems:[67.7418,-67.7418]}),W.set("AR_CONC",qc);const Lt=new X("AR_HBONE");Lt.add({lineAngle:50,x:0,y:0,offsetX:104.896,offsetY:-149.807,dashLengthItems:[19.05,-209.55]}),Lt.add({lineAngle:355,x:0,y:0,offsetX:-51.76101082,offsetY:187.25814969,dashLengthItems:[15.24,-167.64058417]}),Lt.add({lineAngle:100.4514447,x:15.182007,y:-1.3282535,offsetX:145.5569059,offsetY:-176.270089,dashLengthItems:[16.1900088,-178.0902446]}),Lt.add({lineAngle:46.1842,x:0,y:50.8,offsetX:157.343,offsetY:-224.71,dashLengthItems:[28.575,-314.325]}),Lt.add({lineAngle:96.63555761,x:22.5899,y:47.2965,offsetX:218.33577212,offsetY:-264.40480444,dashLengthItems:[24.28502314,-267.13560816]}),Lt.add({lineAngle:351.18415117,x:0,y:50.8,offsetX:196.67912063,offsetY:280.88740361,dashLengthItems:[22.85996707,-251.45973192]}),Lt.add({lineAngle:21,x:25.4,y:38.1,offsetX:104.89565868,offsetY:-149.80652586,dashLengthItems:[19.05,-209.55]}),Lt.add({lineAngle:326,x:25.4,y:38.1,offsetX:-51.7604,offsetY:187.258,dashLengthItems:[15.24,-167.64]}),Lt.add({lineAngle:71.451445,x:38.0345326,y:29.5779001,offsetX:145.5567546,offsetY:-176.2700748,dashLengthItems:[16.1900088,-178.0899376]}),Lt.add({lineAngle:37.5,x:0,y:0,offsetX:53.9242,offsetY:65.2018,dashLengthItems:[0,-165.608,0,-170.18,0,-168.275]}),Lt.add({lineAngle:7.5,x:0,y:0,offsetX:79.3242,offsetY:90.6018,dashLengthItems:[0,-97.028,0,-161.798,0,-64.135]}),Lt.add({lineAngle:-32.5,x:-56.642,y:0,offsetX:117.434,offsetY:68.0212,dashLengthItems:[0,-63.5,0,-198.12,0,-262.89]}),Lt.add({lineAngle:-42.5,x:-82.042,y:0,offsetX:92.0344,offsetY:118.821,dashLengthItems:[0,-82.55,0,-131.572,0,-186.69]}),W.set("AR_HBONE",Lt);const Kc=new X("AR_PARQ1");Kc.add({lineAngle:45,x:0,y:0,offsetX:101.6,offsetY:101.6,dashLengthItems:[304.8,-101.6]}),Kc.add({lineAngle:135,x:71.842,y:71.842,offsetX:101.6,offsetY:-101.6,dashLengthItems:[304.8,-101.6]}),W.set("AR_PARQ1",Kc);const jt=new X("AR_RROOF");jt.add({lineAngle:90,x:0,y:0,offsetX:304.8,offsetY:304.8,dashLengthItems:[304.8,-304.8]}),jt.add({lineAngle:90,x:50.8,y:0,offsetX:304.8,offsetY:304.8,dashLengthItems:[304.8,-304.8]}),jt.add({lineAngle:90,x:101.6,y:0,offsetX:304.8,offsetY:304.8,dashLengthItems:[304.8,-304.8]}),jt.add({lineAngle:90,x:152.4,y:0,offsetX:304.8,offsetY:304.8,dashLengthItems:[304.8,-304.8]}),jt.add({lineAngle:90,x:203.2,y:0,offsetX:304.8,offsetY:304.8,dashLengthItems:[304.8,-304.8]}),jt.add({lineAngle:90,x:254,y:0,offsetX:304.8,offsetY:304.8,dashLengthItems:[304.8,-304.8]}),jt.add({lineAngle:90,x:304.8,y:0,offsetX:304.8,offsetY:304.8,dashLengthItems:[304.8,-304.8]}),jt.add({lineAngle:0,x:0,y:304.8,offsetX:304.8,offsetY:-304.8,dashLengthItems:[304.8,-304.8]}),jt.add({lineAngle:0,x:0,y:355.6,offsetX:304.8,offsetY:-304.8,dashLengthItems:[304.8,-304.8]}),jt.add({lineAngle:0,x:0,y:406.4,offsetX:304.8,offsetY:-304.8,dashLengthItems:[304.8,-304.8]}),jt.add({lineAngle:0,x:0,y:457.2,offsetX:304.8,offsetY:-304.8,dashLengthItems:[304.8,-304.8]}),jt.add({lineAngle:0,x:0,y:508,offsetX:304.8,offsetY:-304.8,dashLengthItems:[304.8,-304.8]}),jt.add({lineAngle:0,x:0,y:558.8,offsetX:304.8,offsetY:-304.8,dashLengthItems:[304.8,-304.8]}),jt.add({lineAngle:0,x:0,y:609.6,offsetX:304.8,offsetY:-304.8,dashLengthItems:[304.8,-304.8]}),W.set("AR_RROOF",jt);const da=new X("AR_RSHKE");da.add({lineAngle:0,x:0,y:0,offsetX:55.88,offsetY:25.4,dashLengthItems:[381,-50.8,127,-25.4]}),da.add({lineAngle:0,x:33.782,y:12.7,offsetX:-25.4,offsetY:33.782,dashLengthItems:[76.2,-8.382,152.4,-19.05]}),da.add({lineAngle:0,x:12.7,y:21.59,offsetX:132.08,offsetY:17.018,dashLengthItems:[203.2,-35.56,101.6,-25.4]}),W.set("AR_RSHKE",da);const _n=new X("AR_SAND");_n.add({lineAngle:0,x:0,y:0,offsetX:647.7,offsetY:304.8,dashLengthItems:[152.4,-127,177.8,-76.2,228.6,-101.6]}),_n.add({lineAngle:0,x:152.4,y:12.7,offsetX:647.7,offsetY:304.8,dashLengthItems:[127,-482.6,101.6,-152.4]}),_n.add({lineAngle:0,x:457.2,y:-19.05,offsetX:647.7,offsetY:304.8,dashLengthItems:[76.2,-787.4]}),_n.add({lineAngle:90,x:0,y:0,offsetX:304.8,offsetY:215.9,dashLengthItems:[292.1,-927.1]}),_n.add({lineAngle:90,x:152.4,y:0,offsetX:304.8,offsetY:215.9,dashLengthItems:[285.75,-933.45]}),_n.add({lineAngle:90,x:279.4,y:0,offsetX:304.8,offsetY:215.9,dashLengthItems:[266.7,-952.5]}),_n.add({lineAngle:90,x:457.2,y:-19.05,offsetX:304.8,offsetY:215.9,dashLengthItems:[292.1,-927.1]}),_n.add({lineAngle:90,x:533.4,y:-19.05,offsetX:304.8,offsetY:215.9,dashLengthItems:[292.1,-927.1]}),_n.add({lineAngle:90,x:762,y:0,offsetX:304.8,offsetY:215.9,dashLengthItems:[279.4,-939.8]}),W.set("AR_SAND",_n);const Ir=new X("BOX");Ir.add({lineAngle:37.5,x:0,y:0,offsetX:28.5242,offsetY:39.8018,dashLengthItems:[0,-38.608,0,-43.18,0,-41.275]}),Ir.add({lineAngle:7.5,x:0,y:0,offsetX:53.9242,offsetY:65.2018,dashLengthItems:[0,-20.828,0,-34.798,0,-13.335]}),Ir.add({lineAngle:-32.5,x:-31.242,y:0,offsetX:66.6344,offsetY:42.6212,dashLengthItems:[0,-12.7,0,-45.72,0,-59.69]}),Ir.add({lineAngle:-42.5,x:-31.242,y:0,offsetX:41.2344,offsetY:68.0212,dashLengthItems:[0,-6.35,0,-29.972,0,-34.29]}),W.set("BOX",Ir);const Vn=new X("BRASS");Vn.add({lineAngle:90,x:0,y:0,offsetX:0,offsetY:25.4,dashLengthItems:[]}),Vn.add({lineAngle:90,x:6.35,y:0,offsetX:0,offsetY:25.4,dashLengthItems:[]}),Vn.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:25.4,dashLengthItems:[-6.35,6.35]}),Vn.add({lineAngle:0,x:0,y:6.35,offsetX:0,offsetY:25.4,dashLengthItems:[-6.35,6.35]}),Vn.add({lineAngle:0,x:0,y:12.7,offsetX:0,offsetY:25.4,dashLengthItems:[6.35,-6.35]}),Vn.add({lineAngle:0,x:0,y:19.05,offsetX:0,offsetY:25.4,dashLengthItems:[6.35,-6.35]}),Vn.add({lineAngle:90,x:12.7,y:0,offsetX:0,offsetY:25.4,dashLengthItems:[6.35,-6.35]}),Vn.add({lineAngle:90,x:19.05,y:0,offsetX:0,offsetY:25.4,dashLengthItems:[6.35,-6.35]}),W.set("BRASS",Vn);const Qc=new X("BRICK");Qc.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),Qc.add({lineAngle:0,x:0,y:3.175,offsetX:0,offsetY:6.35,dashLengthItems:[3.175,-1.5875]}),W.set("BRICK",Qc);const fa=new X("BRSTONE");fa.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),fa.add({lineAngle:90,x:0,y:0,offsetX:0,offsetY:12.7,dashLengthItems:[6.35,-6.35]}),fa.add({lineAngle:90,x:6.35,y:0,offsetX:0,offsetY:12.7,dashLengthItems:[-6.35,6.35]}),W.set("BRSTONE",fa);const Bn=new X("CLAY");Bn.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:8.382,dashLengthItems:[]}),Bn.add({lineAngle:90,x:22.86,y:0,offsetX:8.382,offsetY:12.7,dashLengthItems:[8.382,-8.382]}),Bn.add({lineAngle:90,x:20.32,y:0,offsetX:8.382,offsetY:12.7,dashLengthItems:[8.382,-8.382]}),Bn.add({lineAngle:0,x:22.86,y:1.397,offsetX:12.7,offsetY:8.382,dashLengthItems:[-22.86,2.54]}),Bn.add({lineAngle:0,x:22.86,y:2.794,offsetX:12.7,offsetY:8.382,dashLengthItems:[-22.86,2.54]}),Bn.add({lineAngle:0,x:22.86,y:4.191,offsetX:12.7,offsetY:8.382,dashLengthItems:[-22.86,2.54]}),Bn.add({lineAngle:0,x:22.86,y:5.588,offsetX:12.7,offsetY:8.382,dashLengthItems:[-22.86,2.54]}),Bn.add({lineAngle:0,x:22.86,y:6.985,offsetX:12.7,offsetY:8.382,dashLengthItems:[-22.86,2.54]}),W.set("CLAY",Bn);const Sr=new X("CORK");Sr.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:4.7625,dashLengthItems:[]}),Sr.add({lineAngle:0,x:0,y:.79375,offsetX:0,offsetY:4.7625,dashLengthItems:[]}),Sr.add({lineAngle:0,x:0,y:1.5875,offsetX:0,offsetY:4.7625,dashLengthItems:[]}),Sr.add({lineAngle:0,x:0,y:3.175,offsetX:0,offsetY:4.7625,dashLengthItems:[4.7625,-3.175]}),W.set("CORK",Sr);const br=new X("CROSS");br.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),br.add({lineAngle:135,x:1.5875,y:-1.5875,offsetX:0,offsetY:8.98026,dashLengthItems:[4.49013,-4.49013]}),br.add({lineAngle:135,x:2.38125,y:-1.5875,offsetX:0,offsetY:8.98026,dashLengthItems:[4.49013,-4.49013]}),br.add({lineAngle:135,x:3.175,y:-1.5875,offsetX:0,offsetY:8.98026,dashLengthItems:[4.49013,-4.49013]}),W.set("CROSS",br);const Jc=new X("DASH");Jc.add({lineAngle:0,x:0,y:0,offsetX:6.35,offsetY:6.35,dashLengthItems:[3.175,-9.525]}),Jc.add({lineAngle:90,x:1.5875,y:-1.5875,offsetX:6.35,offsetY:6.35,dashLengthItems:[3.175,-9.525]}),W.set("DASH",Jc);const Jg=new X("DOLMIT");Jg.add({lineAngle:0,x:0,y:0,offsetX:3.175,offsetY:3.175,dashLengthItems:[3.175,-3.175]}),W.set("DOLMIT",Jg);const Zc=new X("DOTS");Zc.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),Zc.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:17.9605,dashLengthItems:[8.980256121069154,-17.960512242138307]}),W.set("DOTS",Zc);const Zg=new X("EARTH");Zg.add({lineAngle:0,x:0,y:0,offsetX:.79375,offsetY:1.5875,dashLengthItems:[0,-1.5875]}),W.set("EARTH",Zg);const zs=new X("ESCHER");zs.add({lineAngle:0,x:0,y:0,offsetX:6.35,offsetY:6.35,dashLengthItems:[6.35,-6.35]}),zs.add({lineAngle:0,x:0,y:2.38125,offsetX:6.35,offsetY:6.35,dashLengthItems:[6.35,-6.35]}),zs.add({lineAngle:0,x:0,y:4.7625,offsetX:6.35,offsetY:6.35,dashLengthItems:[6.35,-6.35]}),zs.add({lineAngle:90,x:.79375,y:5.55625,offsetX:6.35,offsetY:6.35,dashLengthItems:[6.35,-6.35]}),zs.add({lineAngle:90,x:3.175,y:5.55625,offsetX:6.35,offsetY:6.35,dashLengthItems:[6.35,-6.35]}),zs.add({lineAngle:90,x:5.55625,y:5.55625,offsetX:6.35,offsetY:6.35,dashLengthItems:[6.35,-6.35]}),W.set("ESCHER",zs);const Qe=new X("FLEX");Qe.add({lineAngle:60,x:0,y:0,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[27.94,-2.54]}),Qe.add({lineAngle:180,x:0,y:0,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[27.94,-2.54]}),Qe.add({lineAngle:300,x:0,y:0,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[27.94,-2.54]}),Qe.add({lineAngle:60,x:2.54,y:0,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Qe.add({lineAngle:300,x:2.54,y:0,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Qe.add({lineAngle:60,x:-1.27,y:2.199704516,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Qe.add({lineAngle:180,x:-1.27,y:2.199704516,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Qe.add({lineAngle:300,x:-1.27,y:-2.199704516,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Qe.add({lineAngle:180,x:-1.27,y:-2.199704516,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Qe.add({lineAngle:60,x:-10.16,y:0,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Qe.add({lineAngle:300,x:-10.16,y:0,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Qe.add({lineAngle:60,x:5.08,y:-8.7988180894,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Qe.add({lineAngle:180,x:5.08,y:-8.7988180894,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Qe.add({lineAngle:300,x:5.08,y:8.7988180894,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Qe.add({lineAngle:180,x:5.08,y:8.7988180894,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[5.08,-25.4]}),Qe.add({lineAngle:0,x:5.08,y:4.3994090574,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[17.78,-12.7]}),Qe.add({lineAngle:0,x:5.08,y:-4.3994090574,offsetX:-15.24,offsetY:26.3964542936,dashLengthItems:[17.78,-12.7]}),Qe.add({lineAngle:120,x:1.27,y:6.5991135734,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[17.78,-12.7]}),Qe.add({lineAngle:120,x:-6.35,y:2.199704516,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[17.78,-12.7]}),Qe.add({lineAngle:240,x:-6.35,y:-2.199704516,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[17.78,-12.7]}),Qe.add({lineAngle:240,x:1.27,y:-6.5991135734,offsetX:15.24,offsetY:26.3964542936,dashLengthItems:[17.78,-12.7]}),W.set("FLEX",Qe);const eu=new X("GOST_GLASS");eu.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[6.35,-6.35]}),eu.add({lineAngle:45,x:6.35,y:0,offsetX:4.490128053,offsetY:4.490128053,dashLengthItems:[1.5875,-5.8052561314,1.5875,-8.9802561314]}),W.set("GOST_GLASS",eu);const pa=new X("GOST_WOOD");pa.add({lineAngle:45,x:0,y:0,offsetX:6,offsetY:-6,dashLengthItems:[5,-7]}),pa.add({lineAngle:45,x:2.12132,y:0,offsetX:6,offsetY:-6,dashLengthItems:[2,-10]}),pa.add({lineAngle:45,x:0,y:2.12132,offsetX:6,offsetY:-6,dashLengthItems:[2,-10]}),W.set("GOST_WOOD",pa);const ga=new X("GOST_GROUND");ga.add({lineAngle:90,x:0,y:0,offsetX:0,offsetY:-6,dashLengthItems:[10,-2]}),ga.add({lineAngle:90,x:2,y:-2,offsetX:0,offsetY:-6,dashLengthItems:[6,-1.5,3,-1.5]}),ga.add({lineAngle:90,x:4,y:-5,offsetX:0,offsetY:-6,dashLengthItems:[10,-2]}),W.set("GOST_GROUND",ga);const ma=new X("GRASS");ma.add({lineAngle:45,x:0,y:0,offsetX:10,offsetY:-10,dashLengthItems:[20]}),ma.add({lineAngle:45,x:3,y:0,offsetX:10,offsetY:-10,dashLengthItems:[20]}),ma.add({lineAngle:45,x:6,y:0,offsetX:10,offsetY:-10,dashLengthItems:[20]}),W.set("GRASS",ma);const _a=new X("GRATE");_a.add({lineAngle:90,x:0,y:0,offsetX:17.96051224,offsetY:17.96051224,dashLengthItems:[4.7625,-31.15852448]}),_a.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:25.4,dashLengthItems:[4.7625,-20.6375]}),_a.add({lineAngle:135,x:0,y:0,offsetX:0,offsetY:25.4,dashLengthItems:[4.7625,-20.6375]}),W.set("GRATE",_a);const tu=new X("GRAVEL");tu.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:.79375,dashLengthItems:[]}),tu.add({lineAngle:90,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),W.set("GRAVEL",tu);const ve=new X("HEX");ve.add({lineAngle:228.0127875,x:18.288,y:25.4,offsetX:305.85067529778,offsetY:1.88796713245,dashLengthItems:[3.4172144,-338.30483639565]}),ve.add({lineAngle:184.969741,x:16.002,y:22.86,offsetX:-305.8545235377,offsetY:1.10019612724,dashLengthItems:[5.8640472,-580.54048893524]}),ve.add({lineAngle:132.5104471,x:10.16,y:22.352,offsetX:-377.59492241548,offsetY:1.56030959675,dashLengthItems:[4.1348152,-409.347227941]}),ve.add({lineAngle:267.273689,x:.254,y:16.002,offsetX:-508.63316875916,offsetY:1.20815479432,dashLengthItems:[5.3400452,-528.66437425738]}),ve.add({lineAngle:292.83365418,x:0,y:10.668,offsetX:-330.19770134945,offsetY:1.23208097566,dashLengthItems:[5.236337,-518.39807745344]}),ve.add({lineAngle:357.273689,x:2.032,y:5.842,offsetX:-508.63316875916,offsetY:1.20815479432,dashLengthItems:[5.3400452,-528.66437425738]}),ve.add({lineAngle:37.69424047,x:7.366,y:5.588,offsetX:-416.58997273292,offsetY:.91357450169,dashLengthItems:[7.0619366,-699.13115314247]}),ve.add({lineAngle:72.25532837,x:12.954,y:9.906,offsetX:586.40373773403,offsetY:.96766293399,dashLengthItems:[6.6671952,-660.05256601905]}),ve.add({lineAngle:121.42956562,x:14.986,y:16.256,offsetX:387.71230339293,offsetY:1.2040754753,dashLengthItems:[5.35813,-530.45545698712]}),ve.add({lineAngle:175.2363583,x:12.192,y:20.828,offsetX:-280.5442400419,offsetY:2.10935518695,dashLengthItems:[6.1171328,-299.7393695]}),ve.add({lineAngle:222.3974378,x:6.096,y:21.336,offsetX:413.48123885686,offsetY:.81554484621,dashLengthItems:[7.9107792,-783.16772512177]}),ve.add({lineAngle:138.81407483,x:25.4,y:15.748,offsetX:234.164238558,offsetY:2.38943100688,dashLengthItems:[2.7000454,-267.30565824344]}),ve.add({lineAngle:171.4692344,x:23.368,y:17.526,offsetX:-334.082478726,offsetY:1.25594916784,dashLengthItems:[5.1368198,-508.5463899704]}),ve.add({lineAngle:225,x:18.288,y:18.288,offsetX:17.96051224214,offsetY:17.96051224214,dashLengthItems:[3.5920934,-32.32893108428]}),ve.add({lineAngle:203.19859051,x:16.51,y:21.336,offsetX:-136.74251918,offsetY:3.33518339548,dashLengthItems:[1.9344132,-191.50622368894]}),ve.add({lineAngle:291.80140949,x:14.732,y:20.574,offsetX:-80.18324702488,offsetY:4.71666158921,dashLengthItems:[2.7356562,-134.0475299]}),ve.add({lineAngle:30.96375653,x:15.748,y:18.034,offsetX:91.47734531502,offsetY:4.35606406258,dashLengthItems:[4.4431966,-143.6629815291]}),ve.add({lineAngle:161.56505118,x:19.558,y:20.32,offsetX:-56.2252967978,offsetY:8.03218525675,dashLengthItems:[3.2128714,-77.10898116828]}),ve.add({lineAngle:16.389540334,x:0,y:20.574,offsetX:265.17991128726,offsetY:1.43340492604,dashLengthItems:[4.50088,-445.58826672539]}),ve.add({lineAngle:70.34617594,x:4.318,y:21.844,offsetX:-297.29446803469,offsetY:1.70858889651,dashLengthItems:[3.7759894,-373.822156782]}),ve.add({lineAngle:293.19859051,x:19.558,y:25.4,offsetX:-136.7425191801,offsetY:3.33518339548,dashLengthItems:[3.868801,-189.57183588894]}),ve.add({lineAngle:343.61045967,x:21.082,y:21.844,offsetX:-265.17991128725,offsetY:1.433404926,dashLengthItems:[4.50088,-445.5882667254]}),ve.add({lineAngle:339.44395478,x:0,y:4.826,offsetX:-136.75087638398,offsetY:2.97284513779,dashLengthItems:[4.340352,-212.67734313106]}),ve.add({lineAngle:294.7751406,x:4.064,y:3.302,offsetX:-306.90424056705,offsetY:1.77401295215,dashLengthItems:[3.6367212,-360.0359338072]}),ve.add({lineAngle:66.80140949,x:19.812,y:0,offsetX:136.74251918012,offsetY:3.33518339452,dashLengthItems:[3.868801,-189.57183588894]}),ve.add({lineAngle:17.35402464,x:21.336,y:3.556,offsetX:-345.47402804977,offsetY:1.51523696536,dashLengthItems:[4.2578274,-421.523759802]}),ve.add({lineAngle:69.44395478,x:7.366,y:0,offsetX:-136.75087638396,offsetY:2.97284513874,dashLengthItems:[2.170176,-214.84751913106]}),ve.add({lineAngle:101.309932474,x:18.288,y:0,offsetX:104.60834648271,offsetY:4.98134983255,dashLengthItems:[1.295146,-128.21994964526]}),ve.add({lineAngle:165.963756532,x:18.034,y:1.27,offsetX:-80.085263387,offsetY:6.16040487582,dashLengthItems:[5.236337,-99.49054589069]}),ve.add({lineAngle:186.00900596,x:12.954,y:2.54,offsetX:-255.26337856879,offsetY:1.32949676118,dashLengthItems:[4.85267,-480.41364863337]}),ve.add({lineAngle:303.69006753,x:15.748,y:15.748,offsetX:-56.35753993648,offsetY:7.0446924921,dashLengthItems:[3.6632388,-87.9177635968]}),ve.add({lineAngle:353.15722659,x:17.78,y:12.7,offsetX:434.77679606606,offsetY:1.0087628707,dashLengthItems:[6.3955676,-633.16009065031]}),ve.add({lineAngle:60.9453959,x:24.13,y:11.938,offsetX:-204.76648550216,offsetY:2.46706609031,dashLengthItems:[2.6150824,-258.8939231811]}),ve.add({lineAngle:90,x:25.4,y:14.224,offsetX:25.4,offsetY:25.4,dashLengthItems:[1.524,-23.876]}),ve.add({lineAngle:120.25643716,x:12.446,y:3.302,offsetX:-204.77318477297,offsetY:1.8283320086,dashLengthItems:[3.5286696,-349.339407732]}),ve.add({lineAngle:48.0127875,x:10.668,y:6.35,offsetX:305.85067529778,offsetY:1.88796713138,dashLengthItems:[6.8344288,-334.88762199565]}),ve.add({lineAngle:0,x:15.24,y:11.43,offsetX:25.4,offsetY:25.4,dashLengthItems:[6.604,-18.796]}),ve.add({lineAngle:325.3048465,x:21.844,y:11.43,offsetX:310.04235091354,offsetY:-1.6064370526,dashLengthItems:[4.0160956,-397.5931672414]}),ve.add({lineAngle:254.0546041,x:25.146,y:9.144,offsetX:104.6687497289,offsetY:3.48895832444,dashLengthItems:[3.6982908,-181.21650038772]}),ve.add({lineAngle:207.64597536,x:24.13,y:5.588,offsetX:545.36007557253,offsetY:1.07143433066,dashLengthItems:[6.021451,-596.12464422938]}),ve.add({lineAngle:175.42607874,x:18.796,y:2.794,offsetX:331.1739336186,offsetY:1.01276432357,dashLengthItems:[6.3702946,-630.6584645624]}),W.set("HEX",ve);const ya=new X("HONEY");ya.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5.4992613154,dashLengthItems:[3.175,-6.35]}),ya.add({lineAngle:120,x:0,y:0,offsetX:0,offsetY:5.4992613154,dashLengthItems:[3.175,-6.35]}),ya.add({lineAngle:60,x:3.175,y:0,offsetX:0,offsetY:5.4992613154,dashLengthItems:[3.175,-6.35]}),W.set("HONEY",ya);const va=new X("HOUND");va.add({lineAngle:0,x:0,y:0,offsetX:4.7625,offsetY:2.749630645,dashLengthItems:[3.175,-6.35]}),va.add({lineAngle:120,x:0,y:0,offsetX:4.7625,offsetY:2.749630645,dashLengthItems:[3.175,-6.35]}),va.add({lineAngle:60,x:0,y:0,offsetX:4.7625,offsetY:2.749630645,dashLengthItems:[-6.35,3.175]}),W.set("HOUND",va);const nu=new X("INSUL");nu.add({lineAngle:0,x:0,y:0,offsetX:6.35,offsetY:1.5875,dashLengthItems:[25.4,-12.7]}),nu.add({lineAngle:90,x:0,y:0,offsetX:-6.35,offsetY:1.5875,dashLengthItems:[25.4,-12.7]}),W.set("INSUL",nu);const wa=new X("ACAD_ISO02W100");wa.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:9.525,dashLengthItems:[]}),wa.add({lineAngle:0,x:0,y:3.175,offsetX:0,offsetY:9.525,dashLengthItems:[3.175,-3.175]}),wa.add({lineAngle:0,x:0,y:6.35,offsetX:0,offsetY:9.525,dashLengthItems:[3.175,-3.175]}),W.set("ACAD_ISO02W100",wa);const em=new X("ACAD_ISO03W100");em.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-3]}),W.set("ACAD_ISO03W100",em);const tm=new X("ACAD_ISO04W100");tm.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-18]}),W.set("ACAD_ISO04W100",tm);const nm=new X("ACAD_ISO05W100");nm.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[24,-3,.5,-3]}),W.set("ACAD_ISO05W100",nm);const sm=new X("ACAD_ISO06W100");sm.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[24,-3,.5,-3,.5,-3]}),W.set("ACAD_ISO06W100",sm);const su=new X("ACAD_ISO07W100");su.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[24,-3,.5,-3,.5,-6.5]}),su.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[-34,.5,-3]}),W.set("ACAD_ISO07W100",su);const im=new X("ACAD_ISO08W100");im.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[.5,-3]}),W.set("ACAD_ISO08W100",im);const rm=new X("ACAD_ISO09W100");rm.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[24,-3,6,-3]}),W.set("ACAD_ISO09W100",rm);const om=new X("ACAD_ISO10W100");om.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[24,-3,6,-3,6,-3]}),W.set("ACAD_ISO10W100",om);const am=new X("ACAD_ISO11W100");am.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-3,.5,-3]}),W.set("ACAD_ISO11W100",am);const lm=new X("ACAD_ISO12W100");lm.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-3,12,-3,.5,-3]}),W.set("ACAD_ISO12W100",lm);const cm=new X("ACAD_ISO13W100");cm.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-3,.5,-3,.5,-3]}),W.set("ACAD_ISO13W100",cm);const iu=new X("ACAD_ISO14W100");iu.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-3,12,-3,.5,-6.5]}),iu.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[-33.5,.5,-3]}),W.set("ACAD_ISO14W100",iu);const ru=new X("ACAD_ISO15W100");ru.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-3,.5,-3,.5,-6.5]}),ru.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[-22,.5,-3]}),W.set("ACAD_ISO15W100",ru);const ou=new X("JIS_LC_20");ou.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[12,-3,12,-3,.5,-10]}),ou.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5,dashLengthItems:[-33.5,.5,-3,.5,-3]}),W.set("JIS_LC_20",ou);const au=new X("JIS_LC_20A");au.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:20,dashLengthItems:[]}),au.add({lineAngle:45,x:.4,y:0,offsetX:0,offsetY:20,dashLengthItems:[]}),W.set("JIS_LC_20A",au);const lu=new X("JIS_LC_8");lu.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:20,dashLengthItems:[]}),lu.add({lineAngle:45,x:1,y:0,offsetX:0,offsetY:20,dashLengthItems:[]}),W.set("JIS_LC_8",lu);const cu=new X("JIS_LC_8A");cu.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:7.8,dashLengthItems:[]}),cu.add({lineAngle:45,x:.4,y:0,offsetX:0,offsetY:7.8,dashLengthItems:[]}),W.set("JIS_LC_8A",cu);const uu=new X("JIS_RC_10");uu.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:7.8,dashLengthItems:[]}),uu.add({lineAngle:45,x:1,y:0,offsetX:0,offsetY:7.8,dashLengthItems:[]}),W.set("JIS_RC_10",uu);const Ta=new X("JIS_RC_15");Ta.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:10,dashLengthItems:[]}),Ta.add({lineAngle:45,x:.725,y:0,offsetX:0,offsetY:10,dashLengthItems:[]}),Ta.add({lineAngle:45,x:1.45,y:0,offsetX:0,offsetY:10,dashLengthItems:[]}),W.set("JIS_RC_15",Ta);const Ea=new X("JIS_RC_18");Ea.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:15,dashLengthItems:[]}),Ea.add({lineAngle:45,x:.725,y:0,offsetX:0,offsetY:15,dashLengthItems:[]}),Ea.add({lineAngle:45,x:1.45,y:0,offsetX:0,offsetY:15,dashLengthItems:[]}),W.set("JIS_RC_18",Ea);const Aa=new X("JIS_RC_30");Aa.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:18,dashLengthItems:[]}),Aa.add({lineAngle:45,x:1,y:0,offsetX:0,offsetY:18,dashLengthItems:[]}),Aa.add({lineAngle:45,x:2,y:0,offsetX:0,offsetY:18,dashLengthItems:[]}),W.set("JIS_RC_30",Aa);const xa=new X("JIS_STN_1E");xa.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:30,dashLengthItems:[]}),xa.add({lineAngle:45,x:1,y:0,offsetX:0,offsetY:30,dashLengthItems:[]}),xa.add({lineAngle:45,x:2,y:0,offsetX:0,offsetY:30,dashLengthItems:[]}),W.set("JIS_STN_1E",xa);const hu=new X("JIS_STN_2_5");hu.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:1,dashLengthItems:[]}),hu.add({lineAngle:45,x:.705,y:0,offsetX:0,offsetY:1,dashLengthItems:[1,-.5]}),W.set("JIS_STN_2_5",hu);const du=new X("JIS_WOOD");du.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:2.5,dashLengthItems:[]}),du.add({lineAngle:45,x:1.765,y:0,offsetX:0,offsetY:2.5,dashLengthItems:[1.2,-.5]}),W.set("JIS_WOOD",du);const um=new X("LINE");um.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:.70710678,dashLengthItems:[]}),W.set("LINE",um);const hm=new X("MUDST");hm.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),W.set("MUDST",hm);const dm=new X("NET");dm.add({lineAngle:0,x:0,y:0,offsetX:12.7,offsetY:6.35,dashLengthItems:[6.35,-6.35,0,-6.35,0,-6.35]}),W.set("NET",dm);const fu=new X("NET3");fu.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),fu.add({lineAngle:90,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),W.set("NET3",fu);const Ia=new X("PLAST");Ia.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),Ia.add({lineAngle:60,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),Ia.add({lineAngle:120,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),W.set("PLAST",Ia);const Sa=new X("PLASTI");Sa.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),Sa.add({lineAngle:0,x:0,y:.79375,offsetX:0,offsetY:6.35,dashLengthItems:[]}),Sa.add({lineAngle:0,x:0,y:1.5875,offsetX:0,offsetY:6.35,dashLengthItems:[]}),W.set("PLASTI",Sa);const Cr=new X("SACNCR");Cr.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),Cr.add({lineAngle:0,x:0,y:.79375,offsetX:0,offsetY:6.35,dashLengthItems:[]}),Cr.add({lineAngle:0,x:0,y:1.5875,offsetX:0,offsetY:6.35,dashLengthItems:[]}),Cr.add({lineAngle:0,x:0,y:3.96875,offsetX:0,offsetY:6.35,dashLengthItems:[]}),W.set("SACNCR",Cr);const pu=new X("SQUARE");pu.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:2.38125,dashLengthItems:[]}),pu.add({lineAngle:45,x:1.6838,y:0,offsetX:0,offsetY:2.38125,dashLengthItems:[0,-2.38125]}),W.set("SQUARE",pu);const gu=new X("STARS");gu.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[3.175,-3.175]}),gu.add({lineAngle:90,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[3.175,-3.175]}),W.set("STARS",gu);const ba=new X("STEEL");ba.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:5.4992613154,dashLengthItems:[3.175,-3.175]}),ba.add({lineAngle:60,x:0,y:0,offsetX:0,offsetY:5.4992613154,dashLengthItems:[3.175,-3.175]}),ba.add({lineAngle:120,x:1.5875,y:2.7496306704,offsetX:0,offsetY:5.4992613154,dashLengthItems:[3.175,-3.175]}),W.set("STEEL",ba);const mu=new X("SWAMP");mu.add({lineAngle:45,x:0,y:0,offsetX:0,offsetY:3.175,dashLengthItems:[]}),mu.add({lineAngle:45,x:0,y:1.5875,offsetX:0,offsetY:3.175,dashLengthItems:[]}),W.set("SWAMP",mu);const Ys=new X("TRANS");Ys.add({lineAngle:0,x:0,y:0,offsetX:12.7,offsetY:21.9970452362,dashLengthItems:[3.175,-22.225]}),Ys.add({lineAngle:90,x:1.5875,y:0,offsetX:21.9970452362,offsetY:12.7,dashLengthItems:[1.5875,-42.4065904724]}),Ys.add({lineAngle:90,x:1.984375,y:0,offsetX:21.9970452362,offsetY:12.7,dashLengthItems:[1.27,-42.7240904724]}),Ys.add({lineAngle:90,x:1.190625,y:0,offsetX:21.9970452362,offsetY:12.7,dashLengthItems:[1.27,-42.7240904724]}),Ys.add({lineAngle:60,x:2.38125,y:0,offsetX:12.7,offsetY:21.9970452362,dashLengthItems:[1.016,-24.384]}),Ys.add({lineAngle:120,x:.79375,y:0,offsetX:12.7,offsetY:21.9970452362,dashLengthItems:[1.016,-24.384]}),W.set("TRANS",Ys);const _u=new X("TRIANG");_u.add({lineAngle:0,x:0,y:0,offsetX:0,offsetY:6.35,dashLengthItems:[]}),_u.add({lineAngle:0,x:0,y:3.175,offsetX:0,offsetY:6.35,dashLengthItems:[3.175,-3.175]}),W.set("TRIANG",_u);const Ca=new X("ZIGZAG");Ca.add({lineAngle:60,x:0,y:0,offsetX:4.7625,offsetY:8.2488919604,dashLengthItems:[4.7625,-4.7625]}),Ca.add({lineAngle:120,x:0,y:0,offsetX:4.7625,offsetY:8.2488919604,dashLengthItems:[4.7625,-4.7625]}),Ca.add({lineAngle:0,x:-2.38125,y:4.1244459802,offsetX:4.7625,offsetY:8.2488919604,dashLengthItems:[4.7625,-4.7625]}),W.set("ZIGZAG",Ca);class yl{static fromHex(e){return e.startsWith("#")&&(e=e.replace("#","")),parseInt(e,16)}static fromRGB(e,n,s){const i=[e,n,s].reduce((r,o)=>{const a=o.toString(16);return`${r}${a.length===1?"0"+a:a}`},"0x00");return yl.fromHex(i)}}class tt{constructor(e,n,s){this.type=e,this.subclassMarker=n,this.layerName=s==null?void 0:s.layerName,this.handle=Vt.next(),this.trueColor=s==null?void 0:s.trueColor,this.inPaperSpace=!1,this.colorNumber=s==null?void 0:s.colorNumber,this.visible=s==null?void 0:s.visible,this.lineType=s==null?void 0:s.lineType,this.lineTypeScale=s==null?void 0:s.lineTypeScale,this.extrusion=s==null?void 0:s.extrusion,this.xdatas=[]}boundingBox(){return Ue.pointBBox(B())}addXData(e){const n=new Z3(e);return this.xdatas.push(n),n}dxfy(e){var n,s,i;e.type(this.type),e.handle(this.handle),e.push(330,this.ownerBlockRecord),e.subclassMarker("AcDbEntity"),this.inPaperSpace&&e.push(67,Number(this.inPaperSpace)),e.push(420,this.trueColor),e.layerName(this.layerName||Mi.layerZeroName),e.lineType(this.lineType),e.colorNumber(this.colorNumber),e.push(48,this.lineTypeScale),e.visibilty(this.visible),e.subclassMarker(this.subclassMarker),this.type!=="HATCH"&&(e.push(210,(n=this.extrusion)===null||n===void 0?void 0:n.x),e.push(220,(s=this.extrusion)===null||s===void 0?void 0:s.y),e.push(230,(i=this.extrusion)===null||i===void 0?void 0:i.z)),this.dxfyChild(e),this.xdatas.forEach(r=>r.dxfy(e))}}var ns,hh,fm;(function(t){t[t.Default=0]="Default",t[t.Aligned=1]="Aligned",t[t.Angular=2]="Angular",t[t.Diameter=3]="Diameter",t[t.Radius=4]="Radius",t[t.Angular3Point=5]="Angular3Point",t[t.Ordinate=6]="Ordinate",t[t.ReferencedByThis=32]="ReferencedByThis",t[t.OrdinateType=64]="OrdinateType"})(ns||(ns={})),function(t){t[t.TopLeft=1]="TopLeft",t[t.TopCenter=2]="TopCenter",t[t.TopRight=3]="TopRight",t[t.MiddleLeft=4]="MiddleLeft",t[t.MiddleCenter=5]="MiddleCenter",t[t.MiddleRight=6]="MiddleRight",t[t.BottomLeft=7]="BottomLeft",t[t.BottomCenter=8]="BottomCenter",t[t.BottomRight=9]="BottomRight"}(hh||(hh={})),function(t){t[t.AtLeast=1]="AtLeast",t[t.Exact=2]="Exact"}(fm||(fm={}));class sr extends tt{constructor(e){super("DIMENSION","AcDbDimension",e),this.blockName=e==null?void 0:e.blockName,this.definitionPoint=e==null?void 0:e.definitionPoint,this.middlePoint=e==null?void 0:e.middlePoint,this.dimensionType=ns.Default,this.attachmentPoint=(e==null?void 0:e.attachmentPoint)||hh.MiddleCenter,this.textLineSpacingStyle=e==null?void 0:e.textLineSpacingStyle,this.textLineSpacingFactor=e==null?void 0:e.textLineSpacingFactor,this.ActualMeasurement=e==null?void 0:e.ActualMeasurement,this.text=e==null?void 0:e.text,this.rotation=e==null?void 0:e.rotation,this.horizontalDirection=e==null?void 0:e.horizontalDirection,this.styleName=e==null?void 0:e.styleName}dxfyChild(e){e.push(2,this.blockName),e.point3d(this.definitionPoint),e.point3d(this.middlePoint,1),e.push(70,this.dimensionType),e.push(71,this.attachmentPoint),e.push(72,this.textLineSpacingStyle),e.push(41,this.textLineSpacingFactor),e.push(42,this.ActualMeasurement),e.push(1,this.text),e.push(53,this.rotation==="auto"?this.rotate():this.rotation),e.push(51,this.horizontalDirection),e.push(3,this.styleName)}}const vl=/[<>/\\":;?*|=`]/g;function Fr(t){return t*Math.PI/180}function eD(t,e){const n=function(s,i){return Math.sqrt(Math.pow(s.x-i.x,2)+Math.pow(s.y-i.y,2))}(t,e);return n===0?n:180*Math.asin(Math.abs(t.y-e.y)/n)/Math.PI}class tD extends sr{constructor(e,n,s){super(s),this.dimensionType=ns.Aligned,this.insertionPoint=s==null?void 0:s.insertionPoint,this.fisrtPoint=e,this.secondPoint=n,this.offset(s==null?void 0:s.offset)}offset(e){if(e==null)return;const[n,s]=function(r,o){const a=r.x-o.x;let u=0;return a!==0&&(u=(r.y-o.y)/a),[u,r.y-u*r.x]}(this.fisrtPoint,this.secondPoint),i=function(r,o){const[a,u]=o;return u-r*Math.sqrt(a*a+1)}(e,[n,s]);this.definitionPoint=function(r,o){const[a,u]=r,h=a??-1/a,d=o.y-h*o.x,p=h-a;let m=u-d;return p!==0&&(m=(u-d)/p),B(m,a*m+u,o.z)}([n,i],this.fisrtPoint)}rotate(){return eD(this.fisrtPoint,this.secondPoint)}dxfyChild(e){super.dxfyChild(e),e.subclassMarker("AcDbAlignedDimension"),e.point3d(this.insertionPoint,2),e.point3d(this.fisrtPoint,3),e.point3d(this.secondPoint,4)}}class nD extends sr{constructor(e,n,s,i){super(i),this.first=e,this.second=n,this.location=s,this.dimensionType=ns.Angular}rotate(){return 0}_update(){this.definitionPoint=this.second.end}dxfyChild(e){this._update(),super.dxfyChild(e),e.subclassMarker("AcDb2LineAngularDimension"),e.point3d(this.first.start,3),e.point3d(this.first.end,4),e.point3d(this.second.start,5),e.point3d(this.location,6)}}class sD extends sr{constructor(e,n,s,i){super(i),this.center=e,this.first=n,this.second=s,this.dimensionType=ns.Angular3Point}rotate(){return 0}dxfyChild(e){super.dxfyChild(e),e.subclassMarker("AcDb3PointAngularDimension"),e.point3d(this.first,3),e.point3d(this.second,4),e.point3d(this.center,5)}}class iD extends sr{constructor(e,n,s){super(s),this.dimensionType=ns.Diameter,this.first=e,this.definitionPoint=n,this.leaderLength=s==null?void 0:s.leaderLength}rotate(){return 0}dxfyChild(e){super.dxfyChild(e),e.subclassMarker("AcDbDiametricDimension"),e.point3d(this.first,5),e.push(40,this.leaderLength)}}class rD extends sr{constructor(e,n,s){var i;super(s),this.dimensionType=ns.Default,this.insertionPoint=s==null?void 0:s.insertionPoint,this.fisrtPoint=e,this.secondPoint=n,this.angle=(i=s==null?void 0:s.angle)!==null&&i!==void 0?i:0,this.linearType=s==null?void 0:s.linearType,this.offset(s==null?void 0:s.offset)}offset(e){if(e==null)return;const n=Fr(this.angle),s=this.fisrtPoint.x+e*Math.floor(Math.sin(n)),i=this.fisrtPoint.y+e*Math.floor(Math.cos(n));this.definitionPoint=B(s,i,0)}rotate(){return this.angle}dxfyChild(e){super.dxfyChild(e),e.subclassMarker("AcDbAlignedDimension"),e.point3d(this.insertionPoint,2),e.point3d(this.fisrtPoint,3),e.point3d(this.secondPoint,4),e.push(50,this.angle),e.push(52,this.linearType),e.subclassMarker("AcDbRotatedDimension")}}class oD extends sr{constructor(e,n,s){super(s),this.dimensionType=ns.Radius,this.first=e,this.definitionPoint=n,this.leaderLength=s==null?void 0:s.leaderLength}rotate(){return 0}dxfyChild(e){super.dxfyChild(e),e.subclassMarker("AcDbRadialDimension"),e.point3d(this.first,5),e.push(40,this.leaderLength)}}class aD extends tt{get start(){return B(this.center.x+this.radius*Math.cos(Fr(this.startAngle)),this.center.y+this.radius*Math.sin(Fr(this.startAngle)))}get end(){return B(this.center.x+this.radius*Math.cos(Fr(this.endAngle)),this.center.y+this.radius*Math.sin(Fr(this.endAngle)))}constructor(e,n,s,i,r){super("ARC","AcDbCircle",r),this.center=e,this.radius=n,this.startAngle=s,this.endAngle=i}boundingBox(){return Ue.centerRadiusBBox(this.center,this.radius)}dxfyChild(e){e.point3d(this.center),e.push(40,this.radius),e.subclassMarker("AcDbArc"),e.push(50,this.startAngle),e.push(51,this.endAngle)}}class lD extends tt{constructor(e,n,s,i,r){super("ATTDEF","AcDbText",r),this.position=e,this.height=n,this.value=i,this.tag=s,this.textStyle="STANDARD",this.rotation=r==null?void 0:r.rotation,this.obliqueAngle=r==null?void 0:r.obliqueAngle,this.generationFlags=r==null?void 0:r.generationFlags,this.horizontalAlignment=r==null?void 0:r.horizontalAlignment,this.verticalAlignment=r==null?void 0:r.verticalAlignment,this.secondAlignmentPoint=r==null?void 0:r.secondAlignmentPoint,this.relativeXScaleFactor=r==null?void 0:r.relativeXScaleFactor}boundingBox(){return Ue.pointBBox(this.position)}dxfyChild(e){e.point3d(this.position),e.push(40,this.height),e.primaryText(this.value),e.push(50,this.rotation),e.push(41,this.relativeXScaleFactor),e.push(51,this.obliqueAngle),e.textStyle(this.textStyle),e.push(71,this.generationFlags),e.push(72,this.horizontalAlignment),this.secondAlignmentPoint&&(e.push(11,this.secondAlignmentPoint.x),e.push(21,this.secondAlignmentPoint.y),e.push(31,this.secondAlignmentPoint.z)),e.push(73,this.verticalAlignment),e.subclassMarker("AcDbAttributeDefinition"),e.push(280,0),e.push(3,""),e.push(2,this.tag),e.push(70,0)}}class cD extends tt{constructor(e,n,s,i,r){super("ATTRIB","AcDbText",r),this.position=e,this.height=n,this.value=i,this.tag=s,this.textStyle="STANDARD",this.rotation=r==null?void 0:r.rotation,this.obliqueAngle=r==null?void 0:r.obliqueAngle,this.generationFlags=r==null?void 0:r.generationFlags,this.horizontalAlignment=r==null?void 0:r.horizontalAlignment,this.verticalAlignment=r==null?void 0:r.verticalAlignment,this.secondAlignmentPoint=r==null?void 0:r.secondAlignmentPoint,this.relativeXScaleFactor=r==null?void 0:r.relativeXScaleFactor}boundingBox(){return Ue.pointBBox(this.position)}dxfyChild(e){e.point3d(this.position),e.push(40,this.height),e.primaryText(this.value),e.push(50,this.rotation),e.push(41,this.relativeXScaleFactor),e.push(51,this.obliqueAngle),e.textStyle(this.textStyle),e.push(71,this.generationFlags),e.push(72,this.horizontalAlignment),e.point3d(this.secondAlignmentPoint,1),e.push(73,this.verticalAlignment),e.subclassMarker("AcDbAttribute"),e.push(280,0),e.push(2,this.tag),e.push(70,0)}}class uD extends tt{constructor(e,n,s){super("CIRCLE","AcDbCircle",s),this.center=e,this.radius=n}boundingBox(){return Ue.centerRadiusBBox(this.center,this.radius)}dxfyChild(e){e.point3d(this.center),e.push(40,this.radius)}}class hD extends tt{constructor(e,n,s,i,r,o){super("ELLIPSE","AcDbEllipse",o),this.center=e,this.endPointOfMajorAxis=n,this.ratioOfMinorAxisToMajorAxis=s,this.startParameter=i,this.endParameter=r}boundingBox(){const e=this.center.x,n=this.center.y,s=this.endPointOfMajorAxis.x,i=this.endPointOfMajorAxis.y,r=Math.sqrt(Math.pow(e-(e+s),2)+Math.pow(n-(n+i),2));return Ue.centerRadiusBBox(this.center,r)}dxfyChild(e){e.point3d(this.center),e.point3d(this.endPointOfMajorAxis,1),e.push(40,this.ratioOfMinorAxisToMajorAxis),e.push(41,this.startParameter),e.push(42,this.endParameter)}}var Yt,wl,dh,pm,Kr,fh,ph,gh,$n,Tl,Qr,mh,_h,yh,vh,El,gm,mm,_m,Al,wh,Th,Eh,ym,vm,wm,Tm,Em,Am,xm,Ah,xh,xl,Ih;(function(t){t[t.None=0]="None",t[t.First=1]="First",t[t.Second=2]="Second",t[t.Third=4]="Third",t[t.Fourth=8]="Fourth"})(Yt||(Yt={}));class dD extends tt{constructor(e,n,s,i,r){super("3DFACE","AcDbFace",r),this.firstCorner=e,this.secondCorner=n,this.thirdCorner=s,this.fourthCorner=i,this.invisibleEdges=(r==null?void 0:r.invisibleEdges)||Yt.None}setFirstEdgeVisible(e){this.setEdgeVisible(Yt.First,e)}setSecondEdgeVisible(e){this.setEdgeVisible(Yt.Second,e)}setThirdEdgeVisible(e){this.setEdgeVisible(Yt.Third,e)}setFourthEdgeVisible(e){this.setEdgeVisible(Yt.Fourth,e)}setEdgesVisible(e){this.invisibleEdges=e?Yt.None:Yt.First|Yt.Second|Yt.Third|Yt.Fourth}setEdgeVisible(e,n){n?this.invisibleEdges|=e:this.invisibleEdges===(this.invisibleEdges|e)&&(this.invisibleEdges^=e)}boundingBox(){return Ue.verticesBBox([this.firstCorner,this.secondCorner,this.thirdCorner,this.fourthCorner])}dxfyChild(e){e.point3d(this.firstCorner),e.point3d(this.secondCorner,1),e.point3d(this.thirdCorner,2),e.point3d(this.fourthCorner,3),e.push(70,this.invisibleEdges)}}(function(t){t.SOLID="SOLID",t.ANGLE="ANGLE",t.ANSI31="ANSI31",t.ANSI32="ANSI32",t.ANSI33="ANSI33",t.ANSI34="ANSI34",t.ANSI35="ANSI35",t.ANSI36="ANSI36",t.ANSI37="ANSI37",t.ANSI38="ANSI38",t.AR_B816="AR_B816",t.AR_B816C="AR_B816C",t.AR_B88="AR_B88",t.AR_BRELM="AR_BRELM",t.AR_BRSTD="AR_BRSTD",t.AR_CONC="AR_CONC",t.AR_HBONE="AR_HBONE",t.AR_PARQ1="AR_PARQ1",t.AR_RROOF="AR_RROOF",t.AR_RSHKE="AR_RSHKE",t.AR_SAND="AR_SAND",t.BOX="BOX",t.BRASS="BRASS",t.BRICK="BRICK",t.BRSTONE="BRSTONE",t.CLAY="CLAY",t.CORK="CORK",t.CROSS="CROSS",t.DASH="DASH",t.DOLMIT="DOLMIT",t.DOTS="DOTS",t.EARTH="EARTH",t.ESCHER="ESCHER",t.FLEX="FLEX",t.GOST_GLASS="GOST_GLASS",t.GOST_WOOD="GOST_WOOD",t.GOST_GROUND="GOST_GROUND",t.GRASS="GRASS",t.GRATE="GRATE",t.GRAVEL="GRAVEL",t.HEX="HEX",t.HONEY="HONEY",t.HOUND="HOUND",t.INSUL="INSUL",t.ACAD_ISO02W100="ACAD_ISO02W100",t.ACAD_ISO03W100="ACAD_ISO03W100",t.ACAD_ISO04W100="ACAD_ISO04W100",t.ACAD_ISO05W100="ACAD_ISO05W100",t.ACAD_ISO06W100="ACAD_ISO06W100",t.ACAD_ISO07W100="ACAD_ISO07W100",t.ACAD_ISO08W100="ACAD_ISO08W100",t.ACAD_ISO09W100="ACAD_ISO09W100",t.ACAD_ISO10W100="ACAD_ISO10W100",t.ACAD_ISO11W100="ACAD_ISO11W100",t.ACAD_ISO12W100="ACAD_ISO12W100",t.ACAD_ISO13W100="ACAD_ISO13W100",t.ACAD_ISO14W100="ACAD_ISO14W100",t.ACAD_ISO15W100="ACAD_ISO15W100",t.JIS_LC_20="JIS_LC_20",t.JIS_LC_20A="JIS_LC_20A",t.JIS_LC_8="JIS_LC_8",t.JIS_LC_8A="JIS_LC_8A",t.JIS_RC_10="JIS_RC_10",t.JIS_RC_15="JIS_RC_15",t.JIS_RC_18="JIS_RC_18",t.JIS_RC_30="JIS_RC_30",t.JIS_STN_1E="JIS_STN_1E",t.JIS_STN_2_5="JIS_STN_2_5",t.JIS_WOOD="JIS_WOOD",t.LINE="LINE",t.MUDST="MUDST",t.NET="NET",t.NET3="NET3",t.PLAST="PLAST",t.PLASTI="PLASTI",t.SACNCR="SACNCR",t.SQUARE="SQUARE",t.STARS="STARS",t.STEEL="STEEL",t.SWAMP="SWAMP",t.TRANS="TRANS",t.TRIANG="TRIANG",t.ZIGZAG="ZIGZAG"})(wl||(wl={})),function(t){t[t.UserDefined=0]="UserDefined",t[t.Predifined=1]="Predifined",t[t.Custom=2]="Custom"}(dh||(dh={}));(function(t){t[t.Default=0]="Default",t[t.External=1]="External",t[t.Polyline=2]="Polyline",t[t.Derived=4]="Derived",t[t.Textbox=8]="Textbox",t[t.Outermost=16]="Outermost"})(pm||(pm={}));(function(t){t[t.SolidFill=1]="SolidFill",t[t.PatternFill=0]="PatternFill"})(Kr||(Kr={})),function(t){t[t.NonAssociative=0]="NonAssociative",t[t.Associative=1]="Associative"}(fh||(fh={})),function(t){t[t.Normal=0]="Normal",t[t.Outer=1]="Outer",t[t.Ignore=2]="Ignore"}(ph||(ph={})),function(t){t.LINEAR="LINEAR",t.CYLINDER="CYLINDER",t.INVCYLINDER="INVCYLINDER",t.SPHERICAL="SPHERICAL",t.HEMISPHERICAL="HEMISPHERICAL",t.CURVED="CURVED",t.INVSPHERICAL="SPHERICAL",t.INVHEMISPHERICAL="INVHEMISPHERICAL",t.INVCURVED="INVCURVED"}(gh||(gh={}));class fD extends tt{get patternName(){let e=wl.SOLID;return this.isPattern(this.fill)&&(e=this.fill.name),e}get solidFillFlag(){return this.patternName===wl.SOLID?Kr.SolidFill:Kr.PatternFill}constructor(e,n,s){super("HATCH","AcDbHatch",s),this.fill=n,this.elevation=(s==null?void 0:s.elevation)||0,this.extrusion=(s==null?void 0:s.extrusion)||B(0,0,1),this.boundaryPath=e}pattern(e,n){var s;const i=n.name,r=(s=n.angle)!==null&&s!==void 0?s:0,o=n.scale||1,a=n.double||!1;e.push(52,r),e.push(41,o),e.push(77,Number(a));const u=W.get(i);u&&(u.scale=o,r!==0&&(u.angle=r),u.dxfy(e))}gradient(e,n){var s,i,r;const o=n.firstColor,a=(s=n.secondColor)!==null&&s!==void 0?s:7,u=(i=n.angle)!==null&&i!==void 0?i:0,h=n.definition||0,d=(r=n.tint)!==null&&r!==void 0?r:1,p=n.type||gh.LINEAR;e.push(450,1),e.push(451,0),e.push(460,u),e.push(461,h),e.push(452,n.secondColor?0:1),e.push(462,d),e.push(453,2),e.push(463,0),e.push(63,o),e.push(421,yl.fromHex(zg(o))),e.push(463,1),e.push(63,a),e.push(421,yl.fromHex(zg(a))),e.push(470,p)}isPattern(e){return"name"in e}boundingBox(){return Ue.pointBBox(B(0,0))}dxfyChild(e){var n,s,i;e.point3d(B(0,0,this.elevation)),e.push(210,(n=this.extrusion)===null||n===void 0?void 0:n.x),e.push(220,(s=this.extrusion)===null||s===void 0?void 0:s.y),e.push(230,(i=this.extrusion)===null||i===void 0?void 0:i.z),e.name(this.patternName),e.push(70,this.solidFillFlag),e.push(71,fh.NonAssociative),e.push(91,this.boundaryPath.length),this.boundaryPath.dxfy(e),e.push(75,ph.Outer),e.push(76,dh.Predifined),this.isPattern(this.fill)?(this.solidFillFlag===Kr.PatternFill&&this.pattern(e,this.fill),e.push(47,1),e.push(98,0)):(e.push(47,1),e.push(98,0),this.gradient(e,this.fill))}}(function(t){t[t.ShowImage=1]="ShowImage",t[t.ShowImageWhenNotAlignedWithScreen=2]="ShowImageWhenNotAlignedWithScreen",t[t.UseClippingBoundary=4]="UseClippingBoundary",t[t.TransparencyIsOn=8]="TransparencyIsOn"})(Tl||(Tl={})),function(t){t[t.Rectangular=1]="Rectangular",t[t.Polygonal=2]="Polygonal"}(Qr||(Qr={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On"}(mh||(mh={})),function(t){t[t.Outside=0]="Outside",t[t.Inside=1]="Inside"}(_h||(_h={}));class pD extends tt{constructor(e,n){super("IMAGE","AcDbRasterImage",n),$n.set(this,void 0),this.width=e.width,this.height=e.height,this.scale=e.scale,this.rotation=e.rotation,this.insertionPoint=e.insertionPoint,this.ratio=this.scale/this.width,this.imageDefHandle=e.imageDefHandle,this.imageDisplayFlags=(n==null?void 0:n.imageDisplayFlags)||Tl.ShowImage|Tl.ShowImageWhenNotAlignedWithScreen,this.clippingStateFlag=(n==null?void 0:n.clippingStateFlag)||mh.On,this.clipModeFlag=(n==null?void 0:n.clipModeFlag)||_h.Inside,this.clippingType=(n==null?void 0:n.clippingType)||Qr.Rectangular,this.brightness=(n==null?void 0:n.brightness)||50,this.contrast=(n==null?void 0:n.brightness)||50,this.fade=(n==null?void 0:n.fade)||0,kr(this,$n,[]),this.classVersion=(n==null?void 0:n.classVersion)||0,this.resetClipping()}setClipBoundaryVerticies(e,n){if(n===Qr.Rectangular){if(e.length!=2)throw new Error("The number of vertices should be 2 in rectangular clipping !");kr(this,$n,e)}else{if(!(e.length>=3))throw new Error("The number of vertices should be >= 3 in polygonal clipping !");kr(this,$n,e)}kr(this,$n,[]),Fe(this,$n,"f").push(...e)}resetClipping(){const e=[Xe(-.5,-.5),Xe(this.width-.5,this.height-.5)];this.setClipBoundaryVerticies(e,Qr.Rectangular)}_vector(){return Xe(this.ratio*Math.cos(this.rotation*Math.PI/180),this.ratio*Math.sin(this.rotation*Math.PI/180))}_uVector(){const e=this._vector();return B(e.x,-e.y,0)}_vVector(){const e=this._vector();return B(e.y,e.x,0)}boundingBox(){const e=this.scale,n=this.width/this.height*this.scale,s=Math.sqrt(Math.pow(e,2)+Math.pow(n,2));return Ue.centerRadiusBBox(this.insertionPoint,s)}dxfyChild(e){e.push(90,this.classVersion),e.point3d(this.insertionPoint),e.point3d(this._uVector(),1),e.point3d(this._vVector(),2),e.push(13,this.width),e.push(23,this.height),e.push(340,this.imageDefHandle),e.push(70,this.imageDisplayFlags),e.push(280,this.clippingStateFlag),e.push(281,this.brightness),e.push(282,this.contrast),e.push(283,this.fade),e.push(360,this.imageDefReactorHandle),e.push(71,this.clippingType),e.push(91,Fe(this,$n,"f").length),Fe(this,$n,"f").forEach(n=>e.point2d(n,4)),e.push(290,this.clipModeFlag)}}$n=new WeakMap;class gD extends tt{constructor(e,n,s){var i,r,o,a,u,h;super("INSERT","AcDbBlockReference",s),this.blockName=e,this.insertionPoint=n,this.scaleFactor=(s==null?void 0:s.scaleFactor)||B(1,1,1),this.rotationAngle=(i=s==null?void 0:s.rotationAngle)!==null&&i!==void 0?i:0,this.columnCount=(r=s==null?void 0:s.columnCount)!==null&&r!==void 0?r:1,this.rowCount=(o=s==null?void 0:s.rowCount)!==null&&o!==void 0?o:1,this.columnSpacing=(a=s==null?void 0:s.columnSpacing)!==null&&a!==void 0?a:0,this.rowSpacing=(u=s==null?void 0:s.rowSpacing)!==null&&u!==void 0?u:0,this.attributesFollowFlag=(h=s==null?void 0:s.rowSpacing)!==null&&h!==void 0?h:0}boundingBox(){return Ue.pointBBox(this.insertionPoint)}dxfyChild(e){e.name(this.blockName),e.point3d(this.insertionPoint),e.push(41,this.scaleFactor.x),e.push(42,this.scaleFactor.y),e.push(43,this.scaleFactor.z),e.push(50,this.rotationAngle),e.push(66,this.attributesFollowFlag),e.push(70,this.columnCount),e.push(71,this.rowCount),e.push(44,this.columnSpacing),e.push(45,this.rowSpacing)}}(function(t){t[t.Disabed=0]="Disabed",t[t.Enabled=1]="Enabled"})(yh||(yh={})),function(t){t[t.StraightLine=0]="StraightLine",t[t.Spline=1]="Spline"}(vh||(vh={}));class mD extends tt{constructor(e,n){var s,i;super("LEADER","AcDbLeader",n),this.vertices=e,this.flag=(s=n==null?void 0:n.flag)!==null&&s!==void 0?s:yh.Enabled,this.leaderPathType=(i=n==null?void 0:n.leaderPathType)!==null&&i!==void 0?i:vh.StraightLine,this.dimensionStyleName=(n==null?void 0:n.dimensionStyleName)||"Standard"}boundingBox(){return Ue.verticesBBox(this.vertices)}dxfyChild(e){e.push(3,this.dimensionStyleName),e.push(71,this.flag),e.push(72,this.leaderPathType),e.push(76,this.vertices.length),this.vertices.forEach(n=>e.point3d(n))}}class _D extends tt{constructor(e,n,s){super("LINE","AcDbLine",s),this.startPoint=e,this.endPoint=n}boundingBox(){return Ue.lineBBox(this.startPoint,this.endPoint)}dxfyChild(e){e.point3d(this.startPoint),e.point3d(this.endPoint,1)}}(function(t){t[t.None=0]="None",t[t.Closed=1]="Closed",t[t.Plinegen=128]="Plinegen"})(El||(El={}));class yD extends tt{constructor(e,n){super("LWPOLYLINE","AcDbPolyline",n),this.vertices=e,this.flags=(n==null?void 0:n.flags)||El.None,this.constantWidth=(n==null?void 0:n.constantWidth)||0,this.elevation=(n==null?void 0:n.elevation)||0,this.thickness=(n==null?void 0:n.thickness)||0}boundingBox(){return Ue.verticesBBox(this.vertices.map(e=>B(e.point.x,e.point.y,0)))}dxfyChild(e){var n,s,i;e.push(90,this.vertices.length),e.push(70,this.flags||0),this.vertices.find(r=>{var o,a;return((o=r.startingWidth)!==null&&o!==void 0?o:0)>0&&((a=r.endWidth)!==null&&a!==void 0?a:0)>0})||e.push(43,this.constantWidth),e.elevation(this.elevation),e.thickness(this.thickness);for(const r of this.vertices)e.point2d(r.point),e.push(40,r.startingWidth),e.push(41,r.endWidth),e.push(42,r.bulge);e.push(210,(n=this.extrusion)===null||n===void 0?void 0:n.x),e.push(220,(s=this.extrusion)===null||s===void 0?void 0:s.y),e.push(230,(i=this.extrusion)===null||i===void 0?void 0:i.z)}}(function(t){t[t.TopLeft=1]="TopLeft",t[t.TopCenter=2]="TopCenter",t[t.TopRight=3]="TopRight",t[t.MiddleLeft=4]="MiddleLeft",t[t.MiddleCenter=5]="MiddleCenter",t[t.MiddleRight=6]="MiddleRight",t[t.BottomLeft=7]="BottomLeft",t[t.BottomCenter=8]="BottomCenter",t[t.BottomRight=9]="BottomRight"})(gm||(gm={})),function(t){t[t.LeftToRight=1]="LeftToRight",t[t.TopToBottom=3]="TopToBottom",t[t.ByStyle=5]="ByStyle"}(mm||(mm={})),function(t){t[t.AtLeast=1]="AtLeast",t[t.Exact=2]="Exact"}(_m||(_m={}));class vD extends tt{constructor(e,n,s,i){super("MTEXT","AcDbMText",i),this.position=e,this.height=n,this.value=s,this.textStyle="STANDARD",this.rotation=i==null?void 0:i.rotation,this.attachmentPoint=i==null?void 0:i.attachmentPoint,this.drawingDirection=i==null?void 0:i.drawingDirection,this.lineSpacingStyle=i==null?void 0:i.lineSpacingStyle,this.width=i==null?void 0:i.width}boundingBox(){return Ue.pointBBox(this.position)}dxfyChild(e){e.point3d(this.position),e.push(40,this.height),e.push(41,this.width),e.push(71,this.attachmentPoint),e.push(72,this.drawingDirection),e.push(73,this.lineSpacingStyle),e.primaryText(this.value),e.push(50,this.rotation),e.textStyle(this.textStyle)}}class wD extends tt{constructor(e,n,s,i){super("POINT","AcDbPoint",i),this.x=e,this.y=n,this.z=s}boundingBox(){return Ue.pointBBox(B(this.x,this.y,this.z))}dxfyChild(e){e.point3d(B(this.x,this.y,this.z))}}(function(t){t[t.None=0]="None",t[t.ExtraVertex=1]="ExtraVertex",t[t.CurveFit=2]="CurveFit",t[t.NotUsed=4]="NotUsed",t[t.SplineVertex=8]="SplineVertex",t[t.SplineFrame=16]="SplineFrame",t[t.Polyline3dVertex=32]="Polyline3dVertex",t[t.Polygon3dMesh=64]="Polygon3dMesh",t[t.PolyfaceMeshVertex=128]="PolyfaceMeshVertex"})(Al||(Al={}));class TD extends tt{constructor(e,n){var s;super("VERTEX","AcDbVertex",n),this.point=e,this.flags=(s=n==null?void 0:n.flags)!==null&&s!==void 0?s:Al.None,n&&("startingWidth"in n&&(this.startingWidth=n.startingWidth),"endWidth"in n&&(this.endWidth=n.endWidth),"bulge"in n&&(this.bulge=n.bulge))}boundingBox(){return Ue.pointBBox(this.point)}dxfyChild(e){e.subclassMarker("AcDb3dPolylineVertex"),e.point3d(this.point),e.push(40,this.startingWidth),e.push(41,this.endWidth),e.push(42,this.bulge),e.push(70,this.flags)}}class u1 extends tt{dxfyChild(e){}constructor(){super("SEQEND")}}(function(t){t[t.None=0]="None",t[t.Closed=1]="Closed",t[t.CurveFit=2]="CurveFit",t[t.SplineFit=4]="SplineFit",t[t.Polyline3D=8]="Polyline3D",t[t.PolygonMesh3D=16]="PolygonMesh3D",t[t.PolygonMeshClosed=32]="PolygonMeshClosed",t[t.PolyfaceMesh=64]="PolyfaceMesh",t[t.LinetypeGenerated=128]="LinetypeGenerated"})(wh||(wh={})),function(t){t[t.NoSmooth=0]="NoSmooth",t[t.QuadraticBSpline=5]="QuadraticBSpline",t[t.CubicBSpline=6]="CubicBSpline",t[t.Bezier=8]="Bezier"}(Th||(Th={}));class ED extends tt{constructor(e,n){var s,i,r,o,a,u,h,d,p,m;super("POLYLINE","AcDb3dPolyline",n),this._seqend=new u1,this.vertices=[],this.thickness=(s=n==null?void 0:n.thickness)!==null&&s!==void 0?s:0,this.elevation=(i=n==null?void 0:n.elevation)!==null&&i!==void 0?i:0,this.flags=(r=n==null?void 0:n.flags)!==null&&r!==void 0?r:wh.None,this.defaultStartWidth=(o=n==null?void 0:n.defaultStartWidth)!==null&&o!==void 0?o:0,this.defaultEndWidth=(a=n==null?void 0:n.defaultEndWidth)!==null&&a!==void 0?a:0,this.polygonMeshM=(u=n==null?void 0:n.polygonMeshM)!==null&&u!==void 0?u:0,this.polygonMeshN=(h=n==null?void 0:n.polygonMeshN)!==null&&h!==void 0?h:0,this.smoothSurfaceM=(d=n==null?void 0:n.smoothSurfaceM)!==null&&d!==void 0?d:0,this.smoothSurfaceN=(p=n==null?void 0:n.smoothSurfaceN)!==null&&p!==void 0?p:0,this.surfaceType=(m=n==null?void 0:n.surfaceType)!==null&&m!==void 0?m:Th.NoSmooth,e.forEach(y=>this.vertices.push(new TD(y.point,{startingWidth:y.startingWidth,endWidth:y.endWidth,bulge:y.bulge,flags:Al.Polyline3dVertex})))}boundingBox(){return Ue.verticesBBox(this.vertices.map(e=>e.point))}dxfyChild(e){e.push(66,1),e.point3d(B(0,0,this.elevation)),e.push(39,this.thickness),e.push(70,this.flags),e.push(40,this.defaultStartWidth),e.push(41,this.defaultEndWidth),e.push(71,this.polygonMeshM),e.push(72,this.polygonMeshN),e.push(73,this.smoothSurfaceM),e.push(74,this.smoothSurfaceN),e.push(75,this.surfaceType),this.vertices.forEach(n=>n.dxfy(e)),this._seqend.dxfy(e)}}(function(t){t[t.Closed=1]="Closed",t[t.Periodic=2]="Periodic",t[t.Rational=4]="Rational",t[t.Planar=8]="Planar",t[t.Linear=16]="Linear"})(Eh||(Eh={}));class AD extends tt{constructor(e,n){var s,i;super("SPLINE","AcDbSpline",n),this.controlPoints=e.controlPoints,this.degreeCurve=(s=e.degreeCurve)!==null&&s!==void 0?s:3,this.flags=(i=e.flags)!==null&&i!==void 0?i:Eh.Planar,this.knots=e.knots||[],this.weights=e.weights||[],this.fitPoints=e.fitPoints||[];const r=this.controlPoints.length,o=this.degreeCurve,a=o+1,u=this.fitPoints.length;if(r<a)throw new Error(`Number of control points should be >= ${a}.`);if(u!==0&&u<2)throw new Error("Number of fit points should be >= 2.");const h=o+r+1;if(this.knots.length===0){let d=0;for(let p=0;p<h;p++)p<=o||p>=r+1?this.knots.push(d):this.knots.push(++d)}if(this.knots.length!==h)throw new Error(`Number of knots should be ${h}.`)}boundingBox(){return Ue.verticesBBox([...this.controlPoints,...this.fitPoints])}dxfyChild(e){e.push(70,this.flags),e.push(71,this.degreeCurve),e.push(72,this.knots.length),e.push(73,this.controlPoints.length),e.push(74,this.fitPoints.length),e.push(42,"0.0000001"),e.push(43,"0.0000001"),e.push(42,"0.0000000001"),this.knots.forEach(n=>e.push(40,n)),this.weights.forEach(n=>e.push(41,n)),this.controlPoints.forEach(n=>e.point3d(n)),this.fitPoints.forEach(n=>e.point3d(n,1))}}(function(t){t[t.Text=1]="Text",t[t.Block=2]="Block"})(ym||(ym={})),function(t){t[t.False=0]="False",t[t.True=1]="True"}(vm||(vm={})),function(t){t[t.False=0]="False",t[t.True=1]="True"}(wm||(wm={})),function(t){t[t.TopLeft=1]="TopLeft",t[t.TopCenter=2]="TopCenter",t[t.TopRight=3]="TopRight",t[t.MiddleLeft=4]="MiddleLeft",t[t.MiddleCenter=5]="MiddleCenter",t[t.MiddleRight=6]="MiddleRight",t[t.BottomLeft=7]="BottomLeft",t[t.BottomCenter=8]="BottomCenter",t[t.BottomRight=9]="BottomRight"}(Tm||(Tm={}));class xD extends tt{constructor(e,n,s,i,r,o,a){super("ACAD_TABLE","AcDbBlockReference",a),this.blockName=e,this.position=n,this.numberOfRows=s,this.numberOfColumn=i,this.rowsHeight=r,this.columnsHeight=o,this.horizontalDirectionVector=(a==null?void 0:a.horizontalDirectionVector)||B(1),this.cells=a==null?void 0:a.cell}boundingBox(){return Ue.pointBBox(this.position)}dxfyChild(e){var n,s,i,r;e.name(this.blockName),e.point3d(this.position),e.subclassMarker("AcDbTable"),e.point3d(this.horizontalDirectionVector,1),e.push(91,this.numberOfRows),e.push(92,this.numberOfColumn);for(let o=0;o<this.numberOfRows;o++)e.push(141,(s=(n=this.rowsHeight[o])!==null&&n!==void 0?n:this.rowsHeight[0])!==null&&s!==void 0?s:1);for(let o=0;o<this.numberOfColumn;o++)e.push(142,(r=(i=this.columnsHeight[o])!==null&&i!==void 0?i:this.columnsHeight[0])!==null&&r!==void 0?r:1);this.cells.forEach(o=>o.dxfy(e))}}(function(t){t[t.None=0]="None",t[t.Backward=2]="Backward",t[t.UpsideDown=4]="UpsideDown"})(Em||(Em={})),function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right",t[t.Aligned=3]="Aligned",t[t.Middle=4]="Middle",t[t.Fit=5]="Fit"}(Am||(Am={})),function(t){t[t.BaseLine=0]="BaseLine",t[t.Bottom=1]="Bottom",t[t.Middle=2]="Middle",t[t.Top=3]="Top"}(xm||(xm={}));class ID extends tt{constructor(e,n,s,i){super("TEXT","AcDbText",i),this.position=e,this.height=n,this.value=s,this.textStyle="STANDARD",this.rotation=i==null?void 0:i.rotation,this.obliqueAngle=i==null?void 0:i.obliqueAngle,this.generationFlags=i==null?void 0:i.generationFlags,this.horizontalAlignment=i==null?void 0:i.horizontalAlignment,this.verticalAlignment=i==null?void 0:i.verticalAlignment,this.secondAlignmentPoint=i==null?void 0:i.secondAlignmentPoint,this.relativeXScaleFactor=i==null?void 0:i.relativeXScaleFactor}boundingBox(){return Ue.pointBBox(this.position)}dxfyChild(e){e.point3d(this.position),e.push(40,this.height),e.primaryText(this.value),e.push(50,this.rotation),e.push(41,this.relativeXScaleFactor),e.push(51,this.obliqueAngle),e.textStyle(this.textStyle),e.push(71,this.generationFlags),e.push(72,this.horizontalAlignment),e.point3d(this.secondAlignmentPoint,1),e.subclassMarker("AcDbText"),e.push(73,this.verticalAlignment)}}class SD{constructor(e,n,s){this.entities=[],this.handle=Vt.next(),this.objects=e,this.blockRecord=n,this.layerName=s}dxfy(e){for(const n of this.entities)n.dxfy(e)}addHatch(e,n,s){const i=new fD(e,n,s);return this.addEntity(i)}addEntity(e){return e.ownerBlockRecord=this.blockRecord.handle,this.blockRecord.isPaperSpace&&(e.inPaperSpace=!0),e.layerName==null&&(e.layerName=this.layerName),this.entities.push(e),e}addAttrib(e,n,s,i,r,o){r.attributesFollowFlag=1;const a=this.addEntity(new cD(e,n,s,i,o));return this.addEntity(new u1).ownerBlockRecord=r.handle,a}addAttdef(e,n,s,i,r){return this.addEntity(new lD(e,n,s,i,r))}addAlignedDim(e,n,s){return this.addEntity(new tD(e,n,s))}addDiameterDim(e,n,s){return this.addEntity(new iD(e,n,s))}addRadialDim(e,n,s){return this.addEntity(new oD(e,n,s))}addLinearDim(e,n,s){return this.addEntity(new rD(e,n,s))}addAngularLinesDim(e,n,s,i){return this.addEntity(new nD(e,n,s,i))}addAngularPointsDim(e,n,s,i){return this.addEntity(new sD(e,n,s,i))}addLine(e,n,s){return this.addEntity(new _D(e,n,s))}addLeader(e,n){return this.addEntity(new mD(e,n))}addLWPolyline(e,n){return this.addEntity(new yD(e,n))}addRectangle(e,n,s){const i=[],r=e.x,o=e.y,a=n.x,u=n.y;if((s==null?void 0:s.fillet)!==void 0&&(s==null?void 0:s.chamfer)!==void 0)throw new Error("You cannot define both fillet and chamfer!");if((s==null?void 0:s.fillet)!==void 0){const h=s==null?void 0:s.fillet,d=Y3(h);i.push({point:Xe(r,o-h),bulge:d}),i.push({point:Xe(r+h,o)}),i.push({point:Xe(a-h,o),bulge:d}),i.push({point:Xe(a,o-h)}),i.push({point:Xe(a,u+h),bulge:d}),i.push({point:Xe(a-h,u)}),i.push({point:Xe(r+h,u),bulge:d}),i.push({point:Xe(r,u+h)})}else if((s==null?void 0:s.chamfer)!==void 0){const h=s==null?void 0:s.chamfer.first,d=(s==null?void 0:s.chamfer.second)||h;i.push({point:Xe(r,o-h)}),i.push({point:Xe(r+d,o)}),i.push({point:Xe(a-h,o)}),i.push({point:Xe(a,o-d)}),i.push({point:Xe(a,u+h)}),i.push({point:Xe(a-d,u)}),i.push({point:Xe(r+h,u)}),i.push({point:Xe(r,u+d)})}else i.push({point:Xe(r,o)}),i.push({point:Xe(a,o)}),i.push({point:Xe(a,u)}),i.push({point:Xe(r,u)});return this.addLWPolyline(i,Object.assign(Object.assign({},s),{flags:El.Closed}))}addImage(e,n,s,i,r,o,a,u){const h=this.objects.addImageDef(e);h.width=i,h.height=r;const d=new pD({height:r,width:i,scale:o,rotation:a,insertionPoint:s,imageDefHandle:h.handle},u),p=this.objects.addImageDefReactor(d.handle);d.imageDefReactorHandle=p.handle,this.addEntity(d);const m=this.objects.addDictionary();return m.addEntryObject(n,h.handle),h.ownerObjecthandle=m.handle,this.objects.root.addEntryObject("ACAD_IMAGE_DICT",m.handle),h.acadImageDictHandle=m.handle,h.addImageDefReactorHandle(p.handle),d}addPolyline3D(e,n){return this.addEntity(new ED(e,n))}addPoint(e,n,s,i){return this.addEntity(new wD(e,n,s,i))}addCircle(e,n,s){return this.addEntity(new uD(e,n,s))}addArc(e,n,s,i,r){return this.addEntity(new aD(e,n,s,i,r))}addSpline(e,n){return this.addEntity(new AD(e,n))}addEllipse(e,n,s,i,r,o){const a=new hD(e,n,s,i,r,o);return this.addEntity(a),a}add3dFace(e,n,s,i,r){return this.addEntity(new dD(e,n,s,i,r))}addText(e,n,s,i){return this.addEntity(new ID(e,n,s,i))}addMText(e,n,s,i){return this.addEntity(new vD(e,n,s,i))}addInsert(e,n,s){return this.addEntity(new gD(e,n,s||{}))}addTable(e,n,s,i,r,o,a){return this.addEntity(new xD(e,n,s,i,r,o,a))}boundingBox(){const e=[];for(let n=0;n<this.entities.length;n++)e.push(this.entities[n].boundingBox());return Ue.boundingBox(e)}centerView(){return Ue.boundingBoxCenter(this.boundingBox())}viewHeight(){return Ue.boundingBoxHeight(this.boundingBox())}}(function(t){t[t.None=0]="None",t[t.AnonymousBlock=1]="AnonymousBlock",t[t.HasNonConstantAttribute=2]="HasNonConstantAttribute",t[t.XRef=4]="XRef",t[t.XRefOverlay=8]="XRefOverlay",t[t.ExternallyDependent=16]="ExternallyDependent",t[t.ResolvedXRef=32]="ResolvedXRef",t[t.ReferencedXRef=64]="ReferencedXRef"})(Ah||(Ah={}));class bD extends SD{get isPaperSpace(){return this.name.startsWith("*Paper_Space")}get isModelSpace(){return this.name.startsWith("*Model_Space")}get isModelOrPaperSpace(){return this.isModelSpace||this.isPaperSpace}constructor(e,n,s){super(s,n,"0"),this.name=e,this.flags=Ah.None,this.endBlk=new q3,this.ownerObjectHandle=n.handle,this.basePoint=B(0,0,0),this.xrefPathName=""}setLayerName(e){this.layerName=e}dxfy(e){e.type("BLOCK"),e.handle(this.handle),e.push(330,this.ownerObjectHandle),e.subclassMarker("AcDbEntity"),e.layerName(this.layerName),e.subclassMarker("AcDbBlockBegin"),e.name(this.name),e.push(70,this.flags),e.point3d(this.basePoint),e.name(this.name,3),e.push(1,this.xrefPathName),this.isModelSpace||this.name==="*Paper_Space"||super.dxfy(e),this.endBlk.dxfy(e)}}class CD{constructor(e,n){this.blocks=[],this.paperSpaceSeed=0,this.tables=e,this.objects=n,this.modelSpace=this.addBlock("*Model_Space",n,!1),this.paperSpace=this.addBlock("*Paper_Space",n,!1)}addBlock(e,n,s=!0){s&&(e=e.replace(vl,""));const i=this.tables.addBlockRecord(e),r=new bD(e,i,n);return this.blocks.push(r),r}addPaperSpace(){const e="*Paper_Space"+this.paperSpaceSeed++;return this.addBlock(e,this.objects,!1)}dxfy(e){e.start("BLOCKS"),this.blocks.forEach(n=>n.dxfy(e)),e.end()}}class DD{dxfy(e){e.start("CLASSES"),e.end()}}class PD{constructor(e){this.blocks=e,this.modelSpace=e.modelSpace,this.paperSpace=e.paperSpace}setLayerName(e){this.modelSpace.setLayerName(e)}dxfy(e){e.start("ENTITIES"),this.paperSpace.entities.forEach(n=>n.dxfy(e)),this.modelSpace.entities.forEach(n=>n.dxfy(e)),e.end()}}class RD{constructor(e,n){this.values=n,this.name=e}dxfy(e){e.variableName(this.name),Object.entries(this.values).forEach(n=>{const[s,i]=n;e.push(parseInt(s),i)})}}class ND{constructor(){this.variables=[]}setVariable(e,n){const s=this.variables.find(i=>i.name===e);s?s.values=n:this.variables.push(new RD(e,n))}dxfy(e){e.start("HEADER"),this.variables.forEach(n=>n.dxfy(e)),e.end()}}class Ud{constructor(e){this.type=e,this.ownerObjecthandle="0",this.handle=Vt.next()}dxfy(e){e.type(this.type),e.handle(this.handle),e.push(330,this.ownerObjecthandle)}}class Im extends Ud{constructor(){super("DICTIONARY"),this.entries=[],this.duplicateRecordCloningFlag=0}addEntryObject(e,n){this.entries.push({name:e,entryObjectHandle:n})}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbDictionary"),e.push(280,this.hardOwnerFlag),e.push(281,this.duplicateRecordCloningFlag);for(const n of this.entries)e.push(3,n.name),e.push(350,n.entryObjectHandle)}}(function(t){t[t.NoUnits=0]="NoUnits",t[t.Centimeters=2]="Centimeters",t[t.Inch=5]="Inch"})(xh||(xh={}));class MD extends Ud{constructor(e){super("IMAGEDEF"),this.path=e,this.acadImageDictHandle="",this.imageReactorHandles=[],this.width=1,this.height=1,this.widthPixelSize=1,this.heightPixelSize=1,this.loaded=!0,this.resolutionUnits=xh.NoUnits}addImageDefReactorHandle(e){this.imageReactorHandles.push(e)}dxfy(e){super.dxfy(e);const n=new Q3("ACAD_REACTORS");n.add(330,this.acadImageDictHandle);for(const s of this.imageReactorHandles)n.add(330,s);n.dxfy(e),e.subclassMarker("AcDbRasterImageDef"),e.push(1,this.path),e.point2d(Xe(this.width,this.height)),e.push(11,this.widthPixelSize),e.push(21,this.heightPixelSize),e.push(280,Number(this.loaded)),e.push(281,this.resolutionUnits)}}class jD extends Ud{constructor(e){super("IMAGEDEF_REACTOR"),this.imageHandle=e,this.classVersion=2}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbRasterImageDefReactor"),e.push(90,this.classVersion),e.push(330,this.imageHandle)}}class LD{constructor(){this.root=new Im,this.objects=[],this.root.duplicateRecordCloningFlag=1;const e=this.addDictionary();this.root.addEntryObject("ACAD_GROUP",e.handle)}addObject(e){return this.objects.push(e),e}addImageDef(e){return this.addObject(new MD(e))}addImageDefReactor(e){return this.addObject(new jD(e))}addDictionary(){const e=new Im;return e.ownerObjecthandle=this.root.handle,this.addObject(e),e}addEntryToRoot(e,n){this.root.addEntryObject(e,n)}dxfy(e){e.start("OBJECTS"),this.root.dxfy(e);for(const n of this.objects)n.dxfy(e);e.end(),e.type("EOF")}}class as{constructor(e){this.name=e,this.maxNumberEntries=0,this.ownerObjectHandle="0",this.handle=Vt.next(),this.records=[]}dxfy(e){e.type("TABLE"),e.name(this.name),e.handle(this.handle),e.push(330,this.ownerObjectHandle),e.subclassMarker("AcDbSymbolTable"),e.push(70,this.records.length);for(const n of this.records)n.dxfy(e);e.type("ENDTAB")}}(function(t){t[t.None=0]="None",t[t.XRefDependent=16]="XRefDependent",t[t.XRefResolved=32]="XRefResolved"})(xl||(xl={}));class kD extends Bs{constructor(e,n){super("APPID"),this.name=e,this.flags=n??xl.None}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbRegAppTableRecord"),e.name(this.name),e.push(70,this.flags)}}class FD extends Bs{get isPaperSpace(){return this.name.startsWith("*Paper_Space")}constructor(e){super("BLOCK_RECORD"),this.name=e,this.insertionUnits=0,this.explodability=1,this.scalability=0}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbBlockTableRecord"),e.name(this.name),e.push(340,this.layoutObject),e.push(70,this.insertionUnits),e.push(280,this.explodability),e.push(281,this.scalability)}}(function(t){t[t.None=0]="None",t[t.XRefDependent=16]="XRefDependent",t[t.XRefRefesolved=32]="XRefRefesolved"})(Ih||(Ih={}));class OD{constructor(e,n){this.name=e,this.flags=n??Ih.None,this.handle=Vt.next(),this.type="DIMSTYLE"}dxfy(e){e.type(this.type),e.push(105,this.handle),e.push(330,this.ownerObjectHandle),e.subclassMarker("AcDbSymbolTableRecord"),e.subclassMarker("AcDbDimStyleTableRecord"),e.name(this.name),e.push(70,this.flags),e.push(3,this.DIMPOST),e.push(4,this.DIMAPOST),e.push(5,this.DIMBLK),e.push(6,this.DIMBLK1),e.push(7,this.DIMBLK2),e.push(40,this.DIMSCALE),e.push(41,this.DIMASZ),e.push(42,this.DIMEXO),e.push(43,this.DIMDLI),e.push(44,this.DIMEXE),e.push(45,this.DIMRND),e.push(46,this.DIMDLE),e.push(47,this.DIMTP),e.push(48,this.DIMTM),e.push(140,this.DIMTXT),e.push(141,this.DIMCEN),e.push(142,this.DIMTSZ),e.push(143,this.DIMALTF),e.push(144,this.DIMLFAC),e.push(145,this.DIMTVP),e.push(146,this.DIMTFAC),e.push(147,this.DIMGAP),e.push(148,this.DIMALTRND),e.push(71,this.DIMTOL),e.push(72,this.DIMLIM),e.push(73,this.DIMTIH),e.push(74,this.DIMTOH),e.push(75,this.DIMSE1),e.push(76,this.DIMSE2),e.push(77,this.DIMTAD),e.push(78,this.DIMZIN),e.push(79,this.DIMAZIN),e.push(170,this.DIMALT),e.push(171,this.DIMALTD),e.push(172,this.DIMTOFL),e.push(173,this.DIMSAH),e.push(174,this.DIMTIX),e.push(175,this.DIMSOXD),e.push(176,this.DIMCLRD),e.push(177,this.DIMCLRE),e.push(178,this.DIMCLRT),e.push(179,this.DIMADEC),e.push(271,this.DIMDEC),e.push(272,this.DIMTDEC),e.push(273,this.DIMALTU),e.push(274,this.DIMALTTD),e.push(275,this.DIMAUNIT),e.push(276,this.DIMFRAC),e.push(277,this.DIMLUNIT),e.push(278,this.DIMDSEP),e.push(279,this.DIMTMOVE),e.push(280,this.DIMJUST),e.push(281,this.DIMSD1),e.push(282,this.DIMSD2),e.push(283,this.DIMTOLJ),e.push(284,this.DIMTZIN),e.push(285,this.DIMALTZ),e.push(286,this.DIMALTTZ),e.push(287,this.DIMFIT),e.push(288,this.DIMUPT),e.push(289,this.DIMATFIT),e.push(340,this.DIMTXSTY),e.push(341,this.DIMLDRBLK),e.push(342,this.DIMBLK),e.push(343,this.DIMBLK1),e.push(344,this.DIMBLK2),e.push(371,this.DIMLWD),e.push(372,this.DIMLWE)}}class VD extends Bs{constructor(e,n,s,i){super("LTYPE"),this.name=e,this.descriptive=n,this.elements=s,this.flags=i??0}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbLinetypeTableRecord"),e.name(this.name),e.push(70,this.flags),e.push(3,this.descriptive),e.push(72,65),e.push(73,this.elements.length);let n=0;for(const s of this.elements)n+=Math.abs(s);e.push(40,n);for(const s of this.elements)e.push(49,s),e.push(74,0)}}class BD extends Bs{constructor(e,n){super("STYLE"),this.fixedTextHeight=0,this.widthFactor=1,this.obliqueAngle=0,this.textGenerationFlag=0,this.lastHeightUsed=1,this.fontFileName="txt",this.bigFontFileName="",this.name=e,this.flags=n??lh.None}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbTextStyleTableRecord"),e.name(this.name),e.push(70,this.flags),e.push(40,this.fixedTextHeight),e.push(41,this.widthFactor),e.push(50,this.obliqueAngle),e.push(71,this.textGenerationFlag),e.push(42,this.lastHeightUsed),e.push(3,this.fontFileName),e.push(4,this.bigFontFileName)}}class UD extends Bs{constructor(e){super("UCS"),this.name=e}dxfy(e){super.dxfy(e)}}class $D extends Bs{constructor(e){super("VPORT"),this.name=e,this.viewHeight=200,this.viewCenter=[0,0]}dxfy(e){super.dxfy(e);const[n,s]=this.viewCenter;e.subclassMarker("AcDbViewportTableRecord"),e.name(this.name),e.push(70,0),e.point2d({x:0,y:0}),e.push(11,1),e.push(21,1),e.push(12,n),e.push(22,s),e.push(13,0),e.push(23,0),e.push(14,10),e.push(24,10),e.push(15,10),e.push(25,10),e.push(16,0),e.push(26,0),e.push(36,1),e.push(17,0),e.push(27,0),e.push(37,0),e.push(40,this.viewHeight||200),e.push(41,2),e.push(42,50),e.push(43,0),e.push(44,0),e.push(50,0),e.push(51,0),e.push(71,0),e.push(72,100),e.push(73,1),e.push(74,3),e.push(75,0),e.push(76,1),e.push(77,0),e.push(78,0),e.push(281,0),e.push(65,1),e.push(110,0),e.push(120,0),e.push(130,0),e.push(111,1),e.push(121,0),e.push(131,0),e.push(112,0),e.push(122,1),e.push(132,0),e.push(79,0),e.push(146,0),e.push(348,10020),e.push(60,7),e.push(61,5),e.push(292,1),e.push(282,1),e.push(141,0),e.push(142,0),e.push(63,250),e.push(421,3358443)}}class HD extends Bs{constructor(e){var n;super("VIEW"),this.name=e.name,this.flags=(n=e.flags)!==null&&n!==void 0?n:ch.None,this.viewHeight=e.viewHeight,this.viewCenter=e.viewCenter,this.viewWidth=e.viewWidth,this.viewDirection=e.viewDirection,this.targetPoint=e.targetPoint,this.lensLength=e.lensLength,this.frontClipping=e.frontClipping,this.backClipping=e.backClipping,this.twistAngle=e.twistAngle,this.viewMode=e.viewMode,this.renderMode=e.renderMode,this.isUCSAssociated=e.isUCSAssociated,this.isCameraPlottable=e.isCameraPlottable||!1,e.backgroundObjectHandle&&(this.backgroundObjectHandle=e.backgroundObjectHandle),e.liveSectionObjectHandle&&(this.liveSectionObjectHandle=e.liveSectionObjectHandle),e.visualStyleObjectHandle&&(this.visualStyleObjectHandle=e.visualStyleObjectHandle)}dxfy(e){super.dxfy(e),e.subclassMarker("AcDbViewTableRecord"),e.name(this.name),e.push(70,this.flags),e.push(40,this.viewHeight),e.point2d(this.viewCenter),e.push(41,this.viewWidth),e.push(11,this.viewDirection.x),e.push(21,this.viewDirection.y),e.push(31,this.viewDirection.z),e.push(12,this.targetPoint.x),e.push(22,this.targetPoint.y),e.push(32,this.targetPoint.z),e.push(42,this.lensLength),e.push(43,this.frontClipping),e.push(44,this.backClipping),e.push(50,this.twistAngle),e.push(71,this.viewMode),e.push(281,this.renderMode),e.push(72,this.isUCSAssociated?1:0),e.push(73,this.isCameraPlottable?1:void 0),e.push(332,this.backgroundObjectHandle),e.push(334,this.liveSectionObjectHandle),e.push(348,this.visualStyleObjectHandle)}}class WD extends as{constructor(){super("APPID")}addAppId(e,n){const s=new kD(e,n);return s.ownerObjectHandle=this.handle,this.records.push(s),s}}class XD extends as{constructor(){super("BLOCK_RECORD")}addBlockRecord(e){const n=new FD(e);return n.ownerObjectHandle=this.handle,this.records.push(n),n}}class GD extends as{constructor(){super("DIMSTYLE"),this.ownerObjectHandle="0"}addDimStyle(e,n){const s=new OD(e,n);return s.ownerObjectHandle=this.handle,this.records.push(s),s}dxfy(e){e.type("TABLE"),e.name(this.name),e.handle(this.handle),e.push(330,this.ownerObjectHandle),e.subclassMarker("AcDbSymbolTable"),e.push(70,this.records.length),e.subclassMarker("AcDbDimStyleTable");for(const n of this.records)n.dxfy(e);e.type("ENDTAB")}}class zD extends as{constructor(){super("LTYPE")}exist(e){return this.records.find(n=>n.name===e)!==void 0}ltype(e){return this.records.find(n=>n.name===e)}addLType(e,n,s,i){const r=this.ltype(e);if(r)return r;const o=new VD(e,n,s,i);return o.ownerObjectHandle=this.handle,this.records.push(o),o}}class YD extends as{constructor(e){super("LAYER"),this.lTypeTable=e}addLayer(e,n,s,i){e=e.replace(vl,"");const r=this.layer(e);if(r)return r;this.lTypeTable.exist(s)||(s=_l.Continuous);const o=new Mi(e,n,s,i);return o.ownerObjectHandle=this.handle,this.records.push(o),o}layer(e){return e=e.replace(vl,""),this.records.find(n=>n.name===e)}exist(e){return this.records.find(n=>n.name===e)!==void 0}}class qD extends as{constructor(){super("STYLE")}addStyle(e,n){const s=new BD(e,n);return s.ownerObjectHandle=this.handle,this.records.push(s),s}}class KD extends as{constructor(){super("UCS")}addUcs(e){const n=new UD(e);return n.ownerObjectHandle=this.handle,this.records.push(n),n}}class QD extends as{constructor(){super("VPORT")}addViewPort(e){const n=new $D(e);return n.ownerObjectHandle=this.handle,this.records.push(n),n}}class JD extends as{constructor(){super("VIEW")}addView(e){const n=new HD(e);return n.ownerObjectHandle=this.handle,this.records.push(n),n}}class ZD{constructor(){this.vPortTable=new QD,this.ltypeTable=new zD,this.layerTable=new YD(this.ltypeTable),this.styleTable=new qD,this.viewTable=new JD,this.ucsTable=new KD,this.appIdTable=new WD,this.dimStyleTable=new GD,this.blockRecordTable=new XD}layer(e){return this.layerTable.layer(e)}addLType(e,n,s,i){return this.ltypeTable.addLType(e,n,s,i)}addBlockRecord(e){return this.blockRecordTable.addBlockRecord(e)}addLayer(e,n,s,i){return this.layerTable.addLayer(e,n,s,i)}addStyle(e){return this.styleTable.addStyle(e)}addView(e){return this.viewTable.addView(e)}addUcs(e){return this.ucsTable.addUcs(e)}addAppId(e,n){return this.appIdTable.addAppId(e,n)}addDimStyle(e,n){return this.dimStyleTable.addDimStyle(e,n)}addVPort(e){return this.vPortTable.addViewPort(e)}dxfy(e){e.start("TABLES"),this.vPortTable.dxfy(e),this.ltypeTable.dxfy(e),this.layerTable.dxfy(e),this.styleTable.dxfy(e),this.viewTable.dxfy(e),this.ucsTable.dxfy(e),this.appIdTable.dxfy(e),this.dimStyleTable.dxfy(e),this.blockRecordTable.dxfy(e),e.end()}}class eP{constructor(){Vt.clear(),this.header=new ND,this.classes=new DD,this.tables=new ZD,this.objects=new LD,this.blocks=new CD(this.tables,this.objects),this.entities=new PD(this.blocks),this.currentLayerName=Mi.layerZeroName,this.currentUnits=ml.Unitless,this.header.setVariable("$ACADVER",{1:"AC1021"}),this.header.setVariable("$LASTSAVEDBY",{1:"@tarikjabiri/dxf"}),this._handseed(),this.setUnits(ml.Unitless),this.tables.addLType("ByBlock","",[]),this.tables.addLType("ByLayer","",[]);const e=this.tables.addLType("Continuous","Solid line",[]);this.tables.addLayer(Mi.layerZeroName,uh.White,e.name),this.styleStandard=this.tables.addStyle("Standard"),this.tables.addAppId("ACAD",xl.None),this.dimStyleStandard=this.tables.addDimStyle("Standard"),this.dimStyleStandard.DIMTXSTY=this.styleStandard.handle,this.activeVPort=this.tables.addVPort("*Active"),this.modelSpace=this.blocks.modelSpace,this.paperSpace=this.blocks.paperSpace,this.setZeroLayerAsCurrent()}dxfy(e){this.header.dxfy(e),this.classes.dxfy(e),this.tables.dxfy(e),this.blocks.dxfy(e),this.entities.dxfy(e),this.objects.dxfy(e)}addBlock(e){return this.blocks.addBlock(e,this.objects)}setZeroLayerAsCurrent(){this.setCurrentLayerName(Mi.layerZeroName)}setCurrentLayerName(e){this.currentLayerName=e.replace(vl,""),this.entities.setLayerName(this.currentLayerName),this.setCLayerVariable()}_handseed(){this.header.setVariable("$HANDSEED",{5:Vt.peek()})}setUnits(e){this.currentUnits=e,this.header.setVariable("$INSUNITS",{70:this.currentUnits})}setCLayerVariable(){this.header.setVariable("$CLAYER",{8:this.currentLayerName})}setViewCenter(e){this.header.setVariable("$VIEWCTR",{10:e.x,20:e.y}),this.activeVPort.viewCenter=[e.x,e.y]}stringify(){const e=new J3;return this._handseed(),this.setViewCenter(this.modelSpace.centerView()),this.activeVPort.viewHeight=this.modelSpace.viewHeight(),this.dxfy(e),e.stringify()}}class tP{get header(){return this.document.header}get tables(){return this.document.tables}get blocks(){return this.document.blocks}get entities(){return this.document.entities}get currentLayer(){return this.document.currentLayerName}get units(){return this.document.currentUnits}get modelSpace(){return this.document.modelSpace}constructor(){this.document=new eP}layer(e){return this.tables.layer(e)}setZeroLayerAsCurrent(){this.document.setZeroLayerAsCurrent()}addBlock(e){return this.blocks.addBlock(e,this.document.objects)}addPaperSpace(){return this.blocks.addPaperSpace()}setVariable(e,n){this.header.setVariable(e,n)}addLType(e,n,s){return this.tables.addLType(e,n,s)}addDimStyle(e){return this.tables.addDimStyle(e)}addAlignedDim(e,n,s){return this.modelSpace.addAlignedDim(e,n,s)}addDiameterDim(e,n,s){return this.modelSpace.addDiameterDim(e,n,s)}addRadialDim(e,n,s){return this.modelSpace.addRadialDim(e,n,s)}addLinearDim(e,n,s){return this.modelSpace.addLinearDim(e,n,s)}addAngularLinesDim(e,n,s,i){return this.modelSpace.addAngularLinesDim(e,n,s,i)}addHatch(e,n,s){return this.modelSpace.addHatch(e,n,s)}addLayer(e,n,s,i=gl.None){return s||(s=_l.Continuous),this.tables.addLayer(e,n,s,i)}setCurrentLayerName(e){this.document.setCurrentLayerName(e)}setUnits(e){this.document.setUnits(e)}addLine(e,n,s){return this.modelSpace.addLine(e,n,s)}addLeader(e,n){return this.modelSpace.addLeader(e,n)}addLWPolyline(e,n){return this.modelSpace.addLWPolyline(e,n)}addRectangle(e,n,s){return this.modelSpace.addRectangle(e,n,s)}addPolyline3D(e,n){return this.modelSpace.addPolyline3D(e,n)}addPoint(e,n,s,i){return this.modelSpace.addPoint(e,n,s,i)}addCircle(e,n,s){return this.modelSpace.addCircle(e,n,s)}addArc(e,n,s,i,r){return this.modelSpace.addArc(e,n,s,i,r)}addSpline(e,n){return this.modelSpace.addSpline(e,n)}addEllipse(e,n,s,i,r,o){return this.modelSpace.addEllipse(e,n,s,i,r,o)}addImage(e,n,s,i,r,o,a,u){return this.modelSpace.addImage(e,n,s,i,r,o,a,u)}add3dFace(e,n,s,i,r){return this.modelSpace.add3dFace(e,n,s,i,r)}addText(e,n,s,i){return this.modelSpace.addText(e,n,s,i)}addAttdef(e,n,s,i,r){return this.modelSpace.addAttdef(e,n,s,i,r)}addAttrib(e,n,s,i,r,o){return this.modelSpace.addAttrib(e,n,s,i,r,o)}addMText(e,n,s,i){return this.modelSpace.addMText(e,n,s,i)}addInsert(e,n,s){return this.modelSpace.addInsert(e,n,s)}addTable(e,n,s,i,r,o,a){return this.modelSpace.addTable(e,n,s,i,r,o,a)}stringify(){return this.document.stringify()}}const nP=t=>{const{spaceInfo:e,placedModules:n,drawingType:s="front"}=t,i=er.getState();(!i.isCalculated||!i.lastCalculatedSpaceInfo||JSON.stringify(i.lastCalculatedSpaceInfo)!==JSON.stringify(e))&&i.recalculateFromSpaceInfo(e);const r=new tP;switch(s){case"front":Sm(r,e,n);break;case"plan":sP(r,e,n);break;case"side":iP(r,e,n);break;default:Sm(r,e,n);break}return hP(r,e,s),r.stringify()},Sm=(t,e,n)=>{rP(t,e),lP(t,n,e)},sP=(t,e,n)=>{oP(t,e),cP(t,n,e)},iP=(t,e,n)=>{aP(t,e),uP(t,n,e)},rP=(t,e)=>{t.addLine(B(0,0),B(e.width,0)),t.addLine(B(e.width,0),B(e.width,e.height)),t.addLine(B(e.width,e.height),B(0,e.height)),t.addLine(B(0,e.height),B(0,0)),t.addText(B(e.width/2,e.height+200),100,`정면도: ${e.width}mm(폭) × ${e.height}mm(높이)`),t.addText(B(e.width/2,e.height+300),60,`공간 깊이: ${e.depth}mm`)},oP=(t,e)=>{t.addLine(B(0,0),B(e.width,0)),t.addLine(B(e.width,0),B(e.width,e.depth)),t.addLine(B(e.width,e.depth),B(0,e.depth)),t.addLine(B(0,e.depth),B(0,0)),t.addText(B(e.width/2,e.depth+200),100,`평면도: ${e.width}mm(폭) × ${e.depth}mm(깊이)`),t.addText(B(e.width/2,e.depth+300),60,`공간 높이: ${e.height}mm`)},aP=(t,e)=>{t.addLine(B(0,0),B(e.depth,0)),t.addLine(B(e.depth,0),B(e.depth,e.height)),t.addLine(B(e.depth,e.height),B(0,e.height)),t.addLine(B(0,e.height),B(0,0)),t.addText(B(e.depth/2,e.height+200),100,`측면도: ${e.depth}mm(깊이) × ${e.height}mm(높이)`),t.addText(B(e.depth/2,e.height+300),60,`공간 폭: ${e.width}mm`)},lP=(t,e,n)=>{const s=er.getState(),i=pt(n),r={columnCount:s.columnCount,columnWidth:s.columnWidth,columnPositions:s.columnPositions,threeUnitPositions:s.threeUnitPositions,dualColumnPositions:s.dualColumnPositions,internalStartX:(n.width-s.internalWidth)/2,internalWidth:s.internalWidth,threeUnitDualPositions:s.dualColumnPositions.map(o=>o/10)};console.log("🔍 DXF 생성 - 슬롯 인덱싱 정보:",{columnCount:r.columnCount,columnPositions:r.columnPositions,threeUnitPositions:r.threeUnitPositions,dualPositions:r.dualColumnPositions,threeUnitDualPositions:r.threeUnitDualPositions,internalStartX:r.internalStartX,internalWidth:r.internalWidth}),e.forEach((o,a)=>{const{position:u,moduleData:h,moduleId:d}=o,p=ut(d,i,n),m=h.dimensions,y=Math.abs(m.width-r.columnWidth*2)<50;let v=-1,w=0;y&&r.threeUnitDualPositions?(v=r.threeUnitDualPositions.findIndex(P=>Math.abs(P-u.x)<.1),v>=0&&(w=r.dualColumnPositions[v])):(v=r.threeUnitPositions.findIndex(P=>Math.abs(P-u.x)<.1),v>=0&&(w=r.columnPositions[v])),v<0&&(console.warn(`⚠️ 가구 ${a+1}의 슬롯을 찾을 수 없음. 기존 방식 사용.`),w=u.x*10);const E=n.width/2+w;console.log(`🔍 가구 ${a+1} (${h.name}) 좌표 변환:`,{originalThreeJsX:u.x,slotIndex:v,isDualFurniture:y,slotPositionMm:w,dxfXPosition:E,spaceWidth:n.width,dimensions:m});const C=E-m.width/2,A=u.y*10,R=C+m.width,N=A+m.height;console.log("📐 DXF 좌표 최종 계산:",{slotIndex:v,slotPositionMm:w,dxfXPosition:E,x1:C,y1:A,x2:R,y2:N,width:m.width,height:m.height}),t.addLine(B(C,A),B(R,A)),t.addLine(B(R,A),B(R,N)),t.addLine(B(R,N),B(C,N)),t.addLine(B(C,N),B(C,A));const k=m.height,j=m.width,I=p==null?void 0:p.modelConfig,T=(I==null?void 0:I.shelfCount)||0;if(console.log(`🏗️ 가구 ${a+1} 내부 구조:`,{moduleId:d,shelfCount:T,modelConfig:I,furnitureWidth:j,furnitureHeight:k}),k>200&&j>200)if(T>0)if(y){const P=C+j/2;t.addLine(B(P,A),B(P,N));const x=Math.floor(T/2);if(x>0){for(let V=1;V<=x;V++){const Y=A+k/(x+1)*V;t.addLine(B(C,Y),B(P,Y))}for(let V=1;V<=x;V++){const Y=A+k/(x+1)*V;t.addLine(B(P,Y),B(R,Y))}}}else for(let P=1;P<=T;P++){const x=A+k/(T+1)*P;t.addLine(B(C,x),B(R,x))}else console.log("📦 오픈 박스 가구 - 내부 구조 없음");const _=C+m.width/2,S=A+m.height/2;t.addText(B(_,S),Math.min(m.height/4,50),h.name||`가구${a+1}`);const D=T===0?"오픈박스":T===1?"2단":T===6?"7단":T===2?"듀얼2단":T===12?"듀얼7단":`${T}선반`;if(t.addText(B(_,A-120),20,`슬롯${v+1} | ${D}`),t.addText(B(_,A-160),15,`DXF-X: ${Math.round(E)}mm`),console.log(`🔍 정면도 가구 ${a+1} (${h.name}) 치수:`,{moduleId:d,moduleDataDepth:h.dimensions.depth,actualModuleDataDepth:p==null?void 0:p.dimensions.depth,finalDepth:m.depth,width:m.width,height:m.height}),t.addText(B(_,A-80),25,`${m.width}W×${m.height}H×${m.depth}D`),m.height>100){const P=R+50;t.addLine(B(P,A),B(P,N)),t.addLine(B(P-20,A),B(P+20,A)),t.addLine(B(P-20,N),B(P+20,N)),t.addText(B(P+30,S),20,`${m.height}mm`)}})},cP=(t,e,n)=>{const s=er.getState(),i=pt(n),r={columnCount:s.columnCount,columnWidth:s.columnWidth,columnPositions:s.columnPositions,threeUnitPositions:s.threeUnitPositions,dualColumnPositions:s.dualColumnPositions,internalStartX:(n.width-s.internalWidth)/2,internalWidth:s.internalWidth,threeUnitDualPositions:s.dualColumnPositions.map(o=>o/10)};console.log("🔍 DXF 평면도 생성 - 슬롯 인덱싱 정보:",{columnCount:r.columnCount,columnPositions:r.columnPositions,threeUnitPositions:r.threeUnitPositions,dualPositions:r.dualColumnPositions,threeUnitDualPositions:r.threeUnitDualPositions,internalStartX:r.internalStartX,internalWidth:r.internalWidth}),e.forEach((o,a)=>{const{position:u,moduleData:h,moduleId:d}=o,p=ut(d,i,n),m=h.dimensions,y=Math.abs(m.width-r.columnWidth*2)<50;let v=-1,w=0;y&&r.threeUnitDualPositions?(v=r.threeUnitDualPositions.findIndex(V=>Math.abs(V-u.x)<.1),v>=0&&(w=r.dualColumnPositions[v])):(v=r.threeUnitPositions.findIndex(V=>Math.abs(V-u.x)<.1),v>=0&&(w=r.columnPositions[v])),v<0&&(console.warn(`⚠️ 가구 ${a+1}의 슬롯을 찾을 수 없음. 기존 방식 사용.`),w=u.x*10);const E=n.width/2+w,C=20,A=C;console.log(`🔍 평면도 가구 ${a+1} (${h.name}) 좌표 변환:`,{originalThreeJsX:u.x,originalThreeJsZ:u.z,slotIndex:v,isDualFurniture:y,slotPositionMm:w,dxfXPosition:E,frontPositionMm:C,dxfYPosition:A,spaceWidth:n.width,spaceDepth:n.depth,dimensions:m});const R=E-m.width/2,N=A,k=R+m.width,j=N+m.depth;console.log("📐 평면도 DXF 좌표 최종 계산:",{slotIndex:v,slotPositionMm:w,dxfXPosition:E,dxfYPosition:A,x1:R,y1:N,x2:k,y2:j,width:m.width,depth:m.depth}),t.addLine(B(R,N),B(k,N)),t.addLine(B(k,N),B(k,j)),t.addLine(B(k,j),B(R,j)),t.addLine(B(R,j),B(R,N));const I=m.width,T=m.depth,_=p==null?void 0:p.modelConfig,S=(_==null?void 0:_.shelfCount)||0;if(console.log(`🏗️ 평면도 가구 ${a+1} 내부 구조:`,{moduleId:d,shelfCount:S,modelConfig:_,furnitureWidth:I,furnitureDepth:T}),I>200&&T>200&&y){const V=R+I/2;t.addLine(B(V,N),B(V,j))}const D=R+m.width/2,P=N+m.depth/2;t.addText(B(D,P),Math.min(m.width/4,m.depth/4,50),h.name||`가구${a+1}`);const x=S===0?"오픈박스":S===1?"2단":S===6?"7단":S===2?"듀얼2단":S===12?"듀얼7단":`${S}선반`;t.addText(B(D,N-80),15,`슬롯${v+1} | ${x}`),console.log(`🔍 평면도 가구 ${a+1} (${h.name}) 치수:`,{moduleId:d,moduleDataDepth:h.dimensions.depth,actualModuleDataDepth:p==null?void 0:p.dimensions.depth,finalDepth:m.depth,width:m.width,height:m.height}),t.addText(B(D,N-50),20,`${m.width}W×${m.depth}D×${m.height}H`)})},uP=(t,e,n)=>{const s=pt(n);console.log("🔍 DXF 측면도 생성 - 가구 배치 정보:",{totalModules:e.length,spaceDepth:n.depth,spaceHeight:n.height}),e.forEach((i,r)=>{const{moduleData:o,moduleId:a}=i,u=ut(a,s,n),h=o.dimensions,d=h.depth;console.log(`🔍 측면도 가구 ${r+1} (${o.name}) 치수:`,{moduleId:a,moduleDataDepth:o.dimensions.depth,actualModuleDataDepth:u==null?void 0:u.dimensions.depth,finalDepth:d,height:h.height});const p=20,m=p+d,y=p+d/2,v=0,w=h.height,E=w/2;console.log("📐 측면도 DXF 좌표 계산:",{frontPositionMm:p,backPositionMm:m,furnitureCenterX:y,furnitureBottomY:v,furnitureTopY:w,furnitureCenterY:E,actualDepthMm:d,height:h.height});const C=p,A=v,R=m,N=w;t.addLine(B(C,A),B(R,A)),t.addLine(B(R,A),B(R,N)),t.addLine(B(R,N),B(C,N)),t.addLine(B(C,N),B(C,A));const k=u==null?void 0:u.modelConfig,j=(k==null?void 0:k.shelfCount)||0;if(console.log(`🏗️ 측면도 가구 ${r+1} 내부 구조:`,{moduleId:a,shelfCount:j,modelConfig:k,actualDepthMm:d,height:h.height}),h.height>200&&d>200&&j>0)for(let S=1;S<=j;S++){const D=A+h.height/(j+1)*S;t.addLine(B(C,D),B(R,D))}const I=y,T=E;t.addText(B(I,T),Math.min(d/4,h.height/4,50),o.name||`가구${r+1}`);const _=j===0?"오픈박스":j===1?"2단":j===6?"7단":j===2?"듀얼2단":j===12?"듀얼7단":`${j}선반`;if(t.addText(B(I,A-80),15,`${_} | ${r+1}번째`),t.addText(B(I,A-50),20,`${h.width}W×${d}D×${h.height}H`),d>100){const S=A-120;t.addLine(B(C,S),B(R,S)),t.addLine(B(C,S-10),B(C,S+10)),t.addLine(B(R,S-10),B(R,S+10)),t.addText(B(I,S-30),15,`${d}mm`)}})},hP=(t,e,n="front")=>{const s=e.width+500,i=n==="plan"?e.depth:e.height,r={front:{ko:"정면도",en:"Front Elevation"},plan:{ko:"평면도",en:"Plan View"},side:{ko:"측면도",en:"Side Section"}},o=r[n]||r.front;t.addText(B(s,i-100),80,`가구 배치 ${o.ko}`);const a=new Date().toLocaleDateString("ko-KR");t.addText(B(s,i-200),40,`작성일: ${a}`),t.addText(B(s,i-280),40,`도면: ${o.ko} (${o.en})`),t.addText(B(s,i-360),40,"축척: 1:100"),t.addText(B(s,i-440),40,"단위: mm"),n==="plan"?(t.addText(B(e.width/2,-200),60,`폭: ${e.width}mm × 깊이: ${e.depth}mm`),t.addText(B(e.width/2,-280),50,`공간 높이: ${e.height}mm`)):(t.addText(B(e.width/2,-200),60,`폭: ${e.width}mm × 높이: ${e.height}mm`),t.addText(B(e.width/2,-280),50,`공간 깊이: ${e.depth}mm`))},dP=(t,e)=>{try{const n=new Blob([t],{type:"application/dxf"}),s=URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s),console.log(`✅ DXF 파일 다운로드 완료: ${e}`)}catch(n){throw console.error("❌ DXF 파일 다운로드 실패:",n),new Error("DXF 파일 다운로드에 실패했습니다.")}},fP=(t,e="front")=>{const n=new Date().toISOString().slice(0,19).replace(/[:-]/g,""),s=`${t.width}W-${t.height}H-${t.depth}D`;return`furniture-${{front:"elevation",plan:"plan",side:"section"}[e]||"elevation"}-${s}-${n}.dxf`},pP=()=>{const t=M.useCallback(async(s,i,r="front")=>{try{console.log(`🔧 DXF ${r} 도면 내보내기 시작...`),console.log("📊 입력 데이터:",{spaceInfo:{width:s.width,height:s.height,depth:s.depth,surroundType:s.surroundType,customColumnCount:s.customColumnCount},placedModulesCount:i.length,drawingType:r,placedModules:i.map(p=>({id:p.id,moduleId:p.moduleId,position:p.position,slotIndex:p.slotIndex,isDualSlot:p.isDualSlot,customDepth:p.customDepth}))});const o=pt(s),a={spaceInfo:s,drawingType:r,placedModules:i.map(p=>{const m=ut(p.moduleId,o,s);return console.log(`🔍 가구 ${p.id} customDepth 확인:`,{moduleId:p.moduleId,customDepth:p.customDepth,originalDepth:m==null?void 0:m.dimensions.depth}),{id:p.id,moduleId:p.moduleId,position:{x:p.position.x,y:p.position.y,z:p.position.z},moduleData:{name:(m==null?void 0:m.name)||`모듈-${p.moduleId}`,dimensions:{width:(m==null?void 0:m.dimensions.width)||400,height:(m==null?void 0:m.dimensions.height)||400,depth:p.customDepth||(m==null?void 0:m.dimensions.depth)||300}},rotation:p.rotation,slotIndex:p.slotIndex,isDualSlot:p.isDualSlot}})};console.log("🔄 변환된 DXF 데이터:",a);const u=nP(a),h=fP(s,r);return dP(u,h),console.log(`✅ DXF ${r} 도면 내보내기 완료!`),{success:!0,filename:h,message:`DXF ${{front:"정면도",plan:"평면도",side:"측면도"}[r]} 파일이 성공적으로 생성되었습니다.`}}catch(o){return console.error(`❌ DXF ${r} 도면 내보내기 실패:`,o),{success:!1,error:o instanceof Error?o.message:"알 수 없는 오류가 발생했습니다.",message:`DXF ${r} 도면 파일 생성에 실패했습니다.`}}},[]),e=M.useCallback((s,i)=>!(!s||s.width<=0||s.depth<=0),[]),n=M.useCallback((s,i)=>{if(!s)return"공간 정보가 없습니다.";if(s.width<=0||s.depth<=0)return"공간 크기를 설정해주세요.";const r=i.length;return r===0?"공간 도면만 생성됩니다.":`${r}개 가구가 포함된 도면이 생성됩니다.`},[]);return{exportToDXF:t,canExportDXF:e,getExportStatusMessage:n}},gP="_exportPanel_p0xee_1",mP="_header_p0xee_10",_P="_title_p0xee_14",yP="_description_p0xee_24",vP="_drawingTypeSelection_p0xee_32",wP="_selectionTitle_p0xee_36",TP="_drawingTypes_p0xee_43",EP="_drawingTypeItem_p0xee_49",AP="_checkbox_p0xee_71",xP="_drawingTypeInfo_p0xee_78",IP="_drawingTypeIcon_p0xee_85",SP="_drawingTypeText_p0xee_91",bP="_drawingTypeName_p0xee_97",CP="_drawingTypeDescription_p0xee_103",DP="_status_p0xee_108",PP="_statusMessage_p0xee_116",RP="_spaceInfo_p0xee_122",NP="_spaceSize_p0xee_128",MP="_moduleCount_p0xee_133",jP="_actions_p0xee_138",LP="_exportButton_p0xee_142",kP="_disabled_p0xee_160",FP="_icon_p0xee_178",OP="_spinner_p0xee_182",VP="_result_p0xee_196",BP="_success_p0xee_204",UP="_error_p0xee_210",$P="_resultMessage_p0xee_216",HP="_filename_p0xee_221",WP="_info_p0xee_238",XP="_infoItem_p0xee_243",GP="_infoLabel_p0xee_255",zP="_infoValue_p0xee_260",Te={exportPanel:gP,header:mP,title:_P,description:yP,drawingTypeSelection:vP,selectionTitle:wP,drawingTypes:TP,drawingTypeItem:EP,checkbox:AP,drawingTypeInfo:xP,drawingTypeIcon:IP,drawingTypeText:SP,drawingTypeName:bP,drawingTypeDescription:CP,status:DP,statusMessage:PP,spaceInfo:RP,spaceSize:NP,moduleCount:MP,actions:jP,exportButton:LP,disabled:kP,icon:FP,spinner:OP,result:VP,success:BP,error:UP,resultMessage:$P,filename:HP,info:WP,infoItem:XP,infoLabel:GP,infoValue:zP},YP=[{id:"front",name:"정면도",description:"정면에서 본 도면",icon:"📐"},{id:"plan",name:"평면도",description:"위에서 본 도면",icon:"🗺️"},{id:"side",name:"측면도",description:"측면에서 본 도면",icon:"📏"}],qP=()=>{const{spaceInfo:t}=Pt(),e=De(w=>w.placedModules),{exportToDXF:n,canExportDXF:s,getExportStatusMessage:i}=pP(),[r,o]=M.useState(!1),[a,u]=M.useState(["front"]),[h,d]=M.useState(null),p=w=>{u(E=>E.includes(w)?E.filter(C=>C!==w):[...E,w])},m=async()=>{if(!(!t||!s(t,e)||a.length===0)){o(!0),d(null);try{const w=[];for(const A of a){const R=await n(t,e,A);w.push({drawingType:A,result:R})}const E=w.every(A=>A.result.success),C=w.filter(A=>A.result.success).length;d(E?{success:!0,message:`${C}개 도면이 성공적으로 생성되었습니다.`}:{success:!1,message:`${C}/${w.length}개 도면이 생성되었습니다.`}),E&&setTimeout(()=>{d(null)},3e3)}catch{d({success:!1,message:"예상치 못한 오류가 발생했습니다."})}finally{o(!1)}}},y=t&&s(t,e)&&a.length>0,v=t?i(t,e):"공간 정보가 없습니다.";return c.jsxs("div",{className:Te.exportPanel,children:[c.jsxs("div",{className:Te.header,children:[c.jsx("h3",{className:Te.title,children:"📋 도면 내보내기"}),c.jsx("p",{className:Te.description,children:"현재 가구 배치를 CAD 도면(DXF)으로 내보냅니다"})]}),c.jsxs("div",{className:Te.drawingTypeSelection,children:[c.jsx("h4",{className:Te.selectionTitle,children:"내보낼 도면 선택"}),c.jsx("div",{className:Te.drawingTypes,children:YP.map(w=>c.jsxs("label",{className:Te.drawingTypeItem,children:[c.jsx("input",{type:"checkbox",checked:a.includes(w.id),onChange:()=>p(w.id),className:Te.checkbox}),c.jsxs("div",{className:Te.drawingTypeInfo,children:[c.jsx("span",{className:Te.drawingTypeIcon,children:w.icon}),c.jsxs("div",{className:Te.drawingTypeText,children:[c.jsx("span",{className:Te.drawingTypeName,children:w.name}),c.jsx("span",{className:Te.drawingTypeDescription,children:w.description})]})]})]},w.id))})]}),c.jsxs("div",{className:Te.status,children:[c.jsx("div",{className:Te.statusMessage,children:v}),t&&c.jsxs("div",{className:Te.spaceInfo,children:[c.jsxs("span",{className:Te.spaceSize,children:[t.width,"W × ",t.height,"H × ",t.depth,"D mm"]}),c.jsxs("span",{className:Te.moduleCount,children:[e.length,"개 가구"]})]})]}),c.jsx("div",{className:Te.actions,children:c.jsx("button",{className:`${Te.exportButton} ${y?"":Te.disabled}`,onClick:m,disabled:!y||r,children:r?c.jsxs(c.Fragment,{children:[c.jsx("span",{className:Te.spinner}),"내보내는 중..."]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{className:Te.icon,children:"📄"}),"DXF 도면 다운로드 (",a.length,"개)"]})})}),h&&c.jsxs("div",{className:`${Te.result} ${h.success?Te.success:Te.error}`,children:[c.jsxs("div",{className:Te.resultMessage,children:[h.success?"✅":"❌"," ",h.message]}),h.filename&&c.jsxs("div",{className:Te.filename,children:["파일명: ",h.filename]})]}),c.jsxs("div",{className:Te.info,children:[c.jsxs("div",{className:Te.infoItem,children:[c.jsx("span",{className:Te.infoLabel,children:"파일 형식:"}),c.jsx("span",{className:Te.infoValue,children:"DXF (AutoCAD 호환)"})]}),c.jsxs("div",{className:Te.infoItem,children:[c.jsx("span",{className:Te.infoLabel,children:"축척:"}),c.jsx("span",{className:Te.infoValue,children:"1:100"})]}),c.jsxs("div",{className:Te.infoItem,children:[c.jsx("span",{className:Te.infoLabel,children:"단위:"}),c.jsx("span",{className:Te.infoValue,children:"밀리미터(mm)"})]})]})]})},KP="_configurator_3r24j_2",QP="_mainContent_3r24j_12",JP="_sidebarContent_3r24j_20",ZP="_sidebarPanel_3r24j_30",eR="_modulePanelContent_3r24j_38",tR="_modulePanelTitle_3r24j_46",nR="_moduleSection_3r24j_139",sR="_viewerArea_3r24j_145",iR="_viewer_3r24j_145",rR="_viewerDoorToggle_3r24j_161",oR="_viewerDoorButton_3r24j_171",aR="_active_3r24j_189",lR="_rightPanel_3r24j_201",cR="_rightPanelHeader_3r24j_210",uR="_rightPanelTabs_3r24j_215",hR="_rightPanelTab_3r24j_215",dR="_rightPanelContent_3r24j_243",fR="_spaceControls_3r24j_250",pR="_configSection_3r24j_257",gR="_sectionHeader_3r24j_267",mR="_sectionDot_3r24j_274",_R="_sectionTitle_3r24j_282",yR="_inputGroup_3r24j_290",vR="_inputRow_3r24j_299",wR="_inputLabel_3r24j_306",TR="_numberInputGroup_3r24j_313",ER="_decrementButton_3r24j_323",AR="_incrementButton_3r24j_324",xR="_numberInput_3r24j_313",IR="_doorSliderContainer_3r24j_357",SR="_doorSlider_3r24j_357",bR="_sliderLabels_3r24j_393",CR="_sliderLabel_3r24j_393",DR="_slotInfoBox_3r24j_412",PR="_slotInfoText_3r24j_419",RR="_moduleSettings_3r24j_457",NR="_placeholder_3r24j_463",MR="_loadingContainer_3r24j_475",K={configurator:KP,mainContent:QP,sidebarContent:JP,sidebarPanel:ZP,modulePanelContent:eR,modulePanelTitle:tR,moduleSection:nR,viewerArea:sR,viewer:iR,viewerDoorToggle:rR,viewerDoorButton:oR,active:aR,rightPanel:lR,rightPanelHeader:cR,rightPanelTabs:uR,rightPanelTab:hR,rightPanelContent:dR,spaceControls:fR,configSection:pR,sectionHeader:gR,sectionDot:mR,sectionTitle:_R,inputGroup:yR,inputRow:vR,inputLabel:wR,numberInputGroup:TR,decrementButton:ER,incrementButton:AR,numberInput:xR,doorSliderContainer:IR,doorSlider:SR,sliderLabels:bR,sliderLabel:CR,slotInfoBox:DR,slotInfoText:PR,moduleSettings:RR,placeholder:NR,loadingContainer:MR},jR=()=>{const[t]=bm(),e=Il(),[n,s]=M.useState(!1),[i,r]=M.useState(!1),[o,a]=M.useState("idle"),[u,h]=M.useState(null),{setBasicInfo:d,basicInfo:p}=hy(),{setSpaceInfo:m,spaceInfo:y}=Pt(),{setPlacedModules:v,placedModules:w,setAllDoors:E}=De(),C=er(),{updateFurnitureForNewSpace:A}=sC({setPlacedModules:v}),{viewMode:R,setViewMode:N,doorsOpen:k,toggleDoors:j,view2DDirection:I,setView2DDirection:T,showDimensions:_,toggleDimensions:S}=nr(),[D,P]=M.useState("module"),[x,V]=M.useState("placement"),[Y,le]=M.useState(!0),[re,fe]=M.useState("solid"),[Z,te]=M.useState(!0),[Ae,ce]=M.useState(!1),[ie,Rt]=M.useState(y),ne=()=>{if(y.customColumnCount)return y.customColumnCount;if(C.isCalculated&&C.columnCount)return C.columnCount;const pe=(y.width||4800)-100;return Math.max(8,Math.min(15,Math.floor(pe/600)))},ye=w.some(pe=>pe.moduleId.includes("dual-2drawer-styler")||pe.moduleId.includes("dual-4drawer-pantshanger")),We=w.some(pe=>pe.hasDoor),Ye=async pe=>{s(!0);try{const{project:Re,error:gn}=await Ty(pe);if(gn){console.error("프로젝트 로드 에러:",gn),alert("프로젝트를 불러오는데 실패했습니다: "+gn),e("/");return}Re&&(d(Re.projectData),m(Re.spaceConfig),v(Re.furniture.placedModules),h(pe),console.log("✅ 프로젝트 로드 성공:",Re.title),console.log("🎨 로드된 materialConfig:",Re.spaceConfig.materialConfig),console.log("🔄 [프로젝트 로드 후] derivedSpaceStore 강제 재계산"),C.recalculateFromSpaceInfo(Re.spaceConfig))}catch(Re){console.error("프로젝트 로드 실패:",Re),alert("프로젝트 로드 중 오류가 발생했습니다."),e("/")}finally{s(!1)}},J=()=>!0,xe=async()=>{r(!0),a("idle");try{console.log("💾 저장할 spaceInfo:",y),console.log("🎨 저장할 materialConfig:",y.materialConfig);let pe=await Xb();if(pe||(console.log("📸 3D 캔버스 캡처 실패, 기본 썸네일 생성"),pe=Ay(y,w.length)),J()&&u){const{error:Re}=await Ey(u,{title:p.title,projectData:p,spaceConfig:y,furniture:{placedModules:w}},pe);if(Re)console.error("프로젝트 저장 에러:",Re),a("error"),alert("프로젝트 저장에 실패했습니다: "+Re);else{a("success"),console.log("✅ 프로젝트 저장 성공 (썸네일 포함)");try{new BroadcastChannel("project-updates").postMessage({type:"PROJECT_SAVED",projectId:u,timestamp:Date.now()}),console.log("📡 다른 창에 프로젝트 업데이트 알림 전송")}catch(gn){console.warn("BroadcastChannel 전송 실패 (무시 가능):",gn)}setTimeout(()=>a("idle"),3e3)}}else{const Re={id:u||`demo-${Date.now()}`,title:p.title||"데모 프로젝트",projectData:p,spaceConfig:y,furniture:{placedModules:w},thumbnail:pe,savedAt:new Date().toISOString(),furnitureCount:w.length};localStorage.setItem("demoProject",JSON.stringify(Re)),a("success"),console.log("✅ 데모 프로젝트 로컬 저장 성공 (썸네일 포함)"),alert(`데모 프로젝트가 로컬에 저장되었습니다!

썸네일과 함께 저장되어 나중에 확인할 수 있습니다.`),setTimeout(()=>a("idle"),3e3)}}catch(pe){console.error("프로젝트 저장 실패:",pe),a("error"),alert("프로젝트 저장 중 오류가 발생했습니다.")}finally{r(!1)}};M.useEffect(()=>{const pe=t.get("id");pe&&pe!==u&&Ye(pe)},[t]),M.useEffect(()=>{if(JSON.stringify(ie)!==JSON.stringify(y)){const pe={...ie},Re={...y};delete pe.materialConfig,delete Re.materialConfig,JSON.stringify(pe)!==JSON.stringify(Re)&&(console.log("🔄 공간이 변경되었습니다. 가구 재배치 실행 중..."),A(ie,y)),Rt(y)}},[y,ie,A]),M.useEffect(()=>{C.isCalculated||(console.log("🔄 derivedSpaceStore 강제 재계산 (컬럼 수 동기화)"),C.recalculateFromSpaceInfo(y))},[y,C]);const Je=pe=>{P(D===pe?null:pe)},Le=pe=>{m(pe)},lt=()=>{We?E(!1):(E(!0),k&&j())},Dn=()=>{e("/")},pn=()=>{console.log("다음 단계로")},mt=()=>{window.open("/help","_blank")},fi=()=>{console.log("컨버팅")},pi=()=>{e("/login")},Us=()=>{console.log("프로필")},ir=()=>{if(!D)return null;switch(D){case"module":return c.jsx("div",{className:K.sidebarPanel,children:c.jsxs("div",{className:K.modulePanelContent,children:[c.jsx("h3",{className:K.modulePanelTitle,children:"가구 모듈"}),c.jsx("div",{className:K.moduleSection,children:c.jsx(_4,{})})]})});case"material":return c.jsx("div",{className:K.sidebarPanel,children:c.jsx(z3,{})});case"structure":return c.jsx("div",{className:K.sidebarPanel,children:c.jsx("div",{className:K.placeholder,children:"구조물 설정"})});case"etc":return c.jsx("div",{className:K.sidebarPanel,children:c.jsx(qP,{})});default:return null}},ko=()=>{switch(x){case"placement":return c.jsxs("div",{className:K.spaceControls,children:[c.jsxs("div",{className:K.configSection,children:[c.jsxs("div",{className:K.sectionHeader,children:[c.jsx("span",{className:K.sectionDot}),c.jsx("h3",{className:K.sectionTitle,children:"설치 타입"})]}),c.jsx(gy,{spaceInfo:y,onUpdate:Le})]}),c.jsxs("div",{className:K.configSection,children:[c.jsxs("div",{className:K.sectionHeader,children:[c.jsx("span",{className:K.sectionDot}),c.jsx("h3",{className:K.sectionTitle,children:"공간 설정"})]}),c.jsx("div",{className:K.inputGroup,children:c.jsx(fy,{spaceInfo:y,onUpdate:Le,disabled:ye})}),c.jsx("div",{className:K.inputGroup,children:c.jsx(py,{spaceInfo:y,onUpdate:Le})})]}),c.jsxs("div",{className:K.configSection,children:[c.jsxs("div",{className:K.sectionHeader,children:[c.jsx("span",{className:K.sectionDot}),c.jsx("h3",{className:K.sectionTitle,children:"단내림"})]}),c.jsx(Lb,{spaceInfo:y,onUpdate:Le,disabled:ye})]}),c.jsxs("div",{className:K.configSection,children:[c.jsxs("div",{className:K.sectionHeader,children:[c.jsx("span",{className:K.sectionDot}),c.jsx("h3",{className:K.sectionTitle,children:"레이아웃"})]}),c.jsx("div",{className:K.inputGroup,children:c.jsxs("div",{className:K.inputRow,children:[c.jsx("label",{className:K.inputLabel,children:"도어 개수"}),c.jsxs("div",{className:K.numberInputGroup,children:[c.jsx("button",{className:K.decrementButton,onClick:()=>{const pe=ne(),Re=Math.max(8,pe-1);Le({customColumnCount:Re})},children:"−"}),c.jsx("input",{type:"number",min:"8",max:"15",value:ne(),onChange:pe=>{const Re=Math.min(15,Math.max(8,parseInt(pe.target.value)||8));Le({customColumnCount:Re})},className:K.numberInput}),c.jsx("button",{className:K.incrementButton,onClick:()=>{const pe=ne(),Re=Math.min(15,pe+1);Le({customColumnCount:Re})},children:"+"})]})]})}),c.jsxs("div",{className:K.doorSliderContainer,children:[c.jsx("input",{type:"range",min:"8",max:"15",value:ne(),onChange:pe=>{const Re=parseInt(pe.target.value);Le({customColumnCount:Re})},className:K.doorSlider}),c.jsx("div",{className:K.sliderLabels,children:[8,9,10,11,12,13,14,15].map(pe=>c.jsx("span",{className:`${K.sliderLabel} ${ne()===pe?K.active:""}`,children:pe},pe))})]}),c.jsx("div",{className:K.slotInfoBox,children:c.jsxs("p",{className:K.slotInfoText,children:["현 사이즈 기준 슬롯 생성 범위: 최소 8개 ~ 최대 15개",c.jsx("br",{}),"도어 1개 너비: ",Math.floor((y.width||4800)/ne()),"mm"]})})]}),c.jsxs("div",{className:K.configSection,children:[c.jsxs("div",{className:K.sectionHeader,children:[c.jsx("span",{className:K.sectionDot}),c.jsx("h3",{className:K.sectionTitle,children:"바닥 마감재"})]}),c.jsx(Ab,{spaceInfo:y,onUpdate:Le})]}),c.jsxs("div",{className:K.configSection,children:[c.jsxs("div",{className:K.sectionHeader,children:[c.jsx("span",{className:K.sectionDot}),c.jsx("h3",{className:K.sectionTitle,children:"받침대"})]}),c.jsx(Ob,{spaceInfo:y,onUpdate:Le,disabled:ye})]})]});case"module":return c.jsx("div",{className:K.moduleSettings,children:c.jsx("div",{className:K.placeholder,children:"모듈 속성 설정이 여기에 표시됩니다"})});default:return null}};return n?c.jsxs("div",{className:K.loadingContainer,children:[c.jsx(al,{size:"large"}),c.jsx("p",{children:"프로젝트를 불러오는 중..."})]}):c.jsxs("div",{className:K.configurator,children:[c.jsx(vC,{title:p.title||"가구 설계",onSave:xe,onPrevious:Dn,onNext:pn,onHelp:mt,onConvert:fi,onLogout:pi,onProfile:Us,saving:i,saveStatus:o,hasDoorsInstalled:We,onDoorInstallationToggle:lt}),c.jsxs("div",{className:K.mainContent,children:[c.jsx(RC,{activeTab:D,onTabClick:Je,isOpen:!!D}),D&&c.jsx("div",{className:K.sidebarContent,children:ir()}),c.jsxs("div",{className:K.viewerArea,children:[c.jsx(JC,{viewMode:R,onViewModeChange:pe=>N(pe),viewDirection:I,onViewDirectionChange:T,renderMode:re,onRenderModeChange:fe,showAll:Z,onShowAllToggle:()=>te(!Z),showDimensions:_,onShowDimensionsToggle:S,showGuides:Ae,onShowGuidesToggle:()=>ce(!Ae),doorsOpen:k,onDoorsToggle:j}),c.jsxs("div",{className:K.viewer,children:[We&&c.jsxs("div",{className:K.viewerDoorToggle,children:[c.jsx("button",{className:`${K.viewerDoorButton} ${k?"":K.active}`,onClick:()=>!k||j(),children:"Close"}),c.jsx("button",{className:`${K.viewerDoorButton} ${k?K.active:""}`,onClick:()=>k||j(),children:"Open"})]}),c.jsx(r4,{spaceInfo:y,viewMode:R,setViewMode:N,renderMode:re,svgSize:{width:600,height:400}})]})]}),Y&&c.jsxs("div",{className:K.rightPanel,children:[c.jsx("div",{className:K.rightPanelHeader,children:c.jsxs("div",{className:K.rightPanelTabs,children:[c.jsx("button",{className:`${K.rightPanelTab} ${x==="placement"?K.active:""}`,onClick:()=>V("placement"),children:"배치 속성"}),c.jsx("button",{className:`${K.rightPanelTab} ${x==="module"?K.active:""}`,onClick:()=>V("module"),children:"모듈 속성"})]})}),c.jsx("div",{className:K.rightPanelContent,children:ko()})]})]}),c.jsx(M4,{}),c.jsx(u3,{})]})},LR="_card_1qjsu_1",kR="_interactive_1qjsu_14",FR="_selected_1qjsu_24",OR="_imageContainer_1qjsu_30",VR="_image_1qjsu_30",BR="_content_1qjsu_43",UR="_header_1qjsu_47",$R="_title_1qjsu_51",HR="_subtitle_1qjsu_59",WR="_body_1qjsu_65",XR="_footer_1qjsu_71",GR="_clickable_1qjsu_77",Gt={card:LR,default:"_default_1qjsu_10",interactive:kR,selected:FR,imageContainer:OR,image:VR,content:BR,header:UR,title:$R,subtitle:HR,body:WR,footer:XR,clickable:GR},yu=({variant:t="default",title:e,subtitle:n,image:s,aspectRatio:i="1/1",onClick:r,selected:o=!1,className:a="",children:u,footer:h})=>{const d=[Gt.card,Gt[t],o&&Gt.selected,r&&Gt.clickable,a].filter(Boolean).join(" ");return c.jsxs("div",{className:d,onClick:r,role:r?"button":void 0,tabIndex:r?0:void 0,children:[s&&c.jsx("div",{className:Gt.imageContainer,style:{aspectRatio:i},children:c.jsx("img",{src:s,alt:e,className:Gt.image})}),c.jsxs("div",{className:Gt.content,children:[(e||n)&&c.jsxs("div",{className:Gt.header,children:[e&&c.jsx("h3",{className:Gt.title,children:e}),n&&c.jsx("p",{className:Gt.subtitle,children:n})]}),u&&c.jsx("div",{className:Gt.body,children:u}),h&&c.jsx("div",{className:Gt.footer,children:h})]})]})},zR="_container_xvmyl_1",YR="_content_xvmyl_7",qR="_header_xvmyl_12",KR="_title_xvmyl_18",QR="_subtitle_xvmyl_26",JR="_mainCard_xvmyl_33",ZR="_userSection_xvmyl_41",eN="_userInfo_xvmyl_48",tN="_logoutButton_xvmyl_58",nN="_projectsSection_xvmyl_97",sN="_loadingProjects_xvmyl_102",iN="_emptyState_xvmyl_111",rN="_emptyIcon_xvmyl_119",oN="_projectGrid_xvmyl_133",aN="_projectCard_xvmyl_141",lN="_newProjectCard_xvmyl_157",cN="_newProjectContent_xvmyl_172",uN="_newProjectIcon_xvmyl_177",hN="_newProjectText_xvmyl_183",dN="_projectThumbnail_xvmyl_190",fN="_thumbnailPlaceholder_xvmyl_203",pN="_thumbnailImage_xvmyl_213",gN="_editIcon_xvmyl_220",mN="_versionBadge_xvmyl_225",_N="_menuButton_xvmyl_238",yN="_dropdownPortal_xvmyl_277",vN="_deleteMenuItem_xvmyl_316",wN="_projectInfo_xvmyl_322",TN="_projectTitle_xvmyl_327",EN="_projectMeta_xvmyl_336",AN="_projectTime_xvmyl_342",xN="_projectDetailsButton_xvmyl_348",IN="_loginSection_xvmyl_366",SN="_loginButton_xvmyl_380",bN="_buttonGroup_xvmyl_396",CN="_demoButton_xvmyl_403",DN="_featuresGrid_xvmyl_424",PN="_featureCard_xvmyl_430",RN="_featureIcon_xvmyl_435",NN="_loadingScreen_xvmyl_451",ue={container:zR,content:YR,header:qR,title:KR,subtitle:QR,mainCard:JR,userSection:ZR,userInfo:eN,logoutButton:tN,projectsSection:nN,loadingProjects:sN,emptyState:iN,emptyIcon:rN,projectGrid:oN,projectCard:aN,newProjectCard:lN,newProjectContent:cN,newProjectIcon:uN,newProjectText:hN,projectThumbnail:dN,thumbnailPlaceholder:fN,thumbnailImage:pN,editIcon:gN,versionBadge:mN,menuButton:_N,dropdownPortal:yN,deleteMenuItem:vN,projectInfo:wN,projectTitle:TN,projectMeta:EN,projectTime:AN,projectDetailsButton:xN,loginSection:IN,loginButton:SN,buttonGroup:bN,demoButton:CN,featuresGrid:DN,featureCard:PN,featureIcon:RN,loadingScreen:NN},MN=({isOpen:t,onClose:e,position:n,onAction:s})=>{const i=M.useRef(null);return M.useEffect(()=>{const r=o=>{i.current&&!i.current.contains(o.target)&&e()};if(t)return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[t,e]),t?c.jsxs("div",{ref:i,className:ue.dropdownPortal,style:{position:"fixed",top:n.top,left:n.left,zIndex:999999},children:[c.jsx("button",{onClick:()=>s("duplicate"),children:"Duplicate"}),c.jsx("button",{onClick:()=>s("rename"),children:"Rename"}),c.jsx("button",{onClick:()=>s("collaborate"),children:"Collaborate"}),c.jsx("button",{onClick:()=>s("delete"),className:ue.deleteMenuItem,children:"Delete"})]}):null},jN=()=>{const t=Il(),{user:e,loading:n}=uy(),[s,i]=M.useState([]),[r,o]=M.useState(!1),[a,u]=M.useState(!1),[h,d]=M.useState(null),[p,m]=M.useState({top:0,left:0}),y=()=>!0,v=M.useCallback(async()=>{var j,I,T;o(!0);try{if(e&&y()){const{projects:_,error:S}=await Ub();S?(console.error("프로젝트 목록 로드 에러:",S),i([])):i(_)}else{const _=localStorage.getItem("demoProject");if(_){const S=JSON.parse(_),D={id:S.id,title:S.title,updatedAt:S.savedAt,thumbnail:S.thumbnail,furnitureCount:S.furnitureCount||0,spaceSize:{width:((j=S.spaceConfig)==null?void 0:j.width)||0,height:((I=S.spaceConfig)==null?void 0:I.height)||0,depth:((T=S.spaceConfig)==null?void 0:T.depth)||0}};i([D]),console.log("📦 데모 프로젝트 로드됨:",S.title)}else i([])}}catch(_){console.error("프로젝트 목록 로드 실패:",_),i([])}finally{o(!1)}},[e]);M.useEffect(()=>{e&&v()},[e,v]),M.useEffect(()=>{if(!e)return;const j=new BroadcastChannel("project-updates"),I=T=>{T.data.type==="PROJECT_SAVED"&&(console.log("📡 다른 창에서 프로젝트 저장됨, 목록 새로고침:",T.data.projectId),v())};return j.addEventListener("message",I),console.log("📡 프로젝트 업데이트 리스너 등록"),()=>{j.removeEventListener("message",I),j.close(),console.log("📡 프로젝트 업데이트 리스너 해제")}},[e,v]);const w=async()=>{if(!e){t("/auth");return}u(!0);const j=window.open("about:blank","_blank");try{const I=new Date,T=String(I.getFullYear()).slice(-2),_=String(I.getMonth()+1).padStart(2,"0"),S=String(I.getDate()).padStart(2,"0"),D=`가구 ${T}${_}${S}`,{id:P,error:x}=await Vb({title:D,projectData:{title:D,location:""},spaceConfig:dy,furniture:{placedModules:[]}});if(x)console.error("프로젝트 생성 에러:",x),alert("프로젝트 생성에 실패했습니다: "+x),j&&j.close();else if(P){console.log("✅ 새 프로젝트 생성 성공:",P);const V=`/step0?projectId=${P}`;j?j.location.href=V:window.open(V,"_blank")}}catch(I){console.error("프로젝트 생성 실패:",I),alert("프로젝트 생성 중 오류가 발생했습니다."),j&&j.close()}finally{u(!1)}},E=j=>{const I=`/configurator?projectId=${j}`;window.open(I,"_blank")},C=()=>{alert("유료회원 메뉴입니다")},A=(j,I)=>{if(I.stopPropagation(),h===j)d(null);else{const T=I.currentTarget.getBoundingClientRect(),_=140,S=160;let D=T.bottom+4,P=T.right-_;P<0&&(P=T.left),P+_>window.innerWidth&&(P=window.innerWidth-_-8),D+S>window.innerHeight&&(D=T.top-S-4),m({top:D,left:P}),d(j)}},R=async j=>{if(!h)return;const I=s.find(T=>T.id===h);if(I){switch(j){case"duplicate":alert("Duplicate 기능은 아직 구현되지 않았습니다.");break;case"rename":{const T=prompt("새 프로젝트 이름을 입력하세요:",I.title);T&&T.trim()&&alert("Rename 기능은 아직 구현되지 않았습니다.");break}case"collaborate":alert("Collaborate 기능은 아직 구현되지 않았습니다.");break;case"delete":if(window.confirm(`"${I.title}" 프로젝트를 삭제하시겠습니까?`))try{await Bb(I.id),v()}catch(T){console.error("프로젝트 삭제 실패:",T),alert("프로젝트 삭제에 실패했습니다.")}break}d(null)}},N=async()=>{try{const{error:j}=await LI();j?(console.error("로그아웃 에러:",j),alert("로그아웃에 실패했습니다: "+j)):(console.log("✅ 로그아웃 성공"),i([]))}catch(j){console.error("로그아웃 실패:",j),alert("로그아웃 중 오류가 발생했습니다.")}},k=j=>{if(!j)return"날짜 미상";let I;typeof j=="object"&&j!==null&&"seconds"in j&&j.seconds?I=new Date(j.seconds*1e3):j instanceof Date?I=j:typeof j=="string"?I=new Date(j):I=new Date;const _=Math.floor((new Date().getTime()-I.getTime())/(1e3*60*60));return _<1?"방금 전":_<24?`${_}시간 전`:_<24*7?`${Math.floor(_/24)}일 전`:I.toLocaleDateString("ko-KR",{month:"short",day:"numeric"})};return n?c.jsx("div",{className:ue.loadingScreen,children:c.jsx(al,{message:"사용자 정보를 불러오는 중...",size:"large",type:"spinner"})}):c.jsxs("div",{className:ue.container,children:[c.jsxs("div",{className:ue.content,children:[c.jsxs("div",{className:ue.header,children:[c.jsx("h1",{className:ue.title,children:"🏠 가구 설계 도구"}),c.jsx("p",{className:ue.subtitle,children:"직관적인 3D 인터페이스로 맞춤형 가구를 설계하고 관리하세요"})]}),e?c.jsxs("div",{className:ue.mainCard,children:[c.jsxs("div",{className:ue.userSection,children:[c.jsxs("div",{className:ue.userInfo,children:[c.jsxs("h2",{children:["안녕하세요, ",e.displayName||e.email,"님! 👋"]}),c.jsx("p",{children:"새로운 프로젝트를 시작하거나 기존 프로젝트를 계속 작업하세요"})]}),c.jsx("button",{className:ue.logoutButton,onClick:N,title:"로그아웃",children:"로그아웃"})]}),c.jsxs("div",{className:ue.projectsSection,children:[c.jsxs("h3",{children:["내 프로젝트 (",s.length,")"]}),r?c.jsx("div",{className:ue.loadingProjects,children:c.jsx(al,{message:"프로젝트 목록을 불러오는 중...",size:"medium",type:"dots"})}):c.jsxs("div",{className:ue.projectGrid,children:[c.jsx("div",{className:`${ue.projectCard} ${ue.newProjectCard}`,onClick:w,children:c.jsxs("div",{className:ue.newProjectContent,children:[c.jsx("div",{className:ue.newProjectIcon,children:a?"⏳":"+"}),c.jsx("div",{className:ue.newProjectText,children:a?"생성 중...":"New project"})]})}),s.map(j=>c.jsxs("div",{className:ue.projectCard,children:[c.jsxs("div",{className:ue.projectThumbnail,onClick:()=>E(j.id),children:[j.thumbnail?c.jsx("img",{src:j.thumbnail,alt:j.title,className:ue.thumbnailImage}):c.jsx("div",{className:ue.thumbnailPlaceholder,children:c.jsx("div",{className:ue.editIcon,children:"✏️"})}),c.jsx("div",{className:ue.versionBadge,children:"V5.0"}),c.jsx("button",{className:ue.menuButton,onClick:I=>A(j.id,I),children:"⋯"})]}),c.jsxs("div",{className:ue.projectInfo,children:[c.jsx("h4",{className:ue.projectTitle,children:j.title}),c.jsx("div",{className:ue.projectMeta,children:c.jsx("span",{className:ue.projectTime,children:k(j.updatedAt)})})]}),c.jsx("button",{className:ue.projectDetailsButton,onClick:C,children:"도면 보기"})]},j.id))]}),s.length===0&&!r&&c.jsxs("div",{className:ue.emptyState,children:[c.jsx("div",{className:ue.emptyIcon,children:"📁"}),c.jsx("h4",{children:"아직 프로젝트가 없습니다"}),c.jsx("p",{children:"새 프로젝트를 만들어서 가구 설계를 시작해보세요!"})]})]})]}):c.jsx("div",{className:ue.mainCard,children:c.jsxs("div",{className:ue.loginSection,children:[c.jsx("h2",{children:"로그인이 필요합니다"}),c.jsx("p",{children:"프로젝트를 생성하고 관리하려면 먼저 로그인해주세요"}),c.jsxs("div",{className:ue.buttonGroup,children:[c.jsx("button",{className:ue.loginButton,onClick:()=>t("/auth"),children:"로그인하기"}),c.jsx("button",{className:ue.demoButton,onClick:()=>t("/configurator"),children:"🎨 데모 체험하기"})]})]})}),c.jsxs("div",{className:ue.featuresGrid,children:[c.jsx(yu,{children:c.jsxs("div",{className:ue.featureCard,children:[c.jsx("div",{className:ue.featureIcon,children:"🎨"}),c.jsx("h3",{children:"직관적인 설계"}),c.jsx("p",{children:"드래그 앤 드롭으로 쉽게 가구를 배치하고 수정할 수 있습니다"})]})}),c.jsx(yu,{children:c.jsxs("div",{className:ue.featureCard,children:[c.jsx("div",{className:ue.featureIcon,children:"🔄"}),c.jsx("h3",{children:"실시간 3D"}),c.jsx("p",{children:"변경사항이 즉시 3D 뷰에 반영되어 결과를 바로 확인할 수 있습니다"})]})}),c.jsx(yu,{children:c.jsxs("div",{className:ue.featureCard,children:[c.jsx("div",{className:ue.featureIcon,children:"☁️"}),c.jsx("h3",{children:"클라우드 저장"}),c.jsx("p",{children:"프로젝트가 안전하게 클라우드에 저장되어 언제든 접근할 수 있습니다"})]})})]})]}),c.jsx(MN,{isOpen:h!==null,onClose:()=>d(null),position:p,onAction:R})]})},LN="_loginForm_174hp_1",kN="_container_174hp_10",FN="_googleButton_174hp_28",ON="_googleIcon_174hp_54",VN="_divider_174hp_94",BN="_form_174hp_120",UN="_error_174hp_126",$N="_submitButton_174hp_136",HN="_switchMode_174hp_143",WN="_switchButton_174hp_150",yn={loginForm:LN,container:kN,googleButton:FN,googleIcon:ON,divider:VN,form:BN,error:UN,submitButton:$N,switchMode:HN,switchButton:WN},XN=({onSuccess:t})=>{const e=Il(),{user:n,loading:s}=uy(),[i,r]=M.useState(""),[o,a]=M.useState(""),[u,h]=M.useState(""),[d,p]=M.useState(!1),[m,y]=M.useState(!1),[v,w]=M.useState(null);M.useEffect(()=>{if(n&&!s){console.log("✅ 로그인된 상태 감지, 홈페이지로 이동합니다.");const A=setTimeout(()=>{e("/")},1e3);return()=>clearTimeout(A)}},[n,s,e]);const E=async A=>{A.preventDefault(),y(!0),w(null);try{let R;d?R=await jI(i,o,u):R=await NI(i,o),R.error?w(R.error):R.user&&(console.log("✅ 인증 성공:",R.user.email),t==null||t())}catch(R){w("예상치 못한 오류가 발생했습니다."),console.error("인증 에러:",R)}finally{y(!1)}},C=async()=>{y(!0),w(null);try{const A=await MI();A.error?w(A.error):A.user&&(console.log("✅ 구글 로그인 성공:",A.user.email),t==null||t())}catch(A){w("구글 로그인 중 오류가 발생했습니다."),console.error("구글 로그인 에러:",A)}finally{y(!1)}};return c.jsx("div",{className:yn.loginForm,children:c.jsxs("div",{className:yn.container,children:[c.jsx("h2",{children:d?"회원가입":"로그인"}),c.jsxs(zu,{onClick:C,disabled:m,className:yn.googleButton,children:[c.jsx("span",{className:yn.googleIcon,children:"🔍"}),"Google로 ",d?"회원가입":"로그인"]}),c.jsx("div",{className:yn.divider,children:c.jsx("span",{children:"또는"})}),c.jsxs("form",{onSubmit:E,className:yn.form,children:[d&&c.jsx(Va,{type:"text",placeholder:"이름",value:u,onChange:A=>h(A.target.value),required:d}),c.jsx(Va,{type:"email",placeholder:"이메일",value:i,onChange:A=>r(A.target.value),required:!0}),c.jsx(Va,{type:"password",placeholder:"비밀번호",value:o,onChange:A=>a(A.target.value),required:!0}),v&&c.jsx("div",{className:yn.error,children:v}),c.jsx(zu,{type:"submit",disabled:m,className:yn.submitButton,children:m?"처리 중...":d?"회원가입":"로그인"})]}),c.jsxs("div",{className:yn.switchMode,children:[d?"이미 계정이 있으신가요?":"계정이 없으신가요?",c.jsx("button",{type:"button",onClick:()=>p(!d),className:yn.switchButton,children:d?"로그인":"회원가입"})]})]})})};function h1(){const t=document.getElementsByTagName("canvas");for(let e=0;e<t.length;e++){const n=t[e],s=n.getContext("2d");s&&s.clearRect(0,0,n.width,n.height),n.width=1,n.height=1}}function GN(){const t=Cm();return M.useEffect(()=>()=>{setTimeout(()=>{h1()},0)},[t.pathname]),null}function zN(){return c.jsxs(c.Fragment,{children:[c.jsx(GN,{}),c.jsxs(Q1,{children:[c.jsx(hs,{path:"/",element:c.jsx(jN,{})}),c.jsx(hs,{path:"/auth",element:c.jsx(XN,{})}),c.jsx(hs,{path:"/step0",element:c.jsx(Gb,{})}),c.jsx(hs,{path:"/configurator",element:c.jsx(jR,{})}),c.jsx(hs,{path:"/step1",element:c.jsx(Zo,{to:"/configurator",replace:!0})}),c.jsx(hs,{path:"/step2",element:c.jsx(Zo,{to:"/configurator",replace:!0})}),c.jsx(hs,{path:"/step3",element:c.jsx(Zo,{to:"/configurator",replace:!0})}),c.jsx(hs,{path:"*",element:c.jsx(Zo,{to:"/",replace:!0})})]})]})}function YN(){return M.useEffect(()=>{const t=()=>{h1()};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t),t()}},[]),c.jsx(OI,{children:c.jsx(FI,{children:c.jsx(K1,{children:c.jsx(zN,{})})})})}q1.createRoot(document.getElementById("root")).render(c.jsx(YN,{}));
